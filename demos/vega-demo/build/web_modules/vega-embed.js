/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var t9=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r())}}(),n9=Object.prototype.hasOwnProperty;function $y(e,t){return n9.call(e,t)}function Oy(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var r in e)$y(e,r)&&t.push(r);return t}function Bn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function My(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Bo(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function lA(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Dy(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Dy(e[t]))return!0}else if(typeof e=="object"){for(var r=Oy(e),i=r.length,t=0;t<i;t++)if(Dy(e[r[t]]))return!0}}return!1}function uA(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i!="undefined"&&n.push(r+": "+i)}return n.join(`
`)}var cA=function(e){t9(t,e);function t(n,r,i,a,o){var s=this.constructor,l=e.call(this,uA(n,{name:r,index:i,operation:a,tree:o}))||this;return l.name=r,l.index=i,l.operation=a,l.tree=o,Object.setPrototypeOf(l,s.prototype),l.message=uA(n,{name:r,index:i,operation:a,tree:o}),l}return t}(Error),it=cA,r9=Bn,dl={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=hh(n,this.path);r&&(r=Bn(r));var i=qo(n,{op:"remove",path:this.from}).removed;return qo(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=hh(n,this.from);return qo(n,{op:"add",path:this.path,value:Bn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:rc(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},i9={add:function(e,t,n){return My(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:dl.move,copy:dl.copy,test:dl.test,_get:dl._get};function hh(e,t){if(t=="")return e;var n={op:"_get",path:t};return qo(e,n),n.value}function qo(e,t,n,r,i,a){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),a===void 0&&(a=0),n&&(typeof n=="function"?n(t,0,e,t.path):mh(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=hh(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=rc(e,t.value),o.test===!1)throw new it("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new it("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}}else{r||(e=Bn(e));var s=t.path||"",l=s.split("/"),u=e,c=1,f=l.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=mh;;){if(h=l[c],i&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&(d===void 0&&(u[h]===void 0?d=l.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d))),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(n&&!My(h))throw new it("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);My(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>u.length)throw new it("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var o=i9[t.op].call(t,u,h,e);if(o.test===!1)throw new it("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&h.indexOf("~")!=-1&&(h=lA(h)),c>=f){var o=dl[t.op].call(t,u,h,e);if(o.test===!1)throw new it("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}u=u[h]}}}function ph(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new it("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Bn(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=qo(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function a9(e,t,n){var r=qo(e,t);if(r.test===!1)throw new it("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function mh(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new it("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(dl[e.op]){if(typeof e.path!="string")throw new it("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new it('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new it("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new it("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Dy(e.value))throw new it("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new it("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new it("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},s=fA([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new it("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new it("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function fA(e,t,n){try{if(!Array.isArray(e))throw new it("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ph(Bn(t),Bn(e),n||!0);else{n=n||mh;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof it)return i;throw i}}function rc(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,a,o;if(n&&r){if(a=e.length,a!=t.length)return!1;for(i=a;i--!==0;)if(!rc(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var s=Object.keys(e);if(a=s.length,a!==Object.keys(t).length)return!1;for(i=a;i--!==0;)if(!t.hasOwnProperty(s[i]))return!1;for(i=a;i--!==0;)if(o=s[i],!rc(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var o9=Object.freeze({__proto__:null,JsonPatchError:it,deepClone:r9,getValueByPointer:hh,applyOperation:qo,applyPatch:ph,applyReducer:a9,validator:mh,validate:fA,_areEquals:rc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Ny=new WeakMap(),s9=function(){function e(t){this.observers=new Map(),this.obj=t}return e}(),l9=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function u9(e){return Ny.get(e)}function c9(e,t){return e.observers.get(t)}function f9(e,t){e.observers.delete(t.callback)}function d9(e,t){t.unobserve()}function h9(e,t){var n=[],r,i=u9(e);if(!i)i=new s9(e),Ny.set(e,i);else{var a=c9(i,t);r=a&&a.observer}if(r)return r;if(r={},i.value=Bn(e),t){r.callback=t,r.next=null;var o=function(){Ry(r)},s=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return r.patches=n,r.object=e,r.unobserve=function(){Ry(r),clearTimeout(r.next),f9(i,r),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},i.observers.set(t,new l9(t,r)),r}function Ry(e,t){t===void 0&&(t=!1);var n=Ny.get(e.object);Fy(n.value,e.object,e.patches,"",t),e.patches.length&&ph(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Fy(e,t,n,r,i){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=Oy(t),o=Oy(e),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=e[u];if($y(t,u)&&!(t[u]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[u];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?Fy(c,f,n,r+"/"+Bo(u),i):c!==f&&(i&&n.push({op:"test",path:r+"/"+Bo(u),value:Bn(c)}),n.push({op:"replace",path:r+"/"+Bo(u),value:Bn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Bo(u),value:Bn(c)}),n.push({op:"remove",path:r+"/"+Bo(u)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!s&&a.length==o.length)return;for(var l=0;l<a.length;l++){var u=a[l];!$y(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Bo(u),value:Bn(t[u])})}}function p9(e,t,n){n===void 0&&(n=!1);var r=[];return Fy(e,t,r,"",n),r}var m9=Object.freeze({__proto__:null,unobserve:d9,observe:h9,generate:Ry,compare:p9});Object.assign({},o9,m9,{JsonPatchError:cA,deepClone:Bn,escapePathComponent:Bo,unescapePathComponent:lA});var g9=/("(?:[^\\"]|\\.)*")|[:,]/g,Iy=function(t,n){var r,i,a;return n=n||{},r=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),i=r===""?Infinity:n.maxLength===void 0?80:n.maxLength,a=n.replacer,function o(s,l,u){var c,f,d,h,p,m,g,y,v,b,w,x;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),w=JSON.stringify(s,a),w===void 0)return w;if(g=i-l.length-u,w.length<=g&&(v=w.replace(g9,function(E,k){return k||E+" "}),v.length<=g))return v;if(a!=null&&(s=JSON.parse(w),a=void 0),typeof s=="object"&&s!==null){if(y=l+r,d=[],f=0,Array.isArray(s))for(b="[",c="]",g=s.length;f<g;f++)d.push(o(s[f],y,f===g-1?0:1)||"null");else for(b="{",c="}",m=Object.keys(s),g=m.length;f<g;f++)h=m[f],p=JSON.stringify(h)+": ",x=o(s[h],y,p.length+(f===g-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[b,r+d.join(`,
`+y),c].join(`
`+l)}return w}(t,"",0)};function dA(e,t,n){return n={path:t,exports:{},require:function(r,i){return y9(r,i??n.path)}},e(n,n.exports),n.exports}function y9(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const v9="2.0.0",b9=256,w9=Number.MAX_SAFE_INTEGER||9007199254740991,x9=16;var gh={SEMVER_SPEC_VERSION:v9,MAX_LENGTH:b9,MAX_SAFE_INTEGER:w9,MAX_SAFE_COMPONENT_LENGTH:x9};function hA(){throw new Error("setTimeout has not been defined")}function pA(){throw new Error("clearTimeout has not been defined")}var $a=hA,Oa=pA;typeof window.setTimeout=="function"&&($a=setTimeout),typeof window.clearTimeout=="function"&&(Oa=clearTimeout);function mA(e){if($a===setTimeout)return setTimeout(e,0);if(($a===hA||!$a)&&setTimeout)return $a=setTimeout,setTimeout(e,0);try{return $a(e,0)}catch(t){try{return $a.call(null,e,0)}catch(n){return $a.call(this,e,0)}}}function k9(e){if(Oa===clearTimeout)return clearTimeout(e);if((Oa===pA||!Oa)&&clearTimeout)return Oa=clearTimeout,clearTimeout(e);try{return Oa(e)}catch(t){try{return Oa.call(null,e)}catch(n){return Oa.call(this,e)}}}var Hi=[],hl=!1,Ho,yh=-1;function E9(){if(!hl||!Ho)return;hl=!1,Ho.length?Hi=Ho.concat(Hi):yh=-1,Hi.length&&gA()}function gA(){if(hl)return;var e=mA(E9);hl=!0;for(var t=Hi.length;t;){for(Ho=Hi,Hi=[];++yh<t;)Ho&&Ho[yh].run();yh=-1,t=Hi.length}Ho=null,hl=!1,k9(e)}function S9(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Hi.push(new yA(e,t)),Hi.length===1&&!hl&&mA(gA)}function yA(e,t){this.fun=e,this.array=t}yA.prototype.run=function(){this.fun.apply(null,this.array)};var T9="browser",A9="browser",_9=!0,C9=[],$9="",O9={},M9={},D9={};function Wo(){}var N9=Wo,R9=Wo,F9=Wo,I9=Wo,L9=Wo,z9=Wo,P9=Wo;function j9(e){throw new Error("process.binding is not supported")}function U9(){return"/"}function B9(e){throw new Error("process.chdir is not supported")}function q9(){return 0}var pl=window.performance||{},H9=pl.now||pl.mozNow||pl.msNow||pl.oNow||pl.webkitNow||function(){return new Date().getTime()};function W9(e){var t=H9.call(pl)*.001,n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n=n-e[0],r=r-e[1],r<0&&(n--,r+=1e9)),[n,r]}var G9=new Date();function Y9(){var e=new Date(),t=e-G9;return t/1e3}var vh={nextTick:S9,title:T9,browser:_9,env:{NODE_ENV:"production"},argv:C9,version:$9,versions:O9,on:N9,addListener:R9,once:F9,off:I9,removeListener:L9,removeAllListeners:z9,emit:P9,binding:j9,cwd:U9,chdir:B9,umask:q9,hrtime:W9,platform:A9,release:M9,config:D9,uptime:Y9};const V9=typeof vh=="object"&&vh.env&&vh.env.NODE_DEBUG&&/\bsemver\b/i.test(vh.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Re=V9,Ma=dA(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=gh;t=e.exports={};const r=t.re=[],i=t.src=[],a=t.t={};let o=0;const s=(l,u,c)=>{const f=o++;Re(f,u),a[l]=f,i[f]=u,r[f]=new RegExp(u,c?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),s("FULL",`^${i[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),s("LOOSE",`^${i[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),s("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",i[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const X9=["includePrerelease","loose","rtl"],J9=e=>e?typeof e!="object"?{loose:!0}:X9.filter(t=>e[t]).reduce((t,n)=>(t[n]=!0,t),{}):{};var bh=J9;const vA=/^[0-9]+$/,bA=(e,t)=>{const n=vA.test(e),r=vA.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1},K9=(e,t)=>bA(t,e);var Ly={compareIdentifiers:bA,rcompareIdentifiers:K9};const{MAX_LENGTH:wA,MAX_SAFE_INTEGER:wh}=gh,{re:xA,t:kA}=Ma,{compareIdentifiers:ic}=Ly;class Kr{constructor(e,t){if(t=bh(t),e instanceof Kr){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>wA)throw new TypeError(`version is longer than ${wA} characters`);Re("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?xA[kA.LOOSE]:xA[kA.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>wh||this.major<0)throw new TypeError("Invalid major version");if(this.minor>wh||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>wh||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const i=+r;if(i>=0&&i<wh)return i}return r}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Re("SemVer.compare",this.version,this.options,e),!(e instanceof Kr)){if(typeof e=="string"&&e===this.version)return 0;e=new Kr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Kr||(e=new Kr(e,this.options)),ic(this.major,e.major)||ic(this.minor,e.minor)||ic(this.patch,e.patch)}comparePre(e){if(e instanceof Kr||(e=new Kr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(Re("prerelease compare",t,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return ic(n,r)}while(++t)}compareBuild(e){e instanceof Kr||(e=new Kr(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(Re("prerelease compare",t,n,r),n===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(n===void 0)return-1;if(n===r)continue;return ic(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var at=Kr;const{MAX_LENGTH:Q9}=gh,{re:EA,t:SA}=Ma,Z9=(e,t)=>{if(t=bh(t),e instanceof at)return e;if(typeof e!="string")return null;if(e.length>Q9)return null;const n=t.loose?EA[SA.LOOSE]:EA[SA.FULL];if(!n.test(e))return null;try{return new at(e,t)}catch(r){return null}};var Go=Z9;const ej=(e,t)=>{const n=Go(e,t);return n?n.version:null};var tj=ej;const nj=(e,t)=>{const n=Go(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var rj=nj;const ij=(e,t,n,r)=>{typeof n=="string"&&(r=n,n=void 0);try{return new at(e,n).inc(t,r).version}catch(i){return null}};var aj=ij;const oj=(e,t,n)=>new at(e,n).compare(new at(t,n));var qn=oj;const sj=(e,t,n)=>qn(e,t,n)===0;var zy=sj;const lj=(e,t)=>{if(zy(e,t))return null;{const n=Go(e),r=Go(t),i=n.prerelease.length||r.prerelease.length,a=i?"pre":"",o=i?"prerelease":"";for(const s in n)if((s==="major"||s==="minor"||s==="patch")&&n[s]!==r[s])return a+s;return o}};var uj=lj;const cj=(e,t)=>new at(e,t).major;var fj=cj;const dj=(e,t)=>new at(e,t).minor;var hj=dj;const pj=(e,t)=>new at(e,t).patch;var mj=pj;const gj=(e,t)=>{const n=Go(e,t);return n&&n.prerelease.length?n.prerelease:null};var yj=gj;const vj=(e,t,n)=>qn(t,e,n);var bj=vj;const wj=(e,t)=>qn(e,t,!0);var xj=wj;const kj=(e,t,n)=>{const r=new at(e,n),i=new at(t,n);return r.compare(i)||r.compareBuild(i)};var Py=kj;const Ej=(e,t)=>e.sort((n,r)=>Py(n,r,t));var Sj=Ej;const Tj=(e,t)=>e.sort((n,r)=>Py(r,n,t));var Aj=Tj;const _j=(e,t,n)=>qn(e,t,n)>0;var ml=_j;const Cj=(e,t,n)=>qn(e,t,n)<0;var xh=Cj;const $j=(e,t,n)=>qn(e,t,n)!==0;var TA=$j;const Oj=(e,t,n)=>qn(e,t,n)>=0;var jy=Oj;const Mj=(e,t,n)=>qn(e,t,n)<=0;var Uy=Mj;const Dj=(e,t,n,r)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return zy(e,n,r);case"!=":return TA(e,n,r);case">":return ml(e,n,r);case">=":return jy(e,n,r);case"<":return xh(e,n,r);case"<=":return Uy(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};var kh=Dj;const{re:Eh,t:Sh}=Ma,Nj=(e,t)=>{if(e instanceof at)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Eh[Sh.COERCE]);else{let r;for(;(r=Eh[Sh.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||r.index+r[0].length!==n.index+n[0].length)&&(n=r),Eh[Sh.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;Eh[Sh.COERCERTL].lastIndex=-1}return n===null?null:Go(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var Rj=Nj,Fj=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}},Ij=Te;Te.Node=Yo,Te.create=Te;function Te(e){var t=this;if(t instanceof Te||(t=new Te()),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(i){t.push(i)});else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}Te.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Te.prototype.unshiftNode=function(e){if(e===this.head)return;e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++},Te.prototype.pushNode=function(e){if(e===this.tail)return;e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++},Te.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)zj(this,arguments[e]);return this.length},Te.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Pj(this,arguments[e]);return this.length},Te.prototype.pop=function(){if(!this.tail)return;var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e},Te.prototype.shift=function(){if(!this.head)return;var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e},Te.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;n!==null;r++)e.call(t,n.value,r,this),n=n.next},Te.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;n!==null;r--)e.call(t,n.value,r,this),n=n.prev},Te.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value},Te.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value},Te.prototype.map=function(e,t){t=t||this;for(var n=new Te(),r=this.head;r!==null;)n.push(e.call(t,r.value,this)),r=r.next;return n},Te.prototype.mapReverse=function(e,t){t=t||this;for(var n=new Te(),r=this.tail;r!==null;)n.push(e.call(t,r.value,this)),r=r.prev;return n},Te.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else if(this.head)r=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;r!==null;i++)n=e(n,r.value,i),r=r.next;return n},Te.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else if(this.tail)r=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;r!==null;i--)n=e(n,r.value,i),r=r.prev;return n},Te.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e},Te.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e},Te.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Te();if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(;i!==null&&r<t;r++,i=i.next)n.push(i.value);return n},Te.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Te();if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;i!==null&&r>t;r--)i=i.prev;for(;i!==null&&r>e;r--,i=i.prev)n.push(i.value);return n},Te.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(var a=[],r=0;i&&r<t;r++)a.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var r=0;r<n.length;r++)i=Lj(this,i,n[r]);return a},Te.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};function Lj(e,t,n){var r=t===e.head?new Yo(n,null,t,e):new Yo(n,t,t.next,e);return r.next===null&&(e.tail=r),r.prev===null&&(e.head=r),e.length++,r}function zj(e,t){e.tail=new Yo(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Pj(e,t){e.head=new Yo(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Yo(e,t,n,r){if(!(this instanceof Yo))return new Yo(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{Fj(Te)}catch(e){}const Vo=Symbol("max"),Wi=Symbol("length"),gl=Symbol("lengthCalculator"),ac=Symbol("allowStale"),Xo=Symbol("maxAge"),Gi=Symbol("dispose"),AA=Symbol("noDisposeOnSet"),xt=Symbol("lruList"),_r=Symbol("cache"),_A=Symbol("updateAgeOnGet"),By=()=>1;class jj{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");const t=this[Vo]=e.max||Infinity,n=e.length||By;if(this[gl]=typeof n!="function"?By:n,this[ac]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[Xo]=e.maxAge||0,this[Gi]=e.dispose,this[AA]=e.noDisposeOnSet||!1,this[_A]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[Vo]=e||Infinity,oc(this)}get max(){return this[Vo]}set allowStale(e){this[ac]=!!e}get allowStale(){return this[ac]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[Xo]=e,oc(this)}get maxAge(){return this[Xo]}set lengthCalculator(e){typeof e!="function"&&(e=By),e!==this[gl]&&(this[gl]=e,this[Wi]=0,this[xt].forEach(t=>{t.length=this[gl](t.value,t.key),this[Wi]+=t.length})),oc(this)}get lengthCalculator(){return this[gl]}get length(){return this[Wi]}get itemCount(){return this[xt].length}rforEach(e,t){t=t||this;for(let n=this[xt].tail;n!==null;){const r=n.prev;CA(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[xt].head;n!==null;){const r=n.next;CA(this,e,n,t),n=r}}keys(){return this[xt].toArray().map(e=>e.key)}values(){return this[xt].toArray().map(e=>e.value)}reset(){this[Gi]&&this[xt]&&this[xt].length&&this[xt].forEach(e=>this[Gi](e.key,e.value)),this[_r]=new Map(),this[xt]=new Ij(),this[Wi]=0}dump(){return this[xt].map(e=>Th(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[xt]}set(e,t,n){if(n=n||this[Xo],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[gl](t,e);if(this[_r].has(e)){if(i>this[Vo])return yl(this,this[_r].get(e)),!1;const o=this[_r].get(e),s=o.value;return this[Gi]&&(this[AA]||this[Gi](e,s.value)),s.now=r,s.maxAge=n,s.value=t,this[Wi]+=i-s.length,s.length=i,this.get(e),oc(this),!0}const a=new Uj(e,t,i,r,n);return a.length>this[Vo]?(this[Gi]&&this[Gi](e,t),!1):(this[Wi]+=a.length,this[xt].unshift(a),this[_r].set(e,this[xt].head),oc(this),!0)}has(e){if(!this[_r].has(e))return!1;const t=this[_r].get(e).value;return!Th(this,t)}get(e){return qy(this,e,!0)}peek(e){return qy(this,e,!1)}pop(){const e=this[xt].tail;return e?(yl(this,e),e.value):null}del(e){yl(this,this[_r].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(i===0)this.set(r.k,r.v);else{const a=i-t;a>0&&this.set(r.k,r.v,a)}}}prune(){this[_r].forEach((e,t)=>qy(this,t,!1))}}const qy=(e,t,n)=>{const r=e[_r].get(t);if(r){const i=r.value;if(Th(e,i)){if(yl(e,r),!e[ac])return}else n&&(e[_A]&&(r.value.now=Date.now()),e[xt].unshiftNode(r));return i.value}},Th=(e,t)=>{if(!t||!t.maxAge&&!e[Xo])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Xo]&&n>e[Xo]},oc=e=>{if(e[Wi]>e[Vo])for(let t=e[xt].tail;e[Wi]>e[Vo]&&t!==null;){const n=t.prev;yl(e,t),t=n}},yl=(e,t)=>{if(t){const n=t.value;e[Gi]&&e[Gi](n.key,n.value),e[Wi]-=n.length,e[_r].delete(n.key),e[xt].removeNode(t)}};class Uj{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const CA=(e,t,n,r)=>{let i=n.value;Th(e,i)&&(yl(e,n),e[ac]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var Bj=jj;class Ah{constructor(e,t){if(t=bh(t),e instanceof Ah)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Ah(e.raw,t);if(e instanceof Qr)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const n=this.set[0];if(this.set=this.set.filter(r=>!OA(r[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(const r of this.set)if(r.length===1&&Gj(r[0])){this.set=[r];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=Object.keys(this.options).join(","),n=`parseRange:${t}:${e}`,r=$A.get(n);if(r)return r;const i=this.options.loose,a=i?Pt[Dt.HYPHENRANGELOOSE]:Pt[Dt.HYPHENRANGE];e=e.replace(a,n7(this.options.includePrerelease)),Re("hyphen replace",e),e=e.replace(Pt[Dt.COMPARATORTRIM],qj),Re("comparator trim",e,Pt[Dt.COMPARATORTRIM]),e=e.replace(Pt[Dt.TILDETRIM],Hj),e=e.replace(Pt[Dt.CARETTRIM],Wj),e=e.split(/\s+/).join(" ");const o=i?Pt[Dt.COMPARATORLOOSE]:Pt[Dt.COMPARATOR],s=e.split(" ").map(f=>Yj(f,this.options)).join(" ").split(/\s+/).map(f=>t7(f,this.options)).filter(this.options.loose?f=>!!f.match(o):()=>!0).map(f=>new Qr(f,this.options)),l=s.length,u=new Map();for(const f of s){if(OA(f))return[f];u.set(f.value,f)}u.size>1&&u.has("")&&u.delete("");const c=[...u.values()];return $A.set(n,c),c}intersects(e,t){if(!(e instanceof Ah))throw new TypeError("a Range is required");return this.set.some(n=>MA(n,t)&&e.set.some(r=>MA(r,t)&&n.every(i=>r.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new at(e,this.options)}catch(t){return!1}for(let t=0;t<this.set.length;t++)if(r7(this.set[t],e,this.options))return!0;return!1}}var kn=Ah;const $A=new Bj({max:1e3}),{re:Pt,t:Dt,comparatorTrimReplace:qj,tildeTrimReplace:Hj,caretTrimReplace:Wj}=Ma,OA=e=>e.value==="<0.0.0-0",Gj=e=>e.value==="",MA=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every(a=>i.intersects(a,t)),i=r.pop();return n},Yj=(e,t)=>(Re("comp",e,t),e=Jj(e,t),Re("caret",e),e=Vj(e,t),Re("tildes",e),e=Qj(e,t),Re("xrange",e),e=e7(e,t),Re("stars",e),e),nn=e=>!e||e.toLowerCase()==="x"||e==="*",Vj=(e,t)=>e.trim().split(/\s+/).map(n=>Xj(n,t)).join(" "),Xj=(e,t)=>{const n=t.loose?Pt[Dt.TILDELOOSE]:Pt[Dt.TILDE];return e.replace(n,(r,i,a,o,s)=>{Re("tilde",e,r,i,a,o,s);let l;return nn(i)?l="":nn(a)?l=`>=${i}.0.0 <${+i+1}.0.0-0`:nn(o)?l=`>=${i}.${a}.0 <${i}.${+a+1}.0-0`:s?(Re("replaceTilde pr",s),l=`>=${i}.${a}.${o}-${s} <${i}.${+a+1}.0-0`):l=`>=${i}.${a}.${o} <${i}.${+a+1}.0-0`,Re("tilde return",l),l})},Jj=(e,t)=>e.trim().split(/\s+/).map(n=>Kj(n,t)).join(" "),Kj=(e,t)=>{Re("caret",e,t);const n=t.loose?Pt[Dt.CARETLOOSE]:Pt[Dt.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(i,a,o,s,l)=>{Re("caret",e,i,a,o,s,l);let u;return nn(a)?u="":nn(o)?u=`>=${a}.0.0${r} <${+a+1}.0.0-0`:nn(s)?a==="0"?u=`>=${a}.${o}.0${r} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.0${r} <${+a+1}.0.0-0`:l?(Re("replaceCaret pr",l),a==="0"?o==="0"?u=`>=${a}.${o}.${s}-${l} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}-${l} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s}-${l} <${+a+1}.0.0-0`):(Re("no pr"),a==="0"?o==="0"?u=`>=${a}.${o}.${s}${r} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}${r} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s} <${+a+1}.0.0-0`),Re("caret return",u),u})},Qj=(e,t)=>(Re("replaceXRanges",e,t),e.split(/\s+/).map(n=>Zj(n,t)).join(" ")),Zj=(e,t)=>{e=e.trim();const n=t.loose?Pt[Dt.XRANGELOOSE]:Pt[Dt.XRANGE];return e.replace(n,(r,i,a,o,s,l)=>{Re("xRange",e,r,i,a,o,s,l);const u=nn(a),c=u||nn(o),f=c||nn(s),d=f;return i==="="&&d&&(i=""),l=t.includePrerelease?"-0":"",u?i===">"||i==="<"?r="<0.0.0-0":r="*":i&&d?(c&&(o=0),s=0,i===">"?(i=">=",c?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):i==="<="&&(i="<",c?a=+a+1:o=+o+1),i==="<"&&(l="-0"),r=`${i+a}.${o}.${s}${l}`):c?r=`>=${a}.0.0${l} <${+a+1}.0.0-0`:f&&(r=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),Re("xRange return",r),r})},e7=(e,t)=>(Re("replaceStars",e,t),e.trim().replace(Pt[Dt.STAR],"")),t7=(e,t)=>(Re("replaceGTE0",e,t),e.trim().replace(Pt[t.includePrerelease?Dt.GTE0PRE:Dt.GTE0],"")),n7=e=>(t,n,r,i,a,o,s,l,u,c,f,d,h)=>(nn(r)?n="":nn(i)?n=`>=${r}.0.0${e?"-0":""}`:nn(a)?n=`>=${r}.${i}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,nn(u)?l="":nn(c)?l=`<${+u+1}.0.0-0`:nn(f)?l=`<${u}.${+c+1}.0-0`:d?l=`<=${u}.${c}.${f}-${d}`:e?l=`<${u}.${c}.${+f+1}-0`:l=`<=${l}`,`${n} ${l}`.trim()),r7=(e,t,n)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let r=0;r<e.length;r++){if(Re(e[r].semver),e[r].semver===Qr.ANY)continue;if(e[r].semver.prerelease.length>0){const i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}}return!1}return!0},sc=Symbol("SemVer ANY");class Hy{static get ANY(){return sc}constructor(e,t){if(t=bh(t),e instanceof Hy){if(e.loose===!!t.loose)return e;e=e.value}Re("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===sc?this.value="":this.value=this.operator+this.semver.version,Re("comp",this)}parse(e){const t=this.options.loose?DA[NA.COMPARATORLOOSE]:DA[NA.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new at(n[2],this.options.loose):this.semver=sc}toString(){return this.value}test(e){if(Re("Comparator.test",e,this.options.loose),this.semver===sc||e===sc)return!0;if(typeof e=="string")try{e=new at(e,this.options)}catch(t){return!1}return kh(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Hy))throw new TypeError("a Comparator is required");if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new kn(e.value,t).test(this.value);if(e.operator==="")return e.value===""?!0:new kn(this.value,t).test(e.semver);const n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),r=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),i=this.semver.version===e.semver.version,a=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=kh(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),s=kh(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||r||i&&a||o||s}}var Qr=Hy;const{re:DA,t:NA}=Ma,i7=(e,t,n)=>{try{t=new kn(t,n)}catch(r){return!1}return t.test(e)};var Da=i7;const a7=(e,t)=>new kn(e,t).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var o7=a7;const s7=(e,t,n)=>{let r=null,i=null,a=null;try{a=new kn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!r||i.compare(o)===-1)&&(r=o,i=new at(r,n)))}),r};var l7=s7;const u7=(e,t,n)=>{let r=null,i=null,a=null;try{a=new kn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!r||i.compare(o)===1)&&(r=o,i=new at(r,n)))}),r};var c7=u7;const f7=(e,t)=>{e=new kn(e,t);let n=new at("0.0.0");if(e.test(n))return n;if(n=new at("0.0.0-0"),e.test(n))return n;n=null;for(let r=0;r<e.set.length;++r){const i=e.set[r];let a=null;i.forEach(o=>{const s=new at(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!a||ml(s,a))&&(a=s);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),a&&(!n||ml(n,a))&&(n=a)}return n&&e.test(n)?n:null};var d7=f7;const h7=(e,t)=>{try{return new kn(e,t).range||"*"}catch(n){return null}};var p7=h7;const{ANY:m7}=Qr,g7=(e,t,n,r)=>{e=new at(e,r),t=new kn(t,r);let i,a,o,s,l;switch(n){case">":i=ml,a=Uy,o=xh,s=">",l=">=";break;case"<":i=xh,a=jy,o=ml,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Da(e,t,r))return!1;for(let u=0;u<t.set.length;++u){const c=t.set[u];let f=null,d=null;if(c.forEach(h=>{h.semver===m7&&(h=new Qr(">=0.0.0")),f=f||h,d=d||h,i(h.semver,f.semver,r)?f=h:o(h.semver,d.semver,r)&&(d=h)}),f.operator===s||f.operator===l)return!1;if((!d.operator||d.operator===s)&&a(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};var Wy=g7;const y7=(e,t,n)=>Wy(e,t,">",n);var v7=y7;const b7=(e,t,n)=>Wy(e,t,"<",n);var w7=b7;const x7=(e,t,n)=>(e=new kn(e,n),t=new kn(t,n),e.intersects(t));var k7=x7,E7=(e,t,n)=>{const r=[];let i=null,a=null;const o=e.sort((c,f)=>qn(c,f,n));for(const c of o){const f=Da(c,t,n);f?(a=c,i||(i=c)):(a&&r.push([i,a]),a=null,i=null)}i&&r.push([i,null]);const s=[];for(const[c,f]of r)c===f?s.push(c):!f&&c===o[0]?s.push("*"):f?c===o[0]?s.push(`<=${f}`):s.push(`${c} - ${f}`):s.push(`>=${c}`);const l=s.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return l.length<u.length?l:t};const{ANY:Gy}=Qr,S7=(e,t,n={})=>{if(e===t)return!0;e=new kn(e,n),t=new kn(t,n);let r=!1;e:for(const i of e.set){for(const a of t.set){const o=T7(i,a,n);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},T7=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===Gy){if(t.length===1&&t[0].semver===Gy)return!0;n.includePrerelease?e=[new Qr(">=0.0.0-0")]:e=[new Qr(">=0.0.0")]}if(t.length===1&&t[0].semver===Gy){if(n.includePrerelease)return!0;t=[new Qr(">=0.0.0")]}const r=new Set();let i,a;for(const h of e)h.operator===">"||h.operator===">="?i=RA(i,h,n):h.operator==="<"||h.operator==="<="?a=FA(a,h,n):r.add(h.semver);if(r.size>1)return null;let o;if(i&&a){if(o=qn(i.semver,a.semver,n),o>0)return null;if(o===0&&(i.operator!==">="||a.operator!=="<="))return null}for(const h of r){if(i&&!Da(h,String(i),n))return null;if(a&&!Da(h,String(a),n))return null;for(const p of t)if(!Da(h,String(p),n))return!1;return!0}let s,l,u,c,f=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:!1,d=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&a.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const h of t){if(c=c||h.operator===">"||h.operator===">=",u=u||h.operator==="<"||h.operator==="<=",i){if(d&&(h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1)),h.operator===">"||h.operator===">="){if(s=RA(i,h,n),s===h&&s!==i)return!1}else if(i.operator===">="&&!Da(i.semver,String(h),n))return!1}if(a){if(f&&(h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1)),h.operator==="<"||h.operator==="<="){if(l=FA(a,h,n),l===h&&l!==a)return!1}else if(a.operator==="<="&&!Da(a.semver,String(h),n))return!1}if(!h.operator&&(a||i)&&o!==0)return!1}return i&&u&&!a&&o!==0||a&&c&&!i&&o!==0?!1:!(d||f)},RA=(e,t,n)=>{if(!e)return t;const r=qn(e.semver,t.semver,n);return r>0?e:r<0||t.operator===">"&&e.operator===">="?t:e},FA=(e,t,n)=>{if(!e)return t;const r=qn(e.semver,t.semver,n);return r<0?e:r>0||t.operator==="<"&&e.operator==="<="?t:e};var A7=S7,IA={re:Ma.re,src:Ma.src,tokens:Ma.t,SEMVER_SPEC_VERSION:gh.SEMVER_SPEC_VERSION,SemVer:at,compareIdentifiers:Ly.compareIdentifiers,rcompareIdentifiers:Ly.rcompareIdentifiers,parse:Go,valid:tj,clean:rj,inc:aj,diff:uj,major:fj,minor:hj,patch:mj,prerelease:yj,compare:qn,rcompare:bj,compareLoose:xj,compareBuild:Py,sort:Sj,rsort:Aj,gt:ml,lt:xh,eq:zy,neq:TA,gte:jy,lte:Uy,cmp:kh,coerce:Rj,Comparator:Qr,Range:kn,satisfies:Da,toComparators:o7,maxSatisfying:l7,minSatisfying:c7,minVersion:d7,validRange:p7,outside:Wy,gtr:v7,ltr:w7,intersects:k7,simplifyRange:E7,subset:A7};function En(e,t,n){return e.fields=t||[],e.fname=n,e}function tt(e){return e==null?null:e.fname}function jt(e){return e==null?null:e.fields}function LA(e){return e.length===1?_7(e[0]):C7(e)}const _7=e=>function(t){return t[e]},C7=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function L(e){throw Error(e)}function Zr(e){const t=[],n=e.length;let r=null,i=0,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<n;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===r)u(),r=null,i=-1;else{if(r)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,r=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||L("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&L("Access path missing closing bracket: "+e),r&&L("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function Sn(e,t,n){const r=Zr(e);return e=r.length===1?r[0]:e,En((n&&n.get||LA)(r),[e],t||e)}const lc=Sn("id"),Ut=En(e=>e,[],"identity"),Na=En(()=>0,[],"zero"),vl=En(()=>1,[],"one"),or=En(()=>!0,[],"true"),Ra=En(()=>!1,[],"false");function _h(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const zA=0,Yy=1,Vy=2,PA=3,jA=4;function Xy(e,t){let n=e||zA;return{level(r){return arguments.length?(n=+r,this):n},error(){return n>=Yy&&_h(t||"error","ERROR",arguments),this},warn(){return n>=Vy&&_h(t||"warn","WARN",arguments),this},info(){return n>=PA&&_h(t||"log","INFO",arguments),this},debug(){return n>=jA&&_h(t||"log","DEBUG",arguments),this}}}var z=Array.isArray;function Q(e){return e===Object(e)}const UA=e=>e!=="__proto__";function bl(...e){return e.reduce((t,n)=>{for(const r in n)if(r==="signals")t.signals=$7(t.signals,n.signals);else{const i=r==="legend"?{layout:1}:r==="style"?!0:null;uc(t,r,n[r],i)}return t},{})}function uc(e,t,n,r){if(!UA(t))return;let i,a;if(Q(n)&&!z(n)){a=Q(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?uc(a,i,n[i]):UA(i)&&(a[i]=n[i])}else e[t]=n}function $7(e,t){if(e==null)return t;const n={},r=[];function i(a){n[a.name]||(n[a.name]=1,r.push(a))}return t.forEach(i),e.forEach(i),r}function ve(e){return e[e.length-1]}function Bt(e){return e==null||e===""?null:+e}const BA=e=>t=>e*Math.exp(t),qA=e=>t=>Math.log(e*t),HA=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),WA=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Ch=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function $h(e,t,n,r){const i=n(e[0]),a=n(ve(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function GA(e,t){return $h(e,t,Bt,Ut)}function YA(e,t){var n=Math.sign(e[0]);return $h(e,t,qA(n),BA(n))}function VA(e,t,n){return $h(e,t,Ch(n),Ch(1/n))}function XA(e,t,n){return $h(e,t,HA(n),WA(n))}function Oh(e,t,n,r,i){const a=r(e[0]),o=r(ve(e)),s=t!=null?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function Jy(e,t,n){return Oh(e,t,n,Bt,Ut)}function Ky(e,t,n){const r=Math.sign(e[0]);return Oh(e,t,n,qA(r),BA(r))}function Mh(e,t,n,r){return Oh(e,t,n,Ch(r),Ch(1/r))}function Qy(e,t,n,r){return Oh(e,t,n,HA(r),WA(r))}function JA(e){return 1+~~(new Date(e).getMonth()/3)}function KA(e){return 1+~~(new Date(e).getUTCMonth()/3)}function J(e){return e!=null?z(e)?e:[e]:[]}function QA(e,t,n){let r=e[0],i=e[1],a;return i<r&&(a=i,i=r,r=a),a=i-r,a>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-a),r+a]}function le(e){return typeof e=="function"}const O7="descending";function Zy(e,t,n){n=n||{},t=J(t)||[];const r=[],i=[],a={},o=n.comparator||M7;return J(e).forEach((s,l)=>{if(s==null)return;r.push(t[l]===O7?-1:1),i.push(s=le(s)?s:Sn(s,null,n)),(jt(s)||[]).forEach(u=>a[u]=1)}),i.length===0?null:En(o(i,r),Object.keys(a))}const Dh=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,M7=(e,t)=>e.length===1?D7(e[0],t[0]):N7(e,t,e.length),D7=(e,t)=>function(n,r){return Dh(e(n),e(r))*t},N7=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=Dh(a(r),a(i));return o*t[s]});function qt(e){return le(e)?e:()=>e}function ev(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function ue(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function ei(e,t){let n=0,r,i,a,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(a=o=i;n<r;++n)i=e[n],i!=null&&(i<a&&(a=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(a=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<a&&(a=i),i>o&&(o=i))}return[a,o]}function ZA(e,t){const n=e.length;let r=-1,i,a,o,s,l;if(t==null){for(;++r<n;)if(a=e[r],a!=null&&a>=a){i=o=a;break}if(r===n)return[-1,-1];for(s=l=r;++r<n;)a=e[r],a!=null&&(i>a&&(i=a,s=r),o<a&&(o=a,l=r))}else{for(;++r<n;)if(a=t(e[r],r,e),a!=null&&a>=a){i=o=a;break}if(r===n)return[-1,-1];for(s=l=r;++r<n;)a=t(e[r],r,e),a!=null&&(i>a&&(i=a,s=r),o<a&&(o=a,l=r))}return[s,l]}const R7=Object.prototype.hasOwnProperty;function te(e,t){return R7.call(e,t)}const Nh={};function wl(e){let t={},n;function r(a){return te(t,a)&&t[a]!==Nh}const i={size:0,empty:0,object:t,has:r,get(a){return r(a)?t[a]:void 0},set(a,o){return r(a)||(++i.size,t[a]===Nh&&--i.empty),t[a]=o,this},delete(a){return r(a)&&(--i.size,++i.empty,t[a]=Nh),this},clear(){i.size=i.empty=0,i.object=t={}},test(a){return arguments.length?(n=a,i):n},clean(){const a={};let o=0;for(const s in t){const l=t[s];l!==Nh&&(!n||!n(l))&&(a[s]=l,++o)}i.size=o,i.empty=0,i.object=t=a}};return e&&Object.keys(e).forEach(a=>{i.set(a,e[a])}),i}function e_(e,t,n,r,i,a){if(!n&&n!==0)return a;const o=+n;let s=e[0],l=ve(e),u;l<s&&(u=s,s=l,l=u),u=Math.abs(t-s);const c=Math.abs(l-t);return u<c&&u<=o?r:c<=o?i:a}function q(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),ue(r,n)}function xl(e,t,n,r){let i=t[0],a=t[t.length-1],o;return i>a&&(o=i,i=a,a=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=a:e<a)}function Fa(e){return typeof e=="boolean"}function Ia(e){return Object.prototype.toString.call(e)==="[object Date]"}function t_(e){return e&&le(e[Symbol.iterator])}function Le(e){return typeof e=="number"}function n_(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function X(e){return typeof e=="string"}function tv(e,t,n){e&&(e=t?J(e).map(s=>s.replace(/\\(.)/g,"$1")):J(e));const r=e&&e.length,i=n&&n.get||LA,a=s=>i(t?[s]:Zr(s));let o;if(!r)o=function(){return""};else if(r===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<r;)u+="|"+s[c](l);return u}}return En(o,e,"key")}function r_(e,t){const n=e[0],r=ve(e),i=+t;return i?i===1?r:n+i*(r-n):n}const F7=1e4;function i_(e){e=+e||F7;let t,n,r;const i=()=>{t={},n={},r=0},a=(o,s)=>(++r>e&&(n=t,t={},r=1),t[o]=s);return i(),{clear:i,has:o=>te(t,o)||te(n,o),get:o=>te(t,o)?t[o]:te(n,o)?a(o,n[o]):void 0,set:(o,s)=>te(t,o)?t[o]=s:a(o,s)}}function a_(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function cc(e,t){let n="";for(;--t>=0;)n+=e;return n}function o_(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:r==="left"?cc(i,o)+a:r==="center"?cc(i,~~(o/2))+a+cc(i,Math.ceil(o/2)):a+cc(i,o)}function fc(e){return e&&ve(e)-e[0]||0}function H(e){return z(e)?"["+e.map(H)+"]":Q(e)||X(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function nv(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const I7=e=>Le(e)||Ia(e)?e:Date.parse(e);function rv(e,t){return t=t||I7,e==null||e===""?null:t(e)}function iv(e){return e==null||e===""?null:e+""}function kt(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function s_(e,t,n,r){const i=r??"",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:n==="left"?i+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function La(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const a=t(e[i]);a&&n(a,i,e)}}else e.forEach(n)}const L7=/^([A-Za-z]+:)?\/\//,z7=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,P7=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,l_="file://";function j7(e,t){return n=>({options:n||{},sanitize:B7,load:U7,fileAccess:!!t,file:q7(t),http:W7(e)})}async function U7(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function B7(e,t){t=ue({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=z7.test(e.replace(P7,""));(e==null||typeof e!="string"||!s)&&L("Sanitize failure, invalid URI: "+H(e));const l=L7.test(e);return(o=t.baseURL)&&!l&&(!e.startsWith("/")&&o[o.length-1]!=="/"&&(e="/"+e),e=o+e),a=(i=e.startsWith(l_))||t.mode==="file"||t.mode!=="http"&&!l&&n,i?e=e.slice(l_.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function q7(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,a)=>{i?r(i):n(a)})}):H7}async function H7(){L("No file system access.")}function W7(e){return e?async function(t,n){const r=ue({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?le(a[i])?a[i]():a.text():L(a.status+""+a.statusText)}:G7}async function G7(){L("No HTTP fetch method available.")}const Y7=e=>e!=null&&e===e,V7=e=>e==="true"||e==="false"||e===!0||e===!1,X7=e=>!Number.isNaN(Date.parse(e)),u_=e=>!Number.isNaN(+e)&&!(e instanceof Date),J7=e=>u_(e)&&Number.isInteger(+e),av={boolean:nv,integer:Bt,number:Bt,date:rv,string:iv,unknown:Ut},Rh=[V7,J7,u_,X7],K7=["boolean","integer","number","date"];function c_(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=Rh.length,i=Rh.map((a,o)=>o+1);for(let a=0,o=0,s,l;a<n;++a)for(l=t?e[a][t]:e[a],s=0;s<r;++s)if(i[s]&&Y7(l)&&!Rh[s](l)&&(i[s]=0,++o,o===Rh.length))return"string";return K7[i.reduce((a,o)=>a===0?o:a,0)-1]}function f_(e,t){return t.reduce((n,r)=>(n[r]=c_(e,r),n),{})}var d_={},ov={},sv=34,dc=10,lv=13;function h_(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function Q7(e,t){var n=h_(e);return function(r,i){return t(n(r),i,e)}}function p_(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function Tn(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Z7(e){return e<0?"-"+Tn(-e,6):e>9999?"+"+Tn(e,6):Tn(e,4)}function eU(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Z7(e.getUTCFullYear())+"-"+Tn(e.getUTCMonth()+1,2)+"-"+Tn(e.getUTCDate(),2)+(i?"T"+Tn(t,2)+":"+Tn(n,2)+":"+Tn(r,2)+"."+Tn(i,3)+"Z":r?"T"+Tn(t,2)+":"+Tn(n,2)+":"+Tn(r,2)+"Z":n||t?"T"+Tn(t,2)+":"+Tn(n,2)+"Z":"")}function tU(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,d){var h,p,m=i(f,function(g,y){if(h)return h(g,y-1);p=g,h=d?Q7(g,d):h_(g)});return m.columns=p||[],m}function i(f,d){var h=[],p=f.length,m=0,g=0,y,v=p<=0,b=!1;f.charCodeAt(p-1)===dc&&--p,f.charCodeAt(p-1)===lv&&--p;function w(){if(v)return ov;if(b)return b=!1,d_;var E,k=m,S;if(f.charCodeAt(k)===sv){for(;m++<p&&f.charCodeAt(m)!==sv||f.charCodeAt(++m)===sv;);return(E=m)>=p?v=!0:(S=f.charCodeAt(m++))===dc?b=!0:S===lv&&(b=!0,f.charCodeAt(m)===dc&&++m),f.slice(k+1,E-1).replace(/""/g,'"')}for(;m<p;){if((S=f.charCodeAt(E=m++))===dc)b=!0;else if(S===lv)b=!0,f.charCodeAt(m)===dc&&++m;else if(S!==n)continue;return f.slice(k,E)}return v=!0,f.slice(k,p)}for(;(y=w())!==ov;){for(var x=[];y!==d_&&y!==ov;)x.push(y),y=w();if(d&&(x=d(x,g++))==null)continue;h.push(x)}return h}function a(f,d){return f.map(function(h){return d.map(function(p){return c(h[p])}).join(e)})}function o(f,d){return d==null&&(d=p_(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=p_(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?eU(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}function m_(e){const t=function(n,r){const i={delimiter:e};return uv(n,r?ue(r,i):i)};return t.responseType="text",t}function uv(e,t){return t.header&&(e=t.header.map(H).join(t.delimiter)+`
`+e),tU(t.delimiter).parse(e+"")}uv.responseType="text";function nU(e){return typeof Buffer=="function"&&le(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function cv(e,t){const n=t&&t.property?Sn(t.property):Ut;return Q(e)&&!nU(e)?rU(n(e),t):n(JSON.parse(e))}cv.responseType="json";function rU(e,t){return!z(e)&&t_(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}function iU(e){return e}function aU(e){if(e==null)return iU;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=n=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*r+a,f[1]=(n+=s[1])*i+o;u<c;)f[u]=s[u],++u;return f}}function oU(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}function sU(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return g_(e,n)})}:g_(e,t)}function g_(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,a=y_(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:a}:r==null?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function y_(e,t){var n=aU(e.transform),r=e.arcs;function i(c,f){f.length&&f.pop();for(var d=r[c<0?~c:c],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));c<0&&oU(f,p)}function a(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)i(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}function lU(e,t){var n={},r={},i={},a=[],o=-1;t.forEach(function(u,c){var f=e.arcs[u<0?~u:u],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=u,t[c]=d)}),t.forEach(function(u){var c=s(u),f=c[0],d=c[1],h,p;if(h=i[f])if(delete i[h.end],h.push(u),h.end=d,p=r[d]){delete r[p.start];var m=p===h?h:h.concat(p);r[m.start=h.start]=i[m.end=p.end]=m}else r[h.start]=i[h.end]=h;else if(h=r[d])if(delete r[h.start],h.unshift(u),h.start=f,p=i[f]){delete i[p.end];var g=p===h?h:p.concat(h);r[g.start=p.start]=i[g.end=h.end]=g}else r[h.start]=i[h.end]=h;else h=[u],r[h.start=f]=i[h.end=d]=h});function s(u){var c=e.arcs[u<0?~u:u],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],u<0?[d,f]:[f,d]}function l(u,c){for(var f in u){var d=u[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),a.push(d)}}return l(i,r),l(r,i),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function uU(e){return y_(e,cU.apply(this,arguments))}function cU(e,t,n){var r,i,a;if(arguments.length>1)r=fU(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:lU(e,r)}}function fU(e,t,n){var r=[],i=[],a;function o(f){var d=f<0?~f:f;(i[d]||(i[d]=[])).push({i:f,g:a})}function s(f){f.forEach(o)}function l(f){f.forEach(s)}function u(f){f.forEach(l)}function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":u(f.arcs);break}}return c(t),i.forEach(n==null?function(f){r.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&r.push(f[0].i)}),r}const dU={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function v_(e,t){let n,r,i,a;return e=cv(e,t),t&&t.feature?(n=sU,i=t.feature):t&&t.mesh?(n=uU,i=t.mesh,a=dU[t.filter]):L("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):L("Invalid TopoJSON object: "+i),r&&r.features||[r]}v_.responseType="json";const Fh={dsv:uv,csv:m_(","),tsv:m_("	"),json:cv,topojson:v_};function fv(e,t){return arguments.length>1?(Fh[e]=t,this):te(Fh,e)?Fh[e]:null}function b_(e){const t=fv(e);return t&&t.responseType||"text"}var hU=Math.sqrt(50),pU=Math.sqrt(10),mU=Math.sqrt(2);function gU(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=hU?i*=10:a>=pU?i*=5:a>=mU&&(i*=2),t<e?-i:i}function yU(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ih(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function kl(e){return e=Ih(Math.abs(e)),e?e[1]:NaN}function vU(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],l=0;i>0&&s>0&&!(l+s+1>r&&(s=Math.max(1,r-l)),a.push(n.substring(i-=s,i+s)),(l+=s+1)>r);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function bU(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var wU=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hc(e){if(!(t=wU.exec(e)))throw new Error("invalid format: "+e);var t;return new dv({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}hc.prototype=dv.prototype;function dv(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}dv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xU(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var w_;function kU(e,t){var n=Ih(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(w_=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Ih(e,Math.max(0,t+a-1))[0]}function x_(e,t){var n=Ih(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var k_={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:yU,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>x_(e*100,t),r:x_,s:kU,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function E_(e){return e}var S_=Array.prototype.map,T_=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function A_(e){var t=e.grouping===void 0||e.thousands===void 0?E_:vU(S_.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?E_:bU(S_.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=hc(f);var d=f.fill,h=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,v=f.comma,b=f.precision,w=f.trim,x=f.type;x==="n"?(v=!0,x="g"):k_[x]||(b===void 0&&(b=12),w=!0,x="g"),(g||d==="0"&&h==="=")&&(g=!0,d="0",h="=");var E=m==="$"?n:m==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",k=m==="$"?r:/[%p]/.test(x)?o:"",S=k_[x],A=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function C(_){var D=E,M=k,N,T,O;if(x==="c")M=S(_)+M,_="";else{_=+_;var P=_<0||1/_<0;if(_=isNaN(_)?l:S(Math.abs(_),b),w&&(_=xU(_)),P&&+_===0&&p!=="+"&&(P=!1),D=(P?p==="("?p:s:p==="-"||p==="("?"":p)+D,M=(x==="s"?T_[8+w_/3]:"")+M+(P&&p==="("?")":""),A){for(N=-1,T=_.length;++N<T;)if(O=_.charCodeAt(N),48>O||O>57){M=(O===46?i+_.slice(N+1):_.slice(N))+M,_=_.slice(0,N);break}}}v&&!g&&(_=t(_,Infinity));var W=D.length+_.length+M.length,B=W<y?new Array(y-W+1).join(d):"";v&&g&&(_=t(B+_,B.length?y-M.length:Infinity),B="");switch(h){case"<":_=D+_+M+B;break;case"=":_=D+B+_+M;break;case"^":_=B.slice(0,W=B.length>>1)+D+_+M+B.slice(W);break;default:_=B+D+_+M;break}return a(_)}return C.toString=function(){return f+""},C}function c(f,d){var h=u((f=hc(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(kl(d)/3)))*3,m=Math.pow(10,-p),g=T_[8+p/3];return function(y){return h(m*y)+g}}return{format:u,formatPrefix:c}}var Lh,__,C_;EU({thousands:",",grouping:[3],currency:["$",""]});function EU(e){return Lh=A_(e),__=Lh.format,C_=Lh.formatPrefix,Lh}function SU(e){return Math.max(0,-kl(Math.abs(e)))}function TU(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kl(t)/3)))*3-kl(Math.abs(e)))}function AU(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kl(t)-kl(e))+1}var hv=new Date(),pv=new Date();function Et(e,t,n,r){function i(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var o=i(a),s=i.ceil(a);return a-o<s-a?o:s},i.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,s){var l=[],u;if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},i.filter=function(a){return Et(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(i.count=function(a,o){return hv.setTime(+a),pv.setTime(+o),e(hv),e(pv),Math.floor(n(hv,pv))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(r?function(o){return r(o)%a===0}:function(o){return i.count(0,o)%a===0}):i}),i}var zh=Et(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});zh.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Et(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):zh};const pc=1e3,za=pc*60,mc=za*60,mv=mc*24,$_=mv*7;var O_=Et(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*pc)},function(e,t){return(t-e)/pc},function(e){return e.getUTCSeconds()}),_U=Et(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*pc)},function(e,t){e.setTime(+e+t*za)},function(e,t){return(t-e)/za},function(e){return e.getMinutes()}),CU=Et(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*pc-e.getMinutes()*za)},function(e,t){e.setTime(+e+t*mc)},function(e,t){return(t-e)/mc},function(e){return e.getHours()}),Ph=Et(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*za)/mv,e=>e.getDate()-1);function Jo(e){return Et(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*za)/$_})}var M_=Jo(0),ywe=Jo(1),vwe=Jo(2),bwe=Jo(3),wwe=Jo(4),xwe=Jo(5),kwe=Jo(6),D_=Et(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),N_=Et(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});N_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Et(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var $U=Et(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*za)},function(e,t){return(t-e)/za},function(e){return e.getUTCMinutes()}),OU=Et(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*mc)},function(e,t){return(t-e)/mc},function(e){return e.getUTCHours()}),jh=Et(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/mv},function(e){return e.getUTCDate()-1});function Ko(e){return Et(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/$_})}var R_=Ko(0),Ewe=Ko(1),Swe=Ko(2),Twe=Ko(3),Awe=Ko(4),_we=Ko(5),Cwe=Ko(6),F_=Et(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),I_=Et(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});I_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Et(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};function MU(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function DU(e){let t=e,n=e;e.length===1&&(t=(o,s)=>e(o)-s,n=NU(e));function r(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)<0?l=c+1:u=c}return l}function i(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)>0?u=c:l=c+1}return l}function a(o,s,l,u){l==null&&(l=0),u==null&&(u=o.length);const c=r(o,s,l,u-1);return c>l&&t(o[c-1],s)>-t(o[c],s)?c-1:c}return{left:r,center:a,right:i}}function NU(e){return(t,n)=>MU(e(t),n)}var RU=Math.sqrt(50),FU=Math.sqrt(10),IU=Math.sqrt(2);function L_(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=RU?i*=10:a>=FU?i*=5:a>=IU&&(i*=2),t<e?-i:i}const Nt="year",An="quarter",Ht="month",ht="week",_n="date",Wt="day",ti="dayofyear",Hn="hours",Wn="minutes",sr="seconds",Cr="milliseconds",gv=[Nt,An,Ht,ht,_n,Wt,ti,Hn,Wn,sr,Cr],yv=gv.reduce((e,t,n)=>(e[t]=1+n,e),{});function vv(e){const t=J(e).slice(),n={};t.length||L("Missing time unit."),t.forEach(i=>{te(yv,i)?n[i]=1:L("Invalid time unit: ".concat(i,"."))});const r=(n[ht]||n[Wt]?1:0)+(n[An]||n[Ht]||n[_n]?1:0)+(n[ti]?1:0);return r>1&&L("Incompatible time units: ".concat(e)),t.sort((i,a)=>yv[i]-yv[a]),t}const LU={[Nt]:"%Y ",[An]:"Q%q ",[Ht]:"%b ",[_n]:"%d ",[ht]:"W%U ",[Wt]:"%a ",[ti]:"%j ",[Hn]:"%H:00",[Wn]:"00:%M",[sr]:":%S",[Cr]:".%L",["".concat(Nt,"-").concat(Ht)]:"%Y-%m ",["".concat(Nt,"-").concat(Ht,"-").concat(_n)]:"%Y-%m-%d ",["".concat(Hn,"-").concat(Wn)]:"%H:%M"};function z_(e,t){const n=ue({},LU,t),r=vv(e),i=r.length;let a="",o=0,s,l;for(o=0;o<i;)for(s=r.length;s>o;--s)if(l=r.slice(o,s).join("-"),n[l]!=null){a+=n[l],o=s;break}return a.trim()}const Qo=new Date();function bv(e){return Qo.setFullYear(e),Qo.setMonth(0),Qo.setDate(1),Qo.setHours(0,0,0,0),Qo}function P_(e){return U_(new Date(e))}function j_(e){return wv(new Date(e))}function U_(e){return Ph.count(bv(e.getFullYear())-1,e)}function wv(e){return M_.count(bv(e.getFullYear())-1,e)}function xv(e){return bv(e).getDay()}function zU(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function B_(e){return H_(new Date(e))}function q_(e){return kv(new Date(e))}function H_(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return jh.count(t-1,e)}function kv(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return R_.count(t-1,e)}function Ev(e){return Qo.setTime(Date.UTC(e,0,1)),Qo.getUTCDay()}function PU(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(Date.UTC(-1,t,n,r,i,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,r,i,a,o))}function W_(e,t,n,r,i){const a=t||1,o=ve(e),s=(y,v,b)=>(b=b||y,jU(n[b],r[b],y===o&&a,v)),l=new Date(),u=kt(e),c=u[Nt]?s(Nt):qt(2012),f=u[Ht]?s(Ht):u[An]?s(An):Na,d=u[ht]&&u[Wt]?s(Wt,1,ht+Wt):u[ht]?s(ht,1):u[Wt]?s(Wt,1):u[_n]?s(_n,1):u[ti]?s(ti,1):vl,h=u[Hn]?s(Hn):Na,p=u[Wn]?s(Wn):Na,m=u[sr]?s(sr):Na,g=u[Cr]?s(Cr):Na;return function(y){l.setTime(+y);const v=c(l);return i(v,f(l),d(l,v),h(l),p(l),m(l),g(l))}}function jU(e,t,n,r){const i=n<=1?e:r?(a,o)=>r+n*Math.floor((e(a,o)-r)/n):(a,o)=>n*Math.floor(e(a,o)/n);return t?(a,o)=>t(i(a,o),o):i}function El(e,t,n){return t+e*7-(n+6)%7}const UU={[Nt]:e=>e.getFullYear(),[An]:e=>Math.floor(e.getMonth()/3),[Ht]:e=>e.getMonth(),[_n]:e=>e.getDate(),[Hn]:e=>e.getHours(),[Wn]:e=>e.getMinutes(),[sr]:e=>e.getSeconds(),[Cr]:e=>e.getMilliseconds(),[ti]:e=>U_(e),[ht]:e=>wv(e),[ht+Wt]:(e,t)=>El(wv(e),e.getDay(),xv(t)),[Wt]:(e,t)=>El(1,e.getDay(),xv(t))},BU={[An]:e=>3*e,[ht]:(e,t)=>El(e,0,xv(t))};function G_(e,t){return W_(e,t||1,UU,BU,zU)}const qU={[Nt]:e=>e.getUTCFullYear(),[An]:e=>Math.floor(e.getUTCMonth()/3),[Ht]:e=>e.getUTCMonth(),[_n]:e=>e.getUTCDate(),[Hn]:e=>e.getUTCHours(),[Wn]:e=>e.getUTCMinutes(),[sr]:e=>e.getUTCSeconds(),[Cr]:e=>e.getUTCMilliseconds(),[ti]:e=>H_(e),[ht]:e=>kv(e),[Wt]:(e,t)=>El(1,e.getUTCDay(),Ev(t)),[ht+Wt]:(e,t)=>El(kv(e),e.getUTCDay(),Ev(t))},HU={[An]:e=>3*e,[ht]:(e,t)=>El(e,0,Ev(t))};function Y_(e,t){return W_(e,t||1,qU,HU,PU)}const WU={[Nt]:N_,[An]:D_.every(3),[Ht]:D_,[ht]:M_,[_n]:Ph,[Wt]:Ph,[ti]:Ph,[Hn]:CU,[Wn]:_U,[sr]:O_,[Cr]:zh},GU={[Nt]:I_,[An]:F_.every(3),[Ht]:F_,[ht]:R_,[_n]:jh,[Wt]:jh,[ti]:jh,[Hn]:OU,[Wn]:$U,[sr]:O_,[Cr]:zh};function Sl(e){return WU[e]}function Tl(e){return GU[e]}function V_(e,t,n){return e?e.offset(t,n):void 0}function X_(e,t,n){return V_(Sl(e),t,n)}function J_(e,t,n){return V_(Tl(e),t,n)}function K_(e,t,n,r){return e?e.range(t,n,r):void 0}function Q_(e,t,n,r){return K_(Sl(e),t,n,r)}function Z_(e,t,n,r){return K_(Tl(e),t,n,r)}const gc=1e3,yc=gc*60,vc=yc*60,Uh=vc*24,YU=Uh*7,eC=Uh*30,Sv=Uh*365,tC=[Nt,Ht,_n,Hn,Wn,sr,Cr],bc=tC.slice(0,-1),wc=bc.slice(0,-1),xc=wc.slice(0,-1),VU=xc.slice(0,-1),XU=[Nt,ht],nC=[Nt,Ht],rC=[Nt],kc=[[bc,1,gc],[bc,5,5*gc],[bc,15,15*gc],[bc,30,30*gc],[wc,1,yc],[wc,5,5*yc],[wc,15,15*yc],[wc,30,30*yc],[xc,1,vc],[xc,3,3*vc],[xc,6,6*vc],[xc,12,12*vc],[VU,1,Uh],[XU,1,YU],[nC,1,eC],[nC,3,3*eC],[rC,1,Sv]];function iC(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(fc(t))/n;let i=DU(s=>s[2]).right(kc,r),a,o;return i===kc.length?(a=rC,o=L_(t[0]/Sv,t[1]/Sv,n)):i?(i=kc[r/kc[i-1][2]<kc[i][2]/r?i-1:i],a=i[0],o=i[1]):(a=tC,o=Math.max(L_(t[0],t[1],n),1)),{units:a,step:o}}var Tv=new Date(),Av=new Date();function Yi(e,t,n,r){function i(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var o=i(a),s=i.ceil(a);return a-o<s-a?o:s},i.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,s){var l=[],u;if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},i.filter=function(a){return Yi(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(i.count=function(a,o){return Tv.setTime(+a),Av.setTime(+o),e(Tv),e(Av),Math.floor(n(Tv,Av))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(r?function(o){return r(o)%a===0}:function(o){return i.count(0,o)%a===0}):i}),i}const JU=1e3,_v=JU*60,KU=_v*60,Cv=KU*24,aC=Cv*7;var oC=Yi(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_v)/Cv,e=>e.getDate()-1);function Zo(e){return Yi(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*_v)/aC})}var QU=Zo(0),$v=Zo(1),$we=Zo(2),Owe=Zo(3),Ec=Zo(4),Mwe=Zo(5),Dwe=Zo(6),Al=Yi(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Al.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Yi(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var sC=Yi(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Cv},function(e){return e.getUTCDate()-1});function es(e){return Yi(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/aC})}var ZU=es(0),Ov=es(1),Nwe=es(2),Rwe=es(3),Sc=es(4),Fwe=es(5),Iwe=es(6),_l=Yi(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});_l.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Yi(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};function Mv(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Dv(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Tc(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function lC(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=Ac(i),c=_c(i),f=Ac(a),d=_c(a),h=Ac(o),p=_c(o),m=Ac(s),g=_c(s),y=Ac(l),v=_c(l),b={a:P,A:W,b:B,B:se,c:null,d:pC,e:pC,f:kB,g:DB,G:RB,H:bB,I:wB,j:xB,L:mC,m:EB,M:SB,p:me,q:we,Q:xC,s:kC,S:TB,u:AB,U:_B,V:CB,w:$B,W:OB,x:null,X:null,y:MB,Y:NB,Z:FB,"%":wC},w={a:ye,A:Se,b:Ue,B:Pn,c:null,d:yC,e:yC,f:PB,g:XB,G:KB,H:IB,I:LB,j:zB,L:vC,m:jB,M:UB,p:jn,q:zt,Q:xC,s:kC,S:BB,u:qB,U:HB,V:WB,w:GB,W:YB,x:null,X:null,y:VB,Y:JB,Z:QB,"%":wC},x={a:C,A:_,b:D,B:M,c:N,d:dC,e:dC,f:mB,g:fC,G:cC,H:hC,I:hC,j:fB,L:pB,m:cB,M:dB,p:A,q:uB,Q:yB,s:vB,S:hB,u:iB,U:aB,V:oB,w:rB,W:sB,x:T,X:O,y:fC,Y:cC,Z:lB,"%":gB};b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),w.x=E(n,w),w.X=E(r,w),w.c=E(t,w);function E(R,G){return function(K){var $=[],ge=-1,Z=0,Me=R.length,xe,qe,ut;for(K instanceof Date||(K=new Date(+K));++ge<Me;)R.charCodeAt(ge)===37&&($.push(R.slice(Z,ge)),(qe=uC[xe=R.charAt(++ge)])!=null?xe=R.charAt(++ge):qe=xe==="e"?" ":"0",(ut=G[xe])&&(xe=ut(K,qe)),$.push(xe),Z=ge+1);return $.push(R.slice(Z,ge)),$.join("")}}function k(R,G){return function(K){var $=Tc(1900,void 0,1),ge=S($,R,K+="",0),Z,Me;if(ge!=K.length)return null;if("Q"in $)return new Date($.Q);if("s"in $)return new Date($.s*1e3+("L"in $?$.L:0));if(G&&!("Z"in $)&&($.Z=0),"p"in $&&($.H=$.H%12+$.p*12),$.m===void 0&&($.m="q"in $?$.q:0),"V"in $){if($.V<1||$.V>53)return null;"w"in $||($.w=1),"Z"in $?(Z=Dv(Tc($.y,0,1)),Me=Z.getUTCDay(),Z=Me>4||Me===0?Ov.ceil(Z):Ov(Z),Z=sC.offset(Z,($.V-1)*7),$.y=Z.getUTCFullYear(),$.m=Z.getUTCMonth(),$.d=Z.getUTCDate()+($.w+6)%7):(Z=Mv(Tc($.y,0,1)),Me=Z.getDay(),Z=Me>4||Me===0?$v.ceil(Z):$v(Z),Z=oC.offset(Z,($.V-1)*7),$.y=Z.getFullYear(),$.m=Z.getMonth(),$.d=Z.getDate()+($.w+6)%7)}else("W"in $||"U"in $)&&("w"in $||($.w="u"in $?$.u%7:"W"in $?1:0),Me="Z"in $?Dv(Tc($.y,0,1)).getUTCDay():Mv(Tc($.y,0,1)).getDay(),$.m=0,$.d="W"in $?($.w+6)%7+$.W*7-(Me+5)%7:$.w+$.U*7-(Me+6)%7);return"Z"in $?($.H+=$.Z/100|0,$.M+=$.Z%100,Dv($)):Mv($)}}function S(R,G,K,$){for(var ge=0,Z=G.length,Me=K.length,xe,qe;ge<Z;){if($>=Me)return-1;if(xe=G.charCodeAt(ge++),xe===37){if(xe=G.charAt(ge++),qe=x[xe in uC?G.charAt(ge++):xe],!qe||($=qe(R,K,$))<0)return-1}else if(xe!=K.charCodeAt($++))return-1}return $}function A(R,G,K){var $=u.exec(G.slice(K));return $?(R.p=c.get($[0].toLowerCase()),K+$[0].length):-1}function C(R,G,K){var $=h.exec(G.slice(K));return $?(R.w=p.get($[0].toLowerCase()),K+$[0].length):-1}function _(R,G,K){var $=f.exec(G.slice(K));return $?(R.w=d.get($[0].toLowerCase()),K+$[0].length):-1}function D(R,G,K){var $=y.exec(G.slice(K));return $?(R.m=v.get($[0].toLowerCase()),K+$[0].length):-1}function M(R,G,K){var $=m.exec(G.slice(K));return $?(R.m=g.get($[0].toLowerCase()),K+$[0].length):-1}function N(R,G,K){return S(R,t,G,K)}function T(R,G,K){return S(R,n,G,K)}function O(R,G,K){return S(R,r,G,K)}function P(R){return o[R.getDay()]}function W(R){return a[R.getDay()]}function B(R){return l[R.getMonth()]}function se(R){return s[R.getMonth()]}function me(R){return i[+(R.getHours()>=12)]}function we(R){return 1+~~(R.getMonth()/3)}function ye(R){return o[R.getUTCDay()]}function Se(R){return a[R.getUTCDay()]}function Ue(R){return l[R.getUTCMonth()]}function Pn(R){return s[R.getUTCMonth()]}function jn(R){return i[+(R.getUTCHours()>=12)]}function zt(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var G=E(R+="",b);return G.toString=function(){return R},G},parse:function(R){var G=k(R+="",!1);return G.toString=function(){return R},G},utcFormat:function(R){var G=E(R+="",w);return G.toString=function(){return R},G},utcParse:function(R){var G=k(R+="",!0);return G.toString=function(){return R},G}}}var uC={"-":"",_:" ","0":"0"},St=/^\s*\d+/,eB=/^%/,tB=/[\\^$*+?|[\]().{}]/g;function Ae(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function nB(e){return e.replace(tB,"\\$&")}function Ac(e){return new RegExp("^(?:"+e.map(nB).join("|")+")","i")}function _c(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function rB(e,t,n){var r=St.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function iB(e,t,n){var r=St.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function aB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function oB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function sB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function cC(e,t,n){var r=St.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function fC(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function lB(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function uB(e,t,n){var r=St.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function cB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function dC(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function fB(e,t,n){var r=St.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function hC(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function dB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function hB(e,t,n){var r=St.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function pB(e,t,n){var r=St.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function mB(e,t,n){var r=St.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function gB(e,t,n){var r=eB.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function yB(e,t,n){var r=St.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function vB(e,t,n){var r=St.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function pC(e,t){return Ae(e.getDate(),t,2)}function bB(e,t){return Ae(e.getHours(),t,2)}function wB(e,t){return Ae(e.getHours()%12||12,t,2)}function xB(e,t){return Ae(1+oC.count(Al(e),e),t,3)}function mC(e,t){return Ae(e.getMilliseconds(),t,3)}function kB(e,t){return mC(e,t)+"000"}function EB(e,t){return Ae(e.getMonth()+1,t,2)}function SB(e,t){return Ae(e.getMinutes(),t,2)}function TB(e,t){return Ae(e.getSeconds(),t,2)}function AB(e){var t=e.getDay();return t===0?7:t}function _B(e,t){return Ae(QU.count(Al(e)-1,e),t,2)}function gC(e){var t=e.getDay();return t>=4||t===0?Ec(e):Ec.ceil(e)}function CB(e,t){return e=gC(e),Ae(Ec.count(Al(e),e)+(Al(e).getDay()===4),t,2)}function $B(e){return e.getDay()}function OB(e,t){return Ae($v.count(Al(e)-1,e),t,2)}function MB(e,t){return Ae(e.getFullYear()%100,t,2)}function DB(e,t){return e=gC(e),Ae(e.getFullYear()%100,t,2)}function NB(e,t){return Ae(e.getFullYear()%1e4,t,4)}function RB(e,t){var n=e.getDay();return e=n>=4||n===0?Ec(e):Ec.ceil(e),Ae(e.getFullYear()%1e4,t,4)}function FB(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ae(t/60|0,"0",2)+Ae(t%60,"0",2)}function yC(e,t){return Ae(e.getUTCDate(),t,2)}function IB(e,t){return Ae(e.getUTCHours(),t,2)}function LB(e,t){return Ae(e.getUTCHours()%12||12,t,2)}function zB(e,t){return Ae(1+sC.count(_l(e),e),t,3)}function vC(e,t){return Ae(e.getUTCMilliseconds(),t,3)}function PB(e,t){return vC(e,t)+"000"}function jB(e,t){return Ae(e.getUTCMonth()+1,t,2)}function UB(e,t){return Ae(e.getUTCMinutes(),t,2)}function BB(e,t){return Ae(e.getUTCSeconds(),t,2)}function qB(e){var t=e.getUTCDay();return t===0?7:t}function HB(e,t){return Ae(ZU.count(_l(e)-1,e),t,2)}function bC(e){var t=e.getUTCDay();return t>=4||t===0?Sc(e):Sc.ceil(e)}function WB(e,t){return e=bC(e),Ae(Sc.count(_l(e),e)+(_l(e).getUTCDay()===4),t,2)}function GB(e){return e.getUTCDay()}function YB(e,t){return Ae(Ov.count(_l(e)-1,e),t,2)}function VB(e,t){return Ae(e.getUTCFullYear()%100,t,2)}function XB(e,t){return e=bC(e),Ae(e.getUTCFullYear()%100,t,2)}function JB(e,t){return Ae(e.getUTCFullYear()%1e4,t,4)}function KB(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Sc(e):Sc.ceil(e),Ae(e.getUTCFullYear()%1e4,t,4)}function QB(){return"+0000"}function wC(){return"%"}function xC(e){return+e}function kC(e){return Math.floor(+e/1e3)}var Cl,EC,SC,TC,AC;ZB({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ZB(e){return Cl=lC(e),EC=Cl.format,SC=Cl.parse,TC=Cl.utcFormat,AC=Cl.utcParse,Cl}function Cc(e){const t={};return n=>t[n]||(t[n]=e(n))}function eq(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=tq(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if(r[a]!=="0"){++a;break}return r.slice(0,a)+o}}function tq(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function _C(e){const t=Cc(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=hc(r||",");if(i.precision==null){i.precision=12;switch(i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return eq(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,a,o){o=hc(o??",f");const s=gU(r,i,a),l=Math.max(Math.abs(r),Math.abs(i));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=TU(s,l))||(o.precision=u),n(o,l);case"":case"e":case"g":case"p":case"r":{isNaN(u=AU(s,l))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=SU(s))||(o.precision=u-(o.type==="%")*2);break}}return t(o)}}}let Nv;CC();function CC(){return Nv=_C({format:__,formatPrefix:C_})}function $C(e){return _C(A_(e))}function Bh(e){return arguments.length?Nv=$C(e):Nv}function OC(e,t,n){n=n||{},Q(n)||L("Invalid time multi-format specifier: ".concat(n));const r=t(sr),i=t(Wn),a=t(Hn),o=t(_n),s=t(ht),l=t(Ht),u=t(An),c=t(Nt),f=e(n[Cr]||".%L"),d=e(n[sr]||":%S"),h=e(n[Wn]||"%I:%M"),p=e(n[Hn]||"%I %p"),m=e(n[_n]||n[Wt]||"%a %d"),g=e(n[ht]||"%b %d"),y=e(n[Ht]||"%B"),v=e(n[An]||"%B"),b=e(n[Nt]||"%Y");return w=>(r(w)<w?f:i(w)<w?d:a(w)<w?h:o(w)<w?p:l(w)<w?s(w)<w?m:g:c(w)<w?u(w)<w?y:v:b)(w)}function MC(e){const t=Cc(e.format),n=Cc(e.utcFormat);return{timeFormat:r=>X(r)?t(r):OC(t,Sl,r),utcFormat:r=>X(r)?n(r):OC(n,Tl,r),timeParse:Cc(e.parse),utcParse:Cc(e.utcParse)}}let Rv;DC();function DC(){return Rv=MC({format:EC,parse:SC,utcFormat:TC,utcParse:AC})}function NC(e){return MC(lC(e))}function $c(e){return arguments.length?Rv=NC(e):Rv}const Fv=(e,t)=>ue({},e,t);function RC(e,t){const n=e?$C(e):Bh(),r=t?NC(t):$c();return Fv(n,r)}function Iv(e,t){const n=arguments.length;return n&&n!==2&&L("defaultLocale expects either zero or two arguments."),n?Fv(Bh(e),$c(t)):Fv(Bh(),$c())}function nq(){return CC(),DC(),Iv()}function FC(e,t,n,r){t=t||{};const i=fv(t.type||"json");return i||L("Unknown data format type: "+t.type),e=i(e,t),t.parse&&rq(e,t.parse,n,r),te(e,"columns")&&delete e.columns,e}function rq(e,t,n,r){if(!e.length)return;const i=$c();n=n||i.timeParse,r=r||i.utcParse;let a=e.columns||Object.keys(e[0]),o,s,l,u,c,f;t==="auto"&&(t=f_(e,a)),a=Object.keys(t);const d=a.map(h=>{const p=t[h];let m,g;if(p&&(p.startsWith("date:")||p.startsWith("utc:"))){m=p.split(/:(.+)?/,2),g=m[1],(g[0]==="'"&&g[g.length-1]==="'"||g[0]==='"'&&g[g.length-1]==='"')&&(g=g.slice(1,-1));const y=m[0]==="utc"?r:n;return y(g)}if(!av[p])throw Error("Illegal format pattern: "+h+":"+p);return av[p]});for(l=0,c=e.length,f=a.length;l<c;++l)for(o=e[l],u=0;u<f;++u)s=a[u],o[s]=d[u](o[s])}const qh=j7(typeof fetch!="undefined"&&fetch,null);function Hh(e){const t=e||Ut,n=[],r={};return n.add=i=>{const a=t(i);return r[a]||(r[a]=1,n.push(i)),n},n.remove=i=>{const a=t(i);if(r[a]){r[a]=0;const o=n.indexOf(i);o>=0&&n.splice(o,1)}return n},n}async function Wh(e,t){try{await t(e)}catch(n){e.error(n)}}const IC=Symbol("vega_id");let iq=1;function Gh(e){return!!(e&&ne(e))}function ne(e){return e[IC]}function LC(e,t){return e[IC]=t,e}function Oe(e){const t=e===Object(e)?e:{data:e};return ne(t)?t:LC(t,iq++)}function Lv(e){return Yh(e,Oe({}))}function Yh(e,t){for(const n in e)t[n]=e[n];return t}function zC(e,t){return LC(t,ne(e))}function ts(e,t){return e?t?(n,r)=>e(n,r)||ne(t(n))-ne(t(r)):(n,r)=>e(n,r)||ne(n)-ne(r):null}function PC(e){return e&&e.constructor===ns}function ns(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:ns,insert(s){const l=J(s),u=l.length;for(let c=0;c<u;++c)e.push(l[c]);return this},remove(s){const l=le(s)?r:t,u=J(s),c=u.length;for(let f=0;f<c;++f)l.push(u[f]);return this},modify(s,l,u){const c={field:l,value:qt(u)};return le(s)?(c.filter=s,i.push(c)):(c.tuple=s,n.push(c)),this},encode(s,l){return le(s)?i.push({filter:s,field:l}):n.push({tuple:s,field:l}),this},clean(s){return a=s,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let f,d,h,p,m,g;for(f=0,d=l.length;f<d;++f)u[ne(l[f])]=1;for(f=0,d=t.length;f<d;++f)m=t[f],u[ne(m)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],l.forEach(v=>{p(v)&&(u[ne(v)]=-1)});for(f=0,d=e.length;f<d;++f)m=e[f],g=ne(m),u[g]?u[g]=1:s.add.push(Oe(e[f]));for(f=0,d=l.length;f<d;++f)m=l[f],u[ne(m)]<0&&s.rem.push(m);function y(v,b,w){w?v[b]=w(v):s.encode=b,o||(c[ne(v)]=v)}for(f=0,d=n.length;f<d;++f)h=n[f],m=h.tuple,p=h.field,g=u[ne(m)],g>0&&(y(m,p,h.value),s.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,l.forEach(v=>{p(v)&&u[ne(v)]>0&&y(v,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=t.length||r.length?l.filter(v=>u[ne(v)]>0):l.slice();else for(g in c)s.mod.push(c[g]);return(a||a==null&&(t.length||r.length))&&s.clean(!0),s}}}const Vh="_:mod:_";function Xh(){Object.defineProperty(this,Vh,{writable:!0,value:{}})}Xh.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[Vh];return t!=null&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=z(n)?1+n.length:-1),i},modified(e,t){const n=this[Vh];if(arguments.length){if(z(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}}else{for(const r in n)if(n[r])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Vh]={},this}};let aq=0;const oq="pulse",sq=new Xh(),lq=1,uq=2;function Be(e,t,n,r){this.id=++aq,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function jC(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Be.prototype={targets(){return this._targets||(this._targets=Hh(lc))},set(e){return this.value!==e?(this.value=e,1):0},skip:jC(lq),modified:jC(uq),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new Xh(),i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(f,d,h)=>{h instanceof Be?(h!==this&&(t&&h.targets().add(this),a.push(h)),i.push({op:h,name:f,index:d})):r.set(f,d,h)};for(o in e)if(s=e[o],o===oq)J(s).forEach(f=>{f instanceof Be?f!==this&&(f.targets().add(this),a.push(f)):L("Pulse parameters must be operator instances.")}),this.source=s;else if(z(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||sq,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function cq(e,t,n,r){let i=1,a;return e instanceof Be?a=e:e&&e.prototype instanceof Be?a=new e():le(e)?a=new Be(null,e):(i=0,a=new Be(e,t)),this.rank(a),i&&(r=n,n=t),n&&this.connect(a,a.parameters(n,r)),this.touch(a),a}function fq(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}let dq=0;function Jh(e,t,n){this.id=++dq,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Pa(e,t,n){return new Jh(e,t,n)}Jh.prototype={_filter:or,_apply:Ut,targets(){return this._targets||(this._targets=Hh(lc))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Pa(e);return this.targets().add(t),t},apply(e){const t=Pa(null,e);return this.targets().add(t),t},merge(){const e=Pa();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Pa();return this.targets().add(Pa(null,null,ev(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(Pa(null,null,()=>n=!0)),t.targets().add(Pa(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=or,this._targets=null}};function hq(e,t,n,r){const i=this,a=Pa(n,r),o=function(u){u.dataflow=i;try{a.receive(u)}catch(c){i.error(c)}finally{i.run()}};let s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=J(e);const l=s.length;for(let u=0;u<l;++u)s[u].addEventListener(t,o);return a}function pq(e,t){const n=this.locale();return FC(e,t,n.timeParse,n.utcParse)}function mq(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function gq(e,t){const n=this;let r=0,i;try{i=await n.loader().load(e,{context:"dataflow",response:b_(t&&t.type)});try{i=n.parse(i,t)}catch(a){r=-2,n.warn("Data ingestion failed",e,a)}}catch(a){r=-1,n.warn("Loading failed",e,a)}return{data:i,status:r}}async function yq(e,t,n){const r=this,i=r._pending||vq(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(or).insert(a.data||[])),i.done(),a}function vq(e){let t;const n=new Promise(r=>t=r);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const bq={skip:!0};function wq(e,t,n,r,i){const a=e instanceof Be?kq:xq;return a(this,e,t,n,r,i),this}function xq(e,t,n,r,i,a){const o=ue({},a,bq);let s,l;le(n)||(n=qt(n)),r===void 0?s=u=>e.touch(n(u)):le(r)?(l=new Be(null,r,i,!1),s=u=>{l.evaluate(u);const c=n(u),f=l.value;PC(f)?e.pulse(c,f,a):e.update(c,f,o)}):s=u=>e.update(n(u),r,o),t.apply(s)}function kq(e,t,n,r,i,a){if(r===void 0)t.targets().add(n);else{const o=a||{},s=new Be(null,Eq(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function Eq(e,t){return t=le(t)?t:qt(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}function Sq(e){e.rank=++this._rank}function Tq(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&L("Cycle detected in dataflow graph.")}const Kh={},ni=1<<0,ja=1<<1,Vi=1<<2,Aq=ni|ja,UC=ni|Vi,$l=ni|ja|Vi,BC=1<<3,Oc=1<<4,qC=1<<5,HC=1<<6;function Ua(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function zv(e,t){const n=[];return La(e,t,r=>n.push(r)),n}function WC(e,t){const n={};return e.visit(t,r=>{n[ne(r)]=1}),r=>n[ne(r)]?null:r}function Qh(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}Ua.prototype={StopPropagation:Kh,ADD:ni,REM:ja,MOD:Vi,ADD_REM:Aq,ADD_MOD:UC,ALL:$l,REFLOW:BC,SOURCE:Oc,NO_SOURCE:qC,NO_FIELDS:HC,fork(e){return new Ua(this.dataflow).init(this,e)},clone(){const e=this.fork($l);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize($l|Oc)},addAll(){let e=this;const t=!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length;return t||(e=new Ua(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&HC)&&(n.fields=e.fields),t&ni?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&ja?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Vi?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&qC?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||$l;return t&ni&&this.add.length||t&ja&&this.rem.length||t&Vi&&this.mod.length},reflow(e){if(e)return this.fork($l).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Vi,WC(this,ni))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return z(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?z(e)?e.some(r=>n[r]):n[e]:!!n:!1},filter(e,t){const n=this;return e&ni&&(n.addF=Qh(n.addF,t)),e&ja&&(n.remF=Qh(n.remF,t)),e&Vi&&(n.modF=Qh(n.modF,t)),e&Oc&&(n.srcF=Qh(n.srcF,t)),n},materialize(e){e=e||$l;const t=this;return e&ni&&t.addF&&(t.add=zv(t.add,t.addF),t.addF=null),e&ja&&t.remF&&(t.rem=zv(t.rem,t.remF),t.remF=null),e&Vi&&t.modF&&(t.mod=zv(t.mod,t.modF),t.modF=null),e&Oc&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(e&Oc)return La(n.source,n.srcF,r),n;e&ni&&La(n.add,n.addF,r),e&ja&&La(n.rem,n.remF,r),e&Vi&&La(n.mod,n.modF,r);const i=n.source;if(e&BC&&i){const a=n.add.length+n.mod.length;a===i.length||(a?La(i,WC(n,UC),r):La(i,n.srcF,r))}return n}};function Pv(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let s=0;s<a;++s){const l=n[s];if(l.stamp!==t)continue;if(l.fields){const u=i.fields||(i.fields={});for(const c in l.fields)u[c]=1}l.changed(i.ADD)&&(o|=i.ADD),l.changed(i.REM)&&(o|=i.REM),l.changed(i.MOD)&&(o|=i.MOD)}this.changes=o}q(Pv,Ua,{fork(e){const t=new Ua(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?z(e)?e.some(r=>n[r]):n[e]:0},filter(){L("MultiPulse does not support filtering.")},materialize(){L("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});async function _q(e,t,n){const r=this,i=[];if(r._pulse)return GC(r);if(r._pending&&await r._pending,t&&await Wh(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new Ua(r,a,e),r._touched.forEach(c=>r._enqueue(c,!0)),r._touched=Hh(lc);let o=0,s,l,u;try{for(;r._heap.size()>0;){if(s=r._heap.pop(),s.rank!==s.qrank){r._enqueue(s,!0);continue}l=s.run(r._getPulse(s,e)),l.then?l=await l:l.async&&(i.push(l.async),l=Kh),l!==Kh&&(s._targets&&s._targets.forEach(c=>r._enqueue(c))),++o}}catch(c){r._heap.clear(),u=c}if(r._input={},r._pulse=null,r.debug(`Pulse ${a}: ${o} operators`),u&&(r._postrun=[],r.error(u)),r._postrun.length){const c=r._postrun.sort((f,d)=>d.priority-f.priority);r._postrun=[];for(let f=0;f<c.length;++f)await Wh(r,c[f].callback)}return n&&await Wh(r,n),i.length&&Promise.all(i).then(c=>r.runAsync(null,()=>{c.forEach(f=>{try{f(r)}catch(d){r.error(d)}})})),r}async function Cq(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running}function $q(e,t,n){return this._pulse?GC(this):(this.evaluate(e,t,n),this)}function Oq(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}}function GC(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function Mq(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function Dq(e,t){const n=e.source,r=this._clock;return n&&z(n)?new Pv(this,r,n.map(i=>i.pulse),t):this._input[e.id]||Nq(this._pulse,n&&n.pulse)}function Nq(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Kh&&(e.source=t.source),e)}const jv={skip:!1,force:!1};function Rq(e,t){const n=t||jv;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function Fq(e,t,n){const r=n||jv;return(e.set(t)||r.force)&&this.touch(e,r),this}function Iq(e,t,n){this.touch(e,n||jv);const r=new Ua(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this}function Lq(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),YC(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,zq(t,0,e)):r=n,r}}}function YC(e,t,n,r){let i,a;const o=e[n];for(;n>t;){if(a=n-1>>1,i=e[a],r(o,i)<0){e[n]=i,n=a;continue}break}return e[n]=o}function zq(e,t,n){const r=t,i=e.length,a=e[t];let o=(t<<1)+1,s;for(;o<i;)s=o+1,s<i&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=a,YC(e,r,t,n)}function Ol(){this.logger(Xy()),this.logLevel(Yy),this._clock=0,this._rank=0,this._locale=Iv();try{this._loader=qh()}catch(e){}this._touched=Hh(lc),this._input={},this._pulse=null,this._heap=Lq((e,t)=>e.qrank-t.qrank),this._postrun=[]}function Mc(e){return function(){return this._log[e].apply(this,arguments)}}Ol.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Mc("error"),warn:Mc("warn"),info:Mc("info"),debug:Mc("debug"),logLevel:Mc("level"),cleanThreshold:1e4,add:cq,connect:fq,rank:Sq,rerank:Tq,pulse:Iq,touch:Rq,update:Fq,changeset:ns,ingest:mq,parse:pq,preload:yq,request:gq,events:hq,on:wq,evaluate:_q,run:$q,runAsync:Cq,runAfter:Oq,_enqueue:Mq,_getPulse:Dq};function F(e,t){Be.call(this,e,null,t)}q(F,Be,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Ml={};function VC(e){const t=XC(e);return t&&t.Definition||null}function XC(e){return e=e&&e.toLowerCase(),te(Ml,e)?Ml[e]:null}function Uv(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Pq(e){return e===null?NaN:+e}function*jq(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}function Uq(e,t){let n=0,r,i=0,a=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(r=o-i,i+=r/++n,a+=r*(o-i));else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&(s=+s)>=s&&(r=s-i,i+=r/++n,a+=r*(s-i))}if(n>1)return a/(n-1)}function Bq(e,t){const n=Uq(e,t);return n&&Math.sqrt(n)}function JC(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function KC(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function QC(e,t,n=0,r=e.length-1,i=Uv){for(;r>n;){if(r-n>600){const l=r-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(r,Math.floor(t+(l-u)*f/l+d));QC(e,t,h,p,i)}const a=e[t];let o=n,s=r;for(Dc(e,n,t),i(e[r],a)>0&&Dc(e,n,r);o<s;){for(Dc(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}i(e[n],a)===0?Dc(e,n,s):(++s,Dc(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Dc(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Bv(e,t,n){if(e=Float64Array.from(jq(e,n)),!(r=e.length))return;if((t=+t)<=0||r<2)return KC(e);if(t>=1)return JC(e);var r,i=(r-1)*t,a=Math.floor(i),o=JC(QC(e,a).subarray(0,a+1)),s=KC(e.subarray(a+1));return o+(s-o)*(i-a)}function qq(e,t,n=Pq){if(!(r=e.length))return;if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(i-a)}function Hq(e,t){return Bv(e,.5,t)}function*ZC(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),r!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function qv(e,t,n){const r=Float64Array.from(ZC(e,n));return r.sort(Uv),t.map(i=>qq(r,i))}function Hv(e,t){return qv(e,[.25,.5,.75],t)}function Wv(e,t){const n=e.length,r=Bq(e,t),i=Hv(e,t),a=(i[2]-i[0])/1.34,o=Math.min(r,a)||r||Math.abs(i[0])||1;return 1.06*o*Math.pow(n,-.2)}function e$(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a=e.extent[0],o=e.extent[1],s,l,u,c,f,d;const h=e.span||o-a||Math.abs(a)||1;if(e.step)s=e.step;else if(e.steps){for(c=h/t,f=0,d=e.steps.length;f<d&&e.steps[f]<c;++f);s=e.steps[Math.max(0,f-1)]}else{for(l=Math.ceil(Math.log(t)/r),u=e.minstep||0,s=Math.max(u,Math.pow(n,Math.round(Math.log(h)/r)-l));Math.ceil(h/s)>t;)s*=n;for(f=0,d=i.length;f<d;++f)c=s/i[f],c>=u&&h/c<=t&&(s=c)}c=Math.log(s);const p=c>=0?0:~~(-c/r)+1,m=Math.pow(n,-p-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(a/s+m)*s,a=a<c?c-s:c,o=Math.ceil(o/s)*s),{start:a,stop:o===a?a+s:o,step:s}}var lr=Math.random;function Wq(e){lr=e}function t$(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(ZC(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(lr()*a)];c[u]=s/a}return c.sort(Uv),[Bv(c,n/2),Bv(c,1-n/2)]}function n$(e,t,n,r){r=r||(d=>d);const i=e.length,a=new Float64Array(i);let o=0,s=1,l=r(e[0]),u=l,c=l+t,f;for(;s<i;++s){if(f=r(e[s]),f>=c){for(u=(l+u)/2;o<s;++o)a[o]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;o<s;++o)a[o]=u;return n?Gq(a,t+t/4):a}function Gq(e,t){const n=e.length;let r=0,i=1,a,o;for(;e[r]===e[i];)++i;for(;i<n;){for(a=i+1;e[i]===e[a];)++a;if(e[i]-e[i-1]<t){for(o=i+(r+a-i-i>>1);o<i;)e[o++]=e[i];for(;o>i;)e[o--]=e[r]}r=i,i=a}return e}function Yq(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function Vq(e,t){t==null&&(t=e,e=0);let n,r,i;const a={min(o){return arguments.length?(n=o||0,i=r-n,a):n},max(o){return arguments.length?(r=o||0,i=r-n,a):r},sample(){return n+Math.floor(i*lr())},pdf(o){return o===Math.floor(o)&&o>=n&&o<r?1/i:0},cdf(o){const s=Math.floor(o);return s<n?0:s>=r?1:(s-n+1)/i},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*i):NaN}};return a.min(e).max(t)}const r$=Math.sqrt(2*Math.PI),Xq=Math.SQRT2;let Nc=NaN;function Zh(e,t){e=e||0,t=t??1;let n=0,r=0,i,a;if(Nc===Nc)n=Nc,Nc=NaN;else{do n=lr()*2-1,r=lr()*2-1,i=n*n+r*r;while(i===0||i>1);a=Math.sqrt(-2*Math.log(i)/i),n*=a,Nc=r*a}return e+n*t}function Gv(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*r$)}function ep(e,t,n){t=t||0,n=n??1;const r=(e-t)/n,i=Math.abs(r);let a;if(i>37)a=0;else{const o=Math.exp(-i*i/2);let s;i<7.07106781186547?(s=.0352624965998911*i+.700383064443688,s=s*i+6.37396220353165,s=s*i+33.912866078383,s=s*i+112.079291497871,s=s*i+221.213596169931,s=s*i+220.206867912376,a=o*s,s=.0883883476483184*i+1.75566716318264,s=s*i+16.064177579207,s=s*i+86.7807322029461,s=s*i+296.564248779674,s=s*i+637.333633378831,s=s*i+793.826512519948,s=s*i+440.413735824752,a=a/s):(s=i+.65,s=i+4/s,s=i+3/s,s=i+2/s,s=i+1/s,a=o/s/2.506628274631)}return r>0?1-a:a}function tp(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*Xq*Jq(2*e-1)}function Jq(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=Infinity,n*e}function Yv(e,t){let n,r;const i={mean(a){return arguments.length?(n=a||0,i):n},stdev(a){return arguments.length?(r=a??1,i):r},sample:()=>Zh(n,r),pdf:a=>Gv(a,n,r),cdf:a=>ep(a,n,r),icdf:a=>tp(a,n,r)};return i.mean(e).stdev(t)}function Vv(e,t){const n=Yv();let r=0;const i={data(a){return arguments.length?(e=a,r=a?a.length:0,i.bandwidth(t)):e},bandwidth(a){return arguments.length?(t=a,!t&&e&&(t=Wv(e)),i):t},sample(){return e[~~(lr()*r)]+t*n.sample()},pdf(a){let o=0,s=0;for(;s<r;++s)o+=n.pdf((a-e[s])/t);return o/t/r},cdf(a){let o=0,s=0;for(;s<r;++s)o+=n.cdf((a-e[s])/t);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Xv(e,t){return e=e||0,t=t??1,Math.exp(e+Zh()*t)}function Jv(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*r$*e)}function Kv(e,t,n){return ep(Math.log(e),t,n)}function Qv(e,t,n){return Math.exp(tp(e,t,n))}function i$(e,t){let n,r;const i={mean(a){return arguments.length?(n=a||0,i):n},stdev(a){return arguments.length?(r=a??1,i):r},sample:()=>Xv(n,r),pdf:a=>Jv(a,n,r),cdf:a=>Kv(a,n,r),icdf:a=>Qv(a,n,r)};return i.mean(e).stdev(t)}function a$(e,t){let n=0,r;function i(o){const s=[];let l=0,u;for(u=0;u<n;++u)l+=s[u]=o[u]==null?1:+o[u];for(u=0;u<n;++u)s[u]/=l;return s}const a={weights(o){return arguments.length?(r=i(t=o||[]),a):t},distributions(o){return arguments.length?(o?(n=o.length,e=o):(n=0,e=[]),a.weights(t)):e},sample(){const o=lr();let s=e[n-1],l=r[0],u=0;for(;u<n-1;l+=r[++u])if(o<l){s=e[u];break}return s.sample()},pdf(o){let s=0,l=0;for(;l<n;++l)s+=r[l]*e[l].pdf(o);return s},cdf(o){let s=0,l=0;for(;l<n;++l)s+=r[l]*e[l].cdf(o);return s},icdf(){throw Error("Mixture icdf not supported.")}};return a.distributions(e).weights(t)}function Zv(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*lr()}function eb(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function tb(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nb(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function o$(e,t){let n,r;const i={min(a){return arguments.length?(n=a||0,i):n},max(a){return arguments.length?(r=a??1,i):r},sample:()=>Zv(n,r),pdf:a=>eb(a,n,r),cdf:a=>tb(a,n,r),icdf:a=>nb(a,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function Rc(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i,o=t-a*e;return[o,a]}function np(e,t,n,r){e=e.filter(h=>{let p=t(h),m=n(h);return p!=null&&(p=+p)>=p&&m!=null&&(m=+m)>=m}),r&&e.sort((h,p)=>t(h)-t(p));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s=0,l=0,u=0,c,f,d;for(d of e)a[s]=c=+t(d),o[s]=f=+n(d),++s,l+=(c-l)/s,u+=(f-u)/s;for(s=0;s<i;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function Fc(e,t,n,r){let i=-1,a,o;for(const s of e)a=t(s),o=n(s),a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o&&r(a,o,++i)}function Dl(e,t,n,r,i){let a=0,o=0;return Fc(e,t,n,(s,l)=>{const u=l-i(s),c=l-r;a+=u*u,o+=c*c}),1-a/o}function rb(e,t,n){let r=0,i=0,a=0,o=0,s=0;Fc(e,t,n,(c,f)=>{++s,r+=(c-r)/s,i+=(f-i)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=Rc(r,i,a,o),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:Dl(e,t,n,i,u)}}function s$(e,t,n){let r=0,i=0,a=0,o=0,s=0;Fc(e,t,n,(c,f)=>{++s,c=Math.log(c),r+=(c-r)/s,i+=(f-i)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=Rc(r,i,a,o),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:Dl(e,t,n,i,u)}}function l$(e,t,n){const[r,i,a,o]=np(e,t,n);let s=0,l=0,u=0,c=0,f=0,d,h,p;Fc(e,t,n,(v,b)=>{d=r[f++],h=Math.log(b),p=d*b,s+=(b*h-s)/f,l+=(p-l)/f,u+=(p*h-u)/f,c+=(d*p-c)/f});const[m,g]=Rc(l/o,s/o,u/o,c/o),y=v=>Math.exp(m+g*(v-a));return{coef:[Math.exp(m-g*a),g],predict:y,rSquared:Dl(e,t,n,o,y)}}function u$(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;Fc(e,t,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++l,r+=(h-r)/l,i+=(p-i)/l,a+=(h*p-a)/l,o+=(h*h-o)/l,s+=(d-s)/l});const u=Rc(r,i,a,o),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Dl(e,t,n,s,c)}}function ib(e,t,n){const[r,i,a,o]=np(e,t,n),s=r.length;let l=0,u=0,c=0,f=0,d=0,h,p,m,g;for(h=0;h<s;)p=r[h],m=i[h++],g=p*p,l+=(g-l)/h,u+=(g*p-u)/h,c+=(g*g-c)/h,f+=(p*m-f)/h,d+=(g*m-d)/h;const y=c-l*l,v=l*y-u*u,b=(d*l-f*u)/v,w=(f*y-d*u)/v,x=-b*l,E=k=>(k=k-a,b*k*k+w*k+x+o);return{coef:[x-w*a+b*a*a+o,w-2*b*a,b],predict:E,rSquared:Dl(e,t,n,o,E)}}function c$(e,t,n,r){if(r===1)return rb(e,t,n);if(r===2)return ib(e,t,n);const[i,a,o,s]=np(e,t,n),l=i.length,u=[],c=[],f=r+1;let d,h,p,m,g;for(d=0;d<f;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*a[p];for(u.push(m),g=new Float64Array(f),h=0;h<f;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+h);g[h]=m}c.push(g)}c.push(u);const y=Qq(c),v=b=>{b-=o;let w=s+y[0]+y[1]*b+y[2]*b*b;for(d=3;d<f;++d)w+=y[d]*Math.pow(b,d);return w};return{coef:Kq(f,y,-o,s),predict:v,rSquared:Dl(e,t,n,s,v)}}function Kq(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function Qq(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}const f$=2,d$=1e-12;function h$(e,t,n,r){const[i,a,o,s]=np(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let h=-1;++h<=f$;){const p=[0,u-1];for(let g=0;g<l;++g){const y=i[g],v=p[0],b=p[1],w=y-i[v]>i[b]-y?v:b;let x=0,E=0,k=0,S=0,A=0;const C=1/Math.abs(i[w]-y||1);for(let M=v;M<=b;++M){const N=i[M],T=a[M],O=Zq(Math.abs(y-N)*C)*d[M],P=N*O;x+=O,E+=P,k+=T*O,S+=T*P,A+=N*P}const[_,D]=Rc(E/x,k/x,S/x,A/x);c[g]=_+D*y,f[g]=Math.abs(a[g]-c[g]),eH(i,g+1,p)}if(h===f$)break;const m=Hq(f);if(Math.abs(m)<d$)break;for(let g=0,y,v;g<l;++g)y=f[g]/(6*m),d[g]=y>=1?d$:(v=1-y*y)*v}return tH(i,c,o,s)}function Zq(e){return(e=1-e*e*e)*e*e}function eH(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(a>=e.length)return;for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}function tH(e,t,n,r){const i=e.length,a=[];let o=0,s=0,l=[],u;for(;o<i;++o)u=e[o]+n,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=r,l=[u,t[o]],a.push(l));return l[1]+=r,a}const nH=.1*Math.PI/180;function rp(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=h=>[h,e(h)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let h=1;h<r;++h)u.push(i(a+h/n*s));return u.push(i(o)),u}else{c.push(i(o));for(let h=n;--h>0;)c.push(i(a+h/n*s))}let f=u[0],d=c[c.length-1];for(;d;){const h=i((f[0]+d[0])/2);h[0]-f[0]>=l&&rH(f,h,d)>nH?c.push(h):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function rH(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function p$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function iH(e){let t=e,n=e;e.length===1&&(t=(o,s)=>e(o)-s,n=aH(e));function r(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)<0?l=c+1:u=c}return l}function i(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)>0?u=c:l=c+1}return l}function a(o,s,l,u){l==null&&(l=0),u==null&&(u=o.length);const c=r(o,s,l,u-1);return c>l&&t(o[c-1],s)>-t(o[c],s)?c-1:c}return{left:r,center:a,right:i}}function aH(e){return(t,n)=>p$(e(t),n)}function*oH(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}function ab(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function ob(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function m$(e,t,n=0,r=e.length-1,i=p$){for(;r>n;){if(r-n>600){const l=r-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(r,Math.floor(t+(l-u)*f/l+d));m$(e,t,h,p,i)}const a=e[t];let o=n,s=r;for(Ic(e,n,t),i(e[r],a)>0&&Ic(e,n,r);o<s;){for(Ic(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}i(e[n],a)===0?Ic(e,n,s):(++s,Ic(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Ic(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function sH(e,t,n){if(e=Float64Array.from(oH(e,n)),!(r=e.length))return;if((t=+t)<=0||r<2)return ob(e);if(t>=1)return ab(e);var r,i=(r-1)*t,a=Math.floor(i),o=ab(m$(e,a).subarray(0,a+1)),s=ob(e.subarray(a+1));return o+(s-o)*(i-a)}function lH(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n}function uH(e,t){return sH(e,.5,t)}function g$(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);++r<i;)a[r]=e+r*n;return a}function cH(e){return t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}}function sb(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:cH(e)}function y$(e,t,n){return n||e+(t?"_"+t:"")}const lb=()=>{},fH={init:lb,add:lb,rem:lb,idx:0},Lc={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},zc=Object.keys(Lc);function dH(e,t){return n=>ue({name:e,out:n||e},fH,t)}zc.forEach(e=>{Lc[e]=dH(e,Lc[e])});function v$(e,t){return Lc[e](t)}function b$(e,t){return e.idx-t.idx}function hH(e){const t={};e.forEach(r=>t[r.name]=r);const n=r=>{if(!r.req)return;r.req.forEach(i=>{t[i]||n(t[i]=Lc[i]())})};return e.forEach(n),Object.values(t).sort(b$)}function pH(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function mH(e,t){if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid,this._ops.forEach(n=>n.add(this,e,t))}function gH(e,t){if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid,this._ops.forEach(n=>n.rem(this,e,t))}function yH(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function w$(e,t){const n=t||Ut,r=hH(e),i=e.slice().sort(b$);function a(o){this._ops=r,this._out=i,this.cell=o,this.init()}return a.prototype.init=pH,a.prototype.add=mH,a.prototype.rem=gH,a.prototype.set=yH,a.prototype.get=n,a.fields=e.map(o=>o.out),a}function ub(e){this._key=e?Sn(e):ne,this.reset()}const Rt=ub.prototype;Rt.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Rt.add=function(e){this._add.push(e)},Rt.rem=function(e){this._rem.push(e)},Rt.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},Rt.distinct=function(e){const t=this.values(),n={};let r=t.length,i=0,a;for(;--r>=0;)a=e(t[r])+"",te(n,a)||(n[a]=1,++i);return i},Rt.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=ZA(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Rt.argmin=function(e){return this.extent(e)[0]||{}},Rt.argmax=function(e){return this.extent(e)[1]||{}},Rt.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0},Rt.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0},Rt.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Hv(this.values(),e),this._get=e),this._q},Rt.q1=function(e){return this.quartile(e)[0]},Rt.q2=function(e){return this.quartile(e)[1]},Rt.q3=function(e){return this.quartile(e)[2]},Rt.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=t$(this.values(),1e3,.05,e),this._get=e),this._ci},Rt.ci0=function(e){return this.ci(e)[0]},Rt.ci1=function(e){return this.ci(e)[1]};function Ba(e){F.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Ba.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:zc},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},q(Ba,F,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function a(s){let l,u,c,f;for(l in s)for(c=s[l].tuple,u=0;u<i;++u)r[u][f=c[n[u]]]=f}a(e._prev),a(t);function o(s,l,u){const c=n[u],f=r[u++];for(const d in f){const h=s?s+"|"+d:d;l[c]=f[d],u<i?o(h,l,u):t[h]||e.cell(h,l)}}o("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(g){const y=J(jt(g)),v=y.length;let b=0,w;for(;b<v;++b)r[w=y[b]]||(r[w]=1,t.push(w))}this._dims=J(e.groupby),this._dnames=this._dims.map(g=>{const y=tt(g);return i(g),n.push(y),y}),this.cellkey=e.key?e.key:sb(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,f,d,h,p,m;for(l!==o.length&&L("Unmatched number of fields and aggregate ops."),m=0;m<l;++m){if(c=a[m],f=o[m],c==null&&f!=="count"&&L("Null aggregate field specified."),h=tt(c),p=y$(f,h,s[m]),n.push(p),f==="count"){this._counts.push(p);continue}d=u[h],d||(i(c),d=u[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(v$(f,p))}return this._measures=this._measures.map(g=>w$(g,g.field)),{}},cellkey:sb(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let a=0;a<i;++a)n.agg[a]=new r[a](n)}return n.store&&(n.data=new ub()),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let o=0;o<i;++o)a[n[o]]=r[o](e);return t?zC(t.tuple,a):Oe(a)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,a=r.length;i<a;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,a=r.length;i<a;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,f;if(r)for(u in r)l=r[u],(!i||l.num)&&o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(l.num===0&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const vH=1e-14;function cb(e){F.call(this,null,e)}cb.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},q(cb,F,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return e.modified()?(t=t.reflow(!0),u=t.SOURCE):u=t.modified(jt(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?c=>{const f=r(c);c[s]=f,c[l]=f==null?null:i+a*(1+(f-i)/a)}:c=>c[s]=r(c)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=e$(e),r=n.step;let i=n.start,a=i+Math.ceil((n.stop-i)/r)*r,o,s;(o=e.anchor)!=null&&(s=o-(i+r*Math.floor((o-i)/r)),i+=s,a+=s);const l=function(u){let c=Bt(t(u));return c==null?null:c<i?-Infinity:c>a?Infinity:(c=Math.max(i,Math.min(c,a-r)),i+r*Math.floor(vH+(c-i)/r))};return l.start=i,l.stop=n.stop,l.step=r,this.value=En(l,jt(t),e.name||"bin_"+tt(t))}});function x$(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:l=>a.push(l),remove:l=>o[r(l)]=++s,size:()=>i.length,data:(l,u)=>(s&&(i=i.filter(c=>!o[r(c)]),o={},s=0),u&&l&&i.sort(l),a.length&&(i=l?a_(l,i,a.sort(l)):i.concat(a),a=[]),i)}}function fb(e){F.call(this,[],e)}fb.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},q(fb,F,{transform(e,t){const n=t.fork(t.ALL),r=x$(ne,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(ts(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function k$(e){Be.call(this,null,bH,e)}q(k$,Be);function bH(e){return this.value&&!e.modified()?this.value:Zy(e.fields,e.orders)}function db(e){F.call(this,null,e)}db.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function wH(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}q(db,F,{transform(e,t){const n=f=>d=>{for(var h=wH(s(d),e.case,a)||[],p,m=0,g=h.length;m<g;++m)o.test(p=h[m])||f(p)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(f=>i[f]=1+(i[f]||0)),c=n(f=>i[f]-=1);return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=Oe({}),l[i]=s,l[a]=u,o.add.push(l)):u===0?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}});function hb(e){F.call(this,null,e)}hb.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},q(hb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=xH(s,i,a,e.filter||or)):n.mod=s,n.source=this.value,n.modifies(r)}});function xH(e,t,n,r){for(var i=[],a={},o=e.length,s=0,l,u;s<o;++s)for(a[t]=u=e[s],l=0;l<o;++l)a[n]=e[l],r(a)&&(i.push(Oe(a)),a={},a[t]=u);return i}const E$={kde:Vv,mixture:a$,normal:Yv,lognormal:i$,uniform:o$},kH="distributions",S$="function",EH="field";function T$(e,t){const n=e[S$];te(E$,n)||L("Unknown distribution function: "+n);const r=E$[n]();for(const i in e)i===EH?r.data((e.from||t()).map(e[i])):i===kH?r[i](e[i].map(a=>T$(a,t))):typeof r[i]===S$&&r[i](e[i]);return r}function pb(e){F.call(this,null,e)}const A$=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],SH={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:A$},{name:"weights",type:"number",array:!0}]};pb.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:A$.concat(SH)},{name:"as",type:"string",array:!0,default:["value","density"]}]},q(pb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=T$(e.distribution,TH(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&L("Invalid density method: "+o),!e.extent&&!r.data&&L("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=e.extent||ei(r.data()),u=rp(o,l,i,a).map(c=>{const f={};return f[s[0]]=c[0],f[s[1]]=c[1],Oe(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});function TH(e){return()=>e.materialize(e.SOURCE).source}function _$(e,t){return e?e.map((n,r)=>t[r]||tt(n)):null}function mb(e,t,n){const r=[],i=f=>f(l);let a,o,s,l,u,c;if(t==null)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}const C$="bin";function gb(e){F.call(this,null,e)}gb.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:C$}]};const AH=(e,t)=>fc(ei(e,t))/30;q(gb,F,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,r=mb(t.source,e.groupby,Ut),i=e.smooth||!1,a=e.field,o=e.step||AH(n,a),s=ts((p,m)=>a(p)-a(m)),l=e.as||C$,u=r.length;let c=Infinity,f=-Infinity,d=0,h;for(;d<u;++d){const p=r[d].sort(s);h=-1;for(const m of n$(p,o,i,a))m<c&&(c=m),m>f&&(f=m),p[++h][l]=m}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(l)}});function $$(e){Be.call(this,null,_H,e),this.modified(!0)}q($$,Be);function _H(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:En(n=>t(n,e),jt(t),tt(t))}function yb(e){F.call(this,[void 0,void 0],e)}yb.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},q(yb,F,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||a==null)&&(a=Infinity,o=-Infinity),t.visit(i?t.SOURCE:t.ADD,s=>{const l=Bt(r(s));l!=null&&(l<a&&(a=l),l>o&&(o=l))}),!Number.isFinite(a)||!Number.isFinite(o)){let s=tt(r);s&&(s=` for field "${s}"`),t.dataflow.warn(`Infinite extent${s}: [${a}, ${o}]`),a=o=void 0}this.value=[a,o]}});function vb(e,t){Be.call(this,e),this.parent=t,this.count=0}q(vb,Be,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function ip(e){F.call(this,{},e),this._keys=wl();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}q(ip,F,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a=te(i,e)&&i[e],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=r||(s=this._group[e])&&s.tuple,o=n.dataflow,a=new vb(n.fork(n.NO_SOURCE),this),o.add(a).connect(t(o,e,s)),i[e]=a,this.activate(a)),a},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=l=>this.subflow(l,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=ne(l),c=a.get(u);c!==void 0&&(a.delete(u),s(c).rem(l))}),t.visit(t.ADD,l=>{const u=r(l);a.set(ne(l),u),s(u).add(l)}),o||t.modified(r.fields)?t.visit(t.MOD,l=>{const u=ne(l),c=a.get(u),f=r(l);c===f?s(f).mod(l):(a.set(u,f),s(c).rem(l),s(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{s(a.get(ne(l))).mod(l)}),o&&t.visit(t.REFLOW,l=>{const u=ne(l),c=a.get(u),f=r(l);c!==f&&(a.set(u,f),s(c).rem(l),s(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}});function O$(e){Be.call(this,null,CH,e)}q(O$,Be);function CH(e){return this.value&&!e.modified()?this.value:z(e.name)?J(e.name).map(t=>Sn(t)):Sn(e.name,e.as)}function bb(e){F.call(this,wl(),e)}bb.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},q(bb,F,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;t.visit(t.REM,f=>{const d=ne(f);r.has(d)?r.delete(d):o.push(f)}),t.visit(t.ADD,f=>{l(f,e)?a.push(f):r.set(ne(f),1)});function c(f){const d=ne(f),h=l(f,e),p=r.get(d);h&&p?(r.delete(d),a.push(f)):!h&&!p?(r.set(d,1),o.push(f)):u&&h&&!p&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}});function wb(e){F.call(this,[],e)}wb.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},q(wb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=_$(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,s=>{const l=r.map(p=>p(s)),u=l.reduce((p,m)=>Math.max(p,m.length),0);let c=0,f,d,h;for(;c<u;++c){for(d=Lv(s),f=0;f<o;++f)d[i[f]]=(h=l[f][c])==null?null:h;a&&(d[a]=c),n.add.push(d)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}});function xb(e){F.call(this,[],e)}xb.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},q(xb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(tt),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,u=>{for(let c=0,f;c<l;++c)f=Lv(u),f[o]=i[c],f[s]=r[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)}});function kb(e){F.call(this,null,e)}kb.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},q(kb,F,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,o=>o[r]=n(o,e))}});function M$(e){F.call(this,[],e)}q(M$,F,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i=this.value,a=e.size-i.length,o,s,l;if(a>0){for(o=[];--a>=0;)o.push(l=Oe(r(e))),i.push(l);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else s=i.slice(0,-a),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,i=i.slice(-a);return n.source=this.value=i,n}});const ap={value:"value",median:uH,mean:lH,min:ob,max:ab},$H=[];function Eb(e){F.call(this,[],e)}Eb.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function OH(e){var t=e.method||ap.value,n;if(ap[t]==null)L("Unrecognized imputation method: "+t);else return t===ap.value?(n=e.value!==void 0?e.value:0,()=>n):ap[t]}function MH(e){const t=e.field;return n=>n?t(n):NaN}q(Eb,F,{transform(e,t){var n=t.fork(t.ALL),r=OH(e),i=MH(e),a=tt(e.field),o=tt(e.key),s=(e.groupby||[]).map(tt),l=DH(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length,d,h,p,m,g,y,v,b,w,x;for(g=0,b=l.length;g<b;++g)for(d=l[g],p=d.values,h=NaN,v=0;v<f;++v){if(d[v]!=null)continue;for(m=l.domain[v],x={_impute:!0},y=0,w=p.length;y<w;++y)x[s[y]]=p[y];x[o]=m,x[a]=Number.isNaN(h)?h=r(d,i):h,u.push(Oe(x))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n}});function DH(e,t,n,r){var i=y=>y(g),a=[],o=r?r.slice():[],s={},l={},u,c,f,d,h,p,m,g;for(o.forEach((y,v)=>s[y]=v+1),d=0,m=e.length;d<m;++d)g=e[d],p=n(g),h=s[p]||(s[p]=o.push(p)),c=(u=t?t.map(i):$H)+"",(f=l[c])||(f=l[c]=[],a.push(f),f.values=u),f[h-1]=g;return a.domain=o,a}function Sb(e){Ba.call(this,e)}Sb.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:zc},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},q(Sb,Ba,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(i=n.value=n.value||this.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),n.changes(),t.visit(t.SOURCE,a=>{ue(a,i[n.cellkey(a)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function Tb(e){F.call(this,null,e)}Tb.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},q(Tb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=mb(r,e.groupby,e.field),a=(e.groupby||[]).map(tt),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&L("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=ei(r,e.field)),f=d=e.steps||d),i.forEach(h=>{const p=Vv(h,o)[s],m=e.counts?h.length:1,g=c||ei(h);rp(p,g,f,d).forEach(y=>{const v={};for(let b=0;b<a.length;++b)v[a[b]]=h.dims[b];v[l[0]]=y[0],v[l[1]]=y[1]*m,u.push(Oe(v))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});function D$(e){Be.call(this,null,NH,e)}q(D$,Be);function NH(e){return this.value&&!e.modified()?this.value:tv(e.fields,e.flat)}function N$(e){F.call(this,[],e),this._pending=null}q(N$,F,{transform(e,t){const n=t.dataflow;if(this._pending)return Ab(this,t,this._pending);if(RH(e))return t.StopPropagation;if(e.values)return Ab(this,t,n.parse(e.values,e.format));if(e.async){const r=n.request(e.url,e.format).then(i=>(this._pending=J(i.data),a=>a.touch(this)));return{async:r}}else return n.request(e.url,e.format).then(r=>Ab(this,t,J(r.data)))}});function RH(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Ab(e,t,n){n.forEach(Oe);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function _b(e){F.call(this,{},e)}_b.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},q(_b,F,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=e.default==null?null:e.default,o=e.modified(),s=n.length;let l=o?t.SOURCE:t.ADD,u=t,c=e.as,f,d,h;return i?(d=i.length,s>1&&!c&&L('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==s*d&&L('The "as" parameter has too few output field names.'),c=c||i.map(tt),f=function(p){for(var m=0,g=0,y,v;m<s;++m)if(v=r.get(n[m](p)),v==null)for(y=0;y<d;++y,++g)p[c[g]]=a;else for(y=0;y<d;++y,++g)p[c[g]]=i[y](v)}):(c||L("Missing output field names."),f=function(p){for(var m=0,g;m<s;++m)g=r.get(n[m](p)),p[c[m]]=g??a}),o?u=t.reflow(!0):(h=n.some(p=>t.modified(p.fields)),l|=h?t.MOD:0),t.visit(l,f),u.modifies(c)}});function R$(e){Be.call(this,null,FH,e)}q(R$,Be);function FH(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r=Infinity,i=-Infinity,a,o;for(a=0;a<n;++a)o=t[a],o[0]<r&&(r=o[0]),o[1]>i&&(i=o[1]);return[r,i]}function F$(e){Be.call(this,null,IH,e)}q(F$,Be);function IH(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function I$(e){F.call(this,null,e)}q(I$,F,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Cb(e){Ba.call(this,e)}Cb.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:zc,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},q(Cb,Ba,{_transform:Ba.prototype.transform,transform(e,t){return this._transform(LH(e,t),t)}});function LH(e,t){const n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",a=jt(n).concat(jt(r)),o=PH(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(s=>zH(s,n,r,a)),as:o.map(s=>s+""),modified:e.modified.bind(e)}}function zH(e,t,n,r){return En(i=>t(i)===e?n(i):NaN,r,e+"")}function PH(e,t,n){const r={},i=[];return n.visit(n.SOURCE,a=>{const o=e(a);r[o]||(r[o]=1,i.push(o))}),i.sort(Dh),t?i.slice(0,t):i}function L$(e){ip.call(this,e)}q(L$,ip,{transform(e,t){const n=e.subflow,r=e.field,i=a=>this.subflow(ne(a),n,t,a);return(e.modified("field")||r&&t.modified(jt(r)))&&L("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,a=>{const o=i(a);r(a).forEach(s=>o.mod(s))}),t.visit(t.ADD,a=>{const o=i(a);r(a).forEach(s=>o.add(Oe(s)))}),t.visit(t.REM,a=>{const o=i(a);r(a).forEach(s=>o.rem(s))})):(t.visit(t.MOD,a=>i(a).mod(a)),t.visit(t.ADD,a=>i(a).add(a)),t.visit(t.REM,a=>i(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t}});function $b(e){F.call(this,null,e)}$b.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},q($b,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=_$(e.fields,e.as||[]),a=r?(s,l)=>jH(s,l,r,i):Yh;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,s=>{const l=ne(s);n.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,s=>{const l=a(s,Oe({}));o[ne(s)]=l,n.add.push(l)}),t.visit(t.MOD,s=>{n.mod.push(a(s,o[ne(s)]))}),n}});function jH(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}function z$(e){F.call(this,null,e)}q(z$,F,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Ob(e){F.call(this,null,e)}Ob.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const UH=1e-14;q(Ob,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=t.materialize(t.SOURCE).source,a=mb(i,e.groupby,e.field),o=(e.groupby||[]).map(tt),s=[],l=e.step||.01,u=e.probs||g$(l/2,1-UH,l),c=u.length;return a.forEach(f=>{const d=qv(f,u);for(let h=0;h<c;++h){const p={};for(let m=0;m<o.length;++m)p[o[m]]=f.dims[m];p[r[0]]=u[h],p[r[1]]=d[h],s.push(Oe(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n}});function P$(e){F.call(this,null,e)}q(P$,F,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const a=ne(i);n.rem.push(r[a]),r[a]=null}),t.visit(t.ADD,i=>{const a=Lv(i);r[ne(i)]=a,n.add.push(a)}),t.visit(t.MOD,i=>{const a=r[ne(i)];for(const o in i)a[o]=i[o],n.modifies(o);n.mod.push(a)})),n}});function Mb(e){F.call(this,[],e),this.count=0}Mb.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},q(Mb,F,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce((c,f)=>(c[ne(f)]=1,c),{});let o=this.value,s=this.count,l=0;function u(c){let f,d;o.length<i?o.push(c):(d=~~((s+1)*lr()),d<o.length&&d>=l&&(f=o[d],a[ne(f)]&&n.rem.push(f),o[d]=c)),++s}if(t.rem.length&&(t.visit(t.REM,c=>{const f=ne(c);a[f]&&(a[f]=-1,n.rem.push(c)),--s}),o=o.filter(c=>a[ne(c)]!==-1)),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,c=>{a[ne(c)]||u(c)}),l=-1),r&&o.length>i){const c=o.length-i;for(let f=0;f<c;++f)a[ne(o[f])]=-1,n.rem.push(o[f]);o=o.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{a[ne(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter(c=>!a[ne(c)])),this.count=s,this.value=n.source=o,n}});function Db(e){F.call(this,null,e)}Db.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},q(Db,F,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=g$(e.start,e.stop,e.step||1).map(i=>{const a={};return a[r]=i,Oe(a)}),n.add=t.add.concat(this.value),n}});function j$(e){F.call(this,null,e),this.modified(!0)}q(j$,F,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Nb(e){F.call(this,null,e)}const U$=["unit0","unit1"];Nb.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:gv,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:U$}]},q(Nb,F,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",a=this._floor(e,t),o=(i?Tl:Sl)(a.unit).offset,s=e.as||U$,l=s[0],u=s[1],c=a.step;let f=a.start||Infinity,d=a.stop||-Infinity,h=t.ADD;return(e.modified()||t.modified(jt(n)))&&(t=t.reflow(!0),h=t.SOURCE,f=Infinity,d=-Infinity),t.visit(h,p=>{const m=n(p);let g,y;m==null?(p[l]=null,r&&(p[u]=null)):(p[l]=g=y=a(m),r&&(p[u]=y=o(g,c)),g<f&&(f=g),y>d&&(d=y))}),a.start=f,a.stop=d,t.modifies(r?s:l)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:iC({extent:e.extent||ei(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=vv(r),o=this.value||{},s=(n?Y_:G_)(a,i);return s.unit=ve(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}});function B$(e){F.call(this,wl(),e)}q(B$,F,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=s=>i.set(r(s),s);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,s=>i.delete(r(s))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}});function q$(e){F.call(this,null,e)}q(q$,F,{transform(e,t){const n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(ts(e.sort)):t.source).map(e.field))}});function BH(e,t,n,r){const i=Pc[e](t,n);return{init:i.init||Na,update:function(a,o){o[r]=i.next(a)}}}const Pc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Pc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||L("ntile num must be greater than zero.");const n=Pc.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||L("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=qH(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function qH(e,t,n){for(let r=t.length;n<r;++n){const i=e(t[n]);if(i!=null)return n}return-1}const HH=Object.keys(Pc);function H$(e){const t=J(e.ops),n=J(e.fields),r=J(e.params),i=J(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let f=!0;function d(h){J(jt(h)).forEach(p=>s[p]=1)}d(e.sort),t.forEach((h,p)=>{const m=n[p],g=tt(m),y=y$(h,g,i[p]);if(d(m),a.push(y),te(Pc,h))o.push(BH(h,n[p],r[p],y));else{if(m==null&&h!=="count"&&L("Null aggregate field specified."),h==="count"){u.push(y);return}f=!1;let v=l[g];v||(v=l[g]=[],v.field=m,c.push(v)),v.push(v$(h,y))}}),(u.length||c.length)&&(this.cell=WH(c,u,f)),this.inputs=Object.keys(s)}const W$=H$.prototype;W$.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},W$.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)};function WH(e,t,n){e=e.map(l=>w$(l,l.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new ub();return r.add=function(l){if(r.num+=1,n)return;s&&s.add(l);for(let u=0;u<i;++u)a[u].add(a[u].get(l),l)},r.rem=function(l){if(r.num-=1,n)return;s&&s.rem(l);for(let u=0;u<i;++u)a[u].rem(a[u].get(l),l)},r.set=function(l){let u,c;for(s&&s.values(),u=0,c=t.length;u<c;++u)l[t[u]]=r.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},r.init=function(){r.num=0,s&&s.reset();for(let l=0;l<i;++l)a[l].init()},r}function Rb(e){F.call(this,{},e),this._mlen=0,this._mods=[]}Rb.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:HH.concat(zc)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},q(Rb,F,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=ts(e.sort),i=sb(e.groupby),a=s=>this.group(i(s));let o=this.state;(!o||n)&&(o=this.state=new H$(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,s=>a(s).add(s))):(t.visit(t.REM,s=>a(s).remove(s)),t.visit(t.ADD,s=>a(s).add(s)));for(let s=0,l=this._mlen;s<l;++s)GH(this._mods[s],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=x$(ne),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function GH(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?iH(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||qt(-1)};t.init();for(let f=0;f<l;++f)YH(c,o,f,l),a&&VH(c,u),t.update(c,s[f])}function YH(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function VH(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}var XH=Object.freeze({__proto__:null,aggregate:Ba,bin:cb,collect:fb,compare:k$,countpattern:db,cross:hb,density:pb,dotbin:gb,expression:$$,extent:yb,facet:ip,field:O$,filter:bb,flatten:wb,fold:xb,formula:kb,generate:M$,impute:Eb,joinaggregate:Sb,kde:Tb,key:D$,load:N$,lookup:_b,multiextent:R$,multivalues:F$,params:I$,pivot:Cb,prefacet:L$,project:$b,proxy:z$,quantile:Ob,relay:P$,sample:Mb,sequence:Db,sieve:j$,subflow:vb,timeunit:Nb,tupleindex:B$,values:q$,window:Rb});const Fb=Math.PI,Ib=2*Fb,rs=1e-6,JH=Ib-rs;function Lb(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function is(){return new Lb()}Lb.prototype=is.prototype={constructor:Lb,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,l=r-t,u=a-e,c=o-t,f=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>rs)if(!(Math.abs(c*s-l*u)>rs)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-a,h=r-o,p=s*s+l*l,m=d*d+h*h,g=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((Fb-Math.acos((p+f-m)/(2*g*y)))/2),b=v/y,w=v/g;Math.abs(b-1)>rs&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+w*s)+","+(this._y1=t+w*l)}},arc:function(e,t,n,r,i,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null?this._+="M"+l+","+u:(Math.abs(this._x1-l)>rs||Math.abs(this._y1-u)>rs)&&(this._+="L"+l+","+u),!n)return;f<0&&(f=f%Ib+Ib),f>JH?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>rs&&(this._+="A"+n+","+n+",0,"+ +(f>=Fb)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i)))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function De(e){return function(){return e}}var G$=Math.abs,Gt=Math.atan2,as=Math.cos,KH=Math.max,zb=Math.min,ri=Math.sin,Nl=Math.sqrt,Yt=1e-12,Rl=Math.PI,op=Rl/2,Y$=2*Rl;function QH(e){return e>1?0:e<-1?Rl:Math.acos(e)}function V$(e){return e>=1?op:e<=-1?-op:Math.asin(e)}function ZH(e){return e.innerRadius}function eW(e){return e.outerRadius}function tW(e){return e.startAngle}function nW(e){return e.endAngle}function rW(e){return e&&e.padAngle}function iW(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,f=s-a,d=f*l-c*u;return d*d<Yt?void 0:(d=(c*(t-a)-f*(e-i))/d,[e+d*l,t+d*u])}function sp(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/Nl(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,m=r+f,g=(d+p)/2,y=(h+m)/2,v=p-d,b=m-h,w=v*v+b*b,x=i-a,E=d*m-p*h,k=(b<0?-1:1)*Nl(KH(0,x*x*w-E*E)),S=(E*b-v*k)/w,A=(-E*v-b*k)/w,C=(E*b+v*k)/w,_=(-E*v+b*k)/w,D=S-g,M=A-y,N=C-g,T=_-y;return D*D+M*M>N*N+T*T&&(S=C,A=_),{cx:S,cy:A,x01:-c,y01:-f,x11:S*(i/x-1),y11:A*(i/x-1)}}function aW(){var e=ZH,t=eW,n=De(0),r=null,i=tW,a=nW,o=rW,s=null;function l(){var u,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=i.apply(this,arguments)-op,p=a.apply(this,arguments)-op,m=G$(p-h),g=p>h;if(s||(s=u=is()),d<f&&(c=d,d=f,f=c),!(d>Yt))s.moveTo(0,0);else if(m>Y$-Yt)s.moveTo(d*as(h),d*ri(h)),s.arc(0,0,d,h,p,!g),f>Yt&&(s.moveTo(f*as(p),f*ri(p)),s.arc(0,0,f,p,h,g));else{var y=h,v=p,b=h,w=p,x=m,E=m,k=o.apply(this,arguments)/2,S=k>Yt&&(r?+r.apply(this,arguments):Nl(f*f+d*d)),A=zb(G$(d-f)/2,+n.apply(this,arguments)),C=A,_=A,D,M;if(S>Yt){var N=V$(S/f*ri(k)),T=V$(S/d*ri(k));(x-=N*2)>Yt?(N*=g?1:-1,b+=N,w-=N):(x=0,b=w=(h+p)/2),(E-=T*2)>Yt?(T*=g?1:-1,y+=T,v-=T):(E=0,y=v=(h+p)/2)}var O=d*as(y),P=d*ri(y),W=f*as(w),B=f*ri(w);if(A>Yt){var se=d*as(v),me=d*ri(v),we=f*as(b),ye=f*ri(b),Se;if(m<Rl&&(Se=iW(O,P,we,ye,se,me,W,B))){var Ue=O-Se[0],Pn=P-Se[1],jn=se-Se[0],zt=me-Se[1],R=1/ri(QH((Ue*jn+Pn*zt)/(Nl(Ue*Ue+Pn*Pn)*Nl(jn*jn+zt*zt)))/2),G=Nl(Se[0]*Se[0]+Se[1]*Se[1]);C=zb(A,(f-G)/(R-1)),_=zb(A,(d-G)/(R+1))}}E>Yt?_>Yt?(D=sp(we,ye,O,P,d,_,g),M=sp(se,me,W,B,d,_,g),s.moveTo(D.cx+D.x01,D.cy+D.y01),_<A?s.arc(D.cx,D.cy,_,Gt(D.y01,D.x01),Gt(M.y01,M.x01),!g):(s.arc(D.cx,D.cy,_,Gt(D.y01,D.x01),Gt(D.y11,D.x11),!g),s.arc(0,0,d,Gt(D.cy+D.y11,D.cx+D.x11),Gt(M.cy+M.y11,M.cx+M.x11),!g),s.arc(M.cx,M.cy,_,Gt(M.y11,M.x11),Gt(M.y01,M.x01),!g))):(s.moveTo(O,P),s.arc(0,0,d,y,v,!g)):s.moveTo(O,P),!(f>Yt)||!(x>Yt)?s.lineTo(W,B):C>Yt?(D=sp(W,B,se,me,f,-C,g),M=sp(O,P,we,ye,f,-C,g),s.lineTo(D.cx+D.x01,D.cy+D.y01),C<A?s.arc(D.cx,D.cy,C,Gt(D.y01,D.x01),Gt(M.y01,M.x01),!g):(s.arc(D.cx,D.cy,C,Gt(D.y01,D.x01),Gt(D.y11,D.x11),!g),s.arc(0,0,f,Gt(D.cy+D.y11,D.cx+D.x11),Gt(M.cy+M.y11,M.cx+M.x11),g),s.arc(M.cx,M.cy,C,Gt(M.y11,M.x11),Gt(M.y01,M.x01),!g))):s.arc(0,0,f,w,b,g)}if(s.closePath(),u)return s=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-Rl/2;return[as(c)*u,ri(c)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:De(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:De(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:De(+u),l):n},l.padRadius=function(u){return arguments.length?(r=u==null?null:typeof u=="function"?u:De(+u),l):r},l.startAngle=function(u){return arguments.length?(i=typeof u=="function"?u:De(+u),l):i},l.endAngle=function(u){return arguments.length?(a=typeof u=="function"?u:De(+u),l):a},l.padAngle=function(u){return arguments.length?(o=typeof u=="function"?u:De(+u),l):o},l.context=function(u){return arguments.length?(s=u??null,l):s},l}function X$(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function J$(e){this._context=e}J$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Pb(e){return new J$(e)}function K$(e){return e[0]}function Q$(e){return e[1]}function Z$(e,t){var n=De(!0),r=null,i=Pb,a=null;e=typeof e=="function"?e:e===void 0?K$:De(e),t=typeof t=="function"?t:t===void 0?Q$:De(t);function o(s){var l,u=(s=X$(s)).length,c,f=!1,d;for(r==null&&(a=i(d=is())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,s),+t(c,l,s));if(d)return a=null,d+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:De(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:De(+s),o):t},o.defined=function(s){return arguments.length?(n=typeof s=="function"?s:De(!!s),o):n},o.curve=function(s){return arguments.length?(i=s,r!=null&&(a=i(r)),o):i},o.context=function(s){return arguments.length?(s==null?r=a=null:a=i(r=s),o):r},o}function eO(e,t,n){var r=null,i=De(!0),a=null,o=Pb,s=null;e=typeof e=="function"?e:e===void 0?K$:De(+e),t=typeof t=="function"?t:t===void 0?De(0):De(+t),n=typeof n=="function"?n:n===void 0?Q$:De(+n);function l(c){var f,d,h,p=(c=X$(c)).length,m,g=!1,y,v=new Array(p),b=new Array(p);for(a==null&&(s=o(y=is())),f=0;f<=p;++f){if(!(f<p&&i(m=c[f],f,c))===g)if(g=!g)d=f,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=f-1;h>=d;--h)s.point(v[h],b[h]);s.lineEnd(),s.areaEnd()}g&&(v[f]=+e(m,f,c),b[f]=+t(m,f,c),s.point(r?+r(m,f,c):v[f],n?+n(m,f,c):b[f]))}if(y)return s=null,y+""||null}function u(){return Z$().defined(i).curve(o).context(a)}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:De(+c),r=null,l):e},l.x0=function(c){return arguments.length?(e=typeof c=="function"?c:De(+c),l):e},l.x1=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:De(+c),l):r},l.y=function(c){return arguments.length?(t=typeof c=="function"?c:De(+c),n=null,l):t},l.y0=function(c){return arguments.length?(t=typeof c=="function"?c:De(+c),l):t},l.y1=function(c){return arguments.length?(n=c==null?null:typeof c=="function"?c:De(+c),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(c){return arguments.length?(i=typeof c=="function"?c:De(!!c),l):i},l.curve=function(c){return arguments.length?(o=c,a!=null&&(s=o(a)),l):o},l.context=function(c){return arguments.length?(c==null?a=s=null:s=o(a=c),l):a},l}var oW={draw:function(e,t){var n=Math.sqrt(t/Rl);e.moveTo(n,0),e.arc(0,0,n,0,Y$)}};function sW(e,t){var n=null;e=typeof e=="function"?e:De(e||oW),t=typeof t=="function"?t:De(t===void 0?64:+t);function r(){var i;if(n||(n=i=is()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return r.type=function(i){return arguments.length?(e=typeof i=="function"?i:De(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:De(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}function qa(){}function lp(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function up(e){this._context=e}up.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:lp(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:lp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function lW(e){return new up(e)}function tO(e){this._context=e}tO.prototype={areaStart:qa,areaEnd:qa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:lp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function uW(e){return new tO(e)}function nO(e){this._context=e}nO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:lp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function cW(e){return new nO(e)}function rO(e,t){this._basis=new up(e),this._beta=t}rO.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],a=e[n]-r,o=t[n]-i,s=-1,l;++s<=n;)l=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(r+l*a),this._beta*t[s]+(1-this._beta)*(i+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var fW=function e(t){function n(r){return t===1?new up(r):new rO(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function cp(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function jb(e,t){this._context=e,this._k=(1-t)/6}jb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:cp(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:cp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var dW=function e(t){function n(r){return new jb(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Ub(e,t){this._context=e,this._k=(1-t)/6}Ub.prototype={areaStart:qa,areaEnd:qa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:cp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var hW=function e(t){function n(r){return new Ub(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Bb(e,t){this._context=e,this._k=(1-t)/6}Bb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:cp(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var pW=function e(t){function n(r){return new Bb(r,t)}return n.tension=function(r){return e(+r)},n}(0);function qb(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>Yt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>Yt){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function iO(e,t){this._context=e,this._alpha=t}iO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:qb(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var mW=function e(t){function n(r){return t?new iO(r,t):new jb(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function aO(e,t){this._context=e,this._alpha=t}aO.prototype={areaStart:qa,areaEnd:qa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:qb(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var gW=function e(t){function n(r){return t?new aO(r,t):new Ub(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function oO(e,t){this._context=e,this._alpha=t}oO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:qb(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var yW=function e(t){function n(r){return t?new oO(r,t):new Bb(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function sO(e){this._context=e}sO.prototype={areaStart:qa,areaEnd:qa,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function vW(e){return new sO(e)}function lO(e){return e<0?-1:1}function uO(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(lO(a)+lO(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function cO(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Hb(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function fp(e){this._context=e}fp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Hb(this,this._t0,cO(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Hb(this,cO(this,n=uO(this,e,t)),n);break;default:Hb(this,this._t0,n=uO(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}};function fO(e){this._context=new dO(e)}(fO.prototype=Object.create(fp.prototype)).point=function(e,t){fp.prototype.point.call(this,t,e)};function dO(e){this._context=e}dO.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}};function bW(e){return new fp(e)}function wW(e){return new fO(e)}function hO(e){this._context=e}hO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=pO(e),i=pO(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function pO(e){var t,n=e.length-1,r,i=new Array(n),a=new Array(n),o=new Array(n);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/a[t-1],a[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function xW(e){return new hO(e)}function dp(e,t){this._context=e,this._t=t}dp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function kW(e){return new dp(e,.5)}function EW(e){return new dp(e,0)}function SW(e){return new dp(e,1)}function Fl(e,t){if(typeof document!="undefined"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const TW=()=>typeof Image!="undefined"?Image:null;function Wb(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Gb(e){let t=e,n=e;e.length===1&&(t=(o,s)=>e(o)-s,n=AW(e));function r(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)<0?l=c+1:u=c}return l}function i(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)>0?u=c:l=c+1}return l}function a(o,s,l,u){l==null&&(l=0),u==null&&(u=o.length);const c=r(o,s,l,u-1);return c>l&&t(o[c-1],s)>-t(o[c],s)?c-1:c}return{left:r,center:a,right:i}}function AW(e){return(t,n)=>Wb(e(t),n)}function mO(e){return e===null?NaN:+e}const _W=Gb(Wb),os=_W.right,Lwe=Gb(mO).center;var Yb=Math.sqrt(50),Vb=Math.sqrt(10),Xb=Math.sqrt(2);function Jb(e,t,n){var r,i=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(a=e,e=t,t=a),(s=gO(e,t,n))===0||!isFinite(s))return[];if(s>0){let l=Math.round(e/s),u=Math.round(t/s);for(l*s<e&&++l,u*s>t&&--u,o=new Array(a=u-l+1);++i<a;)o[i]=(l+i)*s}else{s=-s;let l=Math.round(e*s),u=Math.round(t*s);for(l/s<e&&++l,u/s>t&&--u,o=new Array(a=u-l+1);++i<a;)o[i]=(l+i)/s}return r&&o.reverse(),o}function gO(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Yb?10:a>=Vb?5:a>=Xb?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Yb?10:a>=Vb?5:a>=Xb?2:1)}function Kb(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Yb?i*=10:a>=Vb?i*=5:a>=Xb&&(i*=2),t<e?-i:i}function CW(e,t,n=mO){if(!(r=e.length))return;if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(i-a)}function $W(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);++r<i;)a[r]=e+r*n;return a}function ii(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ha(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Qb=Symbol("implicit");function Zb(){var e=new Map(),t=[],n=[],r=Qb;function i(a){var o=a+"",s=e.get(o);if(!s){if(r!==Qb)return r;e.set(o,s=t.push(a))}return n[(s-1)%n.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map();for(const o of a){const s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return i},i.range=function(a){return arguments.length?(n=Array.from(a),i):n.slice()},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return Zb(t,n).unknown(r)},ii.apply(i,arguments),i}function Il(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function jc(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Wa(){}var ss=.7,Ll=1/ss,zl="\\s*([+-]?\\d+)\\s*",Uc="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ai="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",OW=/^#([0-9a-f]{3,8})$/,MW=new RegExp("^rgb\\("+[zl,zl,zl]+"\\)$"),DW=new RegExp("^rgb\\("+[ai,ai,ai]+"\\)$"),NW=new RegExp("^rgba\\("+[zl,zl,zl,Uc]+"\\)$"),RW=new RegExp("^rgba\\("+[ai,ai,ai,Uc]+"\\)$"),FW=new RegExp("^hsl\\("+[Uc,ai,ai]+"\\)$"),IW=new RegExp("^hsla\\("+[Uc,ai,ai,Uc]+"\\)$"),yO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Il(Wa,Bc,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:vO,formatHex:vO,formatHsl:LW,formatRgb:bO,toString:bO});function vO(){return this.rgb().formatHex()}function LW(){return SO(this).formatHsl()}function bO(){return this.rgb().formatRgb()}function Bc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=OW.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?wO(t):n===3?new Ft(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?hp(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?hp(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=MW.exec(e))?new Ft(t[1],t[2],t[3],1):(t=DW.exec(e))?new Ft(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=NW.exec(e))?hp(t[1],t[2],t[3],t[4]):(t=RW.exec(e))?hp(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=FW.exec(e))?EO(t[1],t[2]/100,t[3]/100,1):(t=IW.exec(e))?EO(t[1],t[2]/100,t[3]/100,t[4]):yO.hasOwnProperty(e)?wO(yO[e]):e==="transparent"?new Ft(NaN,NaN,NaN,0):null}function wO(e){return new Ft(e>>16&255,e>>8&255,e&255,1)}function hp(e,t,n,r){return r<=0&&(e=t=n=NaN),new Ft(e,t,n,r)}function e1(e){return e instanceof Wa||(e=Bc(e)),e?(e=e.rgb(),new Ft(e.r,e.g,e.b,e.opacity)):new Ft()}function pp(e,t,n,r){return arguments.length===1?e1(e):new Ft(e,t,n,r??1)}function Ft(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}Il(Ft,pp,jc(Wa,{brighter:function(e){return e=e==null?Ll:Math.pow(Ll,e),new Ft(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?ss:Math.pow(ss,e),new Ft(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xO,formatHex:xO,formatRgb:kO,toString:kO}));function xO(){return"#"+t1(this.r)+t1(this.g)+t1(this.b)}function kO(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function t1(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function EO(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new oi(e,t,n,r)}function SO(e){if(e instanceof oi)return new oi(e.h,e.s,e.l,e.opacity);if(e instanceof Wa||(e=Bc(e)),!e)return new oi();if(e instanceof oi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new oi(o,s,l,e.opacity)}function n1(e,t,n,r){return arguments.length===1?SO(e):new oi(e,t,n,r??1)}function oi(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Il(oi,n1,jc(Wa,{brighter:function(e){return e=e==null?Ll:Math.pow(Ll,e),new oi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?ss:Math.pow(ss,e),new oi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Ft(r1(e>=240?e-240:e+120,i,r),r1(e,i,r),r1(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function r1(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const TO=Math.PI/180,AO=180/Math.PI,mp=18,_O=.96422,CO=1,$O=.82521,OO=4/29,Pl=6/29,MO=3*Pl*Pl,zW=Pl*Pl*Pl;function DO(e){if(e instanceof si)return new si(e.l,e.a,e.b,e.opacity);if(e instanceof Xi)return NO(e);e instanceof Ft||(e=e1(e));var t=l1(e.r),n=l1(e.g),r=l1(e.b),i=a1((.2225045*t+.7168786*n+.0606169*r)/CO),a,o;return t===n&&n===r?a=o=i:(a=a1((.4360747*t+.3850649*n+.1430804*r)/_O),o=a1((.0139322*t+.0971045*n+.7141733*r)/$O)),new si(116*i-16,500*(a-i),200*(i-o),e.opacity)}function i1(e,t,n,r){return arguments.length===1?DO(e):new si(e,t,n,r??1)}function si(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}Il(si,i1,jc(Wa,{brighter:function(e){return new si(this.l+mp*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new si(this.l-mp*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=_O*o1(t),e=CO*o1(e),n=$O*o1(n),new Ft(s1(3.1338561*t-1.6168667*e-.4906146*n),s1(-.9787684*t+1.9161415*e+.033454*n),s1(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function a1(e){return e>zW?Math.pow(e,1/3):e/MO+OO}function o1(e){return e>Pl?e*e*e:MO*(e-OO)}function s1(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function l1(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function PW(e){if(e instanceof Xi)return new Xi(e.h,e.c,e.l,e.opacity);if(e instanceof si||(e=DO(e)),e.a===0&&e.b===0)return new Xi(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*AO;return new Xi(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function u1(e,t,n,r){return arguments.length===1?PW(e):new Xi(e,t,n,r??1)}function Xi(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function NO(e){if(isNaN(e.h))return new si(e.l,0,0,e.opacity);var t=e.h*TO;return new si(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Il(Xi,u1,jc(Wa,{brighter:function(e){return new Xi(this.h,this.c,this.l+mp*(e??1),this.opacity)},darker:function(e){return new Xi(this.h,this.c,this.l-mp*(e??1),this.opacity)},rgb:function(){return NO(this).rgb()}}));var RO=-.14861,c1=1.78277,f1=-.29227,gp=-.90649,qc=1.97294,FO=qc*gp,IO=qc*c1,LO=c1*f1-gp*RO;function jW(e){if(e instanceof ls)return new ls(e.h,e.s,e.l,e.opacity);e instanceof Ft||(e=e1(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(LO*r+FO*t-IO*n)/(LO+FO-IO),a=r-i,o=(qc*(n-i)-f1*a)/gp,s=Math.sqrt(o*o+a*a)/(qc*i*(1-i)),l=s?Math.atan2(o,a)*AO-120:NaN;return new ls(l<0?l+360:l,s,i,e.opacity)}function d1(e,t,n,r){return arguments.length===1?jW(e):new ls(e,t,n,r??1)}function ls(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}Il(ls,d1,jc(Wa,{brighter:function(e){return e=e==null?Ll:Math.pow(Ll,e),new ls(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?ss:Math.pow(ss,e),new ls(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*TO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Ft(255*(t+n*(RO*r+c1*i)),255*(t+n*(f1*r+gp*i)),255*(t+n*(qc*r)),this.opacity)}}));function zO(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function PO(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return zO((n-r/t)*t,o,i,a,s)}}function jO(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return zO((n-r/t)*t,i,a,o,s)}}var yp=e=>()=>e;function UO(e,t){return function(n){return e+n*t}}function UW(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function vp(e,t){var n=t-e;return n?UO(e,n>180||n<-180?n-360*Math.round(n/360):n):yp(isNaN(e)?t:e)}function BW(e){return(e=+e)===1?Tt:function(t,n){return n-t?UW(t,n,e):yp(isNaN(t)?n:t)}}function Tt(e,t){var n=t-e;return n?UO(e,n):yp(isNaN(e)?t:e)}var h1=function e(t){var n=BW(t);function r(i,a){var o=n((i=pp(i)).r,(a=pp(a)).r),s=n(i.g,a.g),l=n(i.b,a.b),u=Tt(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=e,r}(1);function BO(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=pp(t[o]),r[o]=s.r||0,i[o]=s.g||0,a[o]=s.b||0;return r=e(r),i=e(i),a=e(a),s.opacity=1,function(l){return s.r=r(l),s.g=i(l),s.b=a(l),s+""}}}var qW=BO(PO),HW=BO(jO);function p1(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function qO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function WW(e,t){return(qO(t)?p1:HO)(e,t)}function HO(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=us(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function WO(e,t){var n=new Date();return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function $r(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function GO(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=us(e[i],t[i]):r[i]=t[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var m1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,g1=new RegExp(m1.source,"g");function GW(e){return function(){return e}}function YW(e){return function(t){return e(t)+""}}function YO(e,t){var n=m1.lastIndex=g1.lastIndex=0,r,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(r=m1.exec(e))&&(i=g1.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:$r(r,i)})),n=g1.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?YW(l[0].x):GW(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function us(e,t){var n=typeof t,r;return t==null||n==="boolean"?yp(t):(n==="number"?$r:n==="string"?(r=Bc(t))?(t=r,h1):YO:t instanceof Bc?h1:t instanceof Date?WO:qO(t)?p1:Array.isArray(t)?HO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?GO:$r)(e,t)}function VW(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function XW(e,t){var n=vp(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function bp(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var VO=180/Math.PI,y1={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function XO(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*VO,skewX:Math.atan(l)*VO,scaleX:o,scaleY:s}}var wp;function JW(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?y1:XO(t.a,t.b,t.c,t.d,t.e,t.f)}function KW(e){return e==null?y1:(wp||(wp=document.createElementNS("http://www.w3.org/2000/svg","g")),wp.setAttribute("transform",e),(e=wp.transform.baseVal.consolidate())?(e=e.matrix,XO(e.a,e.b,e.c,e.d,e.e,e.f)):y1)}function JO(e,t,n,r){function i(u){return u.length?u.pop()+" ":""}function a(u,c,f,d,h,p){if(u!==f||c!==d){var m=h.push("translate(",null,t,null,n);p.push({i:m-4,x:$r(u,f)},{i:m-2,x:$r(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(u,c,f,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:f.push(i(f)+"rotate(",null,r)-2,x:$r(u,c)})):c&&f.push(i(f)+"rotate("+c+r)}function s(u,c,f,d){u!==c?d.push({i:f.push(i(f)+"skewX(",null,r)-2,x:$r(u,c)}):c&&f.push(i(f)+"skewX("+c+r)}function l(u,c,f,d,h,p){if(u!==f||c!==d){var m=h.push(i(h)+"scale(",null,",",null,")");p.push({i:m-4,x:$r(u,f)},{i:m-2,x:$r(c,d)})}else(f!==1||d!==1)&&h.push(i(h)+"scale("+f+","+d+")")}return function(u,c){var f=[],d=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,f,d),o(u.rotate,c.rotate,f,d),s(u.skewX,c.skewX,f,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,d),u=c=null,function(h){for(var p=-1,m=d.length,g;++p<m;)f[(g=d[p]).i]=g.x(h);return f.join("")}}}var QW=JO(JW,"px, ","px)","deg)"),ZW=JO(KW,", ",")",")"),eG=1e-12;function KO(e){return((e=Math.exp(e))+1/e)/2}function tG(e){return((e=Math.exp(e))-1/e)/2}function nG(e){return((e=Math.exp(2*e))-1)/(e+1)}var rG=function e(t,n,r){function i(a,o){var s=a[0],l=a[1],u=a[2],c=o[0],f=o[1],d=o[2],h=c-s,p=f-l,m=h*h+p*p,g,y;if(m<eG)y=Math.log(d/u)/t,g=function(k){return[s+k*h,l+k*p,u*Math.exp(t*k*y)]};else{var v=Math.sqrt(m),b=(d*d-u*u+r*m)/(2*u*n*v),w=(d*d-u*u-r*m)/(2*d*n*v),x=Math.log(Math.sqrt(b*b+1)-b),E=Math.log(Math.sqrt(w*w+1)-w);y=(E-x)/t,g=function(k){var S=k*y,A=KO(x),C=u/(n*v)*(A*nG(t*S+x)-tG(x));return[s+C*h,l+C*p,u*A/KO(t*S+x)]}}return g.duration=y*1e3*t/Math.SQRT2,g}return i.rho=function(a){var o=Math.max(.001,+a),s=o*o,l=s*s;return e(o,s,l)},i}(Math.SQRT2,2,4);function QO(e){return function(t,n){var r=e((t=n1(t)).h,(n=n1(n)).h),i=Tt(t.s,n.s),a=Tt(t.l,n.l),o=Tt(t.opacity,n.opacity);return function(s){return t.h=r(s),t.s=i(s),t.l=a(s),t.opacity=o(s),t+""}}}var iG=QO(vp),aG=QO(Tt);function oG(e,t){var n=Tt((e=i1(e)).l,(t=i1(t)).l),r=Tt(e.a,t.a),i=Tt(e.b,t.b),a=Tt(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=a(o),e+""}}function ZO(e){return function(t,n){var r=e((t=u1(t)).h,(n=u1(n)).h),i=Tt(t.c,n.c),a=Tt(t.l,n.l),o=Tt(t.opacity,n.opacity);return function(s){return t.h=r(s),t.c=i(s),t.l=a(s),t.opacity=o(s),t+""}}}var sG=ZO(vp),lG=ZO(Tt);function eM(e){return function t(n){n=+n;function r(i,a){var o=e((i=d1(i)).h,(a=d1(a)).h),s=Tt(i.s,a.s),l=Tt(i.l,a.l),u=Tt(i.opacity,a.opacity);return function(c){return i.h=o(c),i.s=s(c),i.l=l(Math.pow(c,n)),i.opacity=u(c),i+""}}return r.gamma=t,r}(1)}var uG=eM(vp),cG=eM(Tt);function v1(e,t){t===void 0&&(t=e,e=us);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(o){var s=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return a[s](o-s)}}function fG(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}var dG=Object.freeze({__proto__:null,interpolate:us,interpolateArray:WW,interpolateBasis:PO,interpolateBasisClosed:jO,interpolateDate:WO,interpolateDiscrete:VW,interpolateHue:XW,interpolateNumber:$r,interpolateNumberArray:p1,interpolateObject:GO,interpolateRound:bp,interpolateString:YO,interpolateTransformCss:QW,interpolateTransformSvg:ZW,interpolateZoom:rG,interpolateRgb:h1,interpolateRgbBasis:qW,interpolateRgbBasisClosed:HW,interpolateHsl:iG,interpolateHslLong:aG,interpolateLab:oG,interpolateHcl:sG,interpolateHclLong:lG,interpolateCubehelix:uG,interpolateCubehelixLong:cG,piecewise:v1,quantize:fG});function hG(e){return function(){return e}}function b1(e){return+e}var tM=[0,1];function Cn(e){return e}function w1(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:hG(isNaN(t)?NaN:.5)}function pG(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function mG(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=w1(i,r),a=n(o,a)):(r=w1(r,i),a=n(a,o)),function(s){return a(r(s))}}function gG(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=w1(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(s){var l=os(e,s,1,r)-1;return a[l](i[l](s))}}function Hc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function xp(){var e=tM,t=tM,n=us,r,i,a,o=Cn,s,l,u;function c(){var d=Math.min(e.length,t.length);return o!==Cn&&(o=pG(e[0],e[d-1])),s=d>2?gG:mG,l=u=null,f}function f(d){return d==null||isNaN(d=+d)?a:(l||(l=s(e.map(r),t,n)))(r(o(d)))}return f.invert=function(d){return o(i((u||(u=s(t,e.map(r),$r)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,b1),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=bp,c()},f.clamp=function(d){return arguments.length?(o=d?!0:Cn,c()):o!==Cn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,h){return r=d,i=h,c()}}function nM(){return xp()(Cn,Cn)}function yG(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function kp(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function jl(e){return e=kp(Math.abs(e)),e?e[1]:NaN}function vG(e,t){return function(n,r){for(var i=n.length,a=[],o=0,s=e[0],l=0;i>0&&s>0&&!(l+s+1>r&&(s=Math.max(1,r-l)),a.push(n.substring(i-=s,i+s)),(l+=s+1)>r);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function bG(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var wG=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ep(e){if(!(t=wG.exec(e)))throw new Error("invalid format: "+e);var t;return new x1({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Ep.prototype=x1.prototype;function x1(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}x1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xG(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var rM;function kG(e,t){var n=kp(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(rM=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+kp(e,Math.max(0,t+a-1))[0]}function iM(e,t){var n=kp(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}var aM={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:yG,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>iM(e*100,t),r:iM,s:kG,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function oM(e){return e}var sM=Array.prototype.map,lM=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function EG(e){var t=e.grouping===void 0||e.thousands===void 0?oM:vG(sM.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?oM:bG(sM.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=Ep(f);var d=f.fill,h=f.align,p=f.sign,m=f.symbol,g=f.zero,y=f.width,v=f.comma,b=f.precision,w=f.trim,x=f.type;x==="n"?(v=!0,x="g"):aM[x]||(b===void 0&&(b=12),w=!0,x="g"),(g||d==="0"&&h==="=")&&(g=!0,d="0",h="=");var E=m==="$"?n:m==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",k=m==="$"?r:/[%p]/.test(x)?o:"",S=aM[x],A=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function C(_){var D=E,M=k,N,T,O;if(x==="c")M=S(_)+M,_="";else{_=+_;var P=_<0||1/_<0;if(_=isNaN(_)?l:S(Math.abs(_),b),w&&(_=xG(_)),P&&+_===0&&p!=="+"&&(P=!1),D=(P?p==="("?p:s:p==="-"||p==="("?"":p)+D,M=(x==="s"?lM[8+rM/3]:"")+M+(P&&p==="("?")":""),A){for(N=-1,T=_.length;++N<T;)if(O=_.charCodeAt(N),48>O||O>57){M=(O===46?i+_.slice(N+1):_.slice(N))+M,_=_.slice(0,N);break}}}v&&!g&&(_=t(_,Infinity));var W=D.length+_.length+M.length,B=W<y?new Array(y-W+1).join(d):"";v&&g&&(_=t(B+_,B.length?y-M.length:Infinity),B="");switch(h){case"<":_=D+_+M+B;break;case"=":_=D+B+_+M;break;case"^":_=B.slice(0,W=B.length>>1)+D+_+M+B.slice(W);break;default:_=B+D+_+M;break}return a(_)}return C.toString=function(){return f+""},C}function c(f,d){var h=u((f=Ep(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(jl(d)/3)))*3,m=Math.pow(10,-p),g=lM[8+p/3];return function(y){return h(m*y)+g}}return{format:u,formatPrefix:c}}var Sp,k1,uM;SG({thousands:",",grouping:[3],currency:["$",""]});function SG(e){return Sp=EG(e),k1=Sp.format,uM=Sp.formatPrefix,Sp}function TG(e){return Math.max(0,-jl(Math.abs(e)))}function AG(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jl(t)/3)))*3-jl(Math.abs(e)))}function _G(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,jl(t)-jl(e))+1}function cM(e,t,n,r){var i=Kb(e,t,n),a;r=Ep(r??",f");switch(r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(a=AG(i,o))&&(r.precision=a),uM(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=_G(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=TG(i))&&(r.precision=a-(r.type==="%")*2);break}}return k1(r)}function cs(e){var t=e.domain;return e.ticks=function(n){var r=t();return Jb(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return cM(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,a=r.length-1,o=r[i],s=r[a],l,u,c=10;for(s<o&&(u=o,o=s,s=u,u=i,i=a,a=u);c-- >0;){if(u=gO(o,s,n),u===l)return r[i]=o,r[a]=s,t(r);if(u>0)o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u;else if(u<0)o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u;else break;l=u}return e},e}function fM(){var e=nM();return e.copy=function(){return Hc(e,fM())},ii.apply(e,arguments),cs(e)}function dM(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,b1),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return dM(e).unknown(t)},e=arguments.length?Array.from(e,b1):[0,1],cs(n)}function hM(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],a=e[r],o;return a<i&&(o=n,n=r,r=o,o=i,i=a,a=o),e[n]=t.floor(i),e[r]=t.ceil(a),e}function pM(e){return Math.log(e)}function mM(e){return Math.exp(e)}function CG(e){return-Math.log(-e)}function $G(e){return-Math.exp(-e)}function OG(e){return isFinite(e)?+("1e"+e):e<0?0:e}function MG(e){return e===10?OG:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function DG(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function gM(e){return function(t){return-e(-t)}}function E1(e){var t=e(pM,mM),n=t.domain,r=10,i,a;function o(){return i=DG(r),a=MG(r),n()[0]<0?(i=gM(i),a=gM(a),e(CG,$G)):e(pM,mM),t}return t.base=function(s){return arguments.length?(r=+s,o()):r},t.domain=function(s){return arguments.length?(n(s),o()):n()},t.ticks=function(s){var l=n(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=i(u),h=i(c),p,m,g,y=s==null?10:+s,v=[];if(!(r%1)&&h-d<y){if(d=Math.floor(d),h=Math.ceil(h),u>0)for(;d<=h;++d)for(m=1,p=a(d);m<r;++m){if(g=p*m,g<u)continue;if(g>c)break;v.push(g)}else for(;d<=h;++d)for(m=r-1,p=a(d);m>=1;--m){if(g=p*m,g<u)continue;if(g>c)break;v.push(g)}v.length*2<y&&(v=Jb(u,c,y))}else v=Jb(d,h,Math.min(h-d,y)).map(a);return f?v.reverse():v},t.tickFormat=function(s,l){if(l==null&&(l=r===10?".0e":","),typeof l!="function"&&(l=k1(l)),s===Infinity)return l;s==null&&(s=10);var u=Math.max(1,r*s/t.ticks().length);return function(c){var f=c/a(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=u?l(c):""}},t.nice=function(){return n(hM(n(),{floor:function(s){return a(Math.floor(i(s)))},ceil:function(s){return a(Math.ceil(i(s)))}}))},t}function yM(){var e=E1(xp()).domain([1,10]);return e.copy=function(){return Hc(e,yM()).base(e.base())},ii.apply(e,arguments),e}function vM(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function bM(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function S1(e){var t=1,n=e(vM(t),bM(t));return n.constant=function(r){return arguments.length?e(vM(t=+r),bM(t)):t},cs(n)}function wM(){var e=S1(xp());return e.copy=function(){return Hc(e,wM()).constant(e.constant())},ii.apply(e,arguments)}function xM(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function NG(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function RG(e){return e<0?-e*e:e*e}function T1(e){var t=e(Cn,Cn),n=1;function r(){return n===1?e(Cn,Cn):n===.5?e(NG,RG):e(xM(n),xM(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},cs(t)}function A1(){var e=T1(xp());return e.copy=function(){return Hc(e,A1()).exponent(e.exponent())},ii.apply(e,arguments),e}function FG(){return A1.apply(null,arguments).exponent(.5)}function kM(){var e=[],t=[],n=[],r;function i(){var o=0,s=Math.max(1,t.length);for(n=new Array(s-1);++o<s;)n[o-1]=CW(e,o/s);return a}function a(o){return o==null||isNaN(o=+o)?r:t[os(n,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Wb),i()},a.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},a.unknown=function(o){return arguments.length?(r=o,a):r},a.quantiles=function(){return n.slice()},a.copy=function(){return kM().domain(e).range(t).unknown(r)},ii.apply(a,arguments)}function EM(){var e=0,t=1,n=1,r=[.5],i=[0,1],a;function o(l){return l!=null&&l<=l?i[os(r,l,0,n)]:a}function s(){var l=-1;for(r=new Array(n);++l<n;)r[l]=((l+1)*t-(l-n)*e)/(n+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(n=(i=Array.from(l)).length-1,s()):i.slice()},o.invertExtent=function(l){var u=i.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,r[0]]:u>=n?[r[n-1],t]:[r[u-1],r[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return r.slice()},o.copy=function(){return EM().domain([e,t]).range(i).unknown(a)},ii.apply(cs(o),arguments)}function SM(){var e=[.5],t=[0,1],n,r=1;function i(a){return a!=null&&a<=a?t[os(e,a,0,r)]:n}return i.domain=function(a){return arguments.length?(e=Array.from(a),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=Array.from(a),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return SM().domain(e).range(t).unknown(n)},ii.apply(i,arguments)}var _1=new Date(),C1=new Date();function At(e,t,n,r){function i(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var o=i(a),s=i.ceil(a);return a-o<s-a?o:s},i.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,s){var l=[],u;if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},i.filter=function(a){return At(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(i.count=function(a,o){return _1.setTime(+a),C1.setTime(+o),e(_1),e(C1),Math.floor(n(_1,C1))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(r?function(o){return r(o)%a===0}:function(o){return i.count(0,o)%a===0}):i}),i}var $1=At(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});$1.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?At(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):$1};const Ji=1e3,ur=Ji*60,Ki=ur*60,fs=Ki*24,O1=fs*7,TM=fs*30,M1=fs*365;var Ul=At(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Ji)},function(e,t){return(t-e)/Ji},function(e){return e.getUTCSeconds()}),AM=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ji)},function(e,t){e.setTime(+e+t*ur)},function(e,t){return(t-e)/ur},function(e){return e.getMinutes()}),_M=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ji-e.getMinutes()*ur)},function(e,t){e.setTime(+e+t*Ki)},function(e,t){return(t-e)/Ki},function(e){return e.getHours()}),Tp=At(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ur)/fs,e=>e.getDate()-1);function ds(e){return At(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*ur)/O1})}var D1=ds(0),N1=ds(1),zwe=ds(2),Pwe=ds(3),Wc=ds(4),jwe=ds(5),Uwe=ds(6),CM=At(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Ga=At(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ga.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:At(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var $M=At(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*ur)},function(e,t){return(t-e)/ur},function(e){return e.getUTCMinutes()}),OM=At(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Ki)},function(e,t){return(t-e)/Ki},function(e){return e.getUTCHours()}),Ap=At(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/fs},function(e){return e.getUTCDate()-1});function hs(e){return At(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/O1})}var R1=hs(0),F1=hs(1),Bwe=hs(2),qwe=hs(3),Gc=hs(4),Hwe=hs(5),Wwe=hs(6),MM=At(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),Ya=At(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ya.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:At(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};function DM(e,t,n,r,i,a){const o=[[Ul,1,Ji],[Ul,5,5*Ji],[Ul,15,15*Ji],[Ul,30,30*Ji],[a,1,ur],[a,5,5*ur],[a,15,15*ur],[a,30,30*ur],[i,1,Ki],[i,3,3*Ki],[i,6,6*Ki],[i,12,12*Ki],[r,1,fs],[r,2,2*fs],[n,1,O1],[t,1,TM],[t,3,3*TM],[e,1,M1]];function s(u,c,f){const d=c<u;d&&([u,c]=[c,u]);const h=f&&typeof f.range=="function"?f:l(u,c,f),p=h?h.range(u,+c+1):[];return d?p.reverse():p}function l(u,c,f){const d=Math.abs(c-u)/f,h=Gb(([,,g])=>g).right(o,d);if(h===o.length)return e.every(Kb(u/M1,c/M1,f));if(h===0)return $1.every(Math.max(Kb(u,c,f),1));const[p,m]=o[d/o[h-1][2]<o[h][2]/d?h-1:h];return p.every(m)}return[s,l]}const[IG,LG]=DM(Ya,MM,R1,Ap,OM,$M),[zG,PG]=DM(Ga,CM,D1,Tp,_M,AM);function I1(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function L1(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Yc(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function jG(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=Vc(i),c=Xc(i),f=Vc(a),d=Xc(a),h=Vc(o),p=Xc(o),m=Vc(s),g=Xc(s),y=Vc(l),v=Xc(l),b={a:P,A:W,b:B,B:se,c:null,d:zM,e:zM,f:uY,g:bY,G:xY,H:oY,I:sY,j:lY,L:PM,m:cY,M:fY,p:me,q:we,Q:WM,s:GM,S:dY,u:hY,U:pY,V:mY,w:gY,W:yY,x:null,X:null,y:vY,Y:wY,Z:kY,"%":HM},w={a:ye,A:Se,b:Ue,B:Pn,c:null,d:UM,e:UM,f:AY,g:IY,G:zY,H:EY,I:SY,j:TY,L:BM,m:_Y,M:CY,p:jn,q:zt,Q:WM,s:GM,S:$Y,u:OY,U:MY,V:DY,w:NY,W:RY,x:null,X:null,y:FY,Y:LY,Z:PY,"%":HM},x={a:C,A:_,b:D,B:M,c:N,d:IM,e:IM,f:nY,g:FM,G:RM,H:LM,I:LM,j:QG,L:tY,m:KG,M:ZG,p:A,q:JG,Q:iY,s:aY,S:eY,u:WG,U:GG,V:YG,w:HG,W:VG,x:T,X:O,y:FM,Y:RM,Z:XG,"%":rY};b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),w.x=E(n,w),w.X=E(r,w),w.c=E(t,w);function E(R,G){return function(K){var $=[],ge=-1,Z=0,Me=R.length,xe,qe,ut;for(K instanceof Date||(K=new Date(+K));++ge<Me;)R.charCodeAt(ge)===37&&($.push(R.slice(Z,ge)),(qe=NM[xe=R.charAt(++ge)])!=null?xe=R.charAt(++ge):qe=xe==="e"?" ":"0",(ut=G[xe])&&(xe=ut(K,qe)),$.push(xe),Z=ge+1);return $.push(R.slice(Z,ge)),$.join("")}}function k(R,G){return function(K){var $=Yc(1900,void 0,1),ge=S($,R,K+="",0),Z,Me;if(ge!=K.length)return null;if("Q"in $)return new Date($.Q);if("s"in $)return new Date($.s*1e3+("L"in $?$.L:0));if(G&&!("Z"in $)&&($.Z=0),"p"in $&&($.H=$.H%12+$.p*12),$.m===void 0&&($.m="q"in $?$.q:0),"V"in $){if($.V<1||$.V>53)return null;"w"in $||($.w=1),"Z"in $?(Z=L1(Yc($.y,0,1)),Me=Z.getUTCDay(),Z=Me>4||Me===0?F1.ceil(Z):F1(Z),Z=Ap.offset(Z,($.V-1)*7),$.y=Z.getUTCFullYear(),$.m=Z.getUTCMonth(),$.d=Z.getUTCDate()+($.w+6)%7):(Z=I1(Yc($.y,0,1)),Me=Z.getDay(),Z=Me>4||Me===0?N1.ceil(Z):N1(Z),Z=Tp.offset(Z,($.V-1)*7),$.y=Z.getFullYear(),$.m=Z.getMonth(),$.d=Z.getDate()+($.w+6)%7)}else("W"in $||"U"in $)&&("w"in $||($.w="u"in $?$.u%7:"W"in $?1:0),Me="Z"in $?L1(Yc($.y,0,1)).getUTCDay():I1(Yc($.y,0,1)).getDay(),$.m=0,$.d="W"in $?($.w+6)%7+$.W*7-(Me+5)%7:$.w+$.U*7-(Me+6)%7);return"Z"in $?($.H+=$.Z/100|0,$.M+=$.Z%100,L1($)):I1($)}}function S(R,G,K,$){for(var ge=0,Z=G.length,Me=K.length,xe,qe;ge<Z;){if($>=Me)return-1;if(xe=G.charCodeAt(ge++),xe===37){if(xe=G.charAt(ge++),qe=x[xe in NM?G.charAt(ge++):xe],!qe||($=qe(R,K,$))<0)return-1}else if(xe!=K.charCodeAt($++))return-1}return $}function A(R,G,K){var $=u.exec(G.slice(K));return $?(R.p=c.get($[0].toLowerCase()),K+$[0].length):-1}function C(R,G,K){var $=h.exec(G.slice(K));return $?(R.w=p.get($[0].toLowerCase()),K+$[0].length):-1}function _(R,G,K){var $=f.exec(G.slice(K));return $?(R.w=d.get($[0].toLowerCase()),K+$[0].length):-1}function D(R,G,K){var $=y.exec(G.slice(K));return $?(R.m=v.get($[0].toLowerCase()),K+$[0].length):-1}function M(R,G,K){var $=m.exec(G.slice(K));return $?(R.m=g.get($[0].toLowerCase()),K+$[0].length):-1}function N(R,G,K){return S(R,t,G,K)}function T(R,G,K){return S(R,n,G,K)}function O(R,G,K){return S(R,r,G,K)}function P(R){return o[R.getDay()]}function W(R){return a[R.getDay()]}function B(R){return l[R.getMonth()]}function se(R){return s[R.getMonth()]}function me(R){return i[+(R.getHours()>=12)]}function we(R){return 1+~~(R.getMonth()/3)}function ye(R){return o[R.getUTCDay()]}function Se(R){return a[R.getUTCDay()]}function Ue(R){return l[R.getUTCMonth()]}function Pn(R){return s[R.getUTCMonth()]}function jn(R){return i[+(R.getUTCHours()>=12)]}function zt(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var G=E(R+="",b);return G.toString=function(){return R},G},parse:function(R){var G=k(R+="",!1);return G.toString=function(){return R},G},utcFormat:function(R){var G=E(R+="",w);return G.toString=function(){return R},G},utcParse:function(R){var G=k(R+="",!0);return G.toString=function(){return R},G}}}var NM={"-":"",_:" ","0":"0"},_t=/^\s*\d+/,UG=/^%/,BG=/[\\^$*+?|[\]().{}]/g;function _e(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function qG(e){return e.replace(BG,"\\$&")}function Vc(e){return new RegExp("^(?:"+e.map(qG).join("|")+")","i")}function Xc(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function HG(e,t,n){var r=_t.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function WG(e,t,n){var r=_t.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function GG(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function YG(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function VG(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function RM(e,t,n){var r=_t.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function FM(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function XG(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function JG(e,t,n){var r=_t.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function KG(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function IM(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function QG(e,t,n){var r=_t.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function LM(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function ZG(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function eY(e,t,n){var r=_t.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function tY(e,t,n){var r=_t.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function nY(e,t,n){var r=_t.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function rY(e,t,n){var r=UG.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function iY(e,t,n){var r=_t.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function aY(e,t,n){var r=_t.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function zM(e,t){return _e(e.getDate(),t,2)}function oY(e,t){return _e(e.getHours(),t,2)}function sY(e,t){return _e(e.getHours()%12||12,t,2)}function lY(e,t){return _e(1+Tp.count(Ga(e),e),t,3)}function PM(e,t){return _e(e.getMilliseconds(),t,3)}function uY(e,t){return PM(e,t)+"000"}function cY(e,t){return _e(e.getMonth()+1,t,2)}function fY(e,t){return _e(e.getMinutes(),t,2)}function dY(e,t){return _e(e.getSeconds(),t,2)}function hY(e){var t=e.getDay();return t===0?7:t}function pY(e,t){return _e(D1.count(Ga(e)-1,e),t,2)}function jM(e){var t=e.getDay();return t>=4||t===0?Wc(e):Wc.ceil(e)}function mY(e,t){return e=jM(e),_e(Wc.count(Ga(e),e)+(Ga(e).getDay()===4),t,2)}function gY(e){return e.getDay()}function yY(e,t){return _e(N1.count(Ga(e)-1,e),t,2)}function vY(e,t){return _e(e.getFullYear()%100,t,2)}function bY(e,t){return e=jM(e),_e(e.getFullYear()%100,t,2)}function wY(e,t){return _e(e.getFullYear()%1e4,t,4)}function xY(e,t){var n=e.getDay();return e=n>=4||n===0?Wc(e):Wc.ceil(e),_e(e.getFullYear()%1e4,t,4)}function kY(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+_e(t/60|0,"0",2)+_e(t%60,"0",2)}function UM(e,t){return _e(e.getUTCDate(),t,2)}function EY(e,t){return _e(e.getUTCHours(),t,2)}function SY(e,t){return _e(e.getUTCHours()%12||12,t,2)}function TY(e,t){return _e(1+Ap.count(Ya(e),e),t,3)}function BM(e,t){return _e(e.getUTCMilliseconds(),t,3)}function AY(e,t){return BM(e,t)+"000"}function _Y(e,t){return _e(e.getUTCMonth()+1,t,2)}function CY(e,t){return _e(e.getUTCMinutes(),t,2)}function $Y(e,t){return _e(e.getUTCSeconds(),t,2)}function OY(e){var t=e.getUTCDay();return t===0?7:t}function MY(e,t){return _e(R1.count(Ya(e)-1,e),t,2)}function qM(e){var t=e.getUTCDay();return t>=4||t===0?Gc(e):Gc.ceil(e)}function DY(e,t){return e=qM(e),_e(Gc.count(Ya(e),e)+(Ya(e).getUTCDay()===4),t,2)}function NY(e){return e.getUTCDay()}function RY(e,t){return _e(F1.count(Ya(e)-1,e),t,2)}function FY(e,t){return _e(e.getUTCFullYear()%100,t,2)}function IY(e,t){return e=qM(e),_e(e.getUTCFullYear()%100,t,2)}function LY(e,t){return _e(e.getUTCFullYear()%1e4,t,4)}function zY(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Gc(e):Gc.ceil(e),_e(e.getUTCFullYear()%1e4,t,4)}function PY(){return"+0000"}function HM(){return"%"}function WM(e){return+e}function GM(e){return Math.floor(+e/1e3)}var Bl,YM,jY,VM,UY;BY({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function BY(e){return Bl=jG(e),YM=Bl.format,jY=Bl.parse,VM=Bl.utcFormat,UY=Bl.utcParse,Bl}function qY(e){return new Date(e)}function HY(e){return e instanceof Date?+e:+new Date(+e)}function z1(e,t,n,r,i,a,o,s,l,u){var c=nM(),f=c.invert,d=c.domain,h=u(".%L"),p=u(":%S"),m=u("%I:%M"),g=u("%I %p"),y=u("%a %d"),v=u("%b %d"),b=u("%B"),w=u("%Y");function x(E){return(l(E)<E?h:s(E)<E?p:o(E)<E?m:a(E)<E?g:r(E)<E?i(E)<E?y:v:n(E)<E?b:w)(E)}return c.invert=function(E){return new Date(f(E))},c.domain=function(E){return arguments.length?d(Array.from(E,HY)):d().map(qY)},c.ticks=function(E){var k=d();return e(k[0],k[k.length-1],E??10)},c.tickFormat=function(E,k){return k==null?x:u(k)},c.nice=function(E){var k=d();return(!E||typeof E.range!="function")&&(E=t(k[0],k[k.length-1],E??10)),E?d(hM(k,E)):c},c.copy=function(){return Hc(c,z1(e,t,n,r,i,a,o,s,l,u))},c}function WY(){return ii.apply(z1(zG,PG,Ga,CM,D1,Tp,_M,AM,Ul,YM).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function GY(){return ii.apply(z1(IG,LG,Ya,MM,R1,Ap,OM,$M,Ul,VM).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function _p(){var e=0,t=1,n,r,i,a,o=Cn,s=!1,l;function u(f){return f==null||isNaN(f=+f)?l:o(i===0?.5:(f=(a(f)-n)*i,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),r=a(t=+t),i=n===r?0:1/(r-n),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function c(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),u):[o(0),o(1)]}}return u.range=c(us),u.rangeRound=c(bp),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),u}}function Va(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function P1(){var e=cs(_p()(Cn));return e.copy=function(){return Va(e,P1())},Ha.apply(e,arguments)}function XM(){var e=E1(_p()).domain([1,10]);return e.copy=function(){return Va(e,XM()).base(e.base())},Ha.apply(e,arguments)}function JM(){var e=S1(_p());return e.copy=function(){return Va(e,JM()).constant(e.constant())},Ha.apply(e,arguments)}function j1(){var e=T1(_p());return e.copy=function(){return Va(e,j1()).exponent(e.exponent())},Ha.apply(e,arguments)}function YY(){return j1.apply(null,arguments).exponent(.5)}function Cp(){var e=0,t=.5,n=1,r=1,i,a,o,s,l,u=Cn,c,f=!1,d;function h(m){return isNaN(m=+m)?d:(m=.5+((m=+c(m))-a)*(r*m<r*a?s:l),u(f?Math.max(0,Math.min(1,m)):m))}h.domain=function(m){return arguments.length?([e,t,n]=m,i=c(e=+e),a=c(t=+t),o=c(n=+n),s=i===a?0:.5/(a-i),l=a===o?0:.5/(o-a),r=a<i?-1:1,h):[e,t,n]},h.clamp=function(m){return arguments.length?(f=!!m,h):f},h.interpolator=function(m){return arguments.length?(u=m,h):u};function p(m){return function(g){var y,v,b;return arguments.length?([y,v,b]=g,u=v1(m,[y,v,b]),h):[u(0),u(.5),u(1)]}}return h.range=p(us),h.rangeRound=p(bp),h.unknown=function(m){return arguments.length?(d=m,h):d},function(m){return c=m,i=m(e),a=m(t),o=m(n),s=i===a?0:.5/(a-i),l=a===o?0:.5/(o-a),r=a<i?-1:1,h}}function KM(){var e=cs(Cp()(Cn));return e.copy=function(){return Va(e,KM())},Ha.apply(e,arguments)}function QM(){var e=E1(Cp()).domain([.1,1,10]);return e.copy=function(){return Va(e,QM()).base(e.base())},Ha.apply(e,arguments)}function ZM(){var e=S1(Cp());return e.copy=function(){return Va(e,ZM()).constant(e.constant())},Ha.apply(e,arguments)}function U1(){var e=T1(Cp());return e.copy=function(){return Va(e,U1()).exponent(e.exponent())},Ha.apply(e,arguments)}function VY(){return U1.apply(null,arguments).exponent(.5)}function B1(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const XY="identity",ql="linear",Qi="log",Jc="pow",Kc="sqrt",$p="symlog",ps="time",ms="utc",li="sequential",Hl="diverging",Wl="quantile",Op="quantize",Mp="threshold",q1="ordinal",H1="point",eD="band",W1="bin-ordinal",pt="continuous",Qc="discrete",Zc="discretizing",cr="interpolating",G1="temporal";function JY(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function KY(e){return function(t){const n=e.range();let r=t[0],i=t[1],a=-1,o,s,l,u;for(i<r&&(s=r,r=i,i=s),l=0,u=n.length;l<u;++l)n[l]>=r&&n[l]<=i&&(a<0&&(a=l),o=l);return a<0?void 0:(r=e.invertExtent(n[a]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]])}}function Y1(){const e=Zb().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,a,o=!1,s=0,l=0,u=.5;delete e.unknown;function c(){const f=t().length,d=r[1]<r[0],h=r[1-d],p=B1(f,s,l);let m=r[d-0];i=(h-m)/(p||1),o&&(i=Math.floor(i)),m+=(h-m-i*(f-s))*u,a=i*(1-s),o&&(m=Math.round(m),a=Math.round(a));const g=$W(f).map(y=>m+i*y);return n(d?g.reverse():g)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),s=l,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=r[1]<r[0],h=d?n().reverse():n(),p=h.length-1;let m=+f[0],g=+f[1],y,v,b;return m!==m||g!==g?void 0:(g<m&&(b=m,m=g,g=b),g<h[0]||m>r[1-d]?void 0:(y=Math.max(0,os(h,m)-1),v=m===g?y:os(h,g)-1,m-h[y]>a+1e-10&&++y,d&&(b=y,y=p-v,v=p-b),y>v?void 0:t().slice(y,v+1)))},e.invert=function(f){const d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return Y1().domain(t()).range(r).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function tD(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return tD(t())},e}function QY(){return tD(Y1().paddingInner(1))}var ZY=Array.prototype.map;function eV(e){return ZY.call(e,Bt)}const tV=Array.prototype.slice;function nD(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(os(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=eV(r),n):e.slice()},n.range=function(r){return arguments.length?(t=tV.call(r),n):t.slice()},n.tickFormat=function(r,i){return cM(e[0],ve(e),r??10,i)},n.copy=function(){return nD().domain(n.domain()).range(n.range())},n}const Dp={};function nV(e,t,n){const r=function(){const a=t();return a.invertRange||(a.invertRange=a.invert?JY(a):a.invertExtent?KY(a):void 0),a.type=e,a};return r.metadata=kt(J(n)),r}function Ce(e,t,n){return arguments.length>1?(Dp[e]=nV(e,t,n),this):rD(e)?Dp[e]:void 0}Ce(XY,dM),Ce(ql,fM,pt),Ce(Qi,yM,[pt,Qi]),Ce(Jc,A1,pt),Ce(Kc,FG,pt),Ce($p,wM,pt),Ce(ps,WY,[pt,G1]),Ce(ms,GY,[pt,G1]),Ce(li,P1,[pt,cr]),Ce("".concat(li,"-").concat(ql),P1,[pt,cr]),Ce("".concat(li,"-").concat(Qi),XM,[pt,cr,Qi]),Ce("".concat(li,"-").concat(Jc),j1,[pt,cr]),Ce("".concat(li,"-").concat(Kc),YY,[pt,cr]),Ce("".concat(li,"-").concat($p),JM,[pt,cr]),Ce("".concat(Hl,"-").concat(ql),KM,[pt,cr]),Ce("".concat(Hl,"-").concat(Qi),QM,[pt,cr,Qi]),Ce("".concat(Hl,"-").concat(Jc),U1,[pt,cr]),Ce("".concat(Hl,"-").concat(Kc),VY,[pt,cr]),Ce("".concat(Hl,"-").concat($p),ZM,[pt,cr]),Ce(Wl,kM,[Zc,Wl]),Ce(Op,EM,Zc),Ce(Mp,SM,Zc),Ce(W1,nD,[Qc,Zc]),Ce(q1,Zb,Qc),Ce(eD,Y1,Qc),Ce(H1,QY,Qc);function rD(e){return te(Dp,e)}function gs(e,t){const n=Dp[e];return n&&n.metadata[t]}function V1(e){return gs(e,pt)}function Gl(e){return gs(e,Qc)}function X1(e){return gs(e,Zc)}function iD(e){return gs(e,Qi)}function rV(e){return gs(e,G1)}function aD(e){return gs(e,cr)}function oD(e){return gs(e,Wl)}const iV=["clamp","base","constant","exponent"];function sD(e,t){const n=t[0],r=ve(t)-n;return function(i){return e(n+i*r)}}function Np(e,t,n){return v1(J1(t||"rgb",n),e)}function lD(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function uD(e,t,n){const r=n-t;let i,a,o;return!r||!Number.isFinite(r)?qt(.5):(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=Ce(a)().domain([t,n]).range([0,1]),iV.forEach(s=>e[s]?o[s](e[s]()):0),o)}function J1(e,t){const n=dG[aV(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function aV(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const oV={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},sV={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function cD(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function fD(e,t){for(const n in e)K1(n,t(e[n]))}const dD={};fD(sV,cD),fD(oV,e=>Np(cD(e)));function K1(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(dD[e]=t,this):dD[e]}const Rp="symbol",lV="discrete",uV="gradient",cV=e=>z(e)?e.map(t=>String(t)):String(e),fV=(e,t)=>e[1]-t[1],dV=(e,t)=>t[1]-e[1];function Q1(e,t,n){let r;return Le(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(fc(e.domain())/n||1)))),Q(t)&&(r=t.step,t=t.interval),X(t)&&(t=e.type===ps?Sl(t):e.type==ms?Tl(t):L("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function hD(e,t,n){let r=e.range(),i=r[0],a=ve(r),o=fV;if(i>a&&(r=a,a=i,i=r,o=dV),i=Math.floor(i),a=Math.ceil(a),t=t.map(s=>[s,e(s)]).filter(s=>i<=s[1]&&s[1]<=a).sort(o).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=s)}return t}function Z1(e,t){return e.bins?hD(e,e.bins):e.ticks?e.ticks(t):e.domain()}function pD(e,t,n,r,i,a){const o=t.type;let s=cV;if(o===ps||i===ps)s=e.timeFormat(r);else if(o===ms||i===ms)s=e.utcFormat(r);else if(iD(o)){const l=e.formatFloat(r);if(a||t.bins)s=l;else{const u=mD(t,n,!1);s=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,r)}else r&&(s=e.format(r));return s}function mD(e,t,n){const r=Z1(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=l=>{let u=l/Math.pow(i,Math.round(Math.log(l)/a));return u*i<i-.5&&(u*=i),u<=o};return n?r.filter(s):s}const ew={[Wl]:"quantiles",[Op]:"thresholds",[Mp]:"domain"},gD={[Wl]:"quantiles",[Op]:"domain"};function yD(e,t){return e.bins?mV(e.bins):e.type===Qi?mD(e,t,!0):ew[e.type]?pV(e[ew[e.type]]()):Z1(e,t)}function hV(e,t,n){const r=t[gD[t.type]](),i=r.length;let a=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)a=Math.min(a,r[o]-r[o-1]);return e.formatSpan(0,a,3*10,n)}function pV(e){const t=[-Infinity].concat(e);return t.max=Infinity,t}function mV(e){const t=e.slice(0,-1);return t.max=ve(e),t}const gV=e=>ew[e.type]||e.bins;function vD(e,t,n,r,i,a,o){const s=gD[t.type]&&a!==ps&&a!==ms?hV(e,t,i):pD(e,t,n,i,a,o);return r===Rp&&gV(t)?yV(s):r===lV?vV(s):bV(s)}const yV=e=>(t,n,r)=>{const i=bD(r[n+1],bD(r.max,Infinity)),a=wD(t,e),o=wD(i,e);return a&&o?a+"  "+o:o?"< "+o:" "+a},bD=(e,t)=>e??t,vV=e=>(t,n)=>n?e(t):null,bV=e=>t=>e(t),wD=(e,t)=>Number.isFinite(e)?t(e):null;function wV(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+ve(t),a=i-r;if(e.type===Mp){const o=n?a/n:.1;r-=o,i+=o,a=i-r}return o=>(o-r)/a}function xV(e,t,n,r){const i=r||t.type;return X(n)&&rV(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===ps?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===ms?e.utcFormat("%A, %d %B %Y, %X UTC"):vD(e,t,5,null,n,r,!0)}function xD(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=xV(e,t,n.format,n.formatType);if(X1(t.type)){const a=yD(t).slice(1).map(i),o=a.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(a.join(", "))}else if(Gl(t.type)){const a=t.domain(),o=a.length,s=o>r?a.slice(0,r-2).map(i).join(", ")+", ending with "+a.slice(-1).map(i):a.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(s)}else{const a=t.domain();return"values from ".concat(i(a[0])," to ").concat(i(ve(a)))}}let kD=0;function kV(){kD=0}const Fp="p_";function tw(e){return e&&e.gradient}function ED(e,t,n){const r=e.gradient;let i=e.id,a=r==="radial"?Fp:"";return i||(i=e.id="gradient_"+kD++,r==="radial"?(e.x1=ui(e.x1,.5),e.y1=ui(e.y1,.5),e.r1=ui(e.r1,0),e.x2=ui(e.x2,.5),e.y2=ui(e.y2,.5),e.r2=ui(e.r2,.5),a=Fp):(e.x1=ui(e.x1,0),e.y1=ui(e.y1,0),e.x2=ui(e.x2,1),e.y2=ui(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function ui(e,t){return e??t}function SD(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(i,a){return n.push({offset:i,color:a}),r}}}const TD={basis:{curve:lW},"basis-closed":{curve:uW},"basis-open":{curve:cW},bundle:{curve:fW,tension:"beta",value:.85},cardinal:{curve:dW,tension:"tension",value:0},"cardinal-open":{curve:pW,tension:"tension",value:0},"cardinal-closed":{curve:hW,tension:"tension",value:0},"catmull-rom":{curve:mW,tension:"alpha",value:.5},"catmull-rom-closed":{curve:gW,tension:"alpha",value:.5},"catmull-rom-open":{curve:yW,tension:"alpha",value:.5},linear:{curve:Pb},"linear-closed":{curve:vW},monotone:{horizontal:wW,vertical:bW},natural:{curve:xW},step:{curve:kW},"step-after":{curve:SW},"step-before":{curve:EW}};function nw(e,t,n){var r=te(TD,e)&&TD[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const EV={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},ef=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Yl(e){const t=[];let n,r,i,a,o,s,l,u,c,f;const d=e.slice().replace(ef[0],"###$1").split(ef[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],r=n.slice(1).trim().replace(ef[2],"$1###$2").replace(ef[3],"$1###$2").split(ef[4]),o=n.charAt(0),i=[o],u=0,f=r.length;u<f;++u)(a=+r[u])===a&&i.push(a);if(s=EV[o.toLowerCase()],i.length-1>s){const h=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o=o==="M"?"L":o==="m"?"l":o;u<h;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const Xa=Math.PI/180,SV=1e-14,ys=Math.PI/2,ci=Math.PI*2,Vl=Math.sqrt(3)/2;var rw={},iw={},AD=[].join;function TV(e,t,n,r,i,a,o,s,l){const u=AD.call(arguments);if(rw[u])return rw[u];const c=o*Xa,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5;let m=h*h/(n*n)+p*p/(r*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=d/n,y=f/n,v=-f/r,b=d/r,w=g*s+y*l,x=v*s+b*l,E=g*e+y*t,k=v*e+b*t,S=(E-w)*(E-w)+(k-x)*(k-x);let A=1/S-.25;A<0&&(A=0);let C=Math.sqrt(A);a==i&&(C=-C);const _=.5*(w+E)-C*(k-x),D=.5*(x+k)+C*(E-w),M=Math.atan2(x-D,w-_),N=Math.atan2(k-D,E-_);let T=N-M;T<0&&a===1?T+=ci:T>0&&a===0&&(T-=ci);const O=Math.ceil(Math.abs(T/(ys+.001))),P=[];for(let W=0;W<O;++W){const B=M+W*T/O,se=M+(W+1)*T/O;P[W]=[_,D,B,se,n,r,f,d]}return rw[u]=P}function AV(e){const t=AD.call(e);if(iw[t])return iw[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(v*.5),w=8/3*b*b/Math.sin(v),x=n+p-w*m,E=r+m+w*p,k=n+g,S=r+y,A=k+w*y,C=S-w*g;return iw[t]=[c*x+f*E,d*x+h*E,c*A+f*C,d*A+h*C,c*k+f*S,d*k+h*S]}const fr=["l",0,0,0,0,0,0,0];function _V(e,t,n){const r=fr[0]=e[0];if(r==="a"||r==="A")fr[1]=t*e[1],fr[2]=n*e[2],fr[3]=e[3],fr[4]=e[4],fr[5]=e[5],fr[6]=t*e[6],fr[7]=n*e[7];else if(r==="h"||r==="H")fr[1]=t*e[1];else if(r==="v"||r==="V")fr[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)fr[i]=(i%2==1?t:n)*e[i];return fr}function tf(e,t,n,r,i,a){var o,s=null,l=0,u=0,c=0,f=0,d,h,p,m;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),a==null&&(a=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){o=t[g],(i!==1||a!==1)&&(o=_V(o,i,a));switch(o[0]){case"l":l+=o[1],u+=o[2],e.lineTo(l+n,u+r);break;case"L":l=o[1],u=o[2],e.lineTo(l+n,u+r);break;case"h":l+=o[1],e.lineTo(l+n,u+r);break;case"H":l=o[1],e.lineTo(l+n,u+r);break;case"v":u+=o[1],e.lineTo(l+n,u+r);break;case"V":u=o[1],e.lineTo(l+n,u+r);break;case"m":l+=o[1],u+=o[2],e.moveTo(l+n,u+r);break;case"M":l=o[1],u=o[2],e.moveTo(l+n,u+r);break;case"c":d=l+o[5],h=u+o[6],c=l+o[3],f=u+o[4],e.bezierCurveTo(l+o[1]+n,u+o[2]+r,c+n,f+r,d+n,h+r),l=d,u=h;break;case"C":l=o[5],u=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,l+n,u+r);break;case"s":d=l+o[3],h=u+o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+r,l+o[1]+n,u+o[2]+r,d+n,h+r),c=l+o[1],f=u+o[2],l=d,u=h;break;case"S":d=o[3],h=o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,d+n,h+r),l=d,u=h,c=o[1],f=o[2];break;case"q":d=l+o[3],h=u+o[4],c=l+o[1],f=u+o[2],e.quadraticCurveTo(c+n,f+r,d+n,h+r),l=d,u=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,d+n,h+r),l=d,u=h,c=o[1],f=o[2];break;case"t":d=l+o[1],h=u+o[2],s[0].match(/[QqTt]/)===null?(c=l,f=u):s[0]==="t"?(c=2*l-p,f=2*u-m):s[0]==="q"&&(c=2*l-c,f=2*u-f),p=c,m=f,e.quadraticCurveTo(c+n,f+r,d+n,h+r),l=d,u=h,c=l+o[1],f=u+o[2];break;case"T":d=o[1],h=o[2],c=2*l-c,f=2*u-f,e.quadraticCurveTo(c+n,f+r,d+n,h+r),l=d,u=h;break;case"a":_D(e,l+n,u+r,[o[1],o[2],o[3],o[4],o[5],o[6]+l+n,o[7]+u+r]),l+=o[6],u+=o[7];break;case"A":_D(e,l+n,u+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),l=o[6],u=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function _D(e,t,n,r){const i=TV(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let a=0;a<i.length;++a){const o=AV(i[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const CD=.5773502691896257,$D={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,ci)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n,i=r-n*CD,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n,i=r-n*CD;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=Vl*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function OD(e){return te($D,e)?$D[e]:CV(e)}var aw={};function CV(e){if(!te(aw,e)){const t=Yl(e);aw[e]={draw:function(n,r){tf(n,t,0,0,Math.sqrt(r)/2)}}}return aw[e]}const Ja=.448084975506;function $V(e){return e.x}function OV(e){return e.y}function MV(e){return e.width}function DV(e){return e.height}function Zi(e){return typeof e=="function"?e:()=>+e}function Ip(e,t,n){return Math.max(t,Math.min(e,n))}function MD(){var e=$V,t=OV,n=MV,r=DV,i=Zi(0),a=i,o=i,s=i,l=null;function u(c,f,d){var h,p=f??+e.call(this,c),m=d??+t.call(this,c),g=+n.call(this,c),y=+r.call(this,c),v=Math.min(g,y)/2,b=Ip(+i.call(this,c),0,v),w=Ip(+a.call(this,c),0,v),x=Ip(+o.call(this,c),0,v),E=Ip(+s.call(this,c),0,v);if(l||(l=h=is()),b<=0&&w<=0&&x<=0&&E<=0)l.rect(p,m,g,y);else{var k=p+g,S=m+y;l.moveTo(p+b,m),l.lineTo(k-w,m),l.bezierCurveTo(k-Ja*w,m,k,m+Ja*w,k,m+w),l.lineTo(k,S-E),l.bezierCurveTo(k,S-Ja*E,k-Ja*E,S,k-E,S),l.lineTo(p+x,S),l.bezierCurveTo(p+Ja*x,S,p,S-Ja*x,p,S-x),l.lineTo(p,m+b),l.bezierCurveTo(p,m+Ja*b,p+Ja*b,m,p+b,m),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(c){return arguments.length?(e=Zi(c),u):e},u.y=function(c){return arguments.length?(t=Zi(c),u):t},u.width=function(c){return arguments.length?(n=Zi(c),u):n},u.height=function(c){return arguments.length?(r=Zi(c),u):r},u.cornerRadius=function(c,f,d,h){return arguments.length?(i=Zi(c),a=f!=null?Zi(f):i,s=d!=null?Zi(d):i,o=h!=null?Zi(h):a,u):i},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function DD(){var e,t,n,r,i=null,a,o,s,l;function u(f,d,h){const p=h/2;if(a){var m=s-d,g=f-o;if(m||g){var y=Math.sqrt(m*m+g*g),v=(m/=y)*l,b=(g/=y)*l,w=Math.atan2(g,m);i.moveTo(o-v,s-b),i.lineTo(f-m*p,d-g*p),i.arc(f,d,p,w-Math.PI,w),i.lineTo(o+v,s+b),i.arc(o,s,l,w,w+Math.PI)}else i.arc(f,d,p,0,ci);i.closePath()}else a=1;o=f,s=d,l=p}function c(f){var d,h=f.length,p,m=!1,g;for(i==null&&(i=g=is()),d=0;d<=h;++d)!(d<h&&r(p=f[d],d,f))===m&&((m=!m)&&(a=0)),m&&u(+e(p,d,f),+t(p,d,f),+n(p,d,f));if(g)return i=null,g+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function nf(e,t){return e??t}const rf=e=>e.x||0,af=e=>e.y||0,NV=e=>e.width||0,RV=e=>e.height||0,FV=e=>(e.x||0)+(e.width||0),IV=e=>(e.y||0)+(e.height||0),LV=e=>e.startAngle||0,zV=e=>e.endAngle||0,PV=e=>e.padAngle||0,jV=e=>e.innerRadius||0,UV=e=>e.outerRadius||0,BV=e=>e.cornerRadius||0,qV=e=>nf(e.cornerRadiusTopLeft,e.cornerRadius)||0,HV=e=>nf(e.cornerRadiusTopRight,e.cornerRadius)||0,WV=e=>nf(e.cornerRadiusBottomRight,e.cornerRadius)||0,GV=e=>nf(e.cornerRadiusBottomLeft,e.cornerRadius)||0,YV=e=>nf(e.size,64),VV=e=>e.size||1,Lp=e=>!(e.defined===!1),XV=e=>OD(e.shape||"circle"),JV=aW().startAngle(LV).endAngle(zV).padAngle(PV).innerRadius(jV).outerRadius(UV).cornerRadius(BV),KV=eO().x(rf).y1(af).y0(IV).defined(Lp),QV=eO().y(af).x1(rf).x0(FV).defined(Lp),ZV=Z$().x(rf).y(af).defined(Lp),eX=MD().x(rf).y(af).width(NV).height(RV).cornerRadius(qV,HV,WV,GV),tX=sW().type(XV).size(YV),nX=DD().x(rf).y(af).defined(Lp).size(VV);function ow(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function rX(e,t){return JV.context(e)(t)}function iX(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?QV:KV).curve(nw(r,n.orient,n.tension)).context(e)(t)}function aX(e,t){const n=t[0],r=n.interpolate||"linear";return ZV.curve(nw(r,n.orient,n.tension)).context(e)(t)}function Xl(e,t,n,r){return eX.context(e)(t,n,r)}function oX(e,t){return(t.mark.shape||t.shape).context(e)(t)}function sX(e,t){return tX.context(e)(t)}function lX(e,t){return nX.context(e)(t)}var ND=1;function RD(){ND=1}function sw(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+ND++),o=i.clipping[a]||(i.clipping[a]={id:a});return le(r)?o.path=r(null):ow(n)?o.path=Xl(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function mt(e){this.clear(),e&&this.union(e)}mt.prototype={clone(){return new mt(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function zp(e){this.mark=e,this.bounds=this.bounds||new mt()}function Pp(e){zp.call(this,e),this.items=this.items||[]}q(Pp,zp);function lw(e){this._pending=0,this._loader=e||qh()}function FD(e){e._pending+=1}function of(e){e._pending-=1}lw.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return FD(t),t._loader.sanitize(e,{context:"href"}).then(n=>(of(t),n)).catch(()=>(of(t),null))},loadImage(e){const t=this,n=TW();return FD(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const a=new n(),o=te(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>of(t),a.onerror=()=>of(t),a.src=i,a}).catch(r=>(of(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function ea(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?uX(t,r):0))}return e}function uX(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const cX=ci-1e-8;let jp,Up,Bp,vs,uw,qp,cw,fw;const Ka=(e,t)=>jp.add(e,t),Hp=(e,t)=>Ka(Up=e,Bp=t),ID=e=>Ka(e,jp.y1),LD=e=>Ka(jp.x1,e),bs=(e,t)=>uw*e+cw*t,ws=(e,t)=>qp*e+fw*t,dw=(e,t)=>Ka(bs(e,t),ws(e,t)),hw=(e,t)=>Hp(bs(e,t),ws(e,t));function sf(e,t){return jp=e,t?(vs=t*Xa,uw=fw=Math.cos(vs),qp=Math.sin(vs),cw=-qp):(uw=fw=1,vs=qp=cw=0),fX}const fX={beginPath(){},closePath(){},moveTo:hw,lineTo:hw,rect(e,t,n,r){vs?(dw(e+n,t),dw(e+n,t+r),dw(e,t+r),hw(e,t)):(Ka(e+n,t+r),Hp(e,t))},quadraticCurveTo(e,t,n,r){const i=bs(e,t),a=ws(e,t),o=bs(n,r),s=ws(n,r);zD(Up,i,o,ID),zD(Bp,a,s,LD),Hp(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=bs(e,t),s=ws(e,t),l=bs(n,r),u=ws(n,r),c=bs(i,a),f=ws(i,a);PD(Up,o,l,c,ID),PD(Bp,s,u,f,LD),Hp(c,f)},arc(e,t,n,r,i,a){if(r+=vs,i+=vs,Up=n*Math.cos(i)+e,Bp=n*Math.sin(i)+t,Math.abs(i-r)>cX)Ka(e-n,t-n),Ka(e+n,t+n);else{const o=u=>Ka(n*Math.cos(u)+e,n*Math.sin(u)+t);let s,l;if(o(r),o(i),i!==r)if(r=r%ci,r<0&&(r+=ci),i=i%ci,i<0&&(i+=ci),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=ci,s=r-r%ys,l=0;l<4&&s>i;++l,s-=ys)o(s);else for(s=r-r%ys+ys,l=0;l<4&&s<i;++l,s=s+ys)o(s)}}};function zD(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function PD(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l=0,u=0,c;Math.abs(a)>SV?(c=o*o+s*a,c>=0&&(c=Math.sqrt(c),l=(-o+c)/a,u=(-o-c)/a)):l=.5*s/o,0<l&&l<1&&i(jD(l,e,t,n,r)),0<u&&u<1&&i(jD(u,e,t,n,r))}function jD(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var Qa=(Qa=Fl(1,1))?Qa.getContext("2d"):null;const pw=new mt();function mw(e){return function(t,n){if(!Qa)return!0;e(Qa,t),pw.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=pw;for(let s=i;s<=o;++s)for(let l=r;l<=a;++l)if(Qa.isPointInPath(l,s))return!0;return!1}}function gw(e,t){return t.contains(e.x||0,e.y||0)}function UD(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(pw.set(n,r,n+i,r+a))}function BD(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:r;return Jl(t,n,r,i,a)}function Jl(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let f=0,d=1,h,p,m,g;for(g=0;g<4;++g){if(g===0&&(h=-u,p=-(a-t)),g===1&&(h=u,p=s-t),g===2&&(h=-c,p=-(o-n)),g===3&&(h=c,p=l-n),Math.abs(h)<1e-10&&p<0)return!1;if(m=p/h,h<0){if(m>d)return!1;m>f&&(f=m)}else if(h>0){if(m<f)return!1;m<d&&(d=m)}}return!0}function Kl(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Or(e,t){return e??t}function qD(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function dX(e,t,n){const r=n.width(),i=n.height();let a;if(t.gradient==="radial")a=e.createRadialGradient(n.x1+Or(t.x1,.5)*r,n.y1+Or(t.y1,.5)*i,Math.max(r,i)*Or(t.r1,0),n.x1+Or(t.x2,.5)*r,n.y1+Or(t.y2,.5)*i,Math.max(r,i)*Or(t.r2,.5));else{const o=Or(t.x1,0),s=Or(t.y1,0),l=Or(t.x2,1),u=Or(t.y2,0);if(o===l||s===u||r===i)a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i);else{const c=Fl(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=qD(f.createLinearGradient(o,s,l,u),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return qD(a,t.stops)}function HD(e,t,n){return tw(n)?dX(e,n,t.bounds):n}function Wp(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=HD(e,t,t.fill),!0):!1}var hX=[];function Ql(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=HD(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||hX),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function pX(e,t){return e.zindex-t.zindex||e.index-t.index}function yw(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,a;for(i=0,a=t.length;i<a;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(pX)}function Mr(e,t){var n=e.items,r,i;if(!n||!n.length)return;const a=yw(e);if(a&&a.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=a}for(r=0,i=n.length;r<i;++r)t(n[r])}function Gp(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const a=yw(e);for(a&&a.length&&(n=a),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===a){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function vw(e){return function(t,n,r){Mr(n,i=>{(!r||r.intersects(i.bounds))&&WD(e,t,i,i)})}}function mX(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&WD(e,t,n.items[0],n.items)}}function WD(e,t,n,r){var i=n.opacity==null?1:n.opacity;if(i===0)return;if(e(t,r))return;Kl(t,n),n.fill&&Wp(t,n,i)&&t.fill(),n.stroke&&Ql(t,n,i)&&t.stroke()}function Yp(e){return e=e||or,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,Gp(n,s=>{const l=s.bounds;if(l&&!l.contains(a,o)||!l)return;if(e(t,s,r,i,a,o))return s})}}function lf(e,t){return function(n,r,i,a){var o=Array.isArray(r)?r[0]:r,s=t??o.fill,l=o.stroke&&n.isPointInStroke,u,c;return l&&(u=o.strokeWidth,c=o.strokeCap,n.lineWidth=u??1,n.lineCap=c??"butt"),e(n,r)?!1:s&&n.isPointInPath(i,a)||l&&n.isPointInStroke(i,a)}}function bw(e){return Yp(lf(e))}function xs(e,t){return"translate("+e+","+t+")"}function ww(e){return"rotate("+e+")"}function gX(e,t){return"scale("+e+","+t+")"}function GD(e){return xs(e.x||0,e.y||0)}function yX(e){return xs(e.x||0,e.y||0)+(e.angle?" "+ww(e.angle):"")}function vX(e){return xs(e.x||0,e.y||0)+(e.angle?" "+ww(e.angle):"")+(e.scaleX||e.scaleY?" "+gX(e.scaleX||1,e.scaleY||1):"")}function xw(e,t,n){function r(o,s){o("transform",yX(s)),o("d",t(null,s))}function i(o,s){return t(sf(o,s.angle),s),ea(o,s).translate(s.x||0,s.y||0)}function a(o,s){var l=s.x||0,u=s.y||0,c=s.angle||0;o.translate(l,u),c&&o.rotate(c*=Xa),o.beginPath(),t(o,s),c&&o.rotate(-c),o.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:vw(a),pick:bw(a),isect:n||mw(a)}}var bX=xw("arc",rX);function wX(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,a=Infinity,o,s;--i>=0;){if(e[i].defined===!1)continue;s=Math.abs(e[i][r]-n),s<a&&(a=s,o=e[i])}return o}function xX(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,a,o;--r>=0;){if(e[r].defined===!1)continue;if(i=e[r].x-t[0],a=e[r].y-t[1],o=i*i+a*a,o<n)return e[r]}return null}function kX(e,t){for(var n=e.length,r,i,a;--n>=0;){if(e[n].defined===!1)continue;if(r=e[n].x-t[0],i=e[n].y-t[1],a=r*r+i*i,r=e[n].size||1,a<r*r)return e[n]}return null}function kw(e,t,n){function r(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))}function i(l,u){var c=u.items;return c.length===0?l:(t(sf(l),c),ea(l,c[0]))}function a(l,u){l.beginPath(),t(l,u)}const o=lf(a);function s(l,u,c,f,d,h){var p=u.items,m=u.bounds;return!p||!p.length||m&&!m.contains(d,h)?null:(c*=l.pixelRatio,f*=l.pixelRatio,o(l,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:mX(a),pick:s,isect:gw,tip:n}}var EX=kw("area",iX,wX);function SX(e,t){var n=t.clip;e.save(),le(n)?(e.beginPath(),n(e),e.clip()):YD(e,t.group)}function YD(e,t){e.beginPath(),ow(t)?Xl(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function VD(e){const t=Or(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function TX(e,t){e("transform",GD(t))}function XD(e,t){const n=VD(t);e("d",Xl(null,t,n,n))}function AX(e,t){e("class","background"),e("aria-hidden",!0),XD(e,t)}function _X(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?XD(e,t):e("d","")}function CX(e,t,n){const r=t.clip?sw(n,t,t):null;e("clip-path",r)}function $X(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),ea(e,t),e.translate(t.x||0,t.y||0)}function uf(e,t,n,r){const i=VD(t);e.beginPath(),Xl(e,t,(n||0)+i,(r||0)+i)}const OX=lf(uf),MX=lf(uf,!1),DX=lf(uf,!0);function NX(e,t,n){Mr(t,r=>{const i=r.x||0,a=r.y||0,o=r.strokeForeground,s=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&s&&(uf(e,r,i,a),Kl(e,r),r.fill&&Wp(e,r,s)&&e.fill(),r.stroke&&!o&&Ql(e,r,s)&&e.stroke()),e.save(),e.translate(i,a),r.clip&&YD(e,r),n&&n.translate(-i,-a),Mr(r,l=>{this.draw(e,l,n)}),n&&n.translate(i,a),e.restore(),o&&r.stroke&&s&&(uf(e,r,i,a),Kl(e,r),Ql(e,r,s)&&e.stroke())})}function RX(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return Gp(t,l=>{let u,c,f;const d=l.bounds;if(d&&!d.contains(i,a))return;c=l.x||0,f=l.y||0;const h=c+(l.width||0),p=f+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<f||a>p))return;if(e.save(),e.translate(c,f),c=i-c,f=a-f,m&&ow(l)&&!DX(e,l,o,s))return e.restore(),null;const g=l.strokeForeground,y=t.interactive!==!1;return y&&g&&l.stroke&&MX(e,l,o,s)?(e.restore(),l):(u=Gp(l,v=>FX(v,c,f)?this.pick(v,n,r,c,f):null),!u&&y&&(l.fill||!g&&l.stroke)&&OX(e,l,o,s)&&(u=l),e.restore(),u||null)})}function FX(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var IX={type:"group",tag:"g",nested:!1,attr:TX,bound:$X,draw:NX,pick:RX,isect:UD,content:CX,background:AX,foreground:_X},cf={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Ew(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function Sw(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Tw(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function Vp(e,t){return e==="center"?t/2:e==="right"?t:0}function Xp(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function LX(e,t,n){const r=Ew(t,n),i=Sw(t,r),a=Tw(t,r),o=(t.x||0)-Vp(t.align,i),s=(t.y||0)-Xp(t.baseline,a),l=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",l,cf["xmlns:xlink"],"xlink:href"),e("transform",xs(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function zX(e,t){const n=t.image,r=Sw(t,n),i=Tw(t,n),a=(t.x||0)-Vp(t.align,r),o=(t.y||0)-Xp(t.baseline,i);return e.set(a,o,a+r,o+i)}function PX(e,t,n){Mr(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=Ew(r,this);let a=Sw(r,i),o=Tw(r,i);if(a===0||o===0)return;let s=(r.x||0)-Vp(r.align,a),l=(r.y||0)-Xp(r.baseline,o),u,c,f,d;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(d=a/c,l+=(o-d)/2,o=d):(d=o*c,s+=(a-d)/2,a=d))),(i.complete||i.toDataURL)&&(Kl(e,r),e.globalAlpha=(u=r.opacity)!=null?u:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,s,l,a,o))})}var jX={type:"image",tag:"image",nested:!1,attr:LX,bound:zX,draw:PX,pick:Yp(),isect:or,get:Ew,xOffset:Vp,yOffset:Xp},UX=kw("line",aX,xX);function BX(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",vX(t)),e("d",t.path)}function Jp(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*Xa,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Yl(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),tf(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):tf(e,l,r,i,a,o)}function qX(e,t){return Jp(sf(e,t.angle),t)?e.set(0,0,0,0):ea(e,t,!0)}var HX={type:"path",tag:"path",nested:!1,attr:BX,bound:qX,draw:vw(Jp),pick:bw(Jp),isect:mw(Jp)};function WX(e,t){e("d",Xl(null,t))}function GX(e,t){var n,r;return ea(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function JD(e,t){e.beginPath(),Xl(e,t)}var YX={type:"rect",tag:"path",nested:!1,attr:WX,bound:GX,draw:vw(JD),pick:bw(JD),isect:UD};function VX(e,t){e("transform",GD(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function XX(e,t){var n,r;return ea(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function KD(e,t,n){var r,i,a,o;return t.stroke&&Ql(e,t,n)?(r=t.x||0,i=t.y||0,a=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0):!1}function JX(e,t,n){Mr(t,r=>{if(n&&!n.intersects(r.bounds))return;var i=r.opacity==null?1:r.opacity;i&&KD(e,r,i)&&(Kl(e,r),e.stroke())})}function KX(e,t,n,r){return e.isPointInStroke?KD(e,t,1)&&e.isPointInStroke(n,r):!1}var QX={type:"rule",tag:"line",nested:!1,attr:VX,bound:XX,draw:JX,pick:Yp(KX),isect:BD},ZX=xw("shape",oX),eJ=xw("symbol",sX,gw);const QD=i_();var fi={height:di,measureWidth:_w,estimateWidth:Aw,width:Aw,canvas:ZD};ZD(!0);function ZD(e){fi.width=e&&Qa?_w:Aw}function Aw(e,t){return eN(eo(e,t),di(e))}function eN(e,t){return~~(.8*e.length*t)}function _w(e,t){return di(e)<=0||!(t=eo(e,t))?0:tN(t,Kp(e))}function tN(e,t){const n=`(${t}) ${e}`;let r=QD.get(n);return r===void 0&&(Qa.font=t,r=Qa.measureText(e).width,QD.set(n,r)),r}function di(e){return e.fontSize!=null?+e.fontSize||0:11}function Za(e){return e.lineHeight!=null?e.lineHeight:di(e)+2}function tJ(e){return z(e)?e.length>1?e:e[0]:e}function ff(e){return tJ(e.lineBreak&&e.text&&!z(e.text)?e.text.split(e.lineBreak):e.text)}function Cw(e){const t=ff(e);return(z(t)?t.length-1:0)*Za(e)}function eo(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?rJ(e,n):n}function nJ(e){if(fi.width===_w){const t=Kp(e);return n=>tN(n,t)}else{const t=di(e);return n=>eN(n,t)}}function rJ(e,t){var n=+e.limit,r=nJ(e);if(r(t)<n)return t;var i=e.ellipsis||"",a=e.dir==="rtl",o=0,s=t.length,l;if(n-=r(i),a){for(;o<s;)l=o+s>>>1,r(t.slice(l))>n?o=l+1:s=l;return i+t.slice(o)}else{for(;o<s;)l=1+(o+s>>>1),r(t.slice(0,l))<n?o=l:s=l-1;return t.slice(0,o)+i}}function df(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function Kp(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+di(e)+"px "+df(e,t)}function $w(e){var t=e.baseline,n=di(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Za(e):t==="line-bottom"?.29*n-.5*Za(e):0)}const iJ={left:"start",center:"middle",right:"end"},hf=new mt();function Qp(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-ys,t+=r*Math.cos(i),n+=r*Math.sin(i)),hf.x1=t,hf.y1=n,hf}function aJ(e,t){var n=t.dx||0,r=(t.dy||0)+$w(t),i=Qp(t),a=i.x1,o=i.y1,s=t.angle||0,l;e("text-anchor",iJ[t.align]||"start"),s?(l=xs(a,o)+" "+ww(s),(n||r)&&(l+=" "+xs(n,r))):l=xs(a+n,o+r),e("transform",l)}function Ow(e,t,n){var r=fi.height(t),i=t.align,a=Qp(t),o=a.x1,s=a.y1,l=t.dx||0,u=(t.dy||0)+$w(t)-Math.round(.8*r),c=ff(t),f;if(z(c)?(r+=Za(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,fi.width(t,h)),0)):f=fi.width(t,c),i==="center"?l-=f/2:i==="right"&&(l-=f),e.set(l+=o,u+=s,l+f,u+r),t.angle&&!n)e.rotate(t.angle*Xa,o,s);else if(n===2)return e.rotatedPoints(t.angle*Xa,o,s);return e}function oJ(e,t,n){Mr(t,r=>{var i=r.opacity==null?1:r.opacity,a,o,s,l,u,c,f;if(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)return;if(e.font=Kp(r),e.textAlign=r.align||"left",a=Qp(r),o=a.x1,s=a.y1,r.angle&&(e.save(),e.translate(o,s),e.rotate(r.angle*Xa),o=s=0),o+=r.dx||0,s+=(r.dy||0)+$w(r),c=ff(r),Kl(e,r),z(c))for(u=Za(r),l=0;l<c.length;++l)f=eo(r,c[l]),r.fill&&Wp(e,r,i)&&e.fillText(f,o,s),r.stroke&&Ql(e,r,i)&&e.strokeText(f,o,s),s+=u;else f=eo(r,c),r.fill&&Wp(e,r,i)&&e.fillText(f,o,s),r.stroke&&Ql(e,r,i)&&e.strokeText(f,o,s);r.angle&&e.restore()})}function sJ(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=Qp(t),s=o.x1,l=o.y1,u=Ow(hf,t,1),c=-t.angle*Xa,f=Math.cos(c),d=Math.sin(c),h=f*i-d*a+(s-f*s+d*l),p=d*i+f*a+(l-d*s-f*l);return u.contains(h,p)}function lJ(e,t){const n=Ow(hf,e,2);return Jl(t,n[0],n[1],n[2],n[3])||Jl(t,n[0],n[1],n[4],n[5])||Jl(t,n[4],n[5],n[6],n[7])||Jl(t,n[2],n[3],n[6],n[7])}var uJ={type:"text",tag:"text",nested:!1,attr:aJ,bound:Ow,draw:oJ,pick:Yp(sJ),isect:lJ},cJ=kw("trail",lX,kX),Gn={arc:bX,area:EX,group:IX,image:jX,line:UX,path:HX,rect:YX,rule:QX,shape:ZX,symbol:eJ,text:uJ,trail:cJ};function Mw(e,t,n){var r=Gn[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new mt()),e,n)}var nN={mark:null};function rN(e,t,n){var r=Gn[e.marktype],i=r.bound,a=e.items,o=a&&a.length,s,l,u,c;if(r.nested)return o?u=a[0]:(nN.mark=e,u=nN),c=Mw(u,i,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new mt(),o)for(s=0,l=a.length;s<l;++s)t.union(Mw(a[s],i,n));return e.bounds=t}const fJ=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function iN(e,t){return JSON.stringify(e,fJ,t)}function aN(e){const t=typeof e=="string"?JSON.parse(e):e;return oN(t)}function oN(e){var t=e.marktype,n=e.items,r,i,a;if(n)for(i=0,a=n.length;i<a;++i)r=t?"mark":"group",n[i][r]=e,n[i].zindex&&(n[i][r].zdirty=!0),(t||r)==="group"&&oN(n[i]);return t&&rN(e),e}function Dw(e){arguments.length?this.root=aN(e):(this.root=sN({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Pp(this.root)])}Dw.prototype={toJSON(e){return iN(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const r=sN(e,t);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}};function sN(e,t){const n={bounds:new mt(),clip:!!e.clip,group:t,interactive:!(e.interactive===!1),items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function to(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Nw(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function $n(e,t,n,r){var i=e.childNodes[t],a;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(a=i||null,i=to(e.ownerDocument,n,r),e.insertBefore(i,a)),i}function Dr(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function lN(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Zp(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function dJ(e,t,n,r){var i=e&&e.mark,a,o;if(i&&(a=Gn[i.marktype]).tip){for(o=Zp(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=a.tip(i.items,o)}return e}function no(e,t){this._active=null,this._handlers={},this._loader=e||qh(),this._tooltip=t||hJ}function hJ(e,t,n,r){e.element().setAttribute("title",r||"")}no.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),a=to(null,"a");for(const o in r)a.setAttribute(o,r[o]);a.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=dJ(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}};function hi(e){this._el=null,this._bgcolor=null,this._loader=new lw(e)}hi.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(a=>{a&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const pJ="keydown",mJ="keypress",gJ="keyup",uN="dragenter",em="dragleave",cN="dragover",Rw="mousedown",yJ="mouseup",tm="mousemove",pf="mouseout",fN="mouseover",nm="click",vJ="dblclick",bJ="wheel",dN="mousewheel",rm="touchstart",im="touchmove",am="touchend",wJ=[pJ,mJ,gJ,uN,em,cN,Rw,yJ,tm,pf,fN,nm,vJ,bJ,dN,rm,im,am],Fw=tm,mf=pf,Iw=nm;function gf(e,t){no.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const xJ=e=>e===rm||e===im||e===am?[rm,im,am]:[e];function hN(e,t){xJ(t).forEach(n=>kJ(e,n))}function kJ(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function pN(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=a,this.fire(t,r),this.fire(e,r))}}function mN(e){return function(t){this.fire(e,t),this._active=null}}q(gf,no,{initialize(e,t,n){return this._canvas=e&&Nw(e,"canvas"),[nm,Rw,tm,pf,em].forEach(r=>hN(this,r)),no.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:wJ,DOMMouseScroll(e){this.fire(dN,e)},mousemove:pN(tm,fN,pf),dragover:pN(cN,uN,em),mouseout:mN(pf),dragleave:mN(em),mousedown(e){this._down=this._active,this.fire(Rw,e)},click(e){this._down===this._active&&(this.fire(nm,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(rm,e,!0)},touchmove(e){this.fire(im,e,!0)},touchend(e){this.fire(am,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===Iw&&r&&r.href?this.handleHref(t,r,r.href):(e===Fw||e===mf)&&this.handleTooltip(t,r,e!==mf),i)for(let a=0,o=i.length;a<o;++a)i[a].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);return i<0&&(hN(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=Zp(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context(),o=Gn[e.marktype];return o.pick.call(this,a,e,t,n,r,i)}});function EJ(){return typeof window!="undefined"&&window.devicePixelRatio||1}var SJ=EJ();function TJ(e,t,n,r,i,a){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),l=o?SJ:i;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];return o&&l!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1]),e}function om(e){hi.call(this,e),this._options={},this._redraw=!1,this._dirty=new mt(),this._tempb=new mt()}const gN=hi.prototype,AJ=(e,t,n)=>new mt().set(0,0,t,n).translate(-e[0],-e[1]);function _J(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}q(om,hi,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Fl(1,1,this._options.type),e&&this._canvas&&(Dr(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),gN.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(gN.resize.call(this,e,t,n,r),this._canvas)TJ(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||L("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=AJ(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):_J(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=Gn[t.marktype];t.clip&&SX(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();i.type!=="pdf"&&!i.externalContext&&a.clearRect(e,t,n,r),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});function Lw(e,t){no.call(this,e,t);const n=this;n._hrefHandler=zw(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=zw(n,(r,i)=>{n.handleTooltip(r,i,r.type!==mf)})}const zw=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};q(Lw,no,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(Iw,this._hrefHandler),r.removeEventListener(Fw,this._tooltipHandler),r.removeEventListener(mf,this._tooltipHandler)),this._svg=r=e&&Nw(e,"svg"),r&&(r.addEventListener(Iw,this._hrefHandler),r.addEventListener(Fw,this._tooltipHandler),r.addEventListener(mf,this._tooltipHandler)),no.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers,i=this._handlerIndex(r[n],e,t);if(i<0){const a={type:e,handler:t,listener:zw(this,t)};(r[n]||(r[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const yN="aria-hidden",Pw="aria-label",jw="role",Uw="aria-roledescription",vN="graphics-object",Bw="graphics-symbol",bN=(e,t,n)=>({[jw]:e,[Uw]:t,[Pw]:n||void 0}),CJ=kt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),wN={axis:{desc:"axis",caption:MJ},legend:{desc:"legend",caption:DJ},"title-text":{desc:"title",caption:e=>`Title text '${SN(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${SN(e)}'`}},xN={ariaRole:jw,ariaRoleDescription:Uw,description:Pw};function kN(e,t){const n=t.aria===!1;if(e(yN,n||void 0),n||t.description==null)for(const r in xN)e(xN[r],void 0);else{const r=t.mark.marktype;e(Pw,t.description),e(jw,t.ariaRole||(r==="group"?vN:Bw)),e(Uw,t.ariaRoleDescription||`${r} mark`)}}function EN(e){return e.aria===!1?{[yN]:!0}:CJ[e.role]?null:wN[e.role]?OJ(e,wN[e.role]):$J(e)}function $J(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return bN(n?vN:Bw,`${t} mark container`,e.description)}function OJ(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return bN(t.role||Bw,t.desc,n.description||r(n))}catch(n){return null}}function SN(e){return J(e.text).join(" ")}function MJ(e){const t=e.datum,n=e.orient,r=t.title?TN(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type,l=n==="left"||n==="right"?"Y":"X";return`${l}-axis`+(r?` titled '${r}'`:"")+` for a ${Gl(s)?"discrete":s} scale with ${xD(o,a,e)}`}function DJ(e){const t=e.datum,n=t.title?TN(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return RJ(r)+(n?` titled '${n}'`:"")+` for ${NJ(a)} with ${xD(l,s,e)}`}function TN(e){try{return J(ve(e.items).items[0].text).join(" ")}catch(t){return null}}function NJ(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function RJ(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const AN=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),FJ=e=>AN(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function qw(){let e="",t="",n="";const r=[],i=()=>t=n="",a=l=>{t&&(e+=`${t}>${n}`,i()),r.push(l)},o=(l,u)=>(u!=null&&(t+=` ${l}="${FJ(u)}"`),s),s={open(l,...u){a(l),t="<"+l;for(const c of u)for(const f in c)o(f,c[f]);return s},close(){const l=r.pop();return t?e+=t+(n?`>${n}</${l}>`:"/>"):e+=`</${l}>`,i(),s},attr:o,text:l=>(n+=AN(l),s),toString:()=>e};return s}const _N=e=>CN(qw(),e)+"";function CN(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let i=0;i<r;i++){const a=n[i];a.nodeType===3?e.text(a.nodeValue):CN(e,a)}}return e.close()}const sm={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},$N={fill:"none","stroke-miterlimit":10},yf=0,ON="http://www.w3.org/2000/xmlns/",gt=cf.xmlns;function Hw(e){hi.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Ww=hi.prototype;q(Hw,hi,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=$n(e,0,"svg",gt),this._svg.setAttributeNS(ON,"xmlns",gt),this._svg.setAttributeNS(ON,"xmlns:xlink",cf["xmlns:xlink"]),this._svg.setAttribute("version",cf.version),this._svg.setAttribute("class","marks"),Dr(e,1),this._root=$n(this._svg,yf,"g",gt),ro(this._root,$N),Dr(this._svg,yf+1)),this.background(this._bgcolor),Ww.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Ww.background.apply(this,arguments)},resize(e,t,n,r){return Ww.resize.call(this,e,t,n,r),this._svg&&(ro(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=$n(e,yf,"rect",gt),ro(n,{width:this._width,height:this._height,fill:t}));const r=_N(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Dr(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o){if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=Gn[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,MN(n,t),r.items.forEach(u=>{u.dirty=t})),r.zdirty)continue;if(n.exit){a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}if(n=a.nested?r.items[0]:n,n._update===t)continue;!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,MN(n,t)):this._update(a,n._svg,n),n._update=t}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Gn[t.marktype],a=t.interactive===!1?"none":null,o=i.tag==="g";let s=null,l=0;const u=DN(t,e,n,"g",r);u.setAttribute("class",lN(t));const c=EN(t);for(const d in c)rn(u,d,c[d]);o||rn(u,"pointer-events",a),rn(u,"clip-path",t.clip?sw(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),p=DN(d,u,s,i.tag,r);h&&(this._update(i,p,d),o&&zJ(this,p,d)),s=p,++l};return i.nested?t.items.length&&f(t.items[0]):Mr(t,f),Dr(u,l),u},_update(e,t,n){ta=t,Vt=t.__values__,kN(vf,n),e.attr(vf,n,this);const r=jJ[e.type];r&&r.call(this,e,t,n),ta&&this.style(ta,n)},style(e,t){if(t==null)return;for(const n in sm){let r=n==="font"?df(t):t[n];if(r===Vt[n])continue;const i=sm[n];r==null?e.removeAttribute(i):(tw(r)&&(r=ED(r,this._defs.gradient,NN())),e.setAttribute(i,r+"")),Vt[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=$n(e,yf+1,"defs",gt)),r=IJ(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=$n(e,yf+1,"defs",gt)),r=LJ(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):Dr(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function MN(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function IJ(e,t,n){let r,i,a;if(t.gradient==="radial"){let o=$n(e,n++,"pattern",gt);ro(o,{id:Fp+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=$n(o,0,"rect",gt),ro(o,{width:1,height:1,fill:`url(${NN()}#${t.id})`}),e=$n(e,n++,"radialGradient",gt),ro(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=$n(e,n++,"linearGradient",gt),ro(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=$n(e,r,"stop",gt),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return Dr(e,r),n}function LJ(e,t,n){let r;return e=$n(e,n,"clipPath",gt),e.setAttribute("id",t.id),t.path?(r=$n(e,0,"path",gt),r.setAttribute("d",t.path)):(r=$n(e,0,"rect",gt),ro(r,{x:0,y:0,width:t.width,height:t.height})),Dr(e,1),n+1}function zJ(e,t,n){t=t.lastChild.previousSibling;let r,i=0;Mr(n,a=>{r=e.mark(t,a,r),++i}),Dr(t,1+i)}function DN(e,t,n,r,i){let a=e._svg,o;if(!a&&(o=t.ownerDocument,a=to(o,r,gt),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},r==="g"))){const s=to(o,"path",gt);a.appendChild(s),s.__data__=e;const l=to(o,"g",gt);a.appendChild(l),l.__data__=e;const u=to(o,"path",gt);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==i||PJ(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}function PJ(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let ta=null,Vt=null;const jJ={group(e,t,n){const r=ta=t.childNodes[2];Vt=r.__values__,e.foreground(vf,n,this),Vt=t.__values__,ta=t.childNodes[1],e.content(vf,n,this);const i=ta=t.childNodes[0];e.background(vf,n,this);const a=n.mark.interactive===!1?"none":null;if(a!==Vt.events&&(rn(r,"pointer-events",a),rn(i,"pointer-events",a),Vt.events=a),n.strokeForeground&&n.stroke){const o=n.fill;rn(r,"display",null),this.style(i,n),rn(i,"stroke",null),o&&(n.fill=null),Vt=r.__values__,this.style(r,n),o&&(n.fill=o),ta=null}else rn(r,"display","none")},image(e,t,n){n.smooth===!1?(Gw(t,"image-rendering","optimizeSpeed"),Gw(t,"image-rendering","pixelated")):Gw(t,"image-rendering",null)},text(e,t,n){const r=ff(n);let i,a,o,s;z(r)?(a=r.map(l=>eo(n,l)),i=a.join(`
`),i!==Vt.text&&(Dr(t,0),o=t.ownerDocument,s=Za(n),a.forEach((l,u)=>{const c=to(o,"tspan",gt);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),Vt.text=i)):(a=eo(n,r),a!==Vt.text&&(t.textContent=a,Vt.text=a)),rn(t,"font-family",df(n)),rn(t,"font-size",di(n)+"px"),rn(t,"font-style",n.fontStyle),rn(t,"font-variant",n.fontVariant),rn(t,"font-weight",n.fontWeight)}};function vf(e,t,n){if(t===Vt[e])return;n?UJ(ta,e,t,n):rn(ta,e,t),Vt[e]=t}function Gw(e,t,n){n!==Vt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Vt[t]=n)}function ro(e,t){for(const n in t)rn(e,n,t[n])}function rn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function UJ(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function NN(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function Yw(e){hi.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}q(Yw,hi,{svg(){return this._text},_render(e){const t=qw();t.open("svg",ue({},cf,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",$N,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Gn[t.marktype],r=n.tag,i=[kN,n.attr];e.open("g",{class:lN(t),"clip-path":t.clip?sw(this,t,t.group):null},EN(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const a=o=>{const s=this.href(o);if(s&&e.open("a",s),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const l=ff(o);if(z(l)){const u={x:0,dy:Za(o)};for(let c=0;c<l.length;++c)e.open("tspan",c?u:null).text(eo(o,l[c])).close()}else e.text(eo(o,l))}else if(r==="g"){const l=o.strokeForeground,u=o.fill,c=o.stroke;l&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Mr(o,f=>this.mark(e,f)),e.close(),l&&c?(u&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),u&&(o.fill=u)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),s&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):Mr(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},a=(o,s,l,u)=>{i[u||o]=s};return Array.isArray(n)?n.forEach(o=>o(a,t,this)):n(a,t,this),r&&BJ(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping,r=Object.keys(t).length+Object.keys(n).length;if(r===0)return;e.open("defs");for(const i in t){const a=t[i],o=a.stops;a.gradient==="radial"?(e.open("pattern",{id:Fp+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})):e.open("linearGradient",{id:i,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2});for(let s=0;s<o.length;++s)e.open("stop",{offset:o[s].offset,"stop-color":o[s].color}).close();e.close()}for(const i in n){const a=n[i];e.open("clipPath",{id:i}),a.path?e.open("path",{d:a.path}).close():e.open("rect",{x:0,y:0,width:a.width,height:a.height}).close(),e.close()}e.close()}});function BJ(e,t,n,r,i){if(t==null)return e;if(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null))return e;r==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),r==="text"&&(e["font-family"]=df(t),e["font-size"]=di(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in sm){let o=t[a];const s=sm[a];o==="transparent"&&(s==="fill"||s==="stroke")||o!=null&&(tw(o)&&(o=ED(o,i.gradient,"")),e[s]=o)}return e}const RN="canvas",FN="png",IN="svg",LN="none",io={Canvas:RN,PNG:FN,SVG:IN,None:LN},Zl={};Zl[RN]=Zl[FN]={renderer:om,headless:om,handler:gf},Zl[IN]={renderer:Hw,headless:Yw,handler:Lw},Zl[LN]={};function lm(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Zl[e]=t,this):Zl[e]}function zN(e,t,n){const r=[],i=new mt().union(t),a=e.marktype;return a?PN(e,i,n,r):a==="group"?jN(e,i,n,r):L("Intersect scene must be mark node or group item.")}function PN(e,t,n,r){if(qJ(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if(a==="group")for(;s<o;++s)jN(i[s],t,n,r);else for(const l=Gn[a].isect;s<o;++s){const u=i[s];UN(u,t,l)&&r.push(u)}}return r}function qJ(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function jN(e,t,n,r){n&&n(e.mark)&&UN(e,t,Gn.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let l=0;l<a;++l)PN(i[l],t,n,r);t.translate(o,s)}return r}function UN(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}const Vw=new mt();function BN(e){const t=e.clip;if(le(t))t(sf(Vw.clear()));else if(t)Vw.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Vw)}const HJ=1e-9;function Xw(e,t,n){return e===t?!0:n==="path"?qN(e,t):e instanceof Date&&t instanceof Date?+e===+t:Le(e)&&Le(t)?Math.abs(e-t)<=HJ:!e||!t||!Q(e)&&!Q(t)?e==t:WJ(e,t)}function qN(e,t){return Xw(Yl(e),Yl(t))}function WJ(e,t){var n=Object.keys(e),r=Object.keys(t),i,a;if(n.length!==r.length)return!1;for(n.sort(),r.sort(),a=n.length-1;a>=0;a--)if(n[a]!=r[a])return!1;for(a=n.length-1;a>=0;a--)if(i=n[a],!Xw(e[i],t[i],i))return!1;return typeof e===typeof t}function GJ(){RD(),kV()}const eu="top",Nr="left",Rr="right",ao="bottom",YJ="top-left",VJ="top-right",XJ="bottom-left",JJ="bottom-right",Jw="start",Kw="middle",an="end",KJ="x",QJ="y",um="group",Qw="axis",Zw="title",ZJ="frame",eK="scope",ex="legend",HN="row-header",WN="row-footer",GN="row-title",YN="column-header",VN="column-footer",XN="column-title",tK="padding",nK="symbol",JN="fit",rK="fit-x",iK="fit-y",aK="pad",tx="none",cm="all",nx="each",rx="flush",oo="column",so="row";function KN(e){F.call(this,null,e)}q(KN,F,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=Gn[i],o=a.bound;let s=r.bounds,l;if(a.nested)r.items.length&&n.dirty(r.items[0]),s=fm(r,o),r.items.forEach(u=>{u.bounds.clear().union(s)});else if(i===um||e.modified()){t.visit(t.MOD,u=>n.dirty(u)),s.clear(),r.items.forEach(u=>s.union(fm(u,o)));switch(r.role){case Qw:case ex:case Zw:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{s.union(fm(u,o))}),t.visit(t.MOD,u=>{l=l||s.alignsWith(u.bounds),n.dirty(u),s.union(fm(u,o))}),l&&(s.clear(),r.items.forEach(u=>s.union(u.bounds)));return BN(r),t.modifies("bounds")}});function fm(e,t,n){return t(e.bounds.clear(),e,n)}const QN=":vega_identifier:";function ix(e){F.call(this,0,e)}ix.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},q(ix,F,{transform(e,t){const n=oK(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,a=>a[r]=a[r]||++i),n.set(this.value=i),t}});function oK(e){return e._signals[QN]||(e._signals[QN]=e.add(0))}function ZN(e){F.call(this,null,e)}q(ZN,F,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,sK(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===um?Pp:zp;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function sK(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function eR(e){F.call(this,null,e)}const tR={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>!i||!nR(n.bounds,r.bounds,t)?(n=r,1):r.opacity=0)}},nR=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),rR=(e,t)=>{for(var n=1,r=e.length,i=e[0].bounds,a;n<r;i=a,++n)if(nR(i,a=e[n].bounds,t))return!0},lK=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},uK=(e,t,n)=>{var r=e.range(),i=new mt();return t===eu||t===ao?i.set(r[0],-Infinity,r[1],Infinity):i.set(-Infinity,r[0],Infinity,r[1]),i.expand(n||1),a=>i.encloses(a.bounds)},iR=e=>(e.forEach(t=>t.opacity=1),e),aR=(e,t)=>e.reflow(t.modified()).modifies("opacity");q(eR,F,{transform(e,t){const n=tR[e.method]||tR.parity,r=e.separation||0;let i=t.materialize(t.SOURCE).source,a,o;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(iR(i),t=aR(t,e)),t;if(i=i.filter(lK),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),a=iR(i),t=aR(t,e),a.length>=3&&rR(a,r)){do a=n(a,r);while(a.length>=3&&rR(a,r));a.length<3&&!ve(i).opacity&&(a.length>1&&(ve(a).opacity=0),ve(i).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(o=uK(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(l=>{o(l)||(l.opacity=0)}));const s=a[0].mark.bounds.clear();return i.forEach(l=>{l.opacity&&s.union(l.bounds)}),t}});function oR(e){F.call(this,null,e)}q(oR,F,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const Xt=new mt();function tu(e,t,n){return e[t]===n?0:(e[t]=n,1)}function cK(e){var t=e.items[0].orient;return t===Nr||t===Rr}function fK(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function dK(e,t,n,r){var i=t.items[0],a=i.datum,o=i.translate!=null?i.translate:.5,s=i.orient,l=fK(a),u=i.range,c=i.offset,f=i.position,d=i.minExtent,h=i.maxExtent,p=a.title&&i.items[l[2]].items[0],m=i.titlePadding,g=i.bounds,y=p&&Cw(p),v=0,b=0,w,x;Xt.clear().union(g),g.clear(),(w=l[0])>-1&&g.union(i.items[w].bounds),(w=l[1])>-1&&g.union(i.items[w].bounds);switch(s){case eu:v=f||0,b=-c,x=Math.max(d,Math.min(h,-g.y1)),g.add(0,-x).add(u,0),p&&dm(e,p,x,m,y,0,-1,g);break;case Nr:v=-c,b=f||0,x=Math.max(d,Math.min(h,-g.x1)),g.add(-x,0).add(0,u),p&&dm(e,p,x,m,y,1,-1,g);break;case Rr:v=n+c,b=f||0,x=Math.max(d,Math.min(h,g.x2)),g.add(0,0).add(x,u),p&&dm(e,p,x,m,y,1,1,g);break;case ao:v=f||0,b=r+c,x=Math.max(d,Math.min(h,g.y2)),g.add(0,0).add(u,x),p&&dm(e,p,x,m,0,0,1,g);break;default:v=i.x,b=i.y}return ea(g.translate(v,b),i),tu(i,"x",v+o)|tu(i,"y",b+o)&&(i.bounds=Xt,e.dirty(i),i.bounds=g,e.dirty(i)),i.mark.bounds.clear().union(g)}function dm(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const u=o*(n+i+r);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}s.union(l)}const sR=(e,t)=>Math.floor(Math.min(e,t)),lR=(e,t)=>Math.ceil(Math.max(e,t));function hK(e){var t=e.items,n=t.length,r=0,i,a;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r)if(i=t[r],a=i.items,i.marktype===um)switch(i.role){case Qw:case ex:case Zw:break;case HN:o.rowheaders.push(...a);break;case WN:o.rowfooters.push(...a);break;case YN:o.colheaders.push(...a);break;case VN:o.colfooters.push(...a);break;case GN:o.rowtitle=a[0];break;case XN:o.coltitle=a[0];break;default:o.marks.push(...a)}return o}function pK(e){return new mt().set(0,0,e.width||0,e.height||0)}function mK(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Xe(e,t,n){const r=Q(e)?e[t]:e;return r??(n!==void 0?n:0)}function uR(e){return e<0?Math.ceil(-e):0}function cR(e,t,n){var r=!n.nodirty,i=n.bounds===rx?pK:mK,a=Xt.set(0,0,0,0),o=Xe(n.align,oo),s=Xe(n.align,so),l=Xe(n.padding,oo),u=Xe(n.padding,so),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),p=Array(c),m=0,g=Array(d),y=Array(f),v=0,b=Array(d),w=Array(d),x=Array(d),E,k,S,A,C,_,D,M,N,T,O;for(k=0;k<c;++k)p[k]=0;for(k=0;k<f;++k)y[k]=0;for(k=0;k<d;++k)_=t[k],C=x[k]=i(_),_.x=_.x||0,b[k]=0,_.y=_.y||0,w[k]=0,S=k%c,A=~~(k/c),m=Math.max(m,D=Math.ceil(C.x2)),v=Math.max(v,M=Math.ceil(C.y2)),p[S]=Math.max(p[S],D),y[A]=Math.max(y[A],M),h[k]=l+uR(C.x1),g[k]=u+uR(C.y1),r&&e.dirty(t[k]);for(k=0;k<d;++k)k%c===0&&(h[k]=0),k<c&&(g[k]=0);if(o===nx)for(S=1;S<c;++S){for(O=0,k=S;k<d;k+=c)O<h[k]&&(O=h[k]);for(k=S;k<d;k+=c)h[k]=O+p[S-1]}else if(o===cm){for(O=0,k=0;k<d;++k)k%c&&O<h[k]&&(O=h[k]);for(k=0;k<d;++k)k%c&&(h[k]=O+m)}else for(o=!1,S=1;S<c;++S)for(k=S;k<d;k+=c)h[k]+=p[S-1];if(s===nx)for(A=1;A<f;++A){for(O=0,k=A*c,E=k+c;k<E;++k)O<g[k]&&(O=g[k]);for(k=A*c;k<E;++k)g[k]=O+y[A-1]}else if(s===cm){for(O=0,k=c;k<d;++k)O<g[k]&&(O=g[k]);for(k=c;k<d;++k)g[k]=O+v}else for(s=!1,A=1;A<f;++A)for(k=A*c,E=k+c;k<E;++k)g[k]+=y[A-1];for(N=0,k=0;k<d;++k)N=h[k]+(k%c?N:0),b[k]+=N-t[k].x;for(S=0;S<c;++S)for(T=0,k=S;k<d;k+=c)T+=g[k],w[k]+=T-t[k].y;if(o&&Xe(n.center,oo)&&f>1)for(k=0;k<d;++k)C=o===cm?m:p[k%c],N=C-x[k].x2-t[k].x-b[k],N>0&&(b[k]+=N/2);if(s&&Xe(n.center,so)&&c!==1)for(k=0;k<d;++k)C=s===cm?v:y[~~(k/c)],T=C-x[k].y2-t[k].y-w[k],T>0&&(w[k]+=T/2);for(k=0;k<d;++k)a.union(x[k].translate(b[k],w[k]));N=Xe(n.anchor,KJ),T=Xe(n.anchor,QJ);switch(Xe(n.anchor,oo)){case an:N-=a.width();break;case Kw:N-=a.width()/2}switch(Xe(n.anchor,so)){case an:T-=a.height();break;case Kw:T-=a.height()/2}for(N=Math.round(N),T=Math.round(T),a.clear(),k=0;k<d;++k)t[k].mark.bounds.clear();for(k=0;k<d;++k)_=t[k],_.x+=b[k]+=N,_.y+=w[k]+=T,a.union(_.mark.bounds.union(_.bounds.translate(b[k],w[k]))),r&&e.dirty(_);return a}function gK(e,t,n){var r=hK(t),i=r.marks,a=n.bounds===rx?yK:vK,o=n.offset,s=n.columns||i.length,l=s<=0?1:Math.ceil(i.length/s),u=l*s,c,f,d,h,p,m,g;const y=cR(e,i,n);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(m=Xe(n.headerBand,so,null),c=hm(e,r.rowheaders,i,s,l,-Xe(o,"rowHeader"),sR,0,a,"x1",0,s,1,m)),r.colheaders&&(m=Xe(n.headerBand,oo,null),f=hm(e,r.colheaders,i,s,s,-Xe(o,"columnHeader"),sR,1,a,"y1",0,1,s,m)),r.rowfooters&&(m=Xe(n.footerBand,so,null),d=hm(e,r.rowfooters,i,s,l,Xe(o,"rowFooter"),lR,0,a,"x2",s-1,s,1,m)),r.colfooters&&(m=Xe(n.footerBand,oo,null),h=hm(e,r.colfooters,i,s,s,Xe(o,"columnFooter"),lR,1,a,"y2",u-s,1,s,m)),r.rowtitle&&(p=Xe(n.titleAnchor,so),g=Xe(o,"rowTitle"),g=p===an?d+g:c-g,m=Xe(n.titleBand,so,.5),fR(e,r.rowtitle,g,0,y,m)),r.coltitle&&(p=Xe(n.titleAnchor,oo),g=Xe(o,"columnTitle"),g=p===an?h+g:f-g,m=Xe(n.titleBand,oo,.5),fR(e,r.coltitle,g,1,y,m))}function yK(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function vK(e,t){return e.bounds[t]}function hm(e,t,n,r,i,a,o,s,l,u,c,f,d,h){var p=n.length,m=0,g=0,y,v,b,w,x,E,k,S,A;if(!p)return m;for(y=c;y<p;y+=f)n[y]&&(m=o(m,l(n[y],u)));if(!t.length)return m;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),m+=a,v=0,w=t.length;v<w;++v)e.dirty(t[v]),t[v].mark.bounds.clear();for(y=c,v=0,w=t.length;v<w;++v,y+=f){for(E=t[v],x=E.mark.bounds,b=y;b>=0&&(k=n[b])==null;b-=d);s?(S=h==null?k.x:Math.round(k.bounds.x1+h*k.bounds.width()),A=m):(S=m,A=h==null?k.y:Math.round(k.bounds.y1+h*k.bounds.height())),x.union(E.bounds.translate(S-(E.x||0),A-(E.y||0))),E.x=S,E.y=A,e.dirty(E),g=o(g,x[u])}return g}function fR(e,t,n,r,i,a){if(!t)return;e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}function bK(e,t){const n=e[t]||{};return(r,i)=>n[r]!=null?n[r]:e[r]!=null?e[r]:i}function wK(e,t){let n=-Infinity;return e.forEach(r=>{r.offset!=null&&(n=Math.max(n,r.offset))}),n>-Infinity?n:t}function xK(e,t,n,r,i,a,o){const s=bK(n,t),l=wK(e,s("offset",0)),u=s("anchor",Jw),c=u===an?1:u===Kw?.5:0,f={align:nx,bounds:s("bounds",rx),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case Nr:f.anchor={x:Math.floor(r.x1)-l,column:an,y:c*(o||r.height()+2*r.y1),row:u};break;case Rr:f.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case eu:f.anchor={y:Math.floor(i.y1)-l,row:an,x:c*(a||i.width()+2*i.x1),column:u};break;case ao:f.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case YJ:f.anchor={x:l,y:l};break;case VJ:f.anchor={x:a-l,y:l,column:an};break;case XJ:f.anchor={x:l,y:o-l,row:an};break;case JJ:f.anchor={x:a-l,y:o-l,column:an,row:an};break}return f}function kK(e,t){var n=t.items[0],r=n.datum,i=n.orient,a=n.bounds,o=n.x,s=n.y,l,u;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),SK(e,n,n.items[0].items[0]),a=EK(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),r.type===nK&&TK(n.items[0].items[0].items[0].items),i!==tx&&(n.x=o=0,n.y=s=0),n.width=l,n.height=u,ea(a.set(o,s,o+l,s+u),n),n.mark.bounds.clear().union(a),n}function EK(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function SK(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(!t.datum.title)(i||a)&&bf(e,n,i,a);else{var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case Nr:i+=Math.ceil(o.bounds.width())+l;break;case Rr:case ao:break;default:a+=o.bounds.height()+l}(i||a)&&bf(e,n,i,a);switch(o.orient){case Nr:c+=nu(t,n,o,s,1,1);break;case Rr:u+=nu(t,n,o,an,0,0)+l,c+=nu(t,n,o,s,1,1);break;case ao:u+=nu(t,n,o,s,0,0),c+=nu(t,n,o,an,-1,0,1)+l;break;default:u+=nu(t,n,o,s,0,0)}(u||c)&&bf(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(bf(e,n,-u,0),bf(e,o,-u,0))}}function nu(e,t,n,r,i,a,o){const s=e.datum.type!=="symbol",l=n.datum.vgrad,u=s&&(a||!l)&&!o?t.items[0]:t,c=u.bounds[i?"y2":"x2"]-e.padding,f=l&&a?c:0,d=l&&a?0:c,h=i<=0?0:Cw(n);return Math.round(r===Jw?f:r===an?d-h:.5*(c-h))}function bf(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function TK(e){const t=e.reduce((n,r)=>(n[r.column]=Math.max(r.bounds.x2-r.x,n[r.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function AK(e,t,n,r,i){var a=t.items[0],o=a.frame,s=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=s===Nr||s===Rr?r:n,p=0,m=0,g=0,y=0,v=0,b;if(o!==um?s===Nr?(p=i.y2,h=i.y1):s===Rr?(p=i.y1,h=i.y2):(p=i.x1,h=i.x2):s===Nr&&(p=r,h=0),b=l===Jw?p:l===an?h:(p+h)/2,d&&d.text){switch(s){case eu:case ao:v=f.bounds.height()+c;break;case Nr:y=f.bounds.width()+c;break;case Rr:y=-f.bounds.width()-c;break}Xt.clear().union(d.bounds),Xt.translate(y-(d.x||0),v-(d.y||0)),tu(d,"x",y)|tu(d,"y",v)&&(e.dirty(d),d.bounds.clear().union(Xt),d.mark.bounds.clear().union(Xt),e.dirty(d)),Xt.clear().union(d.bounds)}else Xt.clear();Xt.union(f.bounds);switch(s){case eu:m=b,g=i.y1-Xt.height()-u;break;case Nr:m=i.x1-Xt.width()-u,g=b;break;case Rr:m=i.x2+Xt.width()+u,g=b;break;case ao:m=b,g=i.y2+u;break;default:m=a.x,g=a.y}return tu(a,"x",m)|tu(a,"y",g)&&(Xt.translate(m,g),e.dirty(a),a.bounds.clear().union(Xt),t.bounds.clear().union(Xt),e.dirty(a)),a.bounds}function dR(e){F.call(this,null,e)}q(dR,F,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&gK(n,r,e.layout),CK(n,r,e)}),_K(e.mark.group)?t.reflow():t}});function _K(e){return e&&e.mark.role!=="legend-entry"}function CK(e,t,n){var r=t.items,i=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=new mt().set(0,0,i,a),s=o.clone(),l=o.clone(),u=[],c,f,d,h,p,m;for(p=0,m=r.length;p<m;++p){f=r[p];switch(f.role){case Qw:h=cK(f)?s:l,h.union(dK(e,f,i,a));break;case Zw:c=f;break;case ex:u.push(kK(e,f));break;case ZJ:case eK:case HN:case WN:case GN:case YN:case VN:case XN:s.union(f.bounds),l.union(f.bounds);break;default:o.union(f.bounds)}}if(u.length){const g={};u.forEach(y=>{d=y.orient||Rr,d!==tx&&(g[d]||(g[d]=[])).push(y)});for(const y in g){const v=g[y];cR(e,v,xK(v,y,n.legends,s,l,i,a))}u.forEach(y=>{const v=y.bounds;if(v.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=v,e.dirty(y)),n.autosize&&n.autosize.type===JN)switch(y.orient){case Nr:case Rr:o.add(v.x1,0).add(v.x2,0);break;case eu:case ao:o.add(0,v.y1).add(0,v.y2)}else o.union(v)})}o.union(s).union(l),c&&o.union(AK(e,c,i,a,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),$K(e,t,o,n)}function $K(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,Math.ceil(n.y2-c));if(i.contains===tK){const p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===tx?(u=0,f=0,l=o,c=s):a===JN?(l=Math.max(0,o-u-d),c=Math.max(0,s-f-h)):a===rK?(l=Math.max(0,o-u-d),s=c+f+h):a===iK?(o=l+u+d,c=Math.max(0,s-f-h)):a===aK&&(o=l+u+d,s=c+f+h),e._resizeView(o,s,l,c,[u,f],i.resize)}var OK=Object.freeze({__proto__:null,bound:KN,identifier:ix,mark:ZN,overlap:eR,render:oR,viewlayout:dR});function hR(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);++r<i;)a[r]=e+r*n;return a}function MK(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function ax(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function pR(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function wf(){}var xf=.7,pm=1/xf,ru="\\s*([+-]?\\d+)\\s*",kf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",pi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",DK=/^#([0-9a-f]{3,8})$/,NK=new RegExp("^rgb\\("+[ru,ru,ru]+"\\)$"),RK=new RegExp("^rgb\\("+[pi,pi,pi]+"\\)$"),FK=new RegExp("^rgba\\("+[ru,ru,ru,kf]+"\\)$"),IK=new RegExp("^rgba\\("+[pi,pi,pi,kf]+"\\)$"),LK=new RegExp("^hsl\\("+[kf,pi,pi]+"\\)$"),zK=new RegExp("^hsla\\("+[kf,pi,pi,kf]+"\\)$"),mR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ax(wf,Ef,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:gR,formatHex:gR,formatHsl:PK,formatRgb:yR,toString:yR});function gR(){return this.rgb().formatHex()}function PK(){return kR(this).formatHsl()}function yR(){return this.rgb().formatRgb()}function Ef(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=DK.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?vR(t):n===3?new Yn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?mm(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?mm(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=NK.exec(e))?new Yn(t[1],t[2],t[3],1):(t=RK.exec(e))?new Yn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=FK.exec(e))?mm(t[1],t[2],t[3],t[4]):(t=IK.exec(e))?mm(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=LK.exec(e))?xR(t[1],t[2]/100,t[3]/100,1):(t=zK.exec(e))?xR(t[1],t[2]/100,t[3]/100,t[4]):mR.hasOwnProperty(e)?vR(mR[e]):e==="transparent"?new Yn(NaN,NaN,NaN,0):null}function vR(e){return new Yn(e>>16&255,e>>8&255,e&255,1)}function mm(e,t,n,r){return r<=0&&(e=t=n=NaN),new Yn(e,t,n,r)}function jK(e){return e instanceof wf||(e=Ef(e)),e?(e=e.rgb(),new Yn(e.r,e.g,e.b,e.opacity)):new Yn()}function ox(e,t,n,r){return arguments.length===1?jK(e):new Yn(e,t,n,r??1)}function Yn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}ax(Yn,ox,pR(wf,{brighter:function(e){return e=e==null?pm:Math.pow(pm,e),new Yn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?xf:Math.pow(xf,e),new Yn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:bR,formatHex:bR,formatRgb:wR,toString:wR}));function bR(){return"#"+sx(this.r)+sx(this.g)+sx(this.b)}function wR(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function sx(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function xR(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new mi(e,t,n,r)}function kR(e){if(e instanceof mi)return new mi(e.h,e.s,e.l,e.opacity);if(e instanceof wf||(e=Ef(e)),!e)return new mi();if(e instanceof mi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new mi(o,s,l,e.opacity)}function UK(e,t,n,r){return arguments.length===1?kR(e):new mi(e,t,n,r??1)}function mi(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}ax(mi,UK,pR(wf,{brighter:function(e){return e=e==null?pm:Math.pow(pm,e),new mi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?xf:Math.pow(xf,e),new mi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Yn(lx(e>=240?e-240:e+120,i,r),lx(e,i,r),lx(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function lx(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var ux=e=>()=>e;function BK(e,t){return function(n){return e+n*t}}function qK(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function HK(e){return(e=+e)===1?ER:function(t,n){return n-t?qK(t,n,e):ux(isNaN(t)?n:t)}}function ER(e,t){var n=t-e;return n?BK(e,n):ux(isNaN(e)?t:e)}var SR=function e(t){var n=HK(t);function r(i,a){var o=n((i=ox(i)).r,(a=ox(a)).r),s=n(i.g,a.g),l=n(i.b,a.b),u=ER(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return r.gamma=e,r}(1);function WK(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function GK(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function YK(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=hx(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<r;++o)a[o]=i[o](s);return a}}function VK(e,t){var n=new Date();return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function cx(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function XK(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=hx(e[i],t[i]):r[i]=t[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var fx=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dx=new RegExp(fx.source,"g");function JK(e){return function(){return e}}function KK(e){return function(t){return e(t)+""}}function QK(e,t){var n=fx.lastIndex=dx.lastIndex=0,r,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(r=fx.exec(e))&&(i=dx.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:cx(r,i)})),n=dx.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?KK(l[0].x):JK(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function hx(e,t){var n=typeof t,r;return t==null||n==="boolean"?ux(t):(n==="number"?cx:n==="string"?(r=Ef(t))?(t=r,SR):QK:t instanceof Ef?SR:t instanceof Date?VK:GK(t)?WK:Array.isArray(t)?YK:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?XK:cx)(e,t)}function ZK(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function TR(e){F.call(this,null,e)}q(TR,F,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=Q1(a,o,e.minstep),l=e.format||pD(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?hD(a,e.values,s):Z1(a,s);return i&&(r.rem=i),i=u.map((c,f)=>Oe({index:f/(u.length-1||1),value:c,label:l(c)})),e.extra&&i.length&&i.push(Oe({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}});function AR(e){F.call(this,null,e)}function eQ(){return Oe({})}function tQ(e){const t=wl().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}q(AR,F,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||eQ,a=e.key||ne,o=this.value;return z(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&L("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=tQ(a)),t.visit(t.ADD,s=>{const l=a(s);let u=o.get(l);u?u.exit?(o.empty--,r.add.push(u)):r.mod.push(u):(u=i(s),o.set(l,u),r.add.push(u)),u.datum=s,u.exit=!1}),t.visit(t.MOD,s=>{const l=a(s),u=o.get(l);u&&(u.datum=s,r.mod.push(u))}),t.visit(t.REM,s=>{const l=a(s),u=o.get(l);s===u.datum&&!u.exit&&(r.rem.push(u),u.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}});function _R(e){F.call(this,null,e)}q(_R,F,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(z(a))if(n.changed()||a.every(f=>i[f]))a=a[0],n.encode=null;else return t.StopPropagation;var o=a==="enter",s=i.update||Ra,l=i.enter||Ra,u=i.exit||Ra,c=(a&&!o?i[a]:s)||Ra;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{l(f,e),s(f,e)}),n.modifies(l.output),n.modifies(s.output),c!==Ra&&c!==s&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==Ra&&(t.visit(t.REM,f=>{u(f,e)}),n.modifies(u.output)),o||c!==Ra){const f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,d=>{const h=l(d,e)||r;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)):t.visit(f,d=>{(c(d,e)||r)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function CR(e){F.call(this,[],e)}q(CR,F,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.type||Rp,o=e.scale,s=+e.limit,l=Q1(o,e.count==null?5:e.count,e.minstep),u=!!e.values||a===Rp,c=e.format||vD(n,o,l,a,e.formatSpecifier,e.formatType,u),f=e.values||yD(o,l),d,h,p,m,g;return i&&(r.rem=i),a===Rp?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=f.slice(0,s-1),g=!0):i=f,le(p=e.size)?(!e.values&&o(i[0])===0&&(i=i.slice(1)),m=i.reduce((y,v)=>Math.max(y,p(v,e)),0)):p=qt(m=p||8),i=i.map((y,v)=>Oe({index:v,label:c(y,v,i),value:y,offset:m,size:p(y,e)})),g&&(g=f[i.length],i.push(Oe({index:i.length,label:"".concat(f.length-i.length," entries"),value:g,offset:m,size:p(g,e)})))):a===uV?(d=o.domain(),h=uD(o,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),i=f.map((y,v)=>Oe({index:v,label:c(y,v,f),value:y,perc:h(y)}))):(p=f.length-1,h=wV(o),i=f.map((y,v)=>Oe({index:v,label:c(y,v,f),value:y,perc:v?h(y):0,perc2:v===p?1:h(f[v+1])}))),r.source=i,r.add=i,this.value=i,r}});const nQ=e=>e.source.x,rQ=e=>e.source.y,iQ=e=>e.target.x,aQ=e=>e.target.y;function px(e){F.call(this,{},e)}px.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},q(px,F,{transform(e,t){var n=e.sourceX||nQ,r=e.sourceY||rQ,i=e.targetX||iQ,a=e.targetY||aQ,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=DR.get(l+"-"+s)||DR.get(l);return u||L("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[o]=u(n(c),r(c),i(c),a(c))}),t.reflow(e.modified()).modifies(o)}});const $R=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,oQ=(e,t,n,r)=>$R(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),OR=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2,s=180*Math.atan2(a,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+r},sQ=(e,t,n,r)=>OR(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),MR=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},lQ=(e,t,n,r)=>MR(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),uQ=(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,cQ=(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,fQ=(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},dQ=(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},hQ=(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},pQ=(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s},DR=wl({line:$R,"line-radial":oQ,arc:OR,"arc-radial":sQ,curve:MR,"curve-radial":lQ,"orthogonal-horizontal":uQ,"orthogonal-vertical":cQ,"orthogonal-radial":fQ,"diagonal-horizontal":dQ,"diagonal-vertical":hQ,"diagonal-radial":pQ});function mx(e){F.call(this,null,e)}mx.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},q(mx,F,{transform(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],a=e.field||vl,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,u=l.map(a),c=u.length,f=o,d=(s-o)/MK(u),h=hR(c),p,m,g;for(e.sort&&h.sort((y,v)=>u[y]-u[v]),p=0;p<c;++p)g=u[h[p]],m=l[h[p]],m[r]=f,m[i]=f+=g*d;return this.value=u,t.reflow(e.modified()).modifies(n)}});const mQ=5;function gQ(e){const t=e.type;return!e.bins&&(t===ql||t===Jc||t===Kc)}function NR(e){return V1(e)&&e!==li}const yQ=kt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function RR(e){F.call(this,null,e),this.modified(!0)}q(RR,F,{transform(e,t){var n=t.dataflow,r=this.value,i=vQ(e);(!r||i!==r.type)&&(this.value=r=Ce(i)());for(i in e)if(!yQ[i]){if(i==="padding"&&NR(r.type))continue;le(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return SQ(r,e,EQ(r,e,wQ(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function vQ(e){var t=e.type,n="",r;return t===li?li+"-"+ql:(bQ(e)&&(r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=r===2?li+"-":r===3?Hl+"-":""),(n+t||ql).toLowerCase())}function bQ(e){const t=e.type;return V1(t)&&t!==ps&&t!==ms&&(e.scheme||e.range&&e.range.length&&e.range.every(X))}function wQ(e,t,n){const r=xQ(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,a=e.type,o=t.zero||t.zero===void 0&&gQ(e),s,l;if(!i)return 0;if(NR(a)&&t.padding&&i[0]!==ve(i)&&(i=kQ(a,i,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[s]<0&&(i[s]=0)),t.domainMin!=null&&(i[0]=t.domainMin),t.domainMax!=null&&(i[s]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const u=l>i[s]?s+1:l<i[0]?0:s;u!==s&&n.warn("Scale domainMid exceeds domain min or max.",l),i.splice(u,0,l)}return e.domain(FR(a,i,n)),a===q1&&e.unknown(t.domainImplicit?Qb:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&Q1(e,t.nice)||null),i.length}function xQ(e,t,n){return t?(e.domain(FR(e.type,t,n)),t.length):-1}function kQ(e,t,n,r,i,a){var o=Math.abs(ve(n)-n[0]),s=o/(o-2*r),l=e===Qi?Ky(t,null,s):e===Kc?Mh(t,null,s,.5):e===Jc?Mh(t,null,s,i||1):e===$p?Qy(t,null,s,a||1):Jy(t,null,s);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function FR(e,t,n){if(iD(e)){var r=Math.abs(t.reduce((i,a)=>i+(a<0?-1:a>0?1:0),0));r!==t.length&&n.warn("Log scale domain includes zero: "+H(t))}return t}function EQ(e,t,n){let r=t.bins;if(r&&!z(r)){const i=e.domain(),a=i[0],o=ve(i),s=r.step;let l=r.start==null?a:r.start,u=r.stop==null?o:r.stop;s||L("Scale bins parameter missing step property."),l<a&&(l=s*Math.ceil(a/s)),u>o&&(u=s*Math.floor(o/s)),r=hR(l,u+s/2,s)}return r?e.bins=r:e.bins&&delete e.bins,e.type===W1&&(r?!t.domain&&!t.domainRaw&&(e.domain(r),n=r.length):e.bins=e.domain()),n}function SQ(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(t.rangeStep!=null)a=TQ(r,t,n);else if(t.scheme&&(a=AQ(r,t,n),le(a))){if(e.interpolator)return e.interpolator(a);L("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&aD(r))return e.interpolator(Np(gx(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(J1(t.interpolate,t.interpolateGamma)):le(e.round)?e.round(i):le(e.rangeRound)&&e.interpolate(i?ZK:hx),a&&e.range(gx(a,t.reverse))}function TQ(e,t,n){e!==eD&&e!==H1&&L("Only band and point scales support rangeStep.");var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===H1?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*B1(n,i,r)]}function AQ(e,t,n){var r=t.schemeExtent,i,a;return z(t.scheme)?a=Np(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),a=K1(i),a||L("Unrecognized scheme name: ".concat(t.scheme))),n=e===Mp?n+1:e===W1?n-1:e===Wl||e===Op?+t.schemeCount||mQ:n,aD(e)?IR(a,r,t.reverse):le(a)?lD(IR(a,r),n):e===q1?a:a.slice(0,n)}function IR(e,t,n){return le(e)&&(t||n)?sD(e,gx(t||[0,1],n)):e}function gx(e,t){return t?e.slice().reverse():e}function LR(e){F.call(this,null,e)}q(LR,F,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(ts(e.sort)),this.modified(n),t}});const zR="zero",PR="center",jR="normalize",UR=["y0","y1"];function yx(e){F.call(this,null,e)}yx.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:zR,values:[zR,PR,jR]},{name:"as",type:"string",array:!0,length:2,default:UR}]},q(yx,F,{transform(e,t){var n=e.as||UR,r=n[0],i=n[1],a=ts(e.sort),o=e.field||vl,s=e.offset===PR?_Q:e.offset===jR?CQ:$Q,l,u,c,f;for(l=OQ(t.source,e.groupby,a,o),u=0,c=l.length,f=l.max;u<c;++u)s(l[u],f,o,r,i);return t.reflow(e.modified()).modifies(n)}});function _Q(e,t,n,r,i){for(var a=(t-e.sum)/2,o=e.length,s=0,l;s<o;++s)l=e[s],l[r]=a,l[i]=a+=Math.abs(n(l))}function CQ(e,t,n,r,i){for(var a=1/e.sum,o=0,s=e.length,l=0,u=0,c;l<s;++l)c=e[l],c[r]=o,c[i]=o=a*(u+=Math.abs(n(c)))}function $Q(e,t,n,r,i){for(var a=0,o=0,s=e.length,l=0,u,c;l<s;++l)c=e[l],u=+n(c),u<0?(c[r]=o,c[i]=o+=u):(c[r]=a,c[i]=a+=u)}function OQ(e,t,n,r){var i=[],a=m=>m(c),o,s,l,u,c,f,d,h,p;if(t==null)i.push(e.slice());else for(o={},s=0,l=e.length;s<l;++s)c=e[s],f=t.map(a),d=o[f],d||(o[f]=d=[],i.push(d)),d.push(c);for(f=0,p=0,u=i.length;f<u;++f){for(d=i[f],s=0,h=0,l=d.length;s<l;++s)h+=Math.abs(r(d[s]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return i.max=p,i}var MQ=Object.freeze({__proto__:null,axisticks:TR,datajoin:AR,encode:_R,legendentries:CR,linkpath:px,pie:mx,scale:RR,sortitems:LR,stack:yx}),DQ=Math.sqrt(50),NQ=Math.sqrt(10),RQ=Math.sqrt(2);function FQ(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=DQ?i*=10:a>=NQ?i*=5:a>=RQ&&(i*=2),t<e?-i:i}function gm(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function ks(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);++r<i;)a[r]=e+r*n;return a}function IQ(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}class Es{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,r,i,a=0;if(t>0){for(a=e[--t];t>0&&!(n=a,r=e[--t],a=n+r,i=r-(a-n),i););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(r=i*2,n=a+r,r==n-a&&(a=n))}return a}}function*LQ(e){for(const t of e)yield*t}function BR(e){return Array.from(LQ(e))}var ce=1e-6,qR=1e-12,pe=Math.PI,nt=pe/2,HR=pe/4,Vn=pe*2,Jt=180/pe,Qe=pe/180,Fe=Math.abs,iu=Math.atan,na=Math.atan2,he=Math.cos,WR=Math.exp,ym=Math.log,vx=Math.pow,oe=Math.sin,dr=Math.sign||function(e){return e>0?1:e<0?-1:0},On=Math.sqrt,bx=Math.tan;function GR(e){return e>1?0:e<-1?pe:Math.acos(e)}function hr(e){return e>1?nt:e<-1?-nt:Math.asin(e)}function pr(){}function vm(e,t){e&&VR.hasOwnProperty(e.type)&&VR[e.type](e,t)}var YR={Feature:function(e,t){vm(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)vm(n[r].geometry,t)}},VR={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){wx(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)wx(n[r],t,0)},Polygon:function(e,t){XR(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)XR(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)vm(n[r],t)}};function wx(e,t,n){var r=-1,i=e.length-n,a;for(t.lineStart();++r<i;)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function XR(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)wx(e[n],t,1);t.polygonEnd()}function au(e,t){e&&YR.hasOwnProperty(e.type)?YR[e.type](e,t):vm(e,t)}function xx(e){return[na(e[1],e[0]),hr(e[2])]}function ou(e){var t=e[0],n=e[1],r=he(n);return[r*he(t),r*oe(t),oe(n)]}function bm(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function wm(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kx(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function xm(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ex(e){var t=On(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Sx(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function Tx(e,t){return[Fe(e)>pe?e+Math.round(-e/Vn)*Vn:e,t]}Tx.invert=Tx;function JR(e,t,n){return(e%=Vn)?t||n?Sx(QR(e),ZR(t,n)):QR(e):t||n?ZR(t,n):Tx}function KR(e){return function(t,n){return t+=e,[t>pe?t-Vn:t<-pe?t+Vn:t,n]}}function QR(e){var t=KR(e);return t.invert=KR(-e),t}function ZR(e,t){var n=he(e),r=oe(e),i=he(t),a=oe(t);function o(s,l){var u=he(l),c=he(s)*u,f=oe(s)*u,d=oe(l),h=d*n+c*r;return[na(f*i-h*a,c*n-d*r),hr(h*i+f*a)]}return o.invert=function(s,l){var u=he(l),c=he(s)*u,f=oe(s)*u,d=oe(l),h=d*i-f*a;return[na(f*i+d*a,c*n+h*r),hr(h*n-c*r)]},o}function zQ(e){e=JR(e[0]*Qe,e[1]*Qe,e.length>2?e[2]*Qe:0);function t(n){return n=e(n[0]*Qe,n[1]*Qe),n[0]*=Jt,n[1]*=Jt,n}return t.invert=function(n){return n=e.invert(n[0]*Qe,n[1]*Qe),n[0]*=Jt,n[1]*=Jt,n},t}function PQ(e,t,n,r,i,a){if(!n)return;var o=he(t),s=oe(t),l=r*n;i==null?(i=t+r*Vn,a=t-l/2):(i=eF(o,i),a=eF(o,a),(r>0?i<a:i>a)&&(i+=r*Vn));for(var u,c=i;r>0?c>a:c<a;c-=l)u=xx([o,-s*he(c),-s*oe(c)]),e.point(u[0],u[1])}function eF(e,t){t=ou(t),t[0]-=e,Ex(t);var n=GR(-t[1]);return((-t[2]<0?-n:n)+Vn-ce)%Vn}function tF(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:pr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function km(e,t){return Fe(e[0]-t[0])<ce&&Fe(e[1]-t[1])<ce}function Em(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function nF(e,t,n,r,i){var a=[],o=[],s,l;if(e.forEach(function(p){if((m=p.length-1)<=0)return;var m,g=p[0],y=p[m],v;if(km(g,y)){if(!g[2]&&!y[2]){for(i.lineStart(),s=0;s<m;++s)i.point((g=p[s])[0],g[1]);i.lineEnd();return}y[0]+=2*ce}a.push(v=new Em(g,p,null,!0)),o.push(v.o=new Em(g,null,v,!1)),a.push(v=new Em(y,p,null,!1)),o.push(v.o=new Em(y,null,v,!0))}),!a.length)return;for(o.sort(t),rF(a),rF(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)i.point((f=c[s])[0],f[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)i.point((f=c[s])[0],f[1]);else r(d.x,d.p.x,-1,i);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);i.lineEnd()}}function rF(e){if(!(t=e.length))return;for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}function Ax(e){return Fe(e[0])<=pe?e[0]:dr(e[0])*((Fe(e[0])+pe)%Vn-pe)}function jQ(e,t){var n=Ax(t),r=t[1],i=oe(r),a=[oe(n),-he(n),0],o=0,s=0,l=new Es();i===1?r=nt+ce:i===-1&&(r=-nt-ce);for(var u=0,c=e.length;u<c;++u){if(!(d=(f=e[u]).length))continue;for(var f,d,h=f[d-1],p=Ax(h),m=h[1]/2+HR,g=oe(m),y=he(m),v=0;v<d;++v,p=w,g=E,y=k,h=b){var b=f[v],w=Ax(b),x=b[1]/2+HR,E=oe(x),k=he(x),S=w-p,A=S>=0?1:-1,C=A*S,_=C>pe,D=g*E;if(l.add(na(D*A*oe(C),y*k+D*he(C))),o+=_?S+A*Vn:S,_^p>=n^w>=n){var M=wm(ou(h),ou(b));Ex(M);var N=wm(a,M);Ex(N);var T=(_^S>=0?-1:1)*hr(N[2]);(r>T||r===T&&(M[0]||M[1]))&&(s+=_^S>=0?1:-1)}}}return(o<-ce||o<ce&&l<-qR)^s&1}function iF(e,t,n,r){return function(i){var a=t(i),o=tF(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,c=BR(c);var w=jQ(u,r);c.length?(l||(i.polygonStart(),l=!0),nF(c,BQ,w,n,i)):w&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),c=u=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(w,x){e(w,x)&&i.point(w,x)}function p(w,x){a.point(w,x)}function m(){d.point=p,a.lineStart()}function g(){d.point=h,a.lineEnd()}function y(w,x){f.push([w,x]),s.point(w,x)}function v(){s.lineStart(),f=[]}function b(){y(f[0][0],f[0][1]),s.lineEnd();var w=s.clean(),x=o.result(),E,k=x.length,S,A,C;if(f.pop(),u.push(f),f=null,!k)return;if(w&1){if(A=x[0],(S=A.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),E=0;E<S;++E)i.point((C=A[E])[0],C[1]);i.lineEnd()}return}k>1&&w&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(UQ))}return d}}function UQ(e){return e.length>1}function BQ(e,t){return((e=e.x)[0]<0?e[1]-nt-ce:nt-e[1])-((t=t.x)[0]<0?t[1]-nt-ce:nt-t[1])}var aF=iF(function(){return!0},qQ,WQ,[-pe,-nt]);function qQ(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(a,o){var s=a>0?pe:-pe,l=Fe(a-t);Fe(l-pe)<ce?(e.point(t,n=(n+o)/2>0?nt:-nt),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),i=0):r!==s&&l>=pe&&(Fe(t-r)<ce&&(t-=r*ce),Fe(a-s)<ce&&(a-=s*ce),n=HQ(t,n,a,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),i=0),e.point(t=a,n=o),r=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function HQ(e,t,n,r){var i,a,o=oe(e-n);return Fe(o)>ce?iu((oe(t)*(a=he(r))*oe(n)-oe(r)*(i=he(t))*oe(e))/(i*a*o)):(t+r)/2}function WQ(e,t,n,r){var i;if(e==null)i=n*nt,r.point(-pe,i),r.point(0,i),r.point(pe,i),r.point(pe,0),r.point(pe,-i),r.point(0,-i),r.point(-pe,-i),r.point(-pe,0),r.point(-pe,i);else if(Fe(e[0]-t[0])>ce){var a=e[0]<t[0]?pe:-pe;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}function GQ(e){var t=he(e),n=6*Qe,r=t>0,i=Fe(t)>ce;function a(c,f,d,h){PQ(h,e,n,d,c,f)}function o(c,f){return he(c)*he(f)>t}function s(c){var f,d,h,p,m;return{lineStart:function(){p=h=!1,m=1},point:function(g,y){var v=[g,y],b,w=o(g,y),x=r?w?0:u(g,y):w?u(g+(g<0?pe:-pe),y):0;if(!f&&(p=h=w)&&c.lineStart(),w!==h&&(b=l(f,v),(!b||km(f,b)||km(v,b))&&(v[2]=1)),w!==h)m=0,w?(c.lineStart(),b=l(v,f),c.point(b[0],b[1])):(b=l(f,v),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(i&&f&&r^w){var E;!(x&d)&&(E=l(v,f,!0))&&(m=0,r?(c.lineStart(),c.point(E[0][0],E[0][1]),c.point(E[1][0],E[1][1]),c.lineEnd()):(c.point(E[1][0],E[1][1]),c.lineEnd(),c.lineStart(),c.point(E[0][0],E[0][1],3)))}w&&(!f||!km(f,v))&&c.point(v[0],v[1]),f=v,h=w,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return m|(p&&h)<<1}}}function l(c,f,d){var h=ou(c),p=ou(f),m=[1,0,0],g=wm(h,p),y=bm(g,g),v=g[0],b=y-v*v;if(!b)return!d&&c;var w=t*y/b,x=-t*v/b,E=wm(m,g),k=xm(m,w),S=xm(g,x);kx(k,S);var A=E,C=bm(k,A),_=bm(A,A),D=C*C-_*(bm(k,k)-1);if(D<0)return;var M=On(D),N=xm(A,(-C-M)/_);if(kx(N,k),N=xx(N),!d)return N;var T=c[0],O=f[0],P=c[1],W=f[1],B;O<T&&(B=T,T=O,O=B);var se=O-T,me=Fe(se-pe)<ce,we=me||se<ce;if(!me&&W<P&&(B=P,P=W,W=B),we?me?P+W>0^N[1]<(Fe(N[0]-T)<ce?P:W):P<=N[1]&&N[1]<=W:se>pe^(T<=N[0]&&N[0]<=O)){var ye=xm(A,(-C+M)/_);return kx(ye,k),[N,xx(ye)]}}function u(c,f){var d=r?e:pe-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return iF(o,s,a,r?[0,-e]:[-pe,e-pe])}function YQ(e,t,n,r,i,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=i-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=r-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var Sf=1e9,Sm=-Sf;function oF(e,t,n,r){function i(u,c){return e<=u&&u<=n&&t<=c&&c<=r}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?r:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return Fe(u[0]-e)<ce?c>0?0:3:Fe(u[0]-n)<ce?c>0?2:1:Fe(u[1]-t)<ce?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=tF(),d,h,p,m,g,y,v,b,w,x,E,k={point:S,lineStart:D,lineEnd:M,polygonStart:C,polygonEnd:_};function S(T,O){i(T,O)&&c.point(T,O)}function A(){for(var T=0,O=0,P=h.length;O<P;++O)for(var W=h[O],B=1,se=W.length,me=W[0],we,ye,Se=me[0],Ue=me[1];B<se;++B)we=Se,ye=Ue,me=W[B],Se=me[0],Ue=me[1],ye<=r?Ue>r&&(Se-we)*(r-ye)>(Ue-ye)*(e-we)&&++T:Ue<=r&&(Se-we)*(r-ye)<(Ue-ye)*(e-we)&&--T;return T}function C(){c=f,d=[],h=[],E=!0}function _(){var T=A(),O=E&&T,P=(d=BR(d)).length;(O||P)&&(u.polygonStart(),O&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),P&&nF(d,s,T,a,u),u.polygonEnd()),c=u,d=h=p=null}function D(){k.point=N,h&&h.push(p=[]),x=!0,w=!1,v=b=NaN}function M(){d&&(N(m,g),y&&w&&f.rejoin(),d.push(f.result())),k.point=S,w&&c.lineEnd()}function N(T,O){var P=i(T,O);if(h&&p.push([T,O]),x)m=T,g=O,y=P,x=!1,P&&(c.lineStart(),c.point(T,O));else if(P&&w)c.point(T,O);else{var W=[v=Math.max(Sm,Math.min(Sf,v)),b=Math.max(Sm,Math.min(Sf,b))],B=[T=Math.max(Sm,Math.min(Sf,T)),O=Math.max(Sm,Math.min(Sf,O))];YQ(W,B,e,t,n,r)?(w||(c.lineStart(),c.point(W[0],W[1])),c.point(B[0],B[1]),P||c.lineEnd(),E=!1):P&&(c.lineStart(),c.point(T,O),E=!1)}v=T,b=O,w=P}return k}}var Tf=e=>e,_x=new Es(),Cx=new Es(),sF,lF,$x,Ox,ra={point:pr,lineStart:pr,lineEnd:pr,polygonStart:function(){ra.lineStart=VQ,ra.lineEnd=JQ},polygonEnd:function(){ra.lineStart=ra.lineEnd=ra.point=pr,_x.add(Fe(Cx)),Cx=new Es()},result:function(){var e=_x/2;return _x=new Es(),e}};function VQ(){ra.point=XQ}function XQ(e,t){ra.point=uF,sF=$x=e,lF=Ox=t}function uF(e,t){Cx.add(Ox*e-$x*t),$x=e,Ox=t}function JQ(){uF(sF,lF)}var su=Infinity,Tm=su,Af=-su,Am=Af,_m={point:KQ,lineStart:pr,lineEnd:pr,polygonStart:pr,polygonEnd:pr,result:function(){var e=[[su,Tm],[Af,Am]];return Af=Am=-(Tm=su=Infinity),e}};function KQ(e,t){e<su&&(su=e),e>Af&&(Af=e),t<Tm&&(Tm=t),t>Am&&(Am=t)}var Mx=0,Dx=0,_f=0,Cm=0,$m=0,lu=0,Nx=0,Rx=0,Cf=0,cF,fF,gi,yi,mr={point:Ss,lineStart:dF,lineEnd:hF,polygonStart:function(){mr.lineStart=eZ,mr.lineEnd=tZ},polygonEnd:function(){mr.point=Ss,mr.lineStart=dF,mr.lineEnd=hF},result:function(){var e=Cf?[Nx/Cf,Rx/Cf]:lu?[Cm/lu,$m/lu]:_f?[Mx/_f,Dx/_f]:[NaN,NaN];return Mx=Dx=_f=Cm=$m=lu=Nx=Rx=Cf=0,e}};function Ss(e,t){Mx+=e,Dx+=t,++_f}function dF(){mr.point=QQ}function QQ(e,t){mr.point=ZQ,Ss(gi=e,yi=t)}function ZQ(e,t){var n=e-gi,r=t-yi,i=On(n*n+r*r);Cm+=i*(gi+e)/2,$m+=i*(yi+t)/2,lu+=i,Ss(gi=e,yi=t)}function hF(){mr.point=Ss}function eZ(){mr.point=nZ}function tZ(){pF(cF,fF)}function nZ(e,t){mr.point=pF,Ss(cF=gi=e,fF=yi=t)}function pF(e,t){var n=e-gi,r=t-yi,i=On(n*n+r*r);Cm+=i*(gi+e)/2,$m+=i*(yi+t)/2,lu+=i,i=yi*e-gi*t,Nx+=i*(gi+e),Rx+=i*(yi+t),Cf+=i*3,Ss(gi=e,yi=t)}function mF(e){this._context=e}mF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Vn);break}}},result:pr};var Fx=new Es(),Ix,gF,yF,$f,Of,Mf={point:pr,lineStart:function(){Mf.point=rZ},lineEnd:function(){Ix&&vF(gF,yF),Mf.point=pr},polygonStart:function(){Ix=!0},polygonEnd:function(){Ix=null},result:function(){var e=+Fx;return Fx=new Es(),e}};function rZ(e,t){Mf.point=vF,gF=$f=e,yF=Of=t}function vF(e,t){$f-=e,Of-=t,Fx.add(On($f*$f+Of*Of)),$f=e,Of=t}function bF(){this._string=[]}bF.prototype={_radius:4.5,_circle:wF(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=wF(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function wF(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function xF(e,t){var n=4.5,r,i;function a(o){return o&&(typeof n=="function"&&i.pointRadius(+n.apply(this,arguments)),au(o,r(i))),i.result()}return a.area=function(o){return au(o,r(ra)),ra.result()},a.measure=function(o){return au(o,r(Mf)),Mf.result()},a.bounds=function(o){return au(o,r(_m)),_m.result()},a.centroid=function(o){return au(o,r(mr)),mr.result()},a.projection=function(o){return arguments.length?(r=o==null?(e=null,Tf):(e=o).stream,a):e},a.context=function(o){return arguments.length?(i=o==null?(t=null,new bF()):new mF(t=o),typeof n!="function"&&i.pointRadius(n),a):t},a.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(i.pointRadius(+o),+o),a):n},a.projection(e).context(t)}function Om(e){return function(t){var n=new Lx();for(var r in e)n[r]=e[r];return n.stream=t,n}}function Lx(){}Lx.prototype={constructor:Lx,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function zx(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),au(n,e.stream(_m)),t(_m.result()),r!=null&&e.clipExtent(r),e}function Mm(e,t,n){return zx(e,function(r){var i=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),a/(r[1][1]-r[0][1])),s=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(a-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function Px(e,t,n){return Mm(e,[[0,0],t],n)}function jx(e,t,n){return zx(e,function(r){var i=+t,a=i/(r[1][0]-r[0][0]),o=(i-a*(r[1][0]+r[0][0]))/2,s=-a*r[0][1];e.scale(150*a).translate([o,s])},n)}function Ux(e,t,n){return zx(e,function(r){var i=+t,a=i/(r[1][1]-r[0][1]),o=-a*r[0][0],s=(i-a*(r[1][1]+r[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var kF=16,iZ=he(30*Qe);function EF(e,t){return+t?oZ(e,t):aZ(e)}function aZ(e){return Om({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function oZ(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var w=o+d,x=s+h,E=l+p,k=On(w*w+x*x+E*E),S=hr(E/=k),A=Fe(Fe(E)-1)<ce||Fe(a-f)<ce?(a+f)/2:na(x,w),C=e(A,S),_=C[0],D=C[1],M=_-r,N=D-i,T=v*M-y*N;(T*T/b>t||Fe((y*M+v*N)/b-.5)>.3||o*d+s*h+l*p<iZ)&&(n(r,i,a,o,s,l,_,D,A,w/=k,x/=k,E,m,g),g.point(_,D),n(_,D,A,w,x,E,u,c,f,d,h,p,m,g))}}return function(r){var i,a,o,s,l,u,c,f,d,h,p,m,g={point:y,lineStart:v,lineEnd:w,polygonStart:function(){r.polygonStart(),g.lineStart=x},polygonEnd:function(){r.polygonEnd(),g.lineStart=v}};function y(S,A){S=e(S,A),r.point(S[0],S[1])}function v(){f=NaN,g.point=b,r.lineStart()}function b(S,A){var C=ou([S,A]),_=e(S,A);n(f,d,c,h,p,m,f=_[0],d=_[1],c=S,h=C[0],p=C[1],m=C[2],kF,r),r.point(f,d)}function w(){g.point=y,r.lineEnd()}function x(){v(),g.point=E,g.lineEnd=k}function E(S,A){b(i=S,A),a=f,o=d,s=h,l=p,u=m,g.point=b}function k(){n(f,d,c,h,p,m,a,o,i,s,l,u,kF,r),g.lineEnd=w,w()}return g}}var sZ=Om({point:function(e,t){this.stream.point(e*Qe,t*Qe)}});function lZ(e){return Om({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function uZ(e,t,n,r,i){function a(o,s){return o*=r,s*=i,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*r,(n-s)/e*i]},a}function SF(e,t,n,r,i,a){if(!a)return uZ(e,t,n,r,i);var o=he(a),s=oe(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(m,g){return m*=r,g*=i,[l*m-u*g+t,n-u*m-l*g]}return p.invert=function(m,g){return[r*(c*m-f*g+d),i*(h-f*m-c*g)]},p}function ia(e){return TF(function(){return e})()}function TF(e){var t,n=150,r=480,i=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,m=aF,g=null,y,v,b,w=Tf,x=.5,E,k,S,A,C;function _(T){return S(T[0]*Qe,T[1]*Qe)}function D(T){return T=S.invert(T[0],T[1]),T&&[T[0]*Jt,T[1]*Jt]}_.stream=function(T){return A&&C===T?A:A=sZ(lZ(c)(m(E(w(C=T)))))},_.preclip=function(T){return arguments.length?(m=T,p=void 0,N()):m},_.postclip=function(T){return arguments.length?(w=T,g=y=v=b=null,N()):w},_.clipAngle=function(T){return arguments.length?(m=+T?GQ(p=T*Qe):(p=null,aF),N()):p*Jt},_.clipExtent=function(T){return arguments.length?(w=T==null?(g=y=v=b=null,Tf):oF(g=+T[0][0],y=+T[0][1],v=+T[1][0],b=+T[1][1]),N()):g==null?null:[[g,y],[v,b]]},_.scale=function(T){return arguments.length?(n=+T,M()):n},_.translate=function(T){return arguments.length?(r=+T[0],i=+T[1],M()):[r,i]},_.center=function(T){return arguments.length?(a=T[0]%360*Qe,o=T[1]%360*Qe,M()):[a*Jt,o*Jt]},_.rotate=function(T){return arguments.length?(s=T[0]%360*Qe,l=T[1]%360*Qe,u=T.length>2?T[2]%360*Qe:0,M()):[s*Jt,l*Jt,u*Jt]},_.angle=function(T){return arguments.length?(f=T%360*Qe,M()):f*Jt},_.reflectX=function(T){return arguments.length?(d=T?-1:1,M()):d<0},_.reflectY=function(T){return arguments.length?(h=T?-1:1,M()):h<0},_.precision=function(T){return arguments.length?(E=EF(k,x=T*T),N()):On(x)},_.fitExtent=function(T,O){return Mm(_,T,O)},_.fitSize=function(T,O){return Px(_,T,O)},_.fitWidth=function(T,O){return jx(_,T,O)},_.fitHeight=function(T,O){return Ux(_,T,O)};function M(){var T=SF(n,0,0,d,h,f).apply(null,t(a,o)),O=SF(n,r-T[0],i-T[1],d,h,f);return c=JR(s,l,u),k=Sx(t,O),S=Sx(c,k),E=EF(k,x),N()}function N(){return A=C=null,_}return function(){return t=e.apply(this,arguments),_.invert=t.invert&&D,M()}}function Bx(e){var t=0,n=pe/3,r=TF(e),i=r(t,n);return i.parallels=function(a){return arguments.length?r(t=a[0]*Qe,n=a[1]*Qe):[t*Jt,n*Jt]},i}function cZ(e){var t=he(e);function n(r,i){return[r*t,oe(i)/t]}return n.invert=function(r,i){return[r/t,hr(i*t)]},n}function fZ(e,t){var n=oe(e),r=(n+oe(t))/2;if(Fe(r)<ce)return cZ(e);var i=1+n*(2*r-n),a=On(i)/r;function o(s,l){var u=On(i-2*r*oe(l))/r;return[u*oe(s*=r),a-u*he(s)]}return o.invert=function(s,l){var u=a-l,c=na(s,Fe(u))*dr(u);return u*r<0&&(c-=pe*dr(s)*dr(u)),[c/r,hr((i-(s*s+u*u)*r*r)/(2*r))]},o}function Dm(){return Bx(fZ).scale(155.424).center([0,33.6442])}function AF(){return Dm().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function dZ(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function hZ(){var e,t,n=AF(),r,i=Dm().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=Dm().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,l,u={point:function(d,h){l=[d,h]}};function c(d){var h=d[0],p=d[1];return l=null,(r.point(h,p),l)||(a.point(h,p),l)||(s.point(h,p),l)}c.invert=function(d){var h=n.scale(),p=n.translate(),m=(d[0]-p[0])/h,g=(d[1]-p[1])/h;return(g>=.12&&g<.234&&m>=-.425&&m<-.214?i:g>=.166&&g<.234&&m>=-.214&&m<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=dZ([n.stream(t=d),i.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),i.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),i.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],m=+d[1];return r=n.translate(d).clipExtent([[p-.455*h,m-.238*h],[p+.455*h,m+.238*h]]).stream(u),a=i.translate([p-.307*h,m+.201*h]).clipExtent([[p-.425*h+ce,m+.12*h+ce],[p-.214*h-ce,m+.234*h-ce]]).stream(u),s=o.translate([p-.205*h,m+.212*h]).clipExtent([[p-.214*h+ce,m+.166*h+ce],[p-.115*h-ce,m+.234*h-ce]]).stream(u),f()},c.fitExtent=function(d,h){return Mm(c,d,h)},c.fitSize=function(d,h){return Px(c,d,h)},c.fitWidth=function(d,h){return jx(c,d,h)},c.fitHeight=function(d,h){return Ux(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function _F(e){return function(t,n){var r=he(t),i=he(n),a=e(r*i);return a===Infinity?[2,0]:[a*i*oe(t),a*oe(n)]}}function Df(e){return function(t,n){var r=On(t*t+n*n),i=e(r),a=oe(i),o=he(i);return[na(t*a,r*o),hr(r&&n*a/r)]}}var CF=_F(function(e){return On(2/(1+e))});CF.invert=Df(function(e){return 2*hr(e/2)});function pZ(){return ia(CF).scale(124.75).clipAngle(180-.001)}var $F=_F(function(e){return(e=GR(e))&&e/oe(e)});$F.invert=Df(function(e){return e});function mZ(){return ia($F).scale(79.4188).clipAngle(180-.001)}function Nm(e,t){return[e,ym(bx((nt+t)/2))]}Nm.invert=function(e,t){return[e,2*iu(WR(t))-nt]};function gZ(){return OF(Nm).scale(961/Vn)}function OF(e){var t=ia(e),n=t.center,r=t.scale,i=t.translate,a=t.clipExtent,o=null,s,l,u;t.scale=function(f){return arguments.length?(r(f),c()):r()},t.translate=function(f){return arguments.length?(i(f),c()):i()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=s=l=u=null:(o=+f[0][0],s=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):o==null?null:[[o,s],[l,u]]};function c(){var f=pe*r(),d=t(zQ(t.rotate()).invert([0,0]));return a(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===Nm?[[Math.max(d[0]-f,o),s],[Math.min(d[0]+f,l),u]]:[[o,Math.max(d[1]-f,s)],[l,Math.min(d[1]+f,u)]])}return c()}function Rm(e){return bx((nt+e)/2)}function yZ(e,t){var n=he(e),r=e===t?oe(e):ym(n/he(t))/ym(Rm(t)/Rm(e)),i=n*vx(Rm(e),r)/r;if(!r)return Nm;function a(o,s){i>0?s<-nt+ce&&(s=-nt+ce):s>nt-ce&&(s=nt-ce);var l=i/vx(Rm(s),r);return[l*oe(r*o),i-l*he(r*o)]}return a.invert=function(o,s){var l=i-s,u=dr(r)*On(o*o+l*l),c=na(o,Fe(l))*dr(l);return l*r<0&&(c-=pe*dr(o)*dr(l)),[c/r,2*iu(vx(i/u,1/r))-nt]},a}function vZ(){return Bx(yZ).scale(109.5).parallels([30,30])}function Fm(e,t){return[e,t]}Fm.invert=Fm;function bZ(){return ia(Fm).scale(152.63)}function wZ(e,t){var n=he(e),r=e===t?oe(e):(n-he(t))/(t-e),i=n/r+e;if(Fe(r)<ce)return Fm;function a(o,s){var l=i-s,u=r*o;return[l*oe(u),i-l*he(u)]}return a.invert=function(o,s){var l=i-s,u=na(o,Fe(l))*dr(l);return l*r<0&&(u-=pe*dr(o)*dr(l)),[u/r,i-dr(r)*On(o*o+l*l)]},a}function xZ(){return Bx(wZ).scale(131.154).center([0,13.9389])}var Nf=1.340264,Rf=-.081106,Ff=893e-6,If=.003796,Im=On(3)/2,kZ=12;function MF(e,t){var n=hr(Im*oe(t)),r=n*n,i=r*r*r;return[e*he(n)/(Im*(Nf+3*Rf*r+i*(7*Ff+9*If*r))),n*(Nf+Rf*r+i*(Ff+If*r))]}MF.invert=function(e,t){for(var n=t,r=n*n,i=r*r*r,a=0,o,s,l;a<kZ&&!(s=n*(Nf+Rf*r+i*(Ff+If*r))-t,l=Nf+3*Rf*r+i*(7*Ff+9*If*r),n-=o=s/l,r=n*n,i=r*r*r,Fe(o)<qR);++a);return[Im*e*(Nf+3*Rf*r+i*(7*Ff+9*If*r))/he(n),hr(oe(n)/Im)]};function EZ(){return ia(MF).scale(177.158)}function DF(e,t){var n=he(t),r=he(e)*n;return[n*oe(e)/r,oe(t)/r]}DF.invert=Df(iu);function SZ(){return ia(DF).scale(144.049).clipAngle(60)}function TZ(){var e=1,t=0,n=0,r=1,i=1,a=0,o,s,l=null,u,c,f,d=1,h=1,p=Om({point:function(w,x){var E=b([w,x]);this.stream.point(E[0],E[1])}}),m=Tf,g,y;function v(){return d=e*r,h=e*i,g=y=null,b}function b(w){var x=w[0]*d,E=w[1]*h;if(a){var k=E*o-x*s;x=x*o+E*s,E=k}return[x+t,E+n]}return b.invert=function(w){var x=w[0]-t,E=w[1]-n;if(a){var k=E*o+x*s;x=x*o-E*s,E=k}return[x/d,E/h]},b.stream=function(w){return g&&y===w?g:g=p(m(y=w))},b.postclip=function(w){return arguments.length?(m=w,l=u=c=f=null,v()):m},b.clipExtent=function(w){return arguments.length?(m=w==null?(l=u=c=f=null,Tf):oF(l=+w[0][0],u=+w[0][1],c=+w[1][0],f=+w[1][1]),v()):l==null?null:[[l,u],[c,f]]},b.scale=function(w){return arguments.length?(e=+w,v()):e},b.translate=function(w){return arguments.length?(t=+w[0],n=+w[1],v()):[t,n]},b.angle=function(w){return arguments.length?(a=w%360*Qe,s=oe(a),o=he(a),v()):a*Jt},b.reflectX=function(w){return arguments.length?(r=w?-1:1,v()):r<0},b.reflectY=function(w){return arguments.length?(i=w?-1:1,v()):i<0},b.fitExtent=function(w,x){return Mm(b,w,x)},b.fitSize=function(w,x){return Px(b,w,x)},b.fitWidth=function(w,x){return jx(b,w,x)},b.fitHeight=function(w,x){return Ux(b,w,x)},b}function NF(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}NF.invert=function(e,t){var n=t,r=25,i;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(Fe(i)>ce&&--r>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function AZ(){return ia(NF).scale(175.295)}function RF(e,t){return[he(t)*oe(e),oe(t)]}RF.invert=Df(hr);function _Z(){return ia(RF).scale(249.5).clipAngle(90+ce)}function FF(e,t){var n=he(t),r=1+he(e)*n;return[n*oe(e)/r,oe(t)/r]}FF.invert=Df(function(e){return 2*iu(e)});function CZ(){return ia(FF).scale(250).clipAngle(142)}function IF(e,t){return[ym(bx((nt+t)/2)),-e]}IF.invert=function(e,t){return[-t,2*iu(WR(e))-nt]};function $Z(){var e=OF(IF),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}class OZ{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,r,i,a=0;if(t>0){for(a=e[--t];t>0&&!(n=a,r=e[--t],a=n+r,i=r-(a-n),i););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(r=i*2,n=a+r,r==n-a&&(a=n))}return a}}function*MZ(e){for(const t of e)yield*t}function LF(e){return Array.from(MZ(e))}var He=1e-6,DZ=1e-12,ke=Math.PI,gr=ke/2,zF=ke/4,Fr=ke*2,aa=180/ke,Xn=ke/180,ot=Math.abs,NZ=Math.atan,Lf=Math.atan2,st=Math.cos,lt=Math.sin,RZ=Math.sign||function(e){return e>0?1:e<0?-1:0},Lm=Math.sqrt;function FZ(e){return e>1?0:e<-1?ke:Math.acos(e)}function zf(e){return e>1?gr:e<-1?-gr:Math.asin(e)}function Pf(){}function zm(e,t){e&&jF.hasOwnProperty(e.type)&&jF[e.type](e,t)}var PF={Feature:function(e,t){zm(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)zm(n[r].geometry,t)}},jF={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){qx(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)qx(n[r],t,0)},Polygon:function(e,t){UF(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)UF(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)zm(n[r],t)}};function qx(e,t,n){var r=-1,i=e.length-n,a;for(t.lineStart();++r<i;)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function UF(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)qx(e[n],t,1);t.polygonEnd()}function IZ(e,t){e&&PF.hasOwnProperty(e.type)?PF[e.type](e,t):zm(e,t)}function Hx(e){return[Lf(e[1],e[0]),zf(e[2])]}function uu(e){var t=e[0],n=e[1],r=st(n);return[r*st(t),r*lt(t),lt(n)]}function Pm(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function jm(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Wx(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Um(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Gx(e){var t=Lm(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Yx(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function Vx(e,t){return[ot(e)>ke?e+Math.round(-e/Fr)*Fr:e,t]}Vx.invert=Vx;function LZ(e,t,n){return(e%=Fr)?t||n?Yx(qF(e),HF(t,n)):qF(e):t||n?HF(t,n):Vx}function BF(e){return function(t,n){return t+=e,[t>ke?t-Fr:t<-ke?t+Fr:t,n]}}function qF(e){var t=BF(e);return t.invert=BF(-e),t}function HF(e,t){var n=st(e),r=lt(e),i=st(t),a=lt(t);function o(s,l){var u=st(l),c=st(s)*u,f=lt(s)*u,d=lt(l),h=d*n+c*r;return[Lf(f*i-h*a,c*n-d*r),zf(h*i+f*a)]}return o.invert=function(s,l){var u=st(l),c=st(s)*u,f=lt(s)*u,d=lt(l),h=d*i-f*a;return[Lf(f*i+d*a,c*n+h*r),zf(h*n-c*r)]},o}function zZ(e,t,n,r,i,a){if(!n)return;var o=st(t),s=lt(t),l=r*n;i==null?(i=t+r*Fr,a=t-l/2):(i=WF(o,i),a=WF(o,a),(r>0?i<a:i>a)&&(i+=r*Fr));for(var u,c=i;r>0?c>a:c<a;c-=l)u=Hx([o,-s*st(c),-s*lt(c)]),e.point(u[0],u[1])}function WF(e,t){t=uu(t),t[0]-=e,Gx(t);var n=FZ(-t[1]);return((-t[2]<0?-n:n)+Fr-He)%Fr}function GF(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Pf,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function Bm(e,t){return ot(e[0]-t[0])<He&&ot(e[1]-t[1])<He}function qm(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function YF(e,t,n,r,i){var a=[],o=[],s,l;if(e.forEach(function(p){if((m=p.length-1)<=0)return;var m,g=p[0],y=p[m],v;if(Bm(g,y)){if(!g[2]&&!y[2]){for(i.lineStart(),s=0;s<m;++s)i.point((g=p[s])[0],g[1]);i.lineEnd();return}y[0]+=2*He}a.push(v=new qm(g,p,null,!0)),o.push(v.o=new qm(g,null,v,!1)),a.push(v=new qm(y,p,null,!1)),o.push(v.o=new qm(y,null,v,!0))}),!a.length)return;for(o.sort(t),VF(a),VF(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)i.point((f=c[s])[0],f[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)i.point((f=c[s])[0],f[1]);else r(d.x,d.p.x,-1,i);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);i.lineEnd()}}function VF(e){if(!(t=e.length))return;for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}function Xx(e){return ot(e[0])<=ke?e[0]:RZ(e[0])*((ot(e[0])+ke)%Fr-ke)}function PZ(e,t){var n=Xx(t),r=t[1],i=lt(r),a=[lt(n),-st(n),0],o=0,s=0,l=new OZ();i===1?r=gr+He:i===-1&&(r=-gr-He);for(var u=0,c=e.length;u<c;++u){if(!(d=(f=e[u]).length))continue;for(var f,d,h=f[d-1],p=Xx(h),m=h[1]/2+zF,g=lt(m),y=st(m),v=0;v<d;++v,p=w,g=E,y=k,h=b){var b=f[v],w=Xx(b),x=b[1]/2+zF,E=lt(x),k=st(x),S=w-p,A=S>=0?1:-1,C=A*S,_=C>ke,D=g*E;if(l.add(Lf(D*A*lt(C),y*k+D*st(C))),o+=_?S+A*Fr:S,_^p>=n^w>=n){var M=jm(uu(h),uu(b));Gx(M);var N=jm(a,M);Gx(N);var T=(_^S>=0?-1:1)*zf(N[2]);(r>T||r===T&&(M[0]||M[1]))&&(s+=_^S>=0?1:-1)}}}return(o<-He||o<He&&l<-DZ)^s&1}function XF(e,t,n,r){return function(i){var a=t(i),o=GF(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,c=LF(c);var w=PZ(u,r);c.length?(l||(i.polygonStart(),l=!0),YF(c,UZ,w,n,i)):w&&(l||(i.polygonStart(),l=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),l&&(i.polygonEnd(),l=!1),c=u=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(w,x){e(w,x)&&i.point(w,x)}function p(w,x){a.point(w,x)}function m(){d.point=p,a.lineStart()}function g(){d.point=h,a.lineEnd()}function y(w,x){f.push([w,x]),s.point(w,x)}function v(){s.lineStart(),f=[]}function b(){y(f[0][0],f[0][1]),s.lineEnd();var w=s.clean(),x=o.result(),E,k=x.length,S,A,C;if(f.pop(),u.push(f),f=null,!k)return;if(w&1){if(A=x[0],(S=A.length-1)>0){for(l||(i.polygonStart(),l=!0),i.lineStart(),E=0;E<S;++E)i.point((C=A[E])[0],C[1]);i.lineEnd()}return}k>1&&w&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(jZ))}return d}}function jZ(e){return e.length>1}function UZ(e,t){return((e=e.x)[0]<0?e[1]-gr-He:gr-e[1])-((t=t.x)[0]<0?t[1]-gr-He:gr-t[1])}var JF=XF(function(){return!0},BZ,HZ,[-ke,-gr]);function BZ(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(a,o){var s=a>0?ke:-ke,l=ot(a-t);ot(l-ke)<He?(e.point(t,n=(n+o)/2>0?gr:-gr),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),i=0):r!==s&&l>=ke&&(ot(t-r)<He&&(t-=r*He),ot(a-s)<He&&(a-=s*He),n=qZ(t,n,a,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(s,n),i=0),e.point(t=a,n=o),r=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function qZ(e,t,n,r){var i,a,o=lt(e-n);return ot(o)>He?NZ((lt(t)*(a=st(r))*lt(n)-lt(r)*(i=st(t))*lt(e))/(i*a*o)):(t+r)/2}function HZ(e,t,n,r){var i;if(e==null)i=n*gr,r.point(-ke,i),r.point(0,i),r.point(ke,i),r.point(ke,0),r.point(ke,-i),r.point(0,-i),r.point(-ke,-i),r.point(-ke,0),r.point(-ke,i);else if(ot(e[0]-t[0])>He){var a=e[0]<t[0]?ke:-ke;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}function WZ(e){var t=st(e),n=6*Xn,r=t>0,i=ot(t)>He;function a(c,f,d,h){zZ(h,e,n,d,c,f)}function o(c,f){return st(c)*st(f)>t}function s(c){var f,d,h,p,m;return{lineStart:function(){p=h=!1,m=1},point:function(g,y){var v=[g,y],b,w=o(g,y),x=r?w?0:u(g,y):w?u(g+(g<0?ke:-ke),y):0;if(!f&&(p=h=w)&&c.lineStart(),w!==h&&(b=l(f,v),(!b||Bm(f,b)||Bm(v,b))&&(v[2]=1)),w!==h)m=0,w?(c.lineStart(),b=l(v,f),c.point(b[0],b[1])):(b=l(f,v),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(i&&f&&r^w){var E;!(x&d)&&(E=l(v,f,!0))&&(m=0,r?(c.lineStart(),c.point(E[0][0],E[0][1]),c.point(E[1][0],E[1][1]),c.lineEnd()):(c.point(E[1][0],E[1][1]),c.lineEnd(),c.lineStart(),c.point(E[0][0],E[0][1],3)))}w&&(!f||!Bm(f,v))&&c.point(v[0],v[1]),f=v,h=w,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return m|(p&&h)<<1}}}function l(c,f,d){var h=uu(c),p=uu(f),m=[1,0,0],g=jm(h,p),y=Pm(g,g),v=g[0],b=y-v*v;if(!b)return!d&&c;var w=t*y/b,x=-t*v/b,E=jm(m,g),k=Um(m,w),S=Um(g,x);Wx(k,S);var A=E,C=Pm(k,A),_=Pm(A,A),D=C*C-_*(Pm(k,k)-1);if(D<0)return;var M=Lm(D),N=Um(A,(-C-M)/_);if(Wx(N,k),N=Hx(N),!d)return N;var T=c[0],O=f[0],P=c[1],W=f[1],B;O<T&&(B=T,T=O,O=B);var se=O-T,me=ot(se-ke)<He,we=me||se<He;if(!me&&W<P&&(B=P,P=W,W=B),we?me?P+W>0^N[1]<(ot(N[0]-T)<He?P:W):P<=N[1]&&N[1]<=W:se>ke^(T<=N[0]&&N[0]<=O)){var ye=Um(A,(-C+M)/_);return Wx(ye,k),[N,Hx(ye)]}}function u(c,f){var d=r?e:ke-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return XF(o,s,a,r?[0,-e]:[-ke,e-ke])}function GZ(e,t,n,r,i,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=i-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=r-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var jf=1e9,Hm=-jf;function YZ(e,t,n,r){function i(u,c){return e<=u&&u<=n&&t<=c&&c<=r}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?r:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return ot(u[0]-e)<He?c>0?0:3:ot(u[0]-n)<He?c>0?2:1:ot(u[1]-t)<He?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=GF(),d,h,p,m,g,y,v,b,w,x,E,k={point:S,lineStart:D,lineEnd:M,polygonStart:C,polygonEnd:_};function S(T,O){i(T,O)&&c.point(T,O)}function A(){for(var T=0,O=0,P=h.length;O<P;++O)for(var W=h[O],B=1,se=W.length,me=W[0],we,ye,Se=me[0],Ue=me[1];B<se;++B)we=Se,ye=Ue,me=W[B],Se=me[0],Ue=me[1],ye<=r?Ue>r&&(Se-we)*(r-ye)>(Ue-ye)*(e-we)&&++T:Ue<=r&&(Se-we)*(r-ye)<(Ue-ye)*(e-we)&&--T;return T}function C(){c=f,d=[],h=[],E=!0}function _(){var T=A(),O=E&&T,P=(d=LF(d)).length;(O||P)&&(u.polygonStart(),O&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),P&&YF(d,s,T,a,u),u.polygonEnd()),c=u,d=h=p=null}function D(){k.point=N,h&&h.push(p=[]),x=!0,w=!1,v=b=NaN}function M(){d&&(N(m,g),y&&w&&f.rejoin(),d.push(f.result())),k.point=S,w&&c.lineEnd()}function N(T,O){var P=i(T,O);if(h&&p.push([T,O]),x)m=T,g=O,y=P,x=!1,P&&(c.lineStart(),c.point(T,O));else if(P&&w)c.point(T,O);else{var W=[v=Math.max(Hm,Math.min(jf,v)),b=Math.max(Hm,Math.min(jf,b))],B=[T=Math.max(Hm,Math.min(jf,T)),O=Math.max(Hm,Math.min(jf,O))];GZ(W,B,e,t,n,r)?(w||(c.lineStart(),c.point(W[0],W[1])),c.point(B[0],B[1]),P||c.lineEnd(),E=!1):P&&(c.lineStart(),c.point(T,O),E=!1)}v=T,b=O,w=P}return k}}var KF=e=>e,cu=Infinity,Wm=cu,Uf=-cu,Gm=Uf,QF={point:VZ,lineStart:Pf,lineEnd:Pf,polygonStart:Pf,polygonEnd:Pf,result:function(){var e=[[cu,Wm],[Uf,Gm]];return Uf=Gm=-(Wm=cu=Infinity),e}};function VZ(e,t){e<cu&&(cu=e),e>Uf&&(Uf=e),t<Wm&&(Wm=t),t>Gm&&(Gm=t)}function Jx(e){return function(t){var n=new Kx();for(var r in e)n[r]=e[r];return n.stream=t,n}}function Kx(){}Kx.prototype={constructor:Kx,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Qx(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),IZ(n,e.stream(QF)),t(QF.result()),r!=null&&e.clipExtent(r),e}function ZF(e,t,n){return Qx(e,function(r){var i=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),a/(r[1][1]-r[0][1])),s=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,l=+t[0][1]+(a-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function XZ(e,t,n){return ZF(e,[[0,0],t],n)}function JZ(e,t,n){return Qx(e,function(r){var i=+t,a=i/(r[1][0]-r[0][0]),o=(i-a*(r[1][0]+r[0][0]))/2,s=-a*r[0][1];e.scale(150*a).translate([o,s])},n)}function KZ(e,t,n){return Qx(e,function(r){var i=+t,a=i/(r[1][1]-r[0][1]),o=-a*r[0][0],s=(i-a*(r[1][1]+r[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var eI=16,QZ=st(30*Xn);function tI(e,t){return+t?eee(e,t):ZZ(e)}function ZZ(e){return Jx({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function eee(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var w=o+d,x=s+h,E=l+p,k=Lm(w*w+x*x+E*E),S=zf(E/=k),A=ot(ot(E)-1)<He||ot(a-f)<He?(a+f)/2:Lf(x,w),C=e(A,S),_=C[0],D=C[1],M=_-r,N=D-i,T=v*M-y*N;(T*T/b>t||ot((y*M+v*N)/b-.5)>.3||o*d+s*h+l*p<QZ)&&(n(r,i,a,o,s,l,_,D,A,w/=k,x/=k,E,m,g),g.point(_,D),n(_,D,A,w,x,E,u,c,f,d,h,p,m,g))}}return function(r){var i,a,o,s,l,u,c,f,d,h,p,m,g={point:y,lineStart:v,lineEnd:w,polygonStart:function(){r.polygonStart(),g.lineStart=x},polygonEnd:function(){r.polygonEnd(),g.lineStart=v}};function y(S,A){S=e(S,A),r.point(S[0],S[1])}function v(){f=NaN,g.point=b,r.lineStart()}function b(S,A){var C=uu([S,A]),_=e(S,A);n(f,d,c,h,p,m,f=_[0],d=_[1],c=S,h=C[0],p=C[1],m=C[2],eI,r),r.point(f,d)}function w(){g.point=y,r.lineEnd()}function x(){v(),g.point=E,g.lineEnd=k}function E(S,A){b(i=S,A),a=f,o=d,s=h,l=p,u=m,g.point=b}function k(){n(f,d,c,h,p,m,a,o,i,s,l,u,eI,r),g.lineEnd=w,w()}return g}}var tee=Jx({point:function(e,t){this.stream.point(e*Xn,t*Xn)}});function nee(e){return Jx({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function ree(e,t,n,r,i){function a(o,s){return o*=r,s*=i,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*r,(n-s)/e*i]},a}function nI(e,t,n,r,i,a){if(!a)return ree(e,t,n,r,i);var o=st(a),s=lt(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(m,g){return m*=r,g*=i,[l*m-u*g+t,n-u*m-l*g]}return p.invert=function(m,g){return[r*(c*m-f*g+d),i*(h-f*m-c*g)]},p}function iee(e){return aee(function(){return e})()}function aee(e){var t,n=150,r=480,i=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,m=JF,g=null,y,v,b,w=KF,x=.5,E,k,S,A,C;function _(T){return S(T[0]*Xn,T[1]*Xn)}function D(T){return T=S.invert(T[0],T[1]),T&&[T[0]*aa,T[1]*aa]}_.stream=function(T){return A&&C===T?A:A=tee(nee(c)(m(E(w(C=T)))))},_.preclip=function(T){return arguments.length?(m=T,p=void 0,N()):m},_.postclip=function(T){return arguments.length?(w=T,g=y=v=b=null,N()):w},_.clipAngle=function(T){return arguments.length?(m=+T?WZ(p=T*Xn):(p=null,JF),N()):p*aa},_.clipExtent=function(T){return arguments.length?(w=T==null?(g=y=v=b=null,KF):YZ(g=+T[0][0],y=+T[0][1],v=+T[1][0],b=+T[1][1]),N()):g==null?null:[[g,y],[v,b]]},_.scale=function(T){return arguments.length?(n=+T,M()):n},_.translate=function(T){return arguments.length?(r=+T[0],i=+T[1],M()):[r,i]},_.center=function(T){return arguments.length?(a=T[0]%360*Xn,o=T[1]%360*Xn,M()):[a*aa,o*aa]},_.rotate=function(T){return arguments.length?(s=T[0]%360*Xn,l=T[1]%360*Xn,u=T.length>2?T[2]%360*Xn:0,M()):[s*aa,l*aa,u*aa]},_.angle=function(T){return arguments.length?(f=T%360*Xn,M()):f*aa},_.reflectX=function(T){return arguments.length?(d=T?-1:1,M()):d<0},_.reflectY=function(T){return arguments.length?(h=T?-1:1,M()):h<0},_.precision=function(T){return arguments.length?(E=tI(k,x=T*T),N()):Lm(x)},_.fitExtent=function(T,O){return ZF(_,T,O)},_.fitSize=function(T,O){return XZ(_,T,O)},_.fitWidth=function(T,O){return JZ(_,T,O)},_.fitHeight=function(T,O){return KZ(_,T,O)};function M(){var T=nI(n,0,0,d,h,f).apply(null,t(a,o)),O=nI(n,r-T[0],i-T[1],d,h,f);return c=LZ(s,l,u),k=Yx(t,O),S=Yx(c,k),E=tI(k,x),N()}function N(){return A=C=null,_}return function(){return t=e.apply(this,arguments),_.invert=t.invert&&D,M()}}var oee=Math.abs,Zx=Math.cos,Ym=Math.sin,see=1e-6,rI=Math.PI,e2=rI/2,iI=lee(2);function aI(e){return e>1?e2:e<-1?-e2:Math.asin(e)}function lee(e){return e>0?Math.sqrt(e):0}function uee(e,t){var n=e*Ym(t),r=30,i;do t-=i=(t+Ym(t)-n)/(1+Zx(t));while(oee(i)>see&&--r>0);return t/2}function cee(e,t,n){function r(i,a){return[e*i*Zx(a=uee(n,a)),t*Ym(a)]}return r.invert=function(i,a){return a=aI(a/t),[i/(e*Zx(a)),aI((2*a+Ym(2*a))/n)]},r}var fee=cee(iI/e2,iI,rI);function dee(){return iee(fee).scale(169.529)}const hee=xF(),t2=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function pee(e,t){return function n(){const r=t();return r.type=e,r.path=xF().projection(r),r.copy=r.copy||function(){const i=n();return t2.forEach(a=>{r[a]&&i[a](r[a]())}),i.path.pointRadius(r.path.pointRadius()),i},r}}function n2(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(Vm[e]=pee(e,t),this):Vm[e]||null}function oI(e){return e&&e.path||hee}const Vm={albers:AF,albersusa:hZ,azimuthalequalarea:pZ,azimuthalequidistant:mZ,conicconformal:vZ,conicequalarea:Dm,conicequidistant:xZ,equalEarth:EZ,equirectangular:bZ,gnomonic:SZ,identity:TZ,mercator:gZ,mollweide:dee,naturalEarth1:AZ,orthographic:_Z,stereographic:CZ,transversemercator:$Z};for(const e in Vm)n2(e,Vm[e]);var lo=1e-6,sI=Math.abs,Xm=Math.ceil;function lI(e,t,n){var r=ks(e,t-lo,n).concat(t);return function(i){return r.map(function(a){return[i,a]})}}function uI(e,t,n){var r=ks(e,t-lo,n).concat(t);return function(i){return r.map(function(a){return[a,i]})}}function mee(){var e,t,n,r,i,a,o,s,l=10,u=l,c=90,f=360,d,h,p,m,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return ks(Xm(r/c)*c,n,c).map(p).concat(ks(Xm(s/f)*f,o,f).map(m)).concat(ks(Xm(t/l)*l,e,l).filter(function(b){return sI(b%c)>lo}).map(d)).concat(ks(Xm(a/u)*u,i,u).filter(function(b){return sI(b%f)>lo}).map(h))}return y.lines=function(){return v().map(function(b){return{type:"LineString",coordinates:b}})},y.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(m(o).slice(1),p(n).reverse().slice(1),m(s).reverse().slice(1))]}},y.extent=function(b){return arguments.length?y.extentMajor(b).extentMinor(b):y.extentMinor()},y.extentMajor=function(b){return arguments.length?(r=+b[0][0],n=+b[1][0],s=+b[0][1],o=+b[1][1],r>n&&(b=r,r=n,n=b),s>o&&(b=s,s=o,o=b),y.precision(g)):[[r,s],[n,o]]},y.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],a=+b[0][1],i=+b[1][1],t>e&&(b=t,t=e,e=b),a>i&&(b=a,a=i,i=b),y.precision(g)):[[t,a],[e,i]]},y.step=function(b){return arguments.length?y.stepMajor(b).stepMinor(b):y.stepMinor()},y.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],y):[c,f]},y.stepMinor=function(b){return arguments.length?(l=+b[0],u=+b[1],y):[l,u]},y.precision=function(b){return arguments.length?(g=+b,d=lI(a,i,90),h=uI(t,e,g),p=lI(s,o,90),m=uI(r,n,g),y):g},y.extentMajor([[-180,-90+lo],[180,90-lo]]).extentMinor([[-180,-80-lo],[180,80+lo]])}function r2(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function cI(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Bf(){}var qf=.7,Jm=1/qf,fu="\\s*([+-]?\\d+)\\s*",Hf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",vi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",gee=/^#([0-9a-f]{3,8})$/,yee=new RegExp("^rgb\\("+[fu,fu,fu]+"\\)$"),vee=new RegExp("^rgb\\("+[vi,vi,vi]+"\\)$"),bee=new RegExp("^rgba\\("+[fu,fu,fu,Hf]+"\\)$"),wee=new RegExp("^rgba\\("+[vi,vi,vi,Hf]+"\\)$"),xee=new RegExp("^hsl\\("+[Hf,vi,vi]+"\\)$"),kee=new RegExp("^hsla\\("+[Hf,vi,vi,Hf]+"\\)$"),fI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};r2(Bf,i2,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:dI,formatHex:dI,formatHsl:Eee,formatRgb:hI,toString:hI});function dI(){return this.rgb().formatHex()}function Eee(){return vI(this).formatHsl()}function hI(){return this.rgb().formatRgb()}function i2(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=gee.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?pI(t):n===3?new Jn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Km(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Km(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=yee.exec(e))?new Jn(t[1],t[2],t[3],1):(t=vee.exec(e))?new Jn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=bee.exec(e))?Km(t[1],t[2],t[3],t[4]):(t=wee.exec(e))?Km(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=xee.exec(e))?yI(t[1],t[2]/100,t[3]/100,1):(t=kee.exec(e))?yI(t[1],t[2]/100,t[3]/100,t[4]):fI.hasOwnProperty(e)?pI(fI[e]):e==="transparent"?new Jn(NaN,NaN,NaN,0):null}function pI(e){return new Jn(e>>16&255,e>>8&255,e&255,1)}function Km(e,t,n,r){return r<=0&&(e=t=n=NaN),new Jn(e,t,n,r)}function See(e){return e instanceof Bf||(e=i2(e)),e?(e=e.rgb(),new Jn(e.r,e.g,e.b,e.opacity)):new Jn()}function a2(e,t,n,r){return arguments.length===1?See(e):new Jn(e,t,n,r??1)}function Jn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}r2(Jn,a2,cI(Bf,{brighter:function(e){return e=e==null?Jm:Math.pow(Jm,e),new Jn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?qf:Math.pow(qf,e),new Jn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mI,formatHex:mI,formatRgb:gI,toString:gI}));function mI(){return"#"+o2(this.r)+o2(this.g)+o2(this.b)}function gI(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function o2(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function yI(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new bi(e,t,n,r)}function vI(e){if(e instanceof bi)return new bi(e.h,e.s,e.l,e.opacity);if(e instanceof Bf||(e=i2(e)),!e)return new bi();if(e instanceof bi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new bi(o,s,l,e.opacity)}function Tee(e,t,n,r){return arguments.length===1?vI(e):new bi(e,t,n,r??1)}function bi(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}r2(bi,Tee,cI(Bf,{brighter:function(e){return e=e==null?Jm:Math.pow(Jm,e),new bi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?qf:Math.pow(qf,e),new bi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Jn(s2(e>=240?e-240:e+120,i,r),s2(e,i,r),s2(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function s2(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}function Aee(){}const oa=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function bI(){var e=1,t=1,n=s;function r(l,u){return u.map(c=>i(l,c))}function i(l,u){var c=[],f=[];return a(l,u,d=>{n(d,l,u),_ee(d)>0?c.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,p=c.length,m;h<p;++h)if(Cee((m=c[h])[0],d)!==-1){m.push(d);return}}),{type:"MultiPolygon",value:u,coordinates:c}}function a(l,u,c){var f=new Array(),d=new Array(),h,p,m,g,y,v;for(h=p=-1,g=l[0]>=u,oa[g<<1].forEach(b);++h<e-1;)m=g,g=l[h+1]>=u,oa[m|g<<1].forEach(b);for(oa[g<<0].forEach(b);++p<t-1;){for(h=-1,g=l[p*e+e]>=u,y=l[p*e]>=u,oa[g<<1|y<<2].forEach(b);++h<e-1;)m=g,g=l[p*e+e+h+1]>=u,v=y,y=l[p*e+h+1]>=u,oa[m|g<<1|y<<2|v<<3].forEach(b);oa[g|y<<3].forEach(b)}for(h=-1,y=l[p*e]>=u,oa[y<<2].forEach(b);++h<e-1;)v=y,y=l[p*e+h+1]>=u,oa[y<<2|v<<3].forEach(b);oa[y<<3].forEach(b);function b(w){var x=[w[0][0]+h,w[0][1]+p],E=[w[1][0]+h,w[1][1]+p],k=o(x),S=o(E),A,C;(A=d[k])?(C=f[S])?(delete d[A.end],delete f[C.start],A===C?(A.ring.push(E),c(A.ring)):f[A.start]=d[C.end]={start:A.start,end:C.end,ring:A.ring.concat(C.ring)}):(delete d[A.end],A.ring.push(E),d[A.end=S]=A):(A=f[S])?(C=d[k])?(delete f[A.start],delete d[C.end],A===C?(A.ring.push(E),c(A.ring)):f[C.start]=d[A.end]={start:C.start,end:A.end,ring:C.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(x),f[A.start=k]=A):f[k]=d[S]={start:k,end:S,ring:[x,E]}}}function o(l){return l[0]*2+l[1]*(e+1)*4}function s(l,u,c){l.forEach(f=>{var d=f[0],h=f[1],p=d|0,m=h|0,g,y=u[m*e+p];d>0&&d<e&&p===d&&(g=u[m*e+p-1],f[0]=d+(c-g)/(y-g)-.5),h>0&&h<t&&m===h&&(g=u[(m-1)*e+p],f[1]=h+(c-g)/(y-g)-.5)})}return r.contour=i,r.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||L("invalid size"),e=u,t=c,r},r.smooth=function(l){return arguments.length?(n=l?s:Aee,r):n===s},r}function _ee(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function Cee(e,t){for(var n=-1,r=t.length,i;++n<r;)if(i=$ee(e,t[n]))return i;return 0}function $ee(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(Oee(l,f,t))return 0;c>r!==h>r&&n<(d-u)*(r-c)/(h-c)+u&&(i=-i)}return i}function Oee(e,t,n){var r;return Mee(e,t,n)&&Dee(e[r=+(e[0]===t[0])],n[r],t[r])}function Mee(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function Dee(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function wI(e,t,n){return function(r){var i=ei(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?FQ(a,o,e):s/(e+1);return ks(a+l,o,l)}}function l2(e){F.call(this,null,e)}l2.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},q(l2,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Ut,a=bI().smooth(e.smooth!==!1),o=e.thresholds||Nee(r,i,e),s=e.as===null?null:e.as||"contour",l=[];return r.forEach(u=>{const c=i(u),f=a.size([c.width,c.height])(c.values,z(o)?o:o(c.values));Ree(f,c,u,e),f.forEach(d=>{l.push(Yh(u,Oe(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}});function Nee(e,t,n){const r=wI(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?r:r(e.map(i=>gm(t(i).values)))}function Ree(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;if(le(i)&&(i=i(n,r)),le(a)&&(a=a(n,r)),(i===1||i==null)&&!a)return;const o=(Le(i)?i:i[0])||1,s=(Le(i)?i:i[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(xI(t,o,s,l,u))}function xI(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(f){f.forEach(u)}function u(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+r,f[1]=(f[1]-o)*n+i}return function(f){return f.coordinates.forEach(l),f}}function kI(e,t,n){const r=e>=0?e:Wv(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function u2(e){return le(e)?e:qt(+e)}function EI(){var e=l=>l[0],t=l=>l[1],n=vl,r=[-1,-1],i=960,a=500,o=2;function s(l,u){const c=kI(r[0],l,e)>>o,f=kI(r[1],l,t)>>o,d=c?c+2:0,h=f?f+2:0,p=2*d+(i>>o),m=2*h+(a>>o),g=new Float32Array(p*m),y=new Float32Array(p*m);let v=g;l.forEach(w=>{const x=d+(+e(w)>>o),E=h+(+t(w)>>o);x>=0&&x<p&&E>=0&&E<m&&(g[x+E*p]+=+n(w))}),c>0&&f>0?(du(p,m,g,y,c),hu(p,m,y,g,f),du(p,m,g,y,c),hu(p,m,y,g,f),du(p,m,g,y,c),hu(p,m,y,g,f)):c>0?(du(p,m,g,y,c),du(p,m,y,g,c),du(p,m,g,y,c),v=y):f>0&&(hu(p,m,g,y,f),hu(p,m,y,g,f),hu(p,m,g,y,f),v=y);const b=u?Math.pow(2,-2*o):1/IQ(v);for(let w=0,x=p*m;w<x;++w)v[w]*=b;return{values:v,scale:1<<o,width:p,height:m,x1:d,y1:h,x2:d+(i>>o),y2:h+(a>>o)}}return s.x=function(l){return arguments.length?(e=u2(l),s):e},s.y=function(l){return arguments.length?(t=u2(l),s):t},s.weight=function(l){return arguments.length?(n=u2(l),s):n},s.size=function(l){if(!arguments.length)return[i,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||L("invalid size"),i=u,a=c,s},s.cellSize=function(l){return arguments.length?((l=+l)>=1||L("invalid cell size"),o=Math.floor(Math.log(l)/Math.LN2),s):1<<o},s.bandwidth=function(l){return arguments.length?(l=J(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&L("invalid bandwidth"),r=l,s):r},s}function du(e,t,n,r,i){const a=(i<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+i;++s)s<e&&(l+=n[s+o*e]),s>=i&&(s>=a&&(l-=n[s-a+o*e]),r[s-i+o*e]=l/Math.min(s+1,e-1+a-s,a))}function hu(e,t,n,r,i){const a=(i<<1)+1;for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function c2(e){F.call(this,null,e)}c2.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Fee=["x","y","weight","size","cellSize","bandwidth"];function SI(e,t){return Fee.forEach(n=>t[n]!=null?e[n](t[n]):0),e}q(c2,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=Iee(r,e.groupby),a=(e.groupby||[]).map(tt),o=SI(EI(),e),s=e.as||"grid",l=[];function u(c,f){for(let d=0;d<a.length;++d)c[a[d]]=f[d];return c}return l=i.map(c=>Oe(u({[s]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}});function Iee(e,t){var n=[],r=c=>c(s),i,a,o,s,l,u;if(t==null)n.push(e);else for(i={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(r),u=i[l],u||(i[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function f2(e){F.call(this,null,e)}f2.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},q(f2,F,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=bI().smooth(e.smooth!==!1),i=e.values,a=e.thresholds||wI(e.count||10,e.nice,!!i),o=e.size,s,l;return i||(i=t.materialize(t.SOURCE).source,s=SI(EI(),e)(i,!0),l=xI(s,s.scale||1,s.scale||1,0,0),o=[s.width,s.height],i=s.values),a=z(a)?a:a(i),i=r.size(o)(i,a),l&&i.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(i||[]).map(Oe),n}});const d2="Feature",h2="FeatureCollection",Lee="MultiPoint";function p2(e){F.call(this,null,e)}p2.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},q(p2,F,{transform(e,t){var n=this._features,r=this._points,i=e.fields,a=i&&i[0],o=i&&i[1],s=e.geojson||!i&&Ut,l=t.ADD,u;u=e.modified()||t.changed(t.REM)||t.modified(jt(s))||a&&t.modified(jt(a))||o&&t.modified(jt(o)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=r=[]),s&&t.visit(l,c=>n.push(s(c))),a&&o&&(t.visit(l,c=>{var f=a(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&r.push([f,d])}),n=n.concat({type:d2,geometry:{type:Lee,coordinates:r}})),this.value={type:h2,features:n}}});function m2(e){F.call(this,null,e)}m2.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},q(m2,F,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Ut,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=oI(e.projection),n.materialize().reflow()):o=i===Ut||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=zee(r,e.pointRadius);return n.visit(o,l=>l[a]=r(i(l))),r.pointRadius(s),n.modifies(a)}});function zee(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function g2(e){F.call(this,null,e)}g2.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},q(g2,F,{transform(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],l;function u(c){const f=n([r(c),i(c)]);f?(c[o]=f[0],c[s]=f[1]):(c[o]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(r.fields)||t.modified(i.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)}});function y2(e){F.call(this,null,e)}y2.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},q(y2,F,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return(!r||e.modified())&&(this.value=r=Pee(oI(e.projection),e.field||Sn("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,o=>o[i]=r),n.modifies(i)}});function Pee(e,t,n){const r=n==null?i=>e(t(i)):i=>{var a=e.pointRadius(),o=e.pointRadius(n)(t(i));return e.pointRadius(a),o};return r.context=i=>(e.context(i),r),r}function v2(e){F.call(this,[],e),this.generator=mee()}v2.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},q(v2,F,{transform(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified())for(const a in e)le(r[a])&&r[a](e[a]);return i=r(),n.length?t.mod.push(zC(n[0],i)):t.add.push(Oe(i)),n[0]=i,t}});function b2(e){F.call(this,null,e)}b2.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},q(b2,F,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||Ut,a=Uee(e.opacity,e),o=jee(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?gm(n.map(u=>gm(i(u).values))):0};return n.forEach(u=>{const c=i(u),f=ue({},u,l);r||(f.$max=gm(c.values||[])),u[s]=Bee(c,f,o.dep?o:qt(o(f)),a.dep?a:qt(a(f)))}),t.reflow(!0).modifies(s)}});function jee(e,t){let n;return le(e)?(n=r=>a2(e(r,t)),n.dep=TI(e)):n=qt(a2(e||"#888")),n}function Uee(e,t){let n;return le(e)?(n=r=>e(r,t),n.dep=TI(e)):e?n=qt(e):(n=r=>r.$value/r.$max||0,n.dep=!0),n}function TI(e){if(!le(e))return!1;const t=kt(jt(e));return t.$x||t.$y||t.$value||t.$max}function Bee(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||i,u=e.y2||a,c=e.values,f=c?g=>c[g]:Na,d=Fl(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),m=p.data;for(let g=s,y=0;g<u;++g){t.$y=g-s;for(let v=o,b=g*i;v<l;++v,y+=4){t.$x=v-o,t.$value=f(v+b);const w=n(t);m[y+0]=w.r,m[y+1]=w.g,m[y+2]=w.b,m[y+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}function AI(e){F.call(this,null,e),this.modified(!0)}q(AI,F,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=Hee(e.type),t2.forEach(r=>{e[r]!=null&&_I(n,r,e[r])})):t2.forEach(r=>{e.modified(r)&&_I(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&qee(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function qee(e,t){const n=Wee(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function Hee(e){const t=n2((e||"mercator").toLowerCase());return t||L("Unrecognized projection type: "+e),t()}function _I(e,t,n){le(e[t])&&e[t](n)}function Wee(e){return e=J(e),e.length===1?e[0]:{type:h2,features:e.reduce((t,n)=>t.concat(Gee(n)),[])}}function Gee(e){return e.type===h2?e.features:J(e).filter(t=>t!=null).map(t=>t.type===d2?t:{type:d2,geometry:t})}var Yee=Object.freeze({__proto__:null,contour:f2,geojson:p2,geopath:m2,geopoint:g2,geoshape:y2,graticule:v2,heatmap:b2,isocontour:l2,kde2d:c2,projection:AI});function Vee(e,t){var n,r=1;e==null&&(e=0),t==null&&(t=0);function i(){var a,o=n.length,s,l=0,u=0;for(a=0;a<o;++a)s=n[a],l+=s.x,u+=s.y;for(l=(l/o-e)*r,u=(u/o-t)*r,a=0;a<o;++a)s=n[a],s.x-=l,s.y-=u}return i.initialize=function(a){n=a},i.x=function(a){return arguments.length?(e=+a,i):e},i.y=function(a){return arguments.length?(t=+a,i):t},i.strength=function(a){return arguments.length?(r=+a,i):r},i}function Xee(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return CI(this.cover(t,n),t,n,e)}function CI(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a=e._root,o={data:r},s=e._x0,l=e._y0,u=e._x1,c=e._y1,f,d,h,p,m,g,y,v;if(!a)return e._root=o,e;for(;a.length;)if((m=t>=(f=(s+u)/2))?s=f:u=f,(g=n>=(d=(l+c)/2))?l=d:c=d,i=a,!(a=a[y=g<<1|m]))return i[y]=o,e;if(h=+e._x.call(null,a.data),p=+e._y.call(null,a.data),t===h&&n===p)return o.next=a,i?i[y]=o:e._root=o,e;do i=i?i[y]=new Array(4):e._root=new Array(4),(m=t>=(f=(s+u)/2))?s=f:u=f,(g=n>=(d=(l+c)/2))?l=d:c=d;while((y=g<<1|m)===(v=(p>=d)<<1|h>=f));return i[v]=a,i[y]=o,e}function Jee(e){var t,n,r=e.length,i,a,o=new Array(r),s=new Array(r),l=Infinity,u=Infinity,c=-Infinity,f=-Infinity;for(n=0;n<r;++n){if(isNaN(i=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=i,s[n]=a,i<l&&(l=i),i>c&&(c=i),a<u&&(u=a),a>f&&(f=a)}if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<r;++n)CI(this,o[n],s[n],e[n]);return this}function Kee(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o=i-n||1,s=this._root,l,u;n>e||e>=i||r>t||t>=a;){u=(t<r)<<1|e<n,l=new Array(4),l[u]=s,s=l,o*=2;switch(u){case 0:i=n+o,a=r+o;break;case 1:n=i-o,a=r+o;break;case 2:i=n+o,r=a-o;break;case 3:n=i-o,r=a-o;break}}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this}function Qee(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Zee(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function on(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function ete(e,t,n){var r,i=this._x0,a=this._y0,o,s,l,u,c=this._x1,f=this._y1,d=[],h=this._root,p,m;for(h&&d.push(new on(h,i,a,c,f)),n==null?n=Infinity:(i=e-n,a=t-n,c=e+n,f=t+n,n*=n);p=d.pop();){if(!(h=p.node)||(o=p.x0)>c||(s=p.y0)>f||(l=p.x1)<i||(u=p.y1)<a)continue;if(h.length){var g=(o+l)/2,y=(s+u)/2;d.push(new on(h[3],g,y,l,u),new on(h[2],o,y,g,u),new on(h[1],g,s,l,y),new on(h[0],o,s,g,y)),(m=(t>=y)<<1|e>=g)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-m],d[d.length-1-m]=p)}else{var v=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),w=v*v+b*b;if(w<n){var x=Math.sqrt(n=w);i=e-x,a=t-x,c=e+x,f=t+x,r=h.data}}}return r}function tte(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,r,i,a,o=this._x0,s=this._y0,l=this._x1,u=this._y1,c,f,d,h,p,m,g,y;if(!n)return this;if(n.length)for(;;){if((p=c>=(d=(o+l)/2))?o=d:l=d,(m=f>=(h=(s+u)/2))?s=h:u=h,!(t=n,n=n[g=m<<1|p]))return this;if(!n.length)break;(t[g+1&3]||t[g+2&3]||t[g+3&3])&&(r=t,y=g)}for(;n.data!==e;)if(!(i=n,n=n.next))return this;return(a=n.next)&&delete n.next,i?(a?i.next=a:delete i.next,this):t?(a?t[g]=a:delete t[g],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[y]=n:this._root=n),this):(this._root=a,this)}function nte(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function rte(){return this._root}function ite(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function ate(e){var t=[],n,r=this._root,i,a,o,s,l;for(r&&t.push(new on(r,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(r=n.node,a=n.x0,o=n.y0,s=n.x1,l=n.y1)&&r.length){var u=(a+s)/2,c=(o+l)/2;(i=r[3])&&t.push(new on(i,u,c,s,l)),(i=r[2])&&t.push(new on(i,a,c,u,l)),(i=r[1])&&t.push(new on(i,u,o,s,c)),(i=r[0])&&t.push(new on(i,a,o,u,c))}return this}function ote(e){var t=[],n=[],r;for(this._root&&t.push(new on(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var a,o=r.x0,s=r.y0,l=r.x1,u=r.y1,c=(o+l)/2,f=(s+u)/2;(a=i[0])&&t.push(new on(a,o,s,c,f)),(a=i[1])&&t.push(new on(a,c,s,l,f)),(a=i[2])&&t.push(new on(a,o,f,c,u)),(a=i[3])&&t.push(new on(a,c,f,l,u))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.x1,r.y1);return this}function ste(e){return e[0]}function lte(e){return arguments.length?(this._x=e,this):this._x}function ute(e){return e[1]}function cte(e){return arguments.length?(this._y=e,this):this._y}function w2(e,t,n){var r=new x2(t??ste,n??ute,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function x2(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function $I(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var sn=w2.prototype=x2.prototype;sn.copy=function(){var e=new x2(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=$I(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=$I(r));return e},sn.add=Xee,sn.addAll=Jee,sn.cover=Kee,sn.data=Qee,sn.extent=Zee,sn.find=ete,sn.remove=tte,sn.removeAll=nte,sn.root=rte,sn.size=ite,sn.visit=ate,sn.visitAfter=ote,sn.x=lte,sn.y=cte;function ln(e){return function(){return e}}function uo(e){return(e()-.5)*1e-6}function fte(e){return e.x+e.vx}function dte(e){return e.y+e.vy}function hte(e){var t,n,r,i=1,a=1;typeof e!="function"&&(e=ln(e==null?1:+e));function o(){for(var u,c=t.length,f,d,h,p,m,g,y=0;y<a;++y)for(f=w2(t,fte,dte).visitAfter(s),u=0;u<c;++u)d=t[u],m=n[d.index],g=m*m,h=d.x+d.vx,p=d.y+d.vy,f.visit(v);function v(b,w,x,E,k){var S=b.data,A=b.r,C=m+A;if(S){if(S.index>d.index){var _=h-S.x-S.vx,D=p-S.y-S.vy,M=_*_+D*D;M<C*C&&(_===0&&(_=uo(r),M+=_*_),D===0&&(D=uo(r),M+=D*D),M=(C-(M=Math.sqrt(M)))/M*i,d.vx+=(_*=M)*(C=(A*=A)/(g+A)),d.vy+=(D*=M)*C,S.vx-=_*(C=1-C),S.vy-=D*C)}return}return w>h+C||E<h-C||x>p+C||k<p-C}}function s(u){if(u.data)return u.r=n[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(!t)return;var u,c=t.length,f;for(n=new Array(c),u=0;u<c;++u)f=t[u],n[f.index]=+e(f,u,t)}return o.initialize=function(u,c){t=u,r=c,l()},o.iterations=function(u){return arguments.length?(a=+u,o):a},o.strength=function(u){return arguments.length?(i=+u,o):i},o.radius=function(u){return arguments.length?(e=typeof u=="function"?u:ln(+u),l(),o):e},o}function pte(e){return e.index}function OI(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function mte(e){var t=pte,n=f,r,i=ln(30),a,o,s,l,u,c=1;e==null&&(e=[]);function f(g){return 1/Math.min(s[g.source.index],s[g.target.index])}function d(g){for(var y=0,v=e.length;y<c;++y)for(var b=0,w,x,E,k,S,A,C;b<v;++b)w=e[b],x=w.source,E=w.target,k=E.x+E.vx-x.x-x.vx||uo(u),S=E.y+E.vy-x.y-x.vy||uo(u),A=Math.sqrt(k*k+S*S),A=(A-a[b])/A*g*r[b],k*=A,S*=A,E.vx-=k*(C=l[b]),E.vy-=S*C,x.vx+=k*(C=1-C),x.vy+=S*C}function h(){if(!o)return;var g,y=o.length,v=e.length,b=new Map(o.map((x,E)=>[t(x,E,o),x])),w;for(g=0,s=new Array(y);g<v;++g)w=e[g],w.index=g,typeof w.source!="object"&&(w.source=OI(b,w.source)),typeof w.target!="object"&&(w.target=OI(b,w.target)),s[w.source.index]=(s[w.source.index]||0)+1,s[w.target.index]=(s[w.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)w=e[g],l[g]=s[w.source.index]/(s[w.source.index]+s[w.target.index]);r=new Array(v),p(),a=new Array(v),m()}function p(){if(!o)return;for(var g=0,y=e.length;g<y;++g)r[g]=+n(e[g],g,e)}function m(){if(!o)return;for(var g=0,y=e.length;g<y;++g)a[g]=+i(e[g],g,e)}return d.initialize=function(g,y){o=g,u=y,h()},d.links=function(g){return arguments.length?(e=g,h(),d):e},d.id=function(g){return arguments.length?(t=g,d):t},d.iterations=function(g){return arguments.length?(c=+g,d):c},d.strength=function(g){return arguments.length?(n=typeof g=="function"?g:ln(+g),p(),d):n},d.distance=function(g){return arguments.length?(i=typeof g=="function"?g:ln(+g),m(),d):i},d}var gte={value:()=>{}};function MI(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Qm(n)}function Qm(e){this._=e}function yte(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Qm.prototype=MI.prototype={constructor:Qm,on:function(e,t){var n=this._,r=yte(e+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(e=r[a]).type)&&(i=vte(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(i=(e=r[a]).type)n[i]=DI(n[i],e.name,t);else if(t==null)for(i in n)n[i]=DI(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Qm(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],r=0,i=a.length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};function vte(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function DI(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=gte,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var pu=0,Wf=0,Gf=0,NI=1e3,Zm,Yf,eg=0,Ts=0,tg=0,Vf=typeof performance=="object"&&performance.now?performance:Date,RI=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function FI(){return Ts||(RI(bte),Ts=Vf.now()+tg)}function bte(){Ts=0}function k2(){this._call=this._time=this._next=null}k2.prototype=II.prototype={constructor:k2,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?FI():+n)+(t==null?0:+t),!this._next&&Yf!==this&&(Yf?Yf._next=this:Zm=this,Yf=this),this._call=e,this._time=n,E2()},stop:function(){this._call&&(this._call=null,this._time=Infinity,E2())}};function II(e,t,n){var r=new k2();return r.restart(e,t,n),r}function wte(){FI(),++pu;for(var e=Zm,t;e;)(t=Ts-e._time)>=0&&e._call.call(null,t),e=e._next;--pu}function LI(){Ts=(eg=Vf.now())+tg,pu=Wf=0;try{wte()}finally{pu=0,kte(),Ts=0}}function xte(){var e=Vf.now(),t=e-eg;t>NI&&(tg-=t,eg=e)}function kte(){for(var e,t=Zm,n,r=Infinity;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Zm=n);Yf=e,E2(r)}function E2(e){if(pu)return;Wf&&(Wf=clearTimeout(Wf));var t=e-Ts;t>24?(e<Infinity&&(Wf=setTimeout(LI,e-Vf.now()-tg)),Gf&&(Gf=clearInterval(Gf))):(Gf||(eg=Vf.now(),Gf=setInterval(xte,NI)),pu=1,RI(LI))}const Ete=1664525,Ste=1013904223,zI=4294967296;function Tte(){let e=1;return()=>(e=(Ete*e+Ste)%zI)/zI}function Ate(e){return e.x}function _te(e){return e.y}var Cte=10,$te=Math.PI*(3-Math.sqrt(5));function Ote(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map(),l=II(f),u=MI("tick","end"),c=Tte();e==null&&(e=[]);function f(){d(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function d(m){var g,y=e.length,v;m===void 0&&(m=1);for(var b=0;b<m;++b)for(n+=(a-n)*i,s.forEach(function(w){w(n)}),g=0;g<y;++g)v=e[g],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function h(){for(var m=0,g=e.length,y;m<g;++m){if(y=e[m],y.index=m,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var v=Cte*Math.sqrt(.5+m),b=m*$te;y.x=v*Math.cos(b),y.y=v*Math.sin(b)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(m){return m.initialize&&m.initialize(e,c),m}return h(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(m){return arguments.length?(e=m,h(),s.forEach(p),t):e},alpha:function(m){return arguments.length?(n=+m,t):n},alphaMin:function(m){return arguments.length?(r=+m,t):r},alphaDecay:function(m){return arguments.length?(i=+m,t):+i},alphaTarget:function(m){return arguments.length?(a=+m,t):a},velocityDecay:function(m){return arguments.length?(o=1-m,t):1-o},randomSource:function(m){return arguments.length?(c=m,s.forEach(p),t):c},force:function(m,g){return arguments.length>1?(g==null?s.delete(m):s.set(m,p(g)),t):s.get(m)},find:function(m,g,y){var v=0,b=e.length,w,x,E,k,S;for(y==null?y=Infinity:y*=y,v=0;v<b;++v)k=e[v],w=m-k.x,x=g-k.y,E=w*w+x*x,E<y&&(S=k,y=E);return S},on:function(m,g){return arguments.length>1?(u.on(m,g),t):u.on(m)}}}function Mte(){var e,t,n,r,i=ln(-30),a,o=1,s=Infinity,l=.81;function u(h){var p,m=e.length,g=w2(e,Ate,_te).visitAfter(f);for(r=h,p=0;p<m;++p)t=e[p],g.visit(d)}function c(){if(!e)return;var h,p=e.length,m;for(a=new Array(p),h=0;h<p;++h)m=e[h],a[m.index]=+i(m,h,e)}function f(h){var p=0,m,g,y=0,v,b,w;if(h.length){for(v=b=w=0;w<4;++w)(m=h[w])&&(g=Math.abs(m.value))&&(p+=m.value,y+=g,v+=g*m.x,b+=g*m.y);h.x=v/y,h.y=b/y}else{m=h,m.x=m.data.x,m.y=m.data.y;do p+=a[m.data.index];while(m=m.next)}h.value=p}function d(h,p,m,g){if(!h.value)return!0;var y=h.x-t.x,v=h.y-t.y,b=g-p,w=y*y+v*v;if(b*b/l<w)return w<s&&(y===0&&(y=uo(n),w+=y*y),v===0&&(v=uo(n),w+=v*v),w<o&&(w=Math.sqrt(o*w)),t.vx+=y*h.value*r/w,t.vy+=v*h.value*r/w),!0;if(h.length||w>=s)return;(h.data!==t||h.next)&&(y===0&&(y=uo(n),w+=y*y),v===0&&(v=uo(n),w+=v*v),w<o&&(w=Math.sqrt(o*w)));do h.data!==t&&(b=a[h.data.index]*r/w,t.vx+=y*b,t.vy+=v*b);while(h=h.next)}return u.initialize=function(h,p){e=h,n=p,c()},u.strength=function(h){return arguments.length?(i=typeof h=="function"?h:ln(+h),c(),u):i},u.distanceMin=function(h){return arguments.length?(o=h*h,u):Math.sqrt(o)},u.distanceMax=function(h){return arguments.length?(s=h*h,u):Math.sqrt(s)},u.theta=function(h){return arguments.length?(l=h*h,u):Math.sqrt(l)},u}function Dte(e){var t=ln(.1),n,r,i;typeof e!="function"&&(e=ln(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(i[l]-c.x)*r[l]*s}function o(){if(!n)return;var s,l=n.length;for(r=new Array(l),i=new Array(l),s=0;s<l;++s)r[s]=isNaN(i[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:ln(+s),o(),a):t},a.x=function(s){return arguments.length?(e=typeof s=="function"?s:ln(+s),o(),a):e},a}function Nte(e){var t=ln(.1),n,r,i;typeof e!="function"&&(e=ln(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(i[l]-c.y)*r[l]*s}function o(){if(!n)return;var s,l=n.length;for(r=new Array(l),i=new Array(l),s=0;s<l;++s)r[s]=isNaN(i[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:ln(+s),o(),a):t},a.y=function(s){return arguments.length?(e=typeof s=="function"?s:ln(+s),o(),a):e},a}const PI={center:Vee,collide:hte,nbody:Mte,link:mte,x:Dte,y:Nte},Xf="forces",S2=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],Rte=["static","iterations"],jI=["x","y","vx","vy"];function T2(e){F.call(this,null,e)}T2.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:jI}]},q(T2,F,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(S2),a=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&UI(n,e,0,t)):(this.value=n=Ite(t.source,e),n.on("tick",Fte(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(Rte)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let s=this._argops,l=0,u=s.length,c;l<u;++l){if(c=s[l],c.name!==Xf||c.op._argval.force!=="link")continue;for(var r=c.op._argops,i=0,a=r.length,o;i<a;++i)if(r[i].name==="links"&&(o=r[i].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(jI)}});function Fte(e,t){return()=>e.touch(t).run()}function Ite(e,t){const n=Ote(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),UI(n,t,!0).on("end",()=>a=!0)}function UI(e,t,n,r){var i=J(t.forces),a,o,s,l;for(a=0,o=S2.length;a<o;++a)s=S2[a],s!==Xf&&t.modified(s)&&e[s](t[s]);for(a=0,o=i.length;a<o;++a)l=Xf+a,s=n||t.modified(Xf,a)?zte(i[a]):r&&Lte(i[a],r)?e.force(l):null,s&&e.force(l,s);for(o=e.numForces||0;a<o;++a)e.force(Xf+a,null);return e.numForces=i.length,e}function Lte(e,t){var n,r;for(n in e)if(le(r=e[n])&&t.modified(jt(r)))return 1;return 0}function zte(e){var t,n;te(PI,e.force)||L("Unrecognized force: "+e.force),t=PI[e.force]();for(n in e)le(t[n])&&Pte(t[n],e[n],e);return t}function Pte(e,t,n){e(le(t)?r=>t(r,n):t)}var jte=Object.freeze({__proto__:null,force:T2});function Ute(e,t){return e.parent===t.parent?1:2}function Bte(e){return e.reduce(qte,0)/e.length}function qte(e,t){return e+t.x}function Hte(e){return 1+e.reduce(Wte,0)}function Wte(e,t){return Math.max(e,t.y)}function Gte(e){for(var t;t=e.children;)e=t[0];return e}function Yte(e){for(var t;t=e.children;)e=t[t.length-1];return e}function Vte(){var e=Ute,t=1,n=1,r=!1;function i(a){var o,s=0;a.eachAfter(function(d){var h=d.children;h?(d.x=Bte(h),d.y=Hte(h)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=Gte(a),u=Yte(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(r?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*n})}return i.separation=function(a){return arguments.length?(e=a,i):e},i.size=function(a){return arguments.length?(r=!1,t=+a[0],n=+a[1],i):r?null:[t,n]},i.nodeSize=function(a){return arguments.length?(r=!0,t=+a[0],n=+a[1],i):r?[t,n]:null},i}function Xte(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else for(;--r>=0;)t+=n[r].value;e.value=t}function Jte(){return this.eachAfter(Xte)}function Kte(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this}function Qte(e,t){for(var n=this,r=[n],i,a,o=-1;n=r.pop();)if(e.call(t,n,++o,this),i=n.children)for(a=i.length-1;a>=0;--a)r.push(i[a]);return this}function Zte(e,t){for(var n=this,r=[n],i=[],a,o,s,l=-1;n=r.pop();)if(i.push(n),a=n.children)for(o=0,s=a.length;o<s;++o)r.push(a[o]);for(;n=i.pop();)e.call(t,n,++l,this);return this}function ene(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r}function tne(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})}function nne(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function rne(e){for(var t=this,n=ine(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r}function ine(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}function ane(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function one(){return Array.from(this)}function sne(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function lne(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*une(){var e=this,t,n=[e],r,i,a;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,r=e.children)for(i=0,a=r.length;i<a;++i)n.push(r[i]);while(n.length)}function A2(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=dne)):t===void 0&&(t=fne);for(var n=new mu(e),r,i=[n],a,o,s,l;r=i.pop();)if((o=t(r.data))&&(l=(o=Array.from(o)).length))for(r.children=o,s=l-1;s>=0;--s)i.push(a=o[s]=new mu(o[s])),a.parent=r,a.depth=r.depth+1;return n.eachBefore(BI)}function cne(){return A2(this).eachBefore(hne)}function fne(e){return e.children}function dne(e){return Array.isArray(e)?e[1]:null}function hne(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function BI(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function mu(e){this.data=e,this.depth=this.height=0,this.parent=null}mu.prototype=A2.prototype={constructor:mu,count:Jte,each:Kte,eachAfter:Zte,eachBefore:Qte,find:ene,sum:tne,sort:nne,path:rne,ancestors:ane,descendants:one,leaves:sne,links:lne,copy:cne,[Symbol.iterator]:une};function pne(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function mne(e){for(var t=e.length,n,r;t;)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e}function gne(e){for(var t=0,n=(e=mne(Array.from(e))).length,r=[],i,a;t<n;)i=e[t],a&&qI(a,i)?++t:(a=vne(r=yne(r,i)),t=0);return a}function yne(e,t){var n,r;if(_2(t,e))return[t];for(n=0;n<e.length;++n)if(ng(t,e[n])&&_2(Jf(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(ng(Jf(e[n],e[r]),t)&&ng(Jf(e[n],t),e[r])&&ng(Jf(e[r],t),e[n])&&_2(HI(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error()}function ng(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function qI(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function _2(e,t){for(var n=0;n<t.length;++n)if(!qI(e,t[n]))return!1;return!0}function vne(e){switch(e.length){case 1:return bne(e[0]);case 2:return Jf(e[0],e[1]);case 3:return HI(e[0],e[1],e[2])}}function bne(e){return{x:e.x,y:e.y,r:e.r}}function Jf(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(r+o+u/f*c)/2,r:(f+i+s)/2}}function HI(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=r-o,h=r-u,p=i-s,m=i-c,g=l-a,y=f-a,v=r*r+i*i-a*a,b=v-o*o-s*s+l*l,w=v-u*u-c*c+f*f,x=h*p-d*m,E=(p*w-m*b)/(x*2)-r,k=(m*g-p*y)/x,S=(h*b-d*w)/(x*2)-i,A=(d*y-h*g)/x,C=k*k+A*A-1,_=2*(a+E*k+S*A),D=E*E+S*S-a*a,M=-(C?(_+Math.sqrt(_*_-4*C*D))/(2*C):D/_);return{x:r+E+k*M,y:i+S+A*M,r:M}}function WI(e,t,n){var r=e.x-t.x,i,a,o=e.y-t.y,s,l,u=r*r+o*o;u?(a=t.r+n.r,a*=a,l=e.r+n.r,l*=l,a>l?(i=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-i*i)),n.x=e.x-i*r-s*o,n.y=e.y-i*o+s*r):(i=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-i*i)),n.x=t.x+i*r-s*o,n.y=t.y+i*o+s*r)):(n.x=t.x+n.r,n.y=t.y)}function GI(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function YI(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function rg(e){this._=e,this.next=null,this.previous=null}function wne(e){if(!(i=(e=pne(e)).length))return 0;var t,n,r,i,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;WI(n,t,r=e[2]),t=new rg(t),n=new rg(n),r=new rg(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){WI(t._,n._,r=e[s]),r=new rg(r),l=n.next,u=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(GI(l._,r._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(GI(u._,r._)){t=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}while(l!==u.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=YI(t);(r=r.next)!==n;)(o=YI(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=gne(t),s=0;s<i;++s)t=e[s],t.x-=r.x,t.y-=r.y;return r.r}function xne(e){return e==null?null:ig(e)}function ig(e){if(typeof e!="function")throw new Error();return e}function As(){return 0}function gu(e){return function(){return e}}function kne(e){return Math.sqrt(e.value)}function Ene(){var e=null,t=1,n=1,r=As;function i(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(VI(e)).eachAfter(C2(r,.5)).eachBefore(XI(1)):a.eachBefore(VI(kne)).eachAfter(C2(As,1)).eachAfter(C2(r,a.r/Math.min(t,n))).eachBefore(XI(Math.min(t,n)/(2*a.r))),a}return i.radius=function(a){return arguments.length?(e=xne(a),i):e},i.size=function(a){return arguments.length?(t=+a[0],n=+a[1],i):[t,n]},i.padding=function(a){return arguments.length?(r=typeof a=="function"?a:gu(+a),i):r},i}function VI(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function C2(e,t){return function(n){if(r=n.children){var r,i,a=r.length,o=e(n)*t||0,s;if(o)for(i=0;i<a;++i)r[i].r+=o;if(s=wne(r),o)for(i=0;i<a;++i)r[i].r-=o;n.r=s+o}}}function XI(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function JI(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Kf(e,t,n,r,i){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(r-t)/e.value;++s<l;)o=a[s],o.y0=n,o.y1=i,o.x0=t,o.x1=t+=o.value*u}function Sne(){var e=1,t=1,n=0,r=!1;function i(o){var s=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),r&&o.eachBefore(JI),o}function a(o,s){return function(l){l.children&&Kf(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-n,d=l.y1-n;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return i.round=function(o){return arguments.length?(r=!!o,i):r},i.size=function(o){return arguments.length?(e=+o[0],t=+o[1],i):[e,t]},i.padding=function(o){return arguments.length?(n=+o,i):n},i}var Tne={depth:-1},KI={};function Ane(e){return e.id}function _ne(e){return e.parentId}function QI(){var e=Ane,t=_ne;function n(r){var i=Array.from(r),a=i.length,o,s,l,u,c,f,d,h=new Map();for(s=0;s<a;++s)o=i[s],c=i[s]=new mu(o),(f=e(o,s,r))!=null&&(f+="")&&(d=c.id=f,h.set(d,h.has(d)?KI:c)),(f=t(o,s,r))!=null&&(f+="")&&(c.parent=f);for(s=0;s<a;++s)if(c=i[s],f=c.parent){if(u=h.get(f),!u)throw new Error("missing: "+f);if(u===KI)throw new Error("ambiguous: "+f);u.children?u.children.push(c):u.children=[c],c.parent=u}else{if(l)throw new Error("multiple roots");l=c}if(!l)throw new Error("no root");if(l.parent=Tne,l.eachBefore(function(p){p.depth=p.parent.depth+1,--a}).eachBefore(BI),l.parent=null,a>0)throw new Error("cycle");return l}return n.id=function(r){return arguments.length?(e=ig(r),n):e},n.parentId=function(r){return arguments.length?(t=ig(r),n):t},n}function Cne(e,t){return e.parent===t.parent?1:2}function $2(e){var t=e.children;return t?t[0]:e.t}function O2(e){var t=e.children;return t?t[t.length-1]:e.t}function $ne(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function One(e){for(var t=0,n=0,r=e.children,i=r.length,a;--i>=0;)a=r[i],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function Mne(e,t,n){return e.a.parent===t.parent?e.a:n}function ag(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}ag.prototype=Object.create(mu.prototype);function Dne(e){for(var t=new ag(e,0),n,r=[t],i,a,o,s;n=r.pop();)if(a=n._.children)for(n.children=new Array(s=a.length),o=s-1;o>=0;--o)r.push(i=n.children[o]=new ag(a[o],o)),i.parent=n;return(t.parent=new ag(null,0)).children=[t],t}function Nne(){var e=Cne,t=1,n=1,r=null;function i(u){var c=Dne(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),r)u.eachBefore(l);else{var f=u,d=u,h=u;u.eachBefore(function(v){v.x<f.x&&(f=v),v.x>d.x&&(d=v),v.depth>h.depth&&(h=v)});var p=f===d?1:e(f,d)/2,m=p-f.x,g=t/(d.x+p+m),y=n/(h.depth||1);u.eachBefore(function(v){v.x=(v.x+m)*g,v.y=v.depth*y})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){One(u);var h=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-h):u.z=h}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,h=u,p=c,m=d.parent.children[0],g=d.m,y=h.m,v=p.m,b=m.m,w;p=O2(p),d=$2(d),p&&d;)m=$2(m),h=O2(h),h.a=u,w=p.z+v-d.z-g+e(p._,d._),w>0&&($ne(Mne(p,u,f),u,w),g+=w,y+=w),v+=p.m,g+=d.m,b+=m.m,y+=h.m;p&&!O2(h)&&(h.t=p,h.m+=v-y),d&&!$2(m)&&(m.t=d,m.m+=g-b,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*n}return i.separation=function(u){return arguments.length?(e=u,i):e},i.size=function(u){return arguments.length?(r=!1,t=+u[0],n=+u[1],i):r?null:[t,n]},i.nodeSize=function(u){return arguments.length?(r=!0,t=+u[0],n=+u[1],i):r?[t,n]:null},i}function og(e,t,n,r,i){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-n)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=r,o.y0=n,o.y1=n+=o.value*u}var ZI=(1+Math.sqrt(5))/2;function e3(e,t,n,r,i,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,h,p,m=t.value,g,y,v,b,w,x,E;c<d;){h=i-n,p=a-r;do g=s[f++].value;while(!g&&f<d);for(y=v=g,x=Math.max(p/h,h/p)/(m*e),E=g*g*x,w=Math.max(v/E,E/y);f<d;++f){if(g+=u=s[f].value,u<y&&(y=u),u>v&&(v=u),E=g*g*x,b=Math.max(v/E,E/y),b>w){g-=u;break}w=b}o.push(l={value:g,dice:h<p,children:s.slice(c,f)}),l.dice?Kf(l,n,r,i,m?r+=p*g/m:a):og(l,n,r,m?n+=h*g/m:i,a),m-=g,c=f}return o}var t3=function e(t){function n(r,i,a,o,s){e3(t,r,i,a,o,s)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(ZI);function Rne(){var e=t3,t=!1,n=1,r=1,i=[0],a=As,o=As,s=As,l=As,u=As;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=r,d.eachBefore(f),i=[0],t&&d.eachBefore(JI),d}function f(d){var h=i[d.depth],p=d.x0+h,m=d.y0+h,g=d.x1-h,y=d.y1-h;g<p&&(p=g=(p+g)/2),y<m&&(m=y=(m+y)/2),d.x0=p,d.y0=m,d.x1=g,d.y1=y,d.children&&(h=i[d.depth+1]=a(d)/2,p+=u(d)-h,m+=o(d)-h,g-=s(d)-h,y-=l(d)-h,g<p&&(p=g=(p+g)/2),y<m&&(m=y=(m+y)/2),e(d,p,m,g,y))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],r=+d[1],c):[n,r]},c.tile=function(d){return arguments.length?(e=ig(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:gu(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:gu(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:gu(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:gu(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:gu(+d),c):u},c}function Fne(e,t,n,r,i){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,n,r,i);function c(f,d,h,p,m,g,y){if(f>=d-1){var v=a[f];v.x0=p,v.y0=m,v.x1=g,v.y1=y;return}for(var b=u[f],w=h/2+b,x=f+1,E=d-1;x<E;){var k=x+E>>>1;u[k]<w?x=k+1:E=k}w-u[x-1]<u[x]-w&&f+1<x&&--x;var S=u[x]-b,A=h-S;if(g-p>y-m){var C=h?(p*A+g*S)/h:g;c(f,x,S,p,m,C,y),c(x,d,A,C,m,g,y)}else{var _=h?(m*A+y*S)/h:y;c(f,x,S,p,m,g,_),c(x,d,A,p,_,g,y)}}}function Ine(e,t,n,r,i){(e.depth&1?og:Kf)(e,t,n,r,i)}var Lne=function e(t){function n(r,i,a,o,s){if((l=r._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,h,p=l.length,m=r.value;++d<p;){for(u=l[d],c=u.children,f=u.value=0,h=c.length;f<h;++f)u.value+=c[f].value;u.dice?Kf(u,i,a,o,m?a+=(s-a)*u.value/m:s):og(u,i,a,m?i+=(o-i)*u.value/m:o,s),m-=u.value}else r._squarify=l=e3(t,r,i,a,o,s),l.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(ZI);function M2(e,t,n){const r={};return e.each(i=>{const a=i.data;n(a)&&(r[t(a)]=i)}),e.lookup=r,e}function D2(e){F.call(this,null,e)}D2.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const zne=e=>e.values;q(D2,F,{transform(e,t){t.source||L("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each(o=>{o.children&&Gh(o.data)&&i.rem.push(o.data)}),this.value=a=A2({values:J(e.keys).reduce((o,s)=>(o.key(s),o),Pne()).entries(i.source)},zne),n&&a.each(o=>{o.children&&(o=Oe(o.data),i.add.push(o),i.source.push(o))}),M2(a,ne,ne)),i.source.root=a,i}});function Pne(){const e=[],t={entries:i=>r(n(i,0),0),key:i=>(e.push(i),t)};function n(i,a){if(a>=e.length)return i;const o=i.length,s=e[a++],l={},u={};let c=-1,f,d,h;for(;++c<o;)f=s(d=i[c])+"",(h=l[f])?h.push(d):l[f]=[d];for(f in l)u[f]=n(l[f],a);return u}function r(i,a){if(++a>e.length)return i;const o=[];for(const s in i)o.push({key:s,values:r(i[s],a)});return o}return t}function sa(e){F.call(this,null,e)}const jne=(e,t)=>e.parent===t.parent?1:2;q(sa,F,{transform(e,t){(!t.source||!t.source.root)&&L(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(ts(e.sort,o=>o.data)),Une(n,this.params,e),n.separation&&n.separation(e.separation!==!1?jne:vl);try{this.value=n(i)}catch(o){L(o)}return i.each(o=>Bne(o,r,a)),t.reflow(e.modified()).modifies(a).modifies("leaf")}});function Une(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}function Bne(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}const N2=["x","y","r","depth","children"];function R2(e){sa.call(this,e)}R2.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:N2.length,default:N2}]},q(R2,sa,{layout:Ene,params:["radius","size","padding"],fields:N2});const F2=["x0","y0","x1","y1","depth","children"];function I2(e){sa.call(this,e)}I2.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:F2.length,default:F2}]},q(I2,sa,{layout:Sne,params:["size","round","padding"],fields:F2});function L2(e){F.call(this,null,e)}L2.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},q(L2,F,{transform(e,t){t.source||L("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?M2(QI().id(e.key).parentId(e.parentKey)(i.source),e.key,or):M2(QI()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const n3={tidy:Nne,cluster:Vte},z2=["x","y","depth","children"];function P2(e){sa.call(this,e)}P2.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:z2.length,default:z2}]},q(P2,sa,{layout(e){const t=e||"tidy";if(te(n3,t))return n3[t]();L("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:z2});function j2(e){F.call(this,[],e)}j2.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},q(j2,F,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||L("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,o=>a[ne(o)]=1),r.each(o=>{const s=o.data,l=o.parent&&o.parent.data;l&&a[ne(s)]&&a[ne(l)]&&i.add.push(Oe({source:l,target:s}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,o=>a[ne(o)]=1),n.forEach(o=>{(a[ne(o.source)]||a[ne(o.target)])&&i.mod.push(o)})),i}});const r3={binary:Fne,dice:Kf,slice:og,slicedice:Ine,squarify:t3,resquarify:Lne},U2=["x0","y0","x1","y1","depth","children"];function B2(e){sa.call(this,e)}B2.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:U2.length,default:U2}]},q(B2,sa,{layout(){const e=Rne();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{te(r3,t)?e.tile(r3[t]):L("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:U2});var qne=Object.freeze({__proto__:null,nest:D2,pack:R2,partition:I2,stratify:L2,tree:P2,treelinks:j2,treemap:B2});const Hne=4278190080,Wne=268435456,Gne=.0625;function Yne(e,t){const n=e.bitmap();return(t||[]).forEach(r=>n.set(e(r.boundary[0]),e(r.boundary[3]))),[n,void 0]}function Vne(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=Fl(i,a).getContext("2d");t.forEach(g=>i3(s,g,o));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let f,d,h,p,m;for(d=0;d<a;++d)for(f=0;f<i;++f)m=l[d*i+f]&Hne,m&&(h=e(f),p=e(d),r||u.set(h,p),o&&m^Wne&&c.set(h,p));return[u,c]}function i3(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;r==="group"?t.forEach(i=>{i.items.forEach(a=>i3(e,a.items,n))}):Gn[r].draw(e,{items:n?t.map(Xne):t})}function Xne(e){const t=Yh(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=Gne,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const la=5,un=31,Qf=32,co=new Uint32Array(Qf+1),Ir=new Uint32Array(Qf+1);Ir[0]=0,co[0]=~Ir[0];for(let e=1;e<=Qf;++e)Ir[e]=Ir[e-1]<<1|1,co[e]=~Ir[e];function Jne(e,t){const n=new Uint32Array(~~((e*t+Qf)/Qf));function r(a,o){n[a]|=o}function i(a,o){n[a]&=o}return{array:n,get:(a,o)=>{const s=o*e+a;return n[s>>>la]&1<<(s&un)},set:(a,o)=>{const s=o*e+a;r(s>>>la,1<<(s&un))},clear:(a,o)=>{const s=o*e+a;i(s>>>la,~(1<<(s&un)))},getRange:(a,o,s,l)=>{let u=l,c,f,d,h;for(;u>=o;--u)if(c=u*e+a,f=u*e+s,d=c>>>la,h=f>>>la,d===h){if(n[d]&co[c&un]&Ir[(f&un)+1])return!0}else{if(n[d]&co[c&un])return!0;if(n[h]&Ir[(f&un)+1])return!0;for(let p=d+1;p<h;++p)if(n[p])return!0}return!1},setRange:(a,o,s,l)=>{let u,c,f,d,h;for(;o<=l;++o)if(u=o*e+a,c=o*e+s,f=u>>>la,d=c>>>la,f===d)r(f,co[u&un]&Ir[(c&un)+1]);else for(r(f,co[u&un]),r(d,Ir[(c&un)+1]),h=f+1;h<d;++h)r(h,4294967295)},clearRange:(a,o,s,l)=>{let u,c,f,d,h;for(;o<=l;++o)if(u=o*e+a,c=o*e+s,f=u>>>la,d=c>>>la,f===d)i(f,Ir[u&un]|co[(c&un)+1]);else for(i(f,Ir[u&un]),i(d,co[(c&un)+1]),h=f+1;h<d;++h)i(h,0)},outOfBounds:(a,o,s,l)=>a<0||o<0||l>=t||s>=e}}function Kne(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=s=>~~((s+n)/r);return o.invert=s=>s*r-n,o.bitmap=()=>Jne(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function Qne(e,t,n,r){const i=e.width,a=e.height;return function(o){const s=o.datum.datum.items[r].items,l=s.length,u=o.datum.fontSize,c=fi.width(o.datum,o.datum.text);let f=0,d,h,p,m,g,y,v;for(let b=0;b<l;++b)d=s[b].x,p=s[b].y,h=s[b].x2===void 0?d:s[b].x2,m=s[b].y2===void 0?p:s[b].y2,g=(d+h)/2,y=(p+m)/2,v=Math.abs(h-d+m-p),v>=f&&(f=v,o.x=g,o.y=y);return g=c/2,y=u/2,d=o.x-g,h=o.x+g,p=o.y-y,m=o.y+y,o.align="center",d<0&&h<=i?o.align="left":0<=d&&i<h&&(o.align="right"),o.baseline="middle",p<0&&m<=a?o.baseline="top":0<=p&&a<m&&(o.baseline="bottom"),!0}}function sg(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function fo(e,t,n,r,i,a,o,s){const l=i*a/(r*2),u=e(t-l),c=e(t+l),f=e(n-(a=a/2)),d=e(n+a);return o.outOfBounds(u,f,c,d)||o.getRange(u,f,c,d)||s&&s.getRange(u,f,c,d)}function Zne(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(u,c,f,d,h){const p=e.invert(u),m=e.invert(c);let g=f,y=a,v;if(!sg(p,m,d,h,i,a)&&!fo(e,p,m,h,d,g,o,s)&&!fo(e,p,m,h,d,h,o,null)){for(;y-g>=1;)v=(g+y)/2,fo(e,p,m,h,d,v,o,s)?y=v:g=v;if(g>f)return[p,m,g,!0]}}return function(u){const c=u.datum.datum.items[r].items,f=c.length,d=u.datum.fontSize,h=fi.width(u.datum,u.datum.text);let p=n?d:0,m=!1,g=!1,y=0,v,b,w,x,E,k,S,A,C,_,D,M,N,T,O,P,W;for(let B=0;B<f;++B){for(v=c[B].x,w=c[B].y,b=c[B].x2===void 0?v:c[B].x2,x=c[B].y2===void 0?w:c[B].y2,v>b&&(W=v,v=b,b=W),w>x&&(W=w,w=x,x=W),C=e(v),D=e(b),_=~~((C+D)/2),M=e(w),T=e(x),N=~~((M+T)/2),S=_;S>=C;--S)for(A=N;A>=M;--A)P=l(S,A,p,h,d),P&&([u.x,u.y,p,m]=P);for(S=_;S<=D;++S)for(A=N;A<=T;++A)P=l(S,A,p,h,d),P&&([u.x,u.y,p,m]=P);!m&&!n&&(O=Math.abs(b-v+x-w),E=(v+b)/2,k=(w+x)/2,O>=y&&!sg(E,k,h,d,i,a)&&!fo(e,E,k,d,h,d,o,null)&&(y=O,u.x=E,u.y=k,g=!0))}return m||g?(E=h/2,k=d/2,o.setRange(e(u.x-E),e(u.y-k),e(u.x+E),e(u.y+k)),u.align="center",u.baseline="middle",!0):!1}}const ere=[-1,-1,1,1],tre=[-1,1,-1,1];function nre(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(u){const c=u.datum.datum.items[r].items,f=c.length,d=u.datum.fontSize,h=fi.width(u.datum,u.datum.text),p=[];let m=n?d:0,g=!1,y=!1,v=0,b,w,x,E,k,S,A,C,_,D,M,N;for(let T=0;T<f;++T){for(b=c[T].x,x=c[T].y,w=c[T].x2===void 0?b:c[T].x2,E=c[T].y2===void 0?x:c[T].y2,p.push([e((b+w)/2),e((x+E)/2)]);p.length;){if([A,C]=p.pop(),o.get(A,C)||s.get(A,C)||l.get(A,C))continue;l.set(A,C);for(let O=0;O<4;++O)k=A+ere[O],S=C+tre[O],l.outOfBounds(k,S,k,S)||p.push([k,S]);if(k=e.invert(A),S=e.invert(C),_=m,D=a,!sg(k,S,h,d,i,a)&&!fo(e,k,S,d,h,_,o,s)&&!fo(e,k,S,d,h,d,o,null)){for(;D-_>=1;)M=(_+D)/2,fo(e,k,S,d,h,M,o,s)?D=M:_=M;_>m&&(u.x=k,u.y=S,m=_,g=!0)}}!g&&!n&&(N=Math.abs(w-b+E-x),k=(b+w)/2,S=(x+E)/2,N>=v&&!sg(k,S,h,d,i,a)&&!fo(e,k,S,d,h,d,o,null)&&(v=N,u.x=k,u.y=S,y=!0))}return g||y?(k=h/2,S=d/2,o.setRange(e(u.x-k),e(u.y-S),e(u.x+k),e(u.y+S)),u.align="center",u.baseline="middle",!0):!1}}const rre=["right","center","left"],ire=["bottom","middle","top"];function are(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(u){const c=u.boundary,f=u.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>a)return!1;let d=0,h,p,m,g,y,v,b,w,x,E,k,S,A,C,_;for(let D=0;D<l;++D){if(h=(n[D]&3)-1,p=(n[D]>>>2&3)-1,m=h===0&&p===0||r[D]<0,g=h&&p?Math.SQRT1_2:1,y=r[D]<0?-1:1,v=c[1+h]+r[D]*h*g,k=c[4+p]+y*f*p/2+r[D]*p*g,w=k-f/2,x=k+f/2,S=e(v),C=e(w),_=e(x),!d)if(a3(S,S,C,_,o,s,v,v,w,x,c,m))d=fi.width(u.datum,u.datum.text);else continue;if(E=v+y*d*h/2,v=E-d/2,b=E+d/2,S=e(v),A=e(b),a3(S,A,C,_,o,s,v,b,w,x,c,m))return u.x=h?h*y<0?b:v:E,u.y=p?p*y<0?x:w:k,u.align=rre[h*y+1],u.baseline=ire[p*y+1],o.setRange(S,C,A,_),!0}return!1}}function a3(e,t,n,r,i,a,o,s,l,u,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!ore(o,l,s,u,c):i.getRange(e,n,t,r)))}function ore(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}const q2=0,H2=4,W2=8,G2=0,Y2=1,V2=2,sre={"top-left":q2+G2,top:q2+Y2,"top-right":q2+V2,left:H2+G2,middle:H2+Y2,right:H2+V2,"bottom-left":W2+G2,bottom:W2+Y2,"bottom-right":W2+V2},lre={naive:Qne,"reduced-search":Zne,floodfill:nre};function ure(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const f=Math.max(r.length,i.length),d=cre(r,f),h=fre(i,f),p=dre(e[0].datum),m=p==="group"&&e[0].datum.items[l].marktype,g=m==="area",y=hre(p,m,s,l),v=Kne(t[0],t[1],u),b=g&&c==="naive",w=e.map(k=>({datum:k,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(k)}));let x;if(!b){n&&w.sort((S,A)=>n(S.datum,A.datum));let k=!1;for(let S=0;S<h.length&&!k;++S)k=h[S]===5||d[S]<0;p&&(o||g)&&(a=[e.map(S=>S.datum)].concat(a)),x=a.length?Vne(v,a,k,g):Yne(v,o&&w)}const E=g?lre[c](v,x,o,l):are(v,x,h,d);return w.forEach(k=>k.opacity=+E(k)),w}function cre(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}function fre(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=sre[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}function dre(e){return e&&e.mark&&e.mark.marktype}function hre(e,t,n,r){const i=a=>[a.x,a.x,a.x,a.y,a.y,a.y];return e?e==="line"||e==="area"?a=>i(a.datum):t==="line"?a=>{const o=a.datum.items[r].items;return i(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:a=>{const o=a.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:i}const X2=["x","y","opacity","align","baseline"],o3=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function J2(e){F.call(this,null,e)}J2.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:o3},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:X2.length,default:X2}]},q(J2,F,{transform(e,t){function n(a){const o=e[a];return le(o)&&t.modified(o.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&L("Size parameter should be specified as a [width, height] array.");const i=e.as||X2;return ure(t.materialize(t.SOURCE).source,e.size,e.sort,J(e.offset||1),J(e.anchor||o3),e.avoidMarks||[],!(e.avoidBaseMark===!1),e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(a=>{const o=a.datum;o[i[0]]=a.x,o[i[1]]=a.y,o[i[2]]=a.opacity,o[i[3]]=a.align,o[i[4]]=a.baseline}),t.reflow(r).modifies(i)}});var pre=Object.freeze({__proto__:null,label:J2});function s3(e,t){var n=[],r=function(c){return c(s)},i,a,o,s,l,u;if(t==null)n.push(e);else for(i={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(r),u=i[l],u||(i[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function K2(e){F.call(this,null,e)}K2.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},q(K2,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=s3(r,e.groupby),a=(e.groupby||[]).map(tt),o=a.length,s=e.as||[tt(e.x),tt(e.y)],l=[];i.forEach(u=>{h$(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[a[d]]=u.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],l.push(Oe(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});const Q2={linear:rb,log:s$,exp:l$,pow:u$,quad:ib,poly:c$},mre=(e,t)=>e==="poly"?t:e==="quad"?2:1;function Z2(e){F.call(this,null,e)}Z2.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Q2)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},q(Z2,F,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=s3(r,e.groupby),a=(e.groupby||[]).map(tt),o=e.method||"linear",s=e.order||3,l=mre(o,s),u=e.as||[tt(e.x),tt(e.y)],c=Q2[o],f=[];let d=e.extent;te(Q2,o)||L("Invalid regression method: "+o),d!=null&&(o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null)),i.forEach(h=>{const p=h.length;if(p<=l){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const m=c(h,e.x,e.y,s);if(e.params){f.push(Oe({keys:h.dims,coef:m.coef,rSquared:m.rSquared}));return}const g=d||ei(h,e.x),y=v=>{const b={};for(let w=0;w<a.length;++w)b[a[w]]=h.dims[w];b[u[0]]=v[0],b[u[1]]=v[1],f.push(Oe(b))};o==="linear"?g.forEach(v=>y([v,m.predict(v)])):rp(m.predict,g,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});var gre=Object.freeze({__proto__:null,loess:K2,regression:Z2});const l3=Math.pow(2,-52),lg=new Uint32Array(512);class ek{static from(e,t=xre,n=kre){const r=e.length,i=new Float64Array(r*2);for(let a=0;a<r;a++){const o=e[a];i[2*a]=t(o),i[2*a+1]=n(o)}return new ek(i)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=Infinity,s=Infinity,l=-Infinity,u=-Infinity;for(let A=0;A<a;A++){const C=e[2*A],_=e[2*A+1];C<o&&(o=C),_<s&&(s=_),C>l&&(l=C),_>u&&(u=_),this._ids[A]=A}const c=(o+l)/2,f=(s+u)/2;let d=Infinity,h,p,m;for(let A=0;A<a;A++){const C=tk(c,f,e[2*A],e[2*A+1]);C<d&&(h=A,d=C)}const g=e[2*h],y=e[2*h+1];d=Infinity;for(let A=0;A<a;A++){if(A===h)continue;const C=tk(g,y,e[2*A],e[2*A+1]);C<d&&C>0&&(p=A,d=C)}let v=e[2*p],b=e[2*p+1],w=Infinity;for(let A=0;A<a;A++){if(A===h||A===p)continue;const C=bre(g,y,v,b,e[2*A],e[2*A+1]);C<w&&(m=A,w=C)}let x=e[2*m],E=e[2*m+1];if(w===Infinity){for(let _=0;_<a;_++)this._dists[_]=e[2*_]-e[0]||e[2*_+1]-e[1];yu(this._ids,this._dists,0,a-1);const A=new Uint32Array(a);let C=0;for(let _=0,D=-Infinity;_<a;_++){const M=this._ids[_];this._dists[M]>D&&(A[C++]=M,D=this._dists[M])}this.hull=A.subarray(0,C),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ug(g,y,v,b,x,E)){const A=p,C=v,_=b;p=m,v=x,b=E,m=A,x=C,E=_}const k=wre(g,y,v,b,x,E);this._cx=k.x,this._cy=k.y;for(let A=0;A<a;A++)this._dists[A]=tk(e[2*A],e[2*A+1],k.x,k.y);yu(this._ids,this._dists,0,a-1),this._hullStart=h;let S=3;n[h]=t[m]=p,n[p]=t[h]=m,n[m]=t[p]=h,r[h]=0,r[p]=1,r[m]=2,i.fill(-1),i[this._hashKey(g,y)]=h,i[this._hashKey(v,b)]=p,i[this._hashKey(x,E)]=m,this.trianglesLen=0,this._addTriangle(h,p,m,-1,-1,-1);for(let A=0,C,_;A<this._ids.length;A++){const D=this._ids[A],M=e[2*D],N=e[2*D+1];if(A>0&&Math.abs(M-C)<=l3&&Math.abs(N-_)<=l3)continue;if(C=M,_=N,D===h||D===p||D===m)continue;let T=0;for(let se=0,me=this._hashKey(M,N);se<this._hashSize&&!(T=i[(me+se)%this._hashSize],T!==-1&&T!==n[T]);se++);T=t[T];let O=T,P;for(;P=n[O],!ug(M,N,e[2*O],e[2*O+1],e[2*P],e[2*P+1]);)if(O=P,O===T){O=-1;break}if(O===-1)continue;let W=this._addTriangle(O,D,n[O],-1,-1,r[O]);r[D]=this._legalize(W+2),r[O]=W,S++;let B=n[O];for(;P=n[B],ug(M,N,e[2*B],e[2*B+1],e[2*P],e[2*P+1]);)W=this._addTriangle(B,D,P,r[D],-1,r[B]),r[D]=this._legalize(W+2),n[B]=B,S--,B=P;if(O===T)for(;P=t[O],ug(M,N,e[2*P],e[2*P+1],e[2*O],e[2*O+1]);)W=this._addTriangle(P,D,O,-1,r[O],r[P]),this._legalize(W+2),r[P]=W,n[O]=O,S--,O=P;this._hullStart=t[D]=O,n[O]=t[B]=D,n[D]=B,i[this._hashKey(M,N)]=D,i[this._hashKey(e[2*O],e[2*O+1])]=O}this.hull=new Uint32Array(S);for(let A=0,C=this._hullStart;A<S;A++)this.hull[A]=C,C=n[C];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(yre(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(i===0)break;e=lg[--i];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c],m=vre(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1]);if(m){t[e]=p,t[o]=f;const g=n[c];if(g===-1){let v=this._hullStart;do{if(this._hullTri[v]===c){this._hullTri[v]=e;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(e,g),this._link(o,n[a]),this._link(a,c);const y=l+(o+1)%3;i<lg.length&&(lg[i++]=y)}else{if(i===0)break;e=lg[--i]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function yre(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function tk(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function nk(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function ug(e,t,n,r,i,a){const o=nk(i,a,e,t,n,r)||nk(e,t,n,r,i,a)||nk(n,r,i,a,e,t);return o<0}function vre(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,f=r-s,d=i-o,h=a-s,p=l*l+u*u,m=c*c+f*f,g=d*d+h*h;return l*(f*g-m*h)-u*(c*g-m*d)+p*(c*h-f*d)<0}function bre(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function wre(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=e+(u*c-s*f)*d,p=t+(o*f-l*c)*d;return{x:h,y:p}}function yu(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const a=e[i],o=t[a];let s=i-1;for(;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{const i=n+r>>1;let a=n+1,o=r;Zf(e,i,a),t[e[n]]>t[e[r]]&&Zf(e,n,r),t[e[a]]>t[e[r]]&&Zf(e,a,r),t[e[n]]>t[e[a]]&&Zf(e,n,a);const s=e[a],l=t[s];for(;;){do a++;while(t[e[a]]<l);do o--;while(t[e[o]]>l);if(o<a)break;Zf(e,a,o)}e[n+1]=e[o],e[o]=s,r-a+1>=o-n?(yu(e,t,a,r),yu(e,t,n,o-1)):(yu(e,t,n,o-1),yu(e,t,a,r))}}function Zf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function xre(e){return e[0]}function kre(e){return e[1]}const u3=1e-6;class _s{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const r=e+n,i=t;if(n<0)throw new Error("negative radius");if(this._x1===null?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>u3||Math.abs(this._y1-i)>u3)&&(this._+="L"+r+","+i),!n)return;this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class rk{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Ere{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t))||!((i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,m,g;d<p;d+=3,h+=2){const y=n[d]*2,v=n[d+1]*2,b=n[d+2]*2,w=e[y],x=e[y+1],E=e[v],k=e[v+1],S=e[b],A=e[b+1],C=E-w,_=k-x,D=S-w,M=A-x,N=C*C+_*_,T=D*D+M*M,O=(C*M-_*D)*2;if(!O)m=(w+S)/2-1e8*M,g=(x+A)/2+1e8*D;else if(Math.abs(O)<1e-8)m=(w+S)/2,g=(x+A)/2;else{const P=1/O;m=w+(M*N-_*T)*P,g=x+(C*T-D*N)*P}i[h]=m,i[h+1]=g}let a=t[t.length-1],o,s=a*4,l,u=e[2*a],c,f=e[2*a+1];r.fill(0);for(let d=0;d<t.length;++d)a=t[d],o=s,l=u,c=f,s=a*4,u=e[2*a],f=e[2*a+1],r[o+2]=r[s]=c-f,r[o+3]=r[s+1]=u-l}render(e){const t=e==null?e=new _s():void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const f=n[u];if(f<u)continue;const d=Math.floor(u/3)*2,h=Math.floor(f/3)*2,p=a[d],m=a[d+1],g=a[h],y=a[h+1];this._renderSegment(p,m,g,y,e)}let s,l=i[i.length-1];for(let u=0;u<i.length;++u){s=l,l=i[u];const c=Math.floor(r[l]/3)*2,f=a[c],d=a[c+1],h=s*4,p=this._project(f,d,o[h+2],o[h+3]);p&&this._renderSegment(f,d,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new _s():void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new _s():void 0,r=this._clip(e);if(r===null||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let a=2;a<i;a+=2)(r[a]!==r[a-2]||r[a+1]!==r[a-1])&&t.lineTo(r[a],r[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const r=this.cellPolygon(t);r&&(r.index=t,yield r)}}cellPolygon(e){const t=new rk();return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);o===0&&s===0?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const r=this._clip(n);if(r)e:for(let i=0,a=t.length;i<a;i+=2)for(let o=0,s=r.length;o<s;o+=2)if(t[i]==r[o]&&t[i+1]==r[o+1]&&t[(i+2)%a]==r[(o+s-2)%s]&&t[(i+3)%a]==r[(o+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(a===-1)return null;const o=[];let s=a;do{const l=Math.floor(s/3);if(o.push(t[l*2],t[l*2+1]),s=s%3===2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,r=e*4;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r=null,i,a,o=t[n-2],s=t[n-1],l,u=this._regioncode(o,s),c,f;for(let d=0;d<n;d+=2)if(i=o,a=s,o=t[d],s=t[d+1],l=u,u=this._regioncode(o,s),l===0&&u===0)c=f,f=0,r?r.push(o,s):r=[o,s];else{let h,p,m,g,y;if(l===0){if((h=this._clipSegment(i,a,o,s,l,u))===null)continue;[p,m,g,y]=h}else{if((h=this._clipSegment(o,s,i,a,u,l))===null)continue;[g,y,p,m]=h,c=f,f=this._edgecode(p,m),c&&f&&this._edge(e,c,f,r,r.length),r?r.push(p,m):r=[p,m]}c=f,f=this._edgecode(g,y),c&&f&&this._edge(e,c,f,r,r.length),r?r.push(g,y):r=[g,y]}if(r)c=f,f=this._edgecode(r[0],r[1]),c&&f&&this._edge(e,c,f,r,r.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(e,t,n,r,i,a){for(;;){if(i===0&&a===0)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;l&8?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):l&4?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):l&2?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,r))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],i,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let l=0,u=o.length,c,f=this._edgecode(o[u-2],o[u-1]);l<u;l+=2)c=f,f=this._edgecode(o[l],o[l+1]),c&&f&&(l=this._edge(e,c,f,o,l),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,r,i){for(;t!==n;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(r[i]!==a||r[i+1]!==o)&&this.contains(e,a,o)&&(r.splice(i,0,a,o),i+=2)}if(r.length>4)for(let a=0;a<r.length;a+=2){const o=(a+2)%r.length,s=(a+4)%r.length;(r[a]===r[o]&&r[o]===r[s]||r[a+1]===r[o+1]&&r[o+1]===r[s+1])&&(r.splice(o,2),a-=2)}return i}_project(e,t,n,r){let i=Infinity,a,o,s;if(r<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/r)<i&&(s=this.ymin,o=e+(i=a)*n)}else if(r>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/r)<i&&(s=this.ymax,o=e+(i=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<i&&(o=this.xmax,s=t+(i=a)*r)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<i&&(o=this.xmin,s=t+(i=a)*r)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const Sre=2*Math.PI,vu=Math.pow;function Tre(e){return e[0]}function Are(e){return e[1]}function _re(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],a=2*t[r+1],o=2*t[r+2],s=(n[o]-n[i])*(n[a+1]-n[i+1])-(n[a]-n[i])*(n[o+1]-n[i+1]);if(s>1e-10)return!1}return!0}function Cre(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class c3{static from(e,t=Tre,n=Are,r){return new c3("length"in e?$re(e,t,n,r):Float64Array.from(Ore(e,t,n,r)))}constructor(e){this._delaunator=new ek(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&_re(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const s=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*s],t[2*s+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=t.length/2;f<d;++f){const h=Cre(t[2*f],t[2*f+1],c);t[2*f]=h[0],t[2*f+1]=h[1]}this._delaunator=new ek(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const u=i[s%3===2?s-2:s+1];(n[s]===-1||a[u]===-1)&&(a[u]=s)}for(let s=0,l=r.length;s<l;++s)o[r[s]]=s;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,r.length===2&&(a[r[1]]=0))}voronoi(e){return new Ere(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const c=o.indexOf(e);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const s=t[e];if(s===-1)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=i[l],l===-1){const c=n[(r[e]+1)%n.length];c!==u&&(yield c);return}}while(l!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(r[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=vu(t-l[e*2],2)+vu(n-l[e*2+1],2);const f=r[e];let d=f;do{let h=s[d];const p=vu(t-l[h*2],2)+vu(n-l[h*2+1],2);if(p<c&&(c=p,u=h),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],d===-1){if(d=i[(a[e]+1)%i.length],d!==h&&vu(t-l[d*2],2)+vu(n-l[d*2+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=e==null?e=new _s():void 0,{points:n,halfedges:r,triangles:i}=this;for(let a=0,o=r.length;a<o;++a){const s=r[a];if(s<a)continue;const l=i[a]*2,u=i[s]*2;e.moveTo(n[l],n[l+1]),e.lineTo(n[u],n[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=e==null?e=new _s():void 0,{points:r}=this;for(let i=0,a=r.length;i<a;i+=2){const o=r[i],s=r[i+1];e.moveTo(o+t,s),e.arc(o,s,t,0,Sre)}return n&&n.value()}renderHull(e){const t=e==null?e=new _s():void 0,{hull:n,points:r}=this,i=n[0]*2,a=n.length;e.moveTo(r[i],r[i+1]);for(let o=1;o<a;++o){const s=2*n[o];e.lineTo(r[s],r[s+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new rk();return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new _s():void 0,{points:r,triangles:i}=this,a=i[e*=3]*2,o=i[e+1]*2,s=i[e+2]*2;return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new rk();return this.renderTriangle(e,t),t.value()}}function $re(e,t,n,r){const i=e.length,a=new Float64Array(i*2);for(let o=0;o<i;++o){const s=e[o];a[o*2]=t.call(r,s,o,e),a[o*2+1]=n.call(r,s,o,e)}return a}function*Ore(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}function ik(e){F.call(this,null,e)}ik.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Mre=[-1e5,-1e5,1e5,1e5];q(ik,F,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Mre;const a=this.value=c3.from(r,e.x,e.y).voronoi(i);for(let o=0,s=r.length;o<s;++o){const l=a.cellPolygon(o);r[o][n]=l?Dre(l):null}return t.reflow(e.modified()).modifies(n)}});function Dre(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}var Nre=Object.freeze({__proto__:null,voronoi:ik}),ak=Math.PI/180,ed=1<<11>>5,cg=1<<11;function Rre(){var e=[256,256],t,n,r,i,a,o,s,l=f3,u=[],c=Math.random,f={};f.layout=function(){for(var p=d(Fl()),m=jre((e[0]>>5)*e[1]),g=null,y=u.length,v=-1,b=[],w=u.map(E=>({text:t(E),font:n(E),style:i(E),weight:a(E),rotate:o(E),size:~~(r(E)+1e-14),padding:s(E),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:E})).sort((E,k)=>k.size-E.size);++v<y;){var x=w[v];x.x=e[0]*(c()+.5)>>1,x.y=e[1]*(c()+.5)>>1,Fre(p,x,w,v),x.hasText&&h(m,x,g)&&(b.push(x),g?Lre(g,x):g=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return b};function d(p){p.width=p.height=1;var m=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(ed<<5)/m,p.height=cg/m;var g=p.getContext("2d");return g.fillStyle=g.strokeStyle="red",g.textAlign="center",{context:g,ratio:m}}function h(p,m,g){for(var y=m.x,v=m.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),w=l(e),x=c()<.5?1:-1,E=-x,k,S,A;(k=w(E+=x))&&!(S=~~k[0],A=~~k[1],Math.min(Math.abs(S),Math.abs(A))>=b);){if(m.x=y+S,m.y=v+A,m.x+m.x0<0||m.y+m.y0<0||m.x+m.x1>e[0]||m.y+m.y1>e[1])continue;if((!g||!Ire(m,p,e[0]))&&(!g||zre(m,g))){for(var C=m.sprite,_=m.width>>5,D=e[0]>>5,M=m.x-(_<<4),N=M&127,T=32-N,O=m.y1-m.y0,P=(m.y+m.y0)*D+(M>>5),W,B=0;B<O;B++){W=0;for(var se=0;se<=_;se++)p[P+se]|=W<<T|(se<_?(W=C[B*_+se])>>>N:0);P+=D}return m.sprite=null,!0}}return!1}return f.words=function(p){return arguments.length?(u=p,f):u},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=Cs(p),f):n},f.fontStyle=function(p){return arguments.length?(i=Cs(p),f):i},f.fontWeight=function(p){return arguments.length?(a=Cs(p),f):a},f.rotate=function(p){return arguments.length?(o=Cs(p),f):o},f.text=function(p){return arguments.length?(t=Cs(p),f):t},f.spiral=function(p){return arguments.length?(l=Ure[p]||p,f):l},f.fontSize=function(p){return arguments.length?(r=Cs(p),f):r},f.padding=function(p){return arguments.length?(s=Cs(p),f):s},f.random=function(p){return arguments.length?(c=p,f):c},f}function Fre(e,t,n,r){if(t.sprite)return;var i=e.context,a=e.ratio;i.clearRect(0,0,(ed<<5)/a,cg/a);var o=0,s=0,l=0,u=n.length,c,f,d,h,p;for(--r;++r<u;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=i.measureText(t.text+"m").width*a,d=t.size<<1,t.rotate){var m=Math.sin(t.rotate*ak),g=Math.cos(t.rotate*ak),y=c*g,v=c*m,b=d*g,w=d*m;c=Math.max(Math.abs(y+w),Math.abs(y-w))+31>>5<<5,d=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else c=c+31>>5<<5;if(d>l&&(l=d),o+c>=ed<<5&&(o=0,s+=l,l=0),s+d>=cg)break;i.translate((o+(c>>1))/a,(s+(d>>1))/a),t.rotate&&i.rotate(t.rotate*ak),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var x=i.getImageData(0,0,(ed<<5)/a,cg/a).data,E=[];--r>=0;){if(t=n[r],!t.hasText)continue;for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)E[h]=0;if(o=t.xoff,o==null)return;s=t.yoff;var k=0,S=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var A=f*p+(h>>5),C=x[(s+p)*(ed<<5)+(o+h)<<2]?1<<31-h%32:0;E[A]|=C,k|=C}k?S=p:(t.y0++,d--,p--,s++)}t.y1=t.y0+S,t.sprite=E.slice(0,(t.y1-t.y0)*f)}}function Ire(e,t,n){n>>=5;for(var r=e.sprite,i=e.width>>5,a=e.x-(i<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*n+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=i;d++)if((c<<s|(d<i?(c=r[f*i+d])>>>o:0))&t[u+d])return!0;u+=n}return!1}function Lre(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function zre(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function f3(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function Pre(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function jre(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Cs(e){return typeof e=="function"?e:function(){return e}}var Ure={archimedean:f3,rectangular:Pre};const d3=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Bre=["text","font","rotate","fontSize","fontStyle","fontWeight"];function ok(e){F.call(this,Rre(),e)}ok.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:d3}]},q(ok,F,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&L("Wordcloud size dimensions must be non-zero.");function n(p){const m=e[p];return le(m)&&t.modified(m.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||Bre.some(n)))return;const i=t.materialize(t.SOURCE).source,a=this.value,o=e.as||d3;let s=e.fontSize||14,l;if(le(s)?l=e.fontSizeRange:s=qt(s),l){const p=s,m=Ce("sqrt")().domain(ei(i,p)).range(l);s=g=>m(p(g))}i.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const u=a.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(lr).layout(),c=a.size(),f=c[0]>>1,d=c[1]>>1,h=u.length;for(let p=0,m,g;p<h;++p)m=u[p],g=m.datum,g[o[0]]=m.x+f,g[o[1]]=m.y+d,g[o[2]]=m.font,g[o[3]]=m.size,g[o[4]]=m.style,g[o[5]]=m.weight,g[o[6]]=m.rotate;return t.reflow(r).modifies(o)}});var qre=Object.freeze({__proto__:null,wordcloud:ok});function h3(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function p3(e){let t=e,n=e;e.length===1&&(t=(o,s)=>e(o)-s,n=Hre(e));function r(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)<0?l=c+1:u=c}return l}function i(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)>0?u=c:l=c+1}return l}function a(o,s,l,u){l==null&&(l=0),u==null&&(u=o.length);const c=r(o,s,l,u-1);return c>l&&t(o[c-1],s)>-t(o[c],s)?c-1:c}return{left:r,center:a,right:i}}function Hre(e){return(t,n)=>h3(e(t),n)}function Wre(e){return e===null?NaN:+e}const m3=p3(h3),Gre=m3.right,Yre=m3.left,Gwe=p3(Wre).center;function Vre(e,t){return Array.from(t,n=>e[n])}const Xre=e=>new Uint8Array(e),Jre=e=>new Uint16Array(e),td=e=>new Uint32Array(e);function Kre(){let e=8,t=[],n=td(0),r=fg(0,e),i=fg(0,e);return{data:()=>t,seen:()=>n=Qre(n,t.length),add(a){for(let o=0,s=t.length,l=a.length,u;o<l;++o)u=a[o],u._index=s++,t.push(u)},remove(a,o){const s=t.length,l=Array(s-a),u=t;let c,f,d;for(f=0;!o[f]&&f<s;++f)l[f]=t[f],u[f]=f;for(d=f;f<s;++f)c=t[f],o[f]?u[f]=-1:(u[f]=d,r[d]=r[f],i[d]=i[f],l[d]=c,c._index=d++),r[f]=0;return t=l,u},size:()=>t.length,curr:()=>r,prev:()=>i,reset:a=>i[a]=r[a],all:()=>e<257?255:e<65537?65535:4294967295,set(a,o){r[a]|=o},clear(a,o){r[a]&=~o},resize(a,o){const s=r.length;(a>s||o>e)&&(e=Math.max(o,e),r=fg(a,e,r),i=fg(a,e))}}}function Qre(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function fg(e,t,n){const r=(t<257?Xre:t<65537?Jre:td)(e);return n&&r.set(n),r}function g3(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,a){const o=this,s=o.bisect(o.range,i.value),l=i.index,u=s[0],c=s[1],f=l.length;let d;for(d=0;d<u;++d)a[l[d]]|=r;for(d=c;d<f;++d)a[l[d]]|=r;return o}}}function y3(){let e=td(0),t=[],n=0;function r(s,l,u){if(!l.length)return[];const c=n,f=l.length,d=td(f);let h=Array(f),p,m,g;for(g=0;g<f;++g)h[g]=s(l[g]),d[g]=g;if(h=Zre(h,d),c)p=t,m=e,t=Array(c+f),e=td(c+f),eie(u,p,m,c,h,d,f,t,e);else{if(u>0)for(g=0;g<f;++g)d[g]+=u;t=h,e=d}return n=c+f,{index:d,value:h}}function i(s,l){const u=n;let c,f,d;for(f=0;!l[e[f]]&&f<u;++f);for(d=f;f<u;++f)l[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=u-s}function a(s){for(let l=0,u=n;l<u;++l)e[l]=s[e[l]]}function o(s,l){let u;return l?u=l.length:(l=t,u=n),[Yre(l,s[0],0,u),Gre(l,s[1],0,u)]}return{insert:r,remove:i,bisect:o,reindex:a,index:()=>e,size:()=>n}}function Zre(e,t){return e.sort.call(t,(n,r)=>{const i=e[n],a=e[r];return i<a?-1:i>a?1:0}),Vre(e,t)}function eie(e,t,n,r,i,a,o,s,l){let u=0,c=0,f;for(f=0;u<r&&c<o;++f)t[u]<i[c]?(s[f]=t[u],l[f]=n[u++]):(s[f]=i[c],l[f]=a[c++]+e);for(;u<r;++u,++f)s[f]=t[u],l[f]=n[u];for(;c<o;++c,++f)s[f]=i[c],l[f]=a[c]+e}function sk(e){F.call(this,Kre(),e),this._indices=null,this._dims=null}sk.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},q(sk,F,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(r=>t.modified(r.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s=0,l,u;for(;s<o;++s)l=n[s].fname,u=i[l]||(i[l]=y3()),a.push(g3(u,s,r[s]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let m,g,y,v,b,w,x,E,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(w={},v=t.mod,x=0,E=v.length;x<E;++x)w[v[x]._index]=1;for(x=0;x<h;++x)k=r[x],(!o[x]||e.modified("fields",x)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(a[y]=g=y3(),p[y]=m=g.insert(k,t.source,0)),o[x]=g3(g,x,i[x]).onAdd(m,l));for(x=0,E=s.data().length;x<E;++x){if(b[x])continue;u[x]!==l[x]?f.push(x):w[x]&&l[x]!==c&&d.push(x)}return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,f=a.length;let d=i.size(),h,p,m;i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),v=i.all();for(h=0;h<f;++h)p=s[h].fname,m=l[p]||(l[p]=o[p].insert(s[h],r,d)),a[h].onAdd(m,g);for(;d<c;++d)y[d]=v,g[d]!==v&&u.push(d)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in r)r[h].remove(d,l);return this.reindex(t,d,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const a=i.remove(t,n);for(const o in r)r[o].reindex(a)})},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s=0,l,u;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(l=u,++s);if(s===1)s=r[l].one,this.incrementOne(r[l],i[l],n.add,n.rem);else for(u=0,s=0;u<o;++u){if(!e.modified("query",u))continue;s|=r[u].one,this.incrementAll(r[u],i[u],a,n.add),n.rem=n.add}return s},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],m=e.one;let g,y,v;if(f<h)for(g=f,y=Math.min(h,d);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(f>h)for(g=h,y=Math.min(f,p);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;if(d>p)for(g=Math.max(f,p),y=d;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(d<p)for(g=Math.max(h,d),y=p;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value,a=i.curr(),o=e.index(),s=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=s[0],d=s[1],h=e.one;let p,m,g;if(u<f)for(p=u,m=Math.min(f,c);p<m;++p)g=o[p],a[g]^=h,n.push(g);else if(u>f)for(p=f,m=Math.min(u,d);p<m;++p)g=o[p],a[g]^=h,r.push(g);if(c>d)for(p=Math.max(u,d),m=c;p<m;++p)g=o[p],a[g]^=h,n.push(g);else if(c<d)for(p=Math.max(f,c),m=d;p<m;++p)g=o[p],a[g]^=h,r.push(g);e.range=t.slice()}});function lk(e){F.call(this,null,e)}lk.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},q(lk,F,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if((i&n)===0)return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=c=>s[c]&n?null:o[c];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,c=>{const f=s[c]&n,d=!f&&f^l[c]&n;return d?o[c]:null}),a.filter(a.REM,c=>{const f=s[c]&n,d=f&&!(f^(f^l[c]&n));return d?o[c]:null})):(a.filter(a.ADD,u),a.filter(a.REM,c=>(s[c]&n)===i?o[c]:null)),a.filter(a.SOURCE,c=>u(c._index))}});var tie=Object.freeze({__proto__:null,crossfilter:sk,resolvefilter:lk}),nie=Math.sqrt(50),rie=Math.sqrt(10),iie=Math.sqrt(2);function aie(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=nie?i*=10:a>=rie?i*=5:a>=iie&&(i*=2),t<e?-i:i}const oie="RawCode",$s="Literal",sie="Property",lie="Identifier",uie="ArrayExpression",cie="BinaryExpression",v3="CallExpression",fie="ConditionalExpression",die="LogicalExpression",hie="MemberExpression",pie="ObjectExpression",mie="UnaryExpression";function Lr(e){this.type=e}Lr.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=gie(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function gie(e){switch(e.type){case uie:return e.elements;case cie:case die:return[e.left,e.right];case v3:return[e.callee].concat(e.arguments);case fie:return[e.test,e.consequent,e.alternate];case hie:return[e.object,e.property];case pie:return e.properties;case sie:return[e.key,e.value];case mie:return[e.argument];case lie:case $s:case oie:default:return[]}}var wi,ee,I,Kt,Ie,dg=1,nd=2,Os=3,ho=4,hg=5,Ms=6,Mn=7,rd=8,yie=9;wi={},wi[dg]="Boolean",wi[nd]="<end>",wi[Os]="Identifier",wi[ho]="Keyword",wi[hg]="Null",wi[Ms]="Numeric",wi[Mn]="Punctuator",wi[rd]="String",wi[yie]="RegularExpression";var vie="ArrayExpression",bie="BinaryExpression",wie="CallExpression",xie="ConditionalExpression",b3="Identifier",kie="Literal",Eie="LogicalExpression",Sie="MemberExpression",Tie="ObjectExpression",Aie="Property",_ie="UnaryExpression",Ct="Unexpected token %0",Cie="Unexpected number",$ie="Unexpected string",Oie="Unexpected identifier",Mie="Unexpected reserved word",Die="Unexpected end of input",uk="Invalid regular expression",ck="Invalid regular expression: missing /",w3="Octal literals are not allowed in strict mode.",Nie="Duplicate data property in object literal not allowed in strict mode",It="ILLEGAL",id="Disabled.",Rie=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Fie=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function pg(e,t){if(!e)throw new Error("ASSERT: "+t)}function ua(e){return e>=48&&e<=57}function fk(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function ad(e){return"01234567".indexOf(e)>=0}function Iie(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function od(e){return e===10||e===13||e===8232||e===8233}function sd(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Rie.test(String.fromCharCode(e))}function mg(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Fie.test(String.fromCharCode(e))}const Lie={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function x3(){for(;I<Kt;){const e=ee.charCodeAt(I);if(Iie(e)||od(e))++I;else break}}function dk(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)I<Kt&&fk(ee[I])?(r=ee[I++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):$e({},Ct,It);return String.fromCharCode(i)}function zie(){var e,t,n,r;for(e=ee[I],t=0,e==="}"&&$e({},Ct,It);I<Kt&&!(e=ee[I++],!fk(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&$e({},Ct,It),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function k3(){var e,t;for(e=ee.charCodeAt(I++),t=String.fromCharCode(e),e===92&&(ee.charCodeAt(I)!==117&&$e({},Ct,It),++I,e=dk("u"),(!e||e==="\\"||!sd(e.charCodeAt(0)))&&$e({},Ct,It),t=e);I<Kt&&!(e=ee.charCodeAt(I),!mg(e));)++I,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),ee.charCodeAt(I)!==117&&$e({},Ct,It),++I,e=dk("u"),(!e||e==="\\"||!mg(e.charCodeAt(0)))&&$e({},Ct,It),t+=e);return t}function Pie(){var e,t;for(e=I++;I<Kt;){if(t=ee.charCodeAt(I),t===92)return I=e,k3();if(mg(t))++I;else break}return ee.slice(e,I)}function jie(){var e,t,n;return e=I,t=ee.charCodeAt(I)===92?k3():Pie(),t.length===1?n=Os:Lie.hasOwnProperty(t)?n=ho:t==="null"?n=hg:t==="true"||t==="false"?n=dg:n=Os,{type:n,value:t,start:e,end:I}}function hk(){var e=I,t=ee.charCodeAt(I),n,r=ee[I],i,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++I,{type:Mn,value:String.fromCharCode(t),start:e,end:I};default:if(n=ee.charCodeAt(I+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return I+=2,{type:Mn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:I};case 33:case 61:return I+=2,ee.charCodeAt(I)===61&&++I,{type:Mn,value:ee.slice(e,I),start:e,end:I}}}if(o=ee.substr(I,4),o===">>>=")return I+=4,{type:Mn,value:o,start:e,end:I};if(a=o.substr(0,3),a===">>>"||a==="<<="||a===">>=")return I+=3,{type:Mn,value:a,start:e,end:I};if(i=a.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return I+=2,{type:Mn,value:i,start:e,end:I};if(i==="//"&&$e({},Ct,It),"<>=!+-*%&|^/".indexOf(r)>=0)return++I,{type:Mn,value:r,start:e,end:I};$e({},Ct,It)}function Uie(e){let t="";for(;I<Kt&&fk(ee[I]);)t+=ee[I++];return t.length===0&&$e({},Ct,It),sd(ee.charCodeAt(I))&&$e({},Ct,It),{type:Ms,value:parseInt("0x"+t,16),start:e,end:I}}function Bie(e){let t="0"+ee[I++];for(;I<Kt&&ad(ee[I]);)t+=ee[I++];return(sd(ee.charCodeAt(I))||ua(ee.charCodeAt(I)))&&$e({},Ct,It),{type:Ms,value:parseInt(t,8),octal:!0,start:e,end:I}}function E3(){var e,t,n;if(n=ee[I],pg(ua(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=I,e="",n!=="."){if(e=ee[I++],n=ee[I],e==="0"){if(n==="x"||n==="X")return++I,Uie(t);if(ad(n))return Bie(t);n&&ua(n.charCodeAt(0))&&$e({},Ct,It)}for(;ua(ee.charCodeAt(I));)e+=ee[I++];n=ee[I]}if(n==="."){for(e+=ee[I++];ua(ee.charCodeAt(I));)e+=ee[I++];n=ee[I]}if(n==="e"||n==="E")if(e+=ee[I++],n=ee[I],(n==="+"||n==="-")&&(e+=ee[I++]),ua(ee.charCodeAt(I)))for(;ua(ee.charCodeAt(I));)e+=ee[I++];else $e({},Ct,It);return sd(ee.charCodeAt(I))&&$e({},Ct,It),{type:Ms,value:parseFloat(e),start:t,end:I}}function qie(){var e="",t,n,r,i,a=!1;for(t=ee[I],pg(t==="'"||t==='"',"String literal must starts with a quote"),n=I,++I;I<Kt;)if(r=ee[I++],r===t){t="";break}else if(r==="\\")if(r=ee[I++],!r||!od(r.charCodeAt(0)))switch(r){case"u":case"x":ee[I]==="{"?(++I,e+=zie()):e+=dk(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:ad(r)?(i="01234567".indexOf(r),i!==0&&(a=!0),I<Kt&&ad(ee[I])&&(a=!0,i=i*8+"01234567".indexOf(ee[I++]),"0123".indexOf(r)>=0&&I<Kt&&ad(ee[I])&&(i=i*8+"01234567".indexOf(ee[I++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&ee[I]===`
`&&++I;else{if(od(r.charCodeAt(0)))break;e+=r}return t!==""&&$e({},Ct,It),{type:rd,value:e,octal:a,start:n,end:I}}function Hie(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";$e({},uk)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(r){$e({},uk)}try{return new RegExp(e,t)}catch(r){return null}}function Wie(){var e,t,n,r,i;for(e=ee[I],pg(e==="/","Regular expression literal must start with a slash"),t=ee[I++],n=!1,r=!1;I<Kt;)if(e=ee[I++],t+=e,e==="\\")e=ee[I++],od(e.charCodeAt(0))&&$e({},ck),t+=e;else if(od(e.charCodeAt(0)))$e({},ck);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||$e({},ck),i=t.substr(1,t.length-2),{value:i,literal:t}}function Gie(){var e,t,n;for(t="",n="";I<Kt&&!(e=ee[I],!mg(e.charCodeAt(0)));)++I,e==="\\"&&I<Kt?$e({},Ct,It):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&$e({},uk,n),{value:n,literal:t}}function Yie(){var e,t,n,r;return Ie=null,x3(),e=I,t=Wie(),n=Gie(),r=Hie(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:I}}function Vie(e){return e.type===Os||e.type===ho||e.type===dg||e.type===hg}function S3(){if(x3(),I>=Kt)return{type:nd,start:I,end:I};const e=ee.charCodeAt(I);return sd(e)?jie():e===40||e===41||e===59?hk():e===39||e===34?qie():e===46?ua(ee.charCodeAt(I+1))?E3():hk():ua(e)?E3():hk()}function Dn(){const e=Ie;return I=e.end,Ie=S3(),I=e.end,e}function T3(){const e=I;Ie=S3(),I=e}function Xie(e){const t=new Lr(vie);return t.elements=e,t}function A3(e,t,n){const r=new Lr(e==="||"||e==="&&"?Eie:bie);return r.operator=e,r.left=t,r.right=n,r}function Jie(e,t){const n=new Lr(wie);return n.callee=e,n.arguments=t,n}function Kie(e,t,n){const r=new Lr(xie);return r.test=e,r.consequent=t,r.alternate=n,r}function pk(e){const t=new Lr(b3);return t.name=e,t}function ld(e){const t=new Lr(kie);return t.value=e.value,t.raw=ee.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function _3(e,t,n){const r=new Lr(Sie);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function Qie(e){const t=new Lr(Tie);return t.properties=e,t}function C3(e,t,n){const r=new Lr(Aie);return r.key=t,r.value=n,r.kind=e,r}function Zie(e,t){const n=new Lr(_ie);return n.operator=e,n.argument=t,n.prefix=!0,n}function $e(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(a,o)=>(pg(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=I,n.description=i,n}function gg(e){e.type===nd&&$e(e,Die),e.type===Ms&&$e(e,Cie),e.type===rd&&$e(e,$ie),e.type===Os&&$e(e,Oie),e.type===ho&&$e(e,Mie),$e(e,Ct,e.value)}function Qt(e){const t=Dn();(t.type!==Mn||t.value!==e)&&gg(t)}function Ve(e){return Ie.type===Mn&&Ie.value===e}function mk(e){return Ie.type===ho&&Ie.value===e}function eae(){const e=[];for(I=Ie.start,Qt("[");!Ve("]");)Ve(",")?(Dn(),e.push(null)):(e.push(Ds()),Ve("]")||Qt(","));return Dn(),Xie(e)}function $3(){I=Ie.start;const e=Dn();return e.type===rd||e.type===Ms?(e.octal&&$e(e,w3),ld(e)):pk(e.value)}function tae(){var e,t,n,r;if(I=Ie.start,e=Ie,e.type===Os)return n=$3(),Qt(":"),r=Ds(),C3("init",n,r);if(e.type===nd||e.type===Mn)gg(e);else return t=$3(),Qt(":"),r=Ds(),C3("init",t,r)}function nae(){var e=[],t,n,r,i={},a=String;for(I=Ie.start,Qt("{");!Ve("}");)t=tae(),t.key.type===b3?n=t.key.name:n=a(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?$e({},Nie):i[r]=!0,e.push(t),Ve("}")||Qt(",");return Qt("}"),Qie(e)}function rae(){Qt("(");const e=gk();return Qt(")"),e}const iae={if:1};function aae(){var e,t,n;if(Ve("("))return rae();if(Ve("["))return eae();if(Ve("{"))return nae();if(e=Ie.type,I=Ie.start,e===Os||iae[Ie.value])n=pk(Dn().value);else if(e===rd||e===Ms)Ie.octal&&$e(Ie,w3),n=ld(Dn());else{if(e===ho)throw new Error(id);e===dg?(t=Dn(),t.value=t.value==="true",n=ld(t)):e===hg?(t=Dn(),t.value=null,n=ld(t)):Ve("/")||Ve("/=")?(n=ld(Yie()),T3()):gg(Dn())}return n}function oae(){const e=[];if(Qt("("),!Ve(")"))for(;I<Kt&&!(e.push(Ds()),Ve(")"));)Qt(",");return Qt(")"),e}function sae(){I=Ie.start;const e=Dn();return Vie(e)||gg(e),pk(e.value)}function lae(){return Qt("."),sae()}function uae(){Qt("[");const e=gk();return Qt("]"),e}function cae(){var e,t,n;for(e=aae();;)if(Ve("."))n=lae(),e=_3(".",e,n);else if(Ve("("))t=oae(),e=Jie(e,t);else if(Ve("["))n=uae(),e=_3("[",e,n);else break;return e}function O3(){const e=cae();if(Ie.type===Mn&&(Ve("++")||Ve("--")))throw new Error(id);return e}function yg(){var e,t;if(Ie.type!==Mn&&Ie.type!==ho)t=O3();else{if(Ve("++")||Ve("--"))throw new Error(id);if(Ve("+")||Ve("-")||Ve("~")||Ve("!"))e=Dn(),t=yg(),t=Zie(e.value,t);else{if(mk("delete")||mk("void")||mk("typeof"))throw new Error(id);t=O3()}}return t}function M3(e){let t=0;if(e.type!==Mn&&e.type!==ho)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function fae(){var e,t,n,r,i,a,o,s,l,u;if(e=Ie,l=yg(),r=Ie,i=M3(r),i===0)return l;for(r.prec=i,Dn(),t=[e,Ie],o=yg(),a=[l,r,o];(i=M3(Ie))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=A3(s,l,o),a.push(n);r=Dn(),r.prec=i,a.push(r),t.push(Ie),n=yg(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)t.pop(),n=A3(a[u-1].value,a[u-2],n),u-=2;return n}function Ds(){var e,t,n;return e=fae(),Ve("?")&&(Dn(),t=Ds(),Qt(":"),n=Ds(),e=Kie(e,t,n)),e}function gk(){const e=Ds();if(Ve(","))throw new Error(id);return e}function yk(e){ee=e,I=0,Kt=ee.length,Ie=null,T3();const t=gk();if(Ie.type!==nd)throw new Error("Unexpect token after expression.");return t}var D3={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function N3(e){function t(o,s,l,u){let c=e(s[0]);return l&&(c=l+"("+c+")",l.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(u<0?"":u===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(o,s,l){return u=>t(o,u,s,l)}const r="new Date",i="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&L("Missing arguments to clamp function."),o.length>3&&L("Too many arguments to clamp function.");const s=o.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:a,test:n("test",a),if:function(o){o.length<3&&L("Missing arguments to if function."),o.length>3&&L("Too many arguments to if function.");const s=o.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function dae(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function R3(e){e=e||{};const t=e.allowed?kt(e.allowed):{},n=e.forbidden?kt(e.forbidden):{},r=e.constants||D3,i=(e.functions||N3)(f),a=e.globalvar,o=e.fieldvar,s=le(a)?a:p=>"".concat(a,'["').concat(p,'"]');let l={},u={},c=0;function f(p){if(X(p))return p;const m=d[p.type];return m==null&&L("Unsupported type: "+p.type),m(p)}const d={Literal:p=>p.raw,Identifier:p=>{const m=p.name;return c>0?m:te(n,m)?L("Illegal identifier: "+m):te(r,m)?r[m]:te(t,m)?m:(l[m]=1,s(m))},MemberExpression:p=>{const m=!p.computed,g=f(p.object);m&&(c+=1);const y=f(p.property);return g===o&&(u[dae(y)]=1),m&&(c-=1),g+(m?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&L("Illegal callee type: "+p.callee.type);const m=p.callee.name,g=p.arguments,y=te(i,m)&&i[m];return y||L("Unrecognized function: "+m),le(y)?y(g):y+"("+g.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const m=f(p.key);return c-=1,m+":"+f(p.value)}};function h(p){const m={code:f(p),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},m}return h.functions=i,h.constants=r,h}class po{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,r,i,a=0;if(t>0){for(a=e[--t];t>0&&!(n=a,r=e[--t],a=n+r,i=r-(a-n),i););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(r=i*2,n=a+r,r==n-a&&(a=n))}return a}}function hae(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(i);++r<i;)a[r]=e+r*n;return a}var vg=1e-6,F3=1e-12,ud=Math.PI,I3=ud/2,L3=ud/4,z3=ud*2,cd=180/ud,Zt=ud/180,vk=Math.abs,bg=Math.atan2,cn=Math.cos,bk=Math.hypot,fn=Math.sin,P3=Math.sqrt;function wk(e){return e>1?I3:e<-1?-I3:Math.asin(e)}function fd(){}function wg(e,t){e&&U3.hasOwnProperty(e.type)&&U3[e.type](e,t)}var j3={Feature:function(e,t){wg(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)wg(n[r].geometry,t)}},U3={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){xk(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)xk(n[r],t,0)},Polygon:function(e,t){B3(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)B3(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)wg(n[r],t)}};function xk(e,t,n){var r=-1,i=e.length-n,a;for(t.lineStart();++r<i;)a=e[r],t.point(a[0],a[1],a[2]);t.lineEnd()}function B3(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)xk(e[n],t,1);t.polygonEnd()}function kk(e,t){e&&j3.hasOwnProperty(e.type)?j3[e.type](e,t):wg(e,t)}var xg=new po(),kg=new po(),q3,H3,Ek,Sk,Tk,xi={point:fd,lineStart:fd,lineEnd:fd,polygonStart:function(){xg=new po(),xi.lineStart=pae,xi.lineEnd=mae},polygonEnd:function(){var e=+xg;kg.add(e<0?z3+e:e),this.lineStart=this.lineEnd=this.point=fd},sphere:function(){kg.add(z3)}};function pae(){xi.point=gae}function mae(){W3(q3,H3)}function gae(e,t){xi.point=W3,q3=e,H3=t,e*=Zt,t*=Zt,Ek=e,Sk=cn(t=t/2+L3),Tk=fn(t)}function W3(e,t){e*=Zt,t*=Zt,t=t/2+L3;var n=e-Ek,r=n>=0?1:-1,i=r*n,a=cn(t),o=fn(t),s=Tk*o,l=Sk*a+s*cn(i),u=s*r*fn(i);xg.add(bg(u,l)),Ek=e,Sk=a,Tk=o}function yae(e){return kg=new po(),kk(e,xi),kg*2}function vae(e){return[bg(e[1],e[0]),wk(e[2])]}function bae(e){var t=e[0],n=e[1],r=cn(n);return[r*cn(t),r*fn(t),fn(n)]}function G3(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function wae(e){var t=P3(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ze,Nn,rt,Kn,Ns,Y3,V3,bu,dd,mo,ca,fa={point:Ak,lineStart:J3,lineEnd:K3,polygonStart:function(){fa.point=Q3,fa.lineStart=xae,fa.lineEnd=kae,dd=new po(),xi.polygonStart()},polygonEnd:function(){xi.polygonEnd(),fa.point=Ak,fa.lineStart=J3,fa.lineEnd=K3,xg<0?(Ze=-(rt=180),Nn=-(Kn=90)):dd>vg?Kn=90:dd<-vg&&(Nn=-90),ca[0]=Ze,ca[1]=rt},sphere:function(){Ze=-(rt=180),Nn=-(Kn=90)}};function Ak(e,t){mo.push(ca=[Ze=e,rt=e]),t<Nn&&(Nn=t),t>Kn&&(Kn=t)}function X3(e,t){var n=bae([e*Zt,t*Zt]);if(bu){var r=G3(bu,n),i=[r[1],-r[0],0],a=G3(i,r);wae(a),a=vae(a);var o=e-Ns,s=o>0?1:-1,l=a[0]*cd*s,u,c=vk(o)>180;c^(s*Ns<l&&l<s*e)?(u=a[1]*cd,u>Kn&&(Kn=u)):(l=(l+360)%360-180,c^(s*Ns<l&&l<s*e))?(u=-a[1]*cd,u<Nn&&(Nn=u)):(t<Nn&&(Nn=t),t>Kn&&(Kn=t)),c?e<Ns?Qn(Ze,e)>Qn(Ze,rt)&&(rt=e):Qn(e,rt)>Qn(Ze,rt)&&(Ze=e):rt>=Ze?(e<Ze&&(Ze=e),e>rt&&(rt=e)):e>Ns?Qn(Ze,e)>Qn(Ze,rt)&&(rt=e):Qn(e,rt)>Qn(Ze,rt)&&(Ze=e)}else mo.push(ca=[Ze=e,rt=e]);t<Nn&&(Nn=t),t>Kn&&(Kn=t),bu=n,Ns=e}function J3(){fa.point=X3}function K3(){ca[0]=Ze,ca[1]=rt,fa.point=Ak,bu=null}function Q3(e,t){if(bu){var n=e-Ns;dd.add(vk(n)>180?n+(n>0?360:-360):n)}else Y3=e,V3=t;xi.point(e,t),X3(e,t)}function xae(){xi.lineStart()}function kae(){Q3(Y3,V3),xi.lineEnd(),vk(dd)>vg&&(Ze=-(rt=180)),ca[0]=Ze,ca[1]=rt,bu=null}function Qn(e,t){return(t-=e)<0?t+360:t}function Eae(e,t){return e[0]-t[0]}function Z3(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Sae(e){var t,n,r,i,a,o,s;if(Kn=rt=-(Ze=Nn=Infinity),mo=[],kk(e,fa),n=mo.length){for(mo.sort(Eae),t=1,r=mo[0],a=[r];t<n;++t)i=mo[t],Z3(r,i[0])||Z3(r,i[1])?(Qn(r[0],i[1])>Qn(r[0],r[1])&&(r[1]=i[1]),Qn(i[0],r[1])>Qn(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-Infinity,n=a.length-1,t=0,r=a[n];t<=n;r=i,++t)i=a[t],(s=Qn(r[1],i[0]))>o&&(o=s,Ze=i[0],rt=r[1])}return mo=ca=null,Ze===Infinity||Nn===Infinity?[[NaN,NaN],[NaN,NaN]]:[[Ze,Nn],[rt,Kn]]}var hd,Eg,Sg,Tg,Ag,_g,Cg,$g,_k,Ck,$k,e5,t5,dn,hn,pn,zr={sphere:fd,point:Ok,lineStart:n5,lineEnd:r5,polygonStart:function(){zr.lineStart=_ae,zr.lineEnd=Cae},polygonEnd:function(){zr.lineStart=n5,zr.lineEnd=r5}};function Ok(e,t){e*=Zt,t*=Zt;var n=cn(t);pd(n*cn(e),n*fn(e),fn(t))}function pd(e,t,n){++hd,Sg+=(e-Sg)/hd,Tg+=(t-Tg)/hd,Ag+=(n-Ag)/hd}function n5(){zr.point=Tae}function Tae(e,t){e*=Zt,t*=Zt;var n=cn(t);dn=n*cn(e),hn=n*fn(e),pn=fn(t),zr.point=Aae,pd(dn,hn,pn)}function Aae(e,t){e*=Zt,t*=Zt;var n=cn(t),r=n*cn(e),i=n*fn(e),a=fn(t),o=bg(P3((o=hn*a-pn*i)*o+(o=pn*r-dn*a)*o+(o=dn*i-hn*r)*o),dn*r+hn*i+pn*a);Eg+=o,_g+=o*(dn+(dn=r)),Cg+=o*(hn+(hn=i)),$g+=o*(pn+(pn=a)),pd(dn,hn,pn)}function r5(){zr.point=Ok}function _ae(){zr.point=$ae}function Cae(){i5(e5,t5),zr.point=Ok}function $ae(e,t){e5=e,t5=t,e*=Zt,t*=Zt,zr.point=i5;var n=cn(t);dn=n*cn(e),hn=n*fn(e),pn=fn(t),pd(dn,hn,pn)}function i5(e,t){e*=Zt,t*=Zt;var n=cn(t),r=n*cn(e),i=n*fn(e),a=fn(t),o=hn*a-pn*i,s=pn*r-dn*a,l=dn*i-hn*r,u=bk(o,s,l),c=wk(u),f=u&&-c/u;_k.add(f*o),Ck.add(f*s),$k.add(f*l),Eg+=c,_g+=c*(dn+(dn=r)),Cg+=c*(hn+(hn=i)),$g+=c*(pn+(pn=a)),pd(dn,hn,pn)}function Oae(e){hd=Eg=Sg=Tg=Ag=_g=Cg=$g=0,_k=new po(),Ck=new po(),$k=new po(),kk(e,zr);var t=+_k,n=+Ck,r=+$k,i=bk(t,n,r);return i<F3&&(t=_g,n=Cg,r=$g,Eg<vg&&(t=Sg,n=Tg,r=Ag),i=bk(t,n,r),i<F3)?[NaN,NaN]:[bg(n,t)*cd,wk(r/i)*cd]}function md(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Og(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Rs(){}var gd=.7,Mg=1/gd,wu="\\s*([+-]?\\d+)\\s*",yd="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ki="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Mae=/^#([0-9a-f]{3,8})$/,Dae=new RegExp("^rgb\\("+[wu,wu,wu]+"\\)$"),Nae=new RegExp("^rgb\\("+[ki,ki,ki]+"\\)$"),Rae=new RegExp("^rgba\\("+[wu,wu,wu,yd]+"\\)$"),Fae=new RegExp("^rgba\\("+[ki,ki,ki,yd]+"\\)$"),Iae=new RegExp("^hsl\\("+[yd,ki,ki]+"\\)$"),Lae=new RegExp("^hsla\\("+[yd,ki,ki,yd]+"\\)$"),a5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};md(Rs,Mk,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:o5,formatHex:o5,formatHsl:zae,formatRgb:s5,toString:s5});function o5(){return this.rgb().formatHex()}function zae(){return h5(this).formatHsl()}function s5(){return this.rgb().formatRgb()}function Mk(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Mae.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?l5(t):n===3?new mn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Dg(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Dg(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Dae.exec(e))?new mn(t[1],t[2],t[3],1):(t=Nae.exec(e))?new mn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Rae.exec(e))?Dg(t[1],t[2],t[3],t[4]):(t=Fae.exec(e))?Dg(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Iae.exec(e))?d5(t[1],t[2]/100,t[3]/100,1):(t=Lae.exec(e))?d5(t[1],t[2]/100,t[3]/100,t[4]):a5.hasOwnProperty(e)?l5(a5[e]):e==="transparent"?new mn(NaN,NaN,NaN,0):null}function l5(e){return new mn(e>>16&255,e>>8&255,e&255,1)}function Dg(e,t,n,r){return r<=0&&(e=t=n=NaN),new mn(e,t,n,r)}function u5(e){return e instanceof Rs||(e=Mk(e)),e?(e=e.rgb(),new mn(e.r,e.g,e.b,e.opacity)):new mn()}function Dk(e,t,n,r){return arguments.length===1?u5(e):new mn(e,t,n,r??1)}function mn(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}md(mn,Dk,Og(Rs,{brighter:function(e){return e=e==null?Mg:Math.pow(Mg,e),new mn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?gd:Math.pow(gd,e),new mn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:c5,formatHex:c5,formatRgb:f5,toString:f5}));function c5(){return"#"+Nk(this.r)+Nk(this.g)+Nk(this.b)}function f5(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Nk(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function d5(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ei(e,t,n,r)}function h5(e){if(e instanceof Ei)return new Ei(e.h,e.s,e.l,e.opacity);if(e instanceof Rs||(e=Mk(e)),!e)return new Ei();if(e instanceof Ei)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(n-r)/s+(n<r)*6:n===a?o=(r-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Ei(o,s,l,e.opacity)}function p5(e,t,n,r){return arguments.length===1?h5(e):new Ei(e,t,n,r??1)}function Ei(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}md(Ei,p5,Og(Rs,{brighter:function(e){return e=e==null?Mg:Math.pow(Mg,e),new Ei(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?gd:Math.pow(gd,e),new Ei(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new mn(Rk(e>=240?e-240:e+120,i,r),Rk(e,i,r),Rk(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Rk(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Pae=Math.PI/180,jae=180/Math.PI,Ng=18,m5=.96422,g5=1,y5=.82521,v5=4/29,xu=6/29,b5=3*xu*xu,Uae=xu*xu*xu;function w5(e){if(e instanceof Si)return new Si(e.l,e.a,e.b,e.opacity);if(e instanceof da)return E5(e);e instanceof mn||(e=u5(e));var t=zk(e.r),n=zk(e.g),r=zk(e.b),i=Fk((.2225045*t+.7168786*n+.0606169*r)/g5),a,o;return t===n&&n===r?a=o=i:(a=Fk((.4360747*t+.3850649*n+.1430804*r)/m5),o=Fk((.0139322*t+.0971045*n+.7141733*r)/y5)),new Si(116*i-16,500*(a-i),200*(i-o),e.opacity)}function x5(e,t,n,r){return arguments.length===1?w5(e):new Si(e,t,n,r??1)}function Si(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}md(Si,x5,Og(Rs,{brighter:function(e){return new Si(this.l+Ng*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Si(this.l-Ng*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=m5*Ik(t),e=g5*Ik(e),n=y5*Ik(n),new mn(Lk(3.1338561*t-1.6168667*e-.4906146*n),Lk(-.9787684*t+1.9161415*e+.033454*n),Lk(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Fk(e){return e>Uae?Math.pow(e,1/3):e/b5+v5}function Ik(e){return e>xu?e*e*e:b5*(e-v5)}function Lk(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function zk(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Bae(e){if(e instanceof da)return new da(e.h,e.c,e.l,e.opacity);if(e instanceof Si||(e=w5(e)),e.a===0&&e.b===0)return new da(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*jae;return new da(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function k5(e,t,n,r){return arguments.length===1?Bae(e):new da(e,t,n,r??1)}function da(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function E5(e){if(isNaN(e.h))return new Si(e.l,0,0,e.opacity);var t=e.h*Pae;return new Si(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}md(da,k5,Og(Rs,{brighter:function(e){return new da(this.h,this.c,this.l+Ng*(e??1),this.opacity)},darker:function(e){return new da(this.h,this.c,this.l-Ng*(e??1),this.opacity)},rgb:function(){return E5(this).rgb()}}));function qae(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Hae(e){let t=e,n=e;e.length===1&&(t=(o,s)=>e(o)-s,n=Wae(e));function r(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)<0?l=c+1:u=c}return l}function i(o,s,l,u){for(l==null&&(l=0),u==null&&(u=o.length);l<u;){const c=l+u>>>1;n(o[c],s)>0?u=c:l=c+1}return l}function a(o,s,l,u){l==null&&(l=0),u==null&&(u=o.length);const c=r(o,s,l,u-1);return c>l&&t(o[c-1],s)>-t(o[c],s)?c-1:c}return{left:r,center:a,right:i}}function Wae(e){return(t,n)=>qae(e(t),n)}const Pk="intersect",S5="union",Gae="vlMulti",Yae="vlPoint",T5="or",Vae="and",Xae="_vgsid_",Jae="E",Kae="R",Qae="R-E",Zae="R-LE",eoe="R-RE",Rg="index:unit";function A5(e,t){for(var n=t.fields,r=t.values,i=n.length,a=0,o,s;a<i;++a)if(s=n[a],s.getter=Sn.getter||Sn(s.field),o=s.getter(e),Ia(o)&&(o=Bt(o)),Ia(r[a])&&(r[a]=Bt(r[a])),Ia(r[a][0])&&(r[a]=r[a].map(Bt)),s.type===Jae){if(z(r[a])?r[a].indexOf(o)<0:o!==r[a])return!1}else if(s.type===Kae){if(!xl(o,r[a]))return!1}else if(s.type===eoe){if(!xl(o,r[a],!0,!1))return!1}else if(s.type===Qae){if(!xl(o,r[a],!1,!1))return!1}else if(s.type===Zae&&!xl(o,r[a],!1,!0))return!1;return!0}function toe(e,t,n){for(var r=this.context.data[e],i=r?r.values.value:[],a=r?r[Rg]&&r[Rg].value:void 0,o=n===Pk,s=i.length,l=0,u,c,f,d,h;l<s;++l)if(u=i[l],a&&o){if(c=c||{},f=c[d=u.unit]||0,f===-1)continue;if(h=A5(t,u),c[d]=h?-1:++f,h&&a.size===1)return!0;if(!h&&f===a.get(d).count)return!1}else if(h=A5(t,u),o^h)return h;return s&&o}const jk=Sn(Xae),_5=Hae(jk),noe=_5.left,roe=_5.right;function ioe(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],a=r?r[Rg]&&r[Rg].value:void 0,o=n===Pk,s=jk(t),l=noe(i,s);if(l===i.length)return!1;if(jk(i[l])!==s)return!1;if(a&&o){if(a.size===1)return!0;if(roe(i,s)-l<a.size)return!1}return!0}function aoe(e,t){return e.map(n=>ue({values:t.fields.map(r=>(r.getter||(r.getter=Sn(r.field)))(n.datum))},t))}function ooe(e,t,n,r){for(var i=this.context.data[e],a=i?i.values.value:[],o={},s={},l={},u,c,f,d,h,p,m,g,y,v=a.length,b=0,w,x;b<v;++b){for(u=a[b],d=u.unit,c=u.fields,f=u.values,w=0,x=c.length;w<x;++w)h=c[w],p=o[h.field]||(o[h.field]={}),m=p[d]||(p[d]=[]),l[h.field]=g=h.type.charAt(0),y=C5[g+"_union"],p[d]=y(m,J(f[w]));n&&(m=s[d]||(s[d]=[]),m.push(J(f).reduce((E,k,S)=>(E[c[S].field]=k,E),{})))}if(t=t||S5,Object.keys(o).forEach(E=>{o[E]=Object.keys(o[E]).map(k=>o[E][k]).reduce((k,S)=>k===void 0?S:C5[l[E]+"_"+t](k,S))}),a=Object.keys(s),n&&a.length){const E=r?Yae:Gae;o[E]=t===S5?{[T5]:a.reduce((k,S)=>(k.push(...s[S]),k),[])}:{[Vae]:a.map(k=>({[T5]:s[k]}))}}return o}var C5={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Bt(t[0]),r=Bt(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Bt(t[0]),r=Bt(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const soe=":",loe="@";function Uk(e,t,n,r){t[0].type!==$s&&L("First argument to selection functions must be a string literal.");const i=t[0].value,a=t.length>=2&&ve(t).value,o="unit",s=loe+o,l=soe+i;a===Pk&&!te(r,s)&&(r[s]=n.getData(i).indataRef(n,o)),te(r,l)||(r[l]=n.getData(i).tuplesRef())}function $5(e){const t=this.context.data[e];return t?t.values.value:[]}function uoe(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count}function coe(e,t){const n=this.context.dataflow,r=this.context.data[e],i=r.input;return n.pulse(i,n.changeset().remove(or).insert(t)),1}function foe(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e}const vd=e=>function(t,n){const r=this.context.dataflow.locale();return r[e](n)(t)},doe=vd("format"),O5=vd("timeFormat"),hoe=vd("utcFormat"),poe=vd("timeParse"),moe=vd("utcParse"),Fg=new Date(2e3,0,1);function Ig(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Fg.setYear(2e3),Fg.setMonth(e),Fg.setDate(t),O5.call(this,Fg,n))}function goe(e){return Ig.call(this,e,1,"%B")}function yoe(e){return Ig.call(this,e,1,"%b")}function voe(e){return Ig.call(this,0,2+e,"%A")}function boe(e){return Ig.call(this,0,2+e,"%a")}const woe=":",xoe="@",Bk="%",M5="$";function qk(e,t,n,r){t[0].type!==$s&&L("First argument to data functions must be a string literal.");const i=t[0].value,a=woe+i;if(!te(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(o){}}function koe(e,t,n,r){t[0].type!==$s&&L("First argument to indata must be a string literal."),t[1].type!==$s&&L("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o=xoe+a;te(o,r)||(r[o]=n.getData(i).indataRef(n,a))}function Rn(e,t,n,r){if(t[0].type===$s)D5(n,r,t[0].value);else for(e in n.scales)D5(n,r,e)}function D5(e,t,n){const r=Bk+n;if(!te(t,r))try{t[r]=e.scaleRef(n)}catch(i){}}function ha(e,t){let n;return le(e)?e:X(e)?(n=t.scales[e])&&n.value:void 0}function Eoe(e,t,n){t.__bandwidth=i=>i&&i.bandwidth?i.bandwidth():0,n._bandwidth=Rn,n._range=Rn,n._scale=Rn;const r=i=>"_["+(i.type===$s?H(Bk+i.value):H(Bk)+"+"+e(i))+"]";return{_bandwidth:i=>"this.__bandwidth(".concat(r(i[0]),")"),_range:i=>"".concat(r(i[0]),".range()"),_scale:i=>"".concat(r(i[0]),"(").concat(e(i[1]),")")}}function Hk(e,t){return function(n,r,i){if(n){const a=ha(n,(i||this).context);return a&&a.path[e](r)}else return t(r)}}const Soe=Hk("area",yae),Toe=Hk("bounds",Sae),Aoe=Hk("centroid",Oae);function _oe(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Wk(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function Coe(){return Wk(this.context.dataflow,"warn",arguments)}function $oe(){return Wk(this.context.dataflow,"info",arguments)}function Ooe(){return Wk(this.context.dataflow,"debug",arguments)}function Gk(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Yk(e){const t=Dk(e),n=Gk(t.r),r=Gk(t.g),i=Gk(t.b);return .2126*n+.7152*r+.0722*i}function Moe(e,t){const n=Yk(e),r=Yk(t),i=Math.max(n,r),a=Math.min(n,r);return(i+.05)/(a+.05)}function Doe(){const e=[].slice.call(arguments);return e.unshift({}),ue(...e)}function N5(e,t){return e===t||e!==e&&t!==t?!0:z(e)?z(t)&&e.length===t.length?Noe(e,t):!1:Q(e)&&Q(t)?R5(e,t):!1}function Noe(e,t){for(let n=0,r=e.length;n<r;++n)if(!N5(e[n],t[n]))return!1;return!0}function R5(e,t){for(const n in e)if(!N5(e[n],t[n]))return!1;return!0}function F5(e){return t=>R5(e,t)}function Roe(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c=s.changes,f,d;if(o._trigger===!1||!(l.value.length||t||r))return 0;if((!c||c.stamp<u)&&(s.changes=c=o.changeset(),c.stamp=u,o.runAfter(()=>{s.modified=!0,o.pulse(l,c).run()},!0,1)),n&&(f=n===!0?or:z(n)||Gh(n)?n:F5(n),c.remove(f)),t&&c.insert(t),r&&(f=F5(r),l.value.some(f)?c.remove(f):c.insert(r)),i)for(d in a)c.modify(i,d,a[d]);return 1}function Foe(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function Ioe(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const I5={};function Loe(e,t){const n=I5[t]||(I5[t]=Sn(t));return z(e)?e.map(n):n(e)}function Vk(e){return z(e)||ArrayBuffer.isView(e)?e:null}function Xk(e){return Vk(e)||(X(e)?e:null)}function zoe(e,...t){return Vk(e).join(...t)}function Poe(e,...t){return Xk(e).indexOf(...t)}function joe(e,...t){return Xk(e).lastIndexOf(...t)}function Uoe(e,...t){return Xk(e).slice(...t)}function Boe(e,t,n){return le(n)&&L("Function argument passed to replace."),String(e).replace(t,n)}function qoe(e){return Vk(e).slice().reverse()}function Hoe(e,t,n){return B1(e||0,t||0,n||0)}function Woe(e,t){const n=ha(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function Goe(e,t){const n=ha(e,(t||this).context);return n?n.copy():void 0}function Yoe(e,t){const n=ha(e,(t||this).context);return n?n.domain():[]}function Voe(e,t,n){const r=ha(e,(n||this).context);return r?z(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}function Xoe(e,t){const n=ha(e,(t||this).context);return n&&n.range?n.range():[]}function Joe(e,t,n){const r=ha(e,(n||this).context);return r?r(t):void 0}function Koe(e,t,n,r,i){e=ha(e,(i||this).context);const a=SD(t,n);let o=e.domain(),s=o[0],l=ve(o),u=Ut;return l-s?u=uD(e,s,l):e=(e.interpolator?Ce("sequential")().interpolator(e.interpolator()):Ce("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==ve(o)&&o.push(l)),o.forEach(c=>a.stop(u(c),e(c))),a}function Qoe(e,t,n){const r=ha(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}}function Zoe(e){let t=null;return function(n){return n?tf(n,t=t||Yl(e)):e}}const L5=e=>e.data;function z5(e,t){const n=$5.call(t,e);return n.root&&n.root.lookup||{}}function ese(e,t,n){const r=z5(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(L5):void 0}function tse(e,t){const n=z5(e,this)[t];return n?n.ancestors().map(L5):void 0}const P5=()=>typeof window!="undefined"&&window||null;function nse(){const e=P5();return e?e.screen:{}}function rse(){const e=P5();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function ise(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function ase(e,t,n){if(!e)return[];const[r,i]=e,a=new mt().set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return zN(o,a,ose(t))}function ose(e){let t=null;if(e){const n=J(e.marktype),r=J(e.markname);t=i=>(!n.length||n.some(a=>i.marktype===a))&&(!r.length||r.some(a=>i.name===a))}return t}const bd={random(){return lr()},cumulativeNormal:ep,cumulativeLogNormal:Kv,cumulativeUniform:tb,densityNormal:Gv,densityLogNormal:Jv,densityUniform:eb,quantileNormal:tp,quantileLogNormal:Qv,quantileUniform:nb,sampleNormal:Zh,sampleLogNormal:Xv,sampleUniform:Zv,isArray:z,isBoolean:Fa,isDate:Ia,isDefined(e){return e!==void 0},isNumber:Le,isObject:Q,isRegExp:n_,isString:X,isTuple:Gh,isValid(e){return e!=null&&e===e},toBoolean:nv,toDate:rv,toNumber:Bt,toString:iv,indexof:Poe,join:zoe,lastindexof:joe,replace:Boe,reverse:qoe,slice:Uoe,flush:e_,lerp:r_,merge:Doe,pad:o_,peek:ve,pluck:Loe,span:fc,inrange:xl,truncate:s_,rgb:Dk,lab:x5,hcl:k5,hsl:p5,luminance:Yk,contrast:Moe,sequence:hae,format:doe,utcFormat:hoe,utcParse:moe,utcOffset:J_,utcSequence:Z_,timeFormat:O5,timeParse:poe,timeOffset:X_,timeSequence:Q_,timeUnitSpecifier:z_,monthFormat:goe,monthAbbrevFormat:yoe,dayFormat:voe,dayAbbrevFormat:boe,quarter:JA,utcquarter:KA,week:j_,utcweek:q_,dayofyear:P_,utcdayofyear:B_,warn:Coe,info:$oe,debug:Ooe,extent:ei,inScope:_oe,intersect:ase,clampRange:QA,pinchDistance:Foe,pinchAngle:Ioe,screen:nse,containerSize:ise,windowSize:rse,bandspace:Hoe,setdata:coe,pathShape:Zoe,panLinear:GA,panLog:YA,panPow:VA,panSymlog:XA,zoomLinear:Jy,zoomLog:Ky,zoomPow:Mh,zoomSymlog:Qy,encode:foe,modify:Roe},sse=["view","item","group","xy","x","y"],lse="event.vega.",j5="this.",Jk={},U5={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(H(M5+e),"]"),functions:use,constants:D3,visitors:Jk},Kk=R3(U5);function use(e){const t=N3(e);sse.forEach(n=>t[n]=lse+n);for(const n in bd)t[n]=j5+n;return ue(t,Eoe(e,bd,Jk)),t}function ct(e,t,n){return arguments.length===1?bd[e]:(bd[e]=t,n&&(Jk[e]=n),Kk&&(Kk.functions[e]=j5+e),this)}ct("bandwidth",Woe,Rn),ct("copy",Goe,Rn),ct("domain",Yoe,Rn),ct("range",Xoe,Rn),ct("invert",Voe,Rn),ct("scale",Joe,Rn),ct("gradient",Koe,Rn),ct("geoArea",Soe,Rn),ct("geoBounds",Toe,Rn),ct("geoCentroid",Aoe,Rn),ct("geoShape",Qoe,Rn),ct("indata",uoe,koe),ct("data",$5,qk),ct("treePath",ese,qk),ct("treeAncestors",tse,qk),ct("vlSelectionTest",toe,Uk),ct("vlSelectionIdTest",ioe,Uk),ct("vlSelectionResolve",ooe,Uk),ct("vlSelectionTuples",aoe);function Ti(e,t){const n={};let r;try{e=X(e)?e:H(e)+"",r=yk(e)}catch(a){L("Expression parse error: "+e)}r.visit(a=>{if(a.type!==v3)return;const o=a.callee.name,s=U5.visitors[o];s&&s(o,a.arguments,t,n)});const i=Kk(r);return i.globals.forEach(a=>{const o=M5+a;!te(n,o)&&t.getSignal(a)&&(n[o]=t.signalRef(a))}),{$expr:ue({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function cse(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()}const fse=kt(["rule"]),B5=kt(["group","image","rect"]);function dse(e,t){let n="";return fse[t]||(e.x2&&(e.x?(B5[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(B5[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Qk(e){return(e+"").toLowerCase()}function hse(e){return Qk(e)==="operator"}function pse(e){return Qk(e)==="collect"}function wd(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}function mse(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,`
  : (u > v || v == null) && u != null ? `).concat(r,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(n,`
  : v !== v && u === u ? `).concat(r," : ")}var gse={operator:(e,t)=>wd(e,["_"],t.code),parameter:(e,t)=>wd(e,["datum","_"],t.code),event:(e,t)=>wd(e,["event"],t.code),handler:(e,t)=>{const n="var datum=event.item&&event.item.datum;return ".concat(t.code,";");return wd(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const a in r){const o="o["+H(a)+"]";i+="$=".concat(r[a].code,";if(").concat(o,"!==$)").concat(o,"=$,m=1;")}return i+=dse(r,n),i+="return m;",wd(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(H).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=(a,o)=>{const s=t[o];let l,u;return a.path?(l="a".concat(a.path),u="b".concat(a.path)):((n=n||{})["f"+o]=a,l="this.f".concat(o,"(a)"),u="this.f".concat(o,"(b)")),mse(l,u,-s,s)},i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function yse(e){const t=this;hse(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function vse(e){const t=this;if(e.params){const n=t.get(e.id);n||L("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function bse(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=z(i)?i.map(a=>q5(a,n,t)):q5(i,n,t)}return t}function q5(e,t,n){if(!e||!Q(e))return e;for(let r=0,i=H5.length,a;r<i;++r)if(a=H5[r],te(e,a.key))return a.parse(e,t,n);return e}var H5=[{key:"$ref",parse:wse},{key:"$key",parse:kse},{key:"$expr",parse:xse},{key:"$field",parse:Ese},{key:"$encode",parse:Tse},{key:"$compare",parse:Sse},{key:"$context",parse:Ase},{key:"$subflow",parse:_se},{key:"$tupleid",parse:Cse}];function wse(e,t){return t.get(e.$ref)||L("Operator not defined: "+e.$ref)}function xse(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=En(t.parameterExpression(e.$expr),e.$fields,e.$name))}function kse(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=tv(e.$key,e.$flat,t.expr.codegen))}function Ese(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Sn(e.$field,e.$name,t.expr.codegen))}function Sse(e,t){const n="c:"+e.$compare+"_"+e.$order,r=J(e.$compare).map(i=>i&&i.$tupleid?ne:i);return t.fn[n]||(t.fn[n]=Zy(r,e.$order,t.expr.codegen))}function Tse(e,t){const n=e.$encode,r={};for(const i in n){const a=n[i];r[i]=En(t.encodeExpression(a.$expr),a.$fields),r[i].output=a.$output}return r}function Ase(e,t){return t}function _se(e,t){const n=e.$subflow;return function(r,i,a){const o=t.fork().parse(n),s=o.get(n.operators[0].id),l=o.signals.parent;return l&&l.set(a),s.detachSubflow=()=>t.detach(o),s}}function Cse(){return ne}function $se(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,r=e.stream!=null?t.get(e.stream):void 0,i;e.source?r=t.events(e.source,e.type,n):e.merge&&(i=e.merge.map(a=>t.get(a)),r=i[0].merge.apply(i[0],i.slice(1))),e.between&&(i=e.between.map(a=>t.get(a)),r=r.between(i[0],i[1])),e.filter&&(r=r.filter(n)),e.throttle!=null&&(r=r.throttle(+e.throttle)),e.debounce!=null&&(r=r.debounce(+e.debounce)),r==null&&L("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),t.stream(e,r)}function Ose(e){var t=this,n=Q(n=e.source)?n.$ref:n,r=t.get(n),i=null,a=e.update,o=void 0;r||L("Source not defined: "+e.source),i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(o=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,r,i,a,o)}const Mse={skip:!0};function Dse(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(a=>{const o=t.signals[a];e.signals(a,o)&&(r[a]=o.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(a=>{const o=t.data[a];e.data(a,o)&&(i[a]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n}function Nse(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(a=>{n.update(t.signals[a],i[a],Mse)}),Object.keys(r||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(or).insert(r[a]))}),(e.subcontext||[]).forEach((a,o)=>{const s=t.subcontext[o];s&&s.setState(a)})}function W5(e,t,n,r){return new G5(e,t,n,r)}function G5(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||gse,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function Y5(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}G5.prototype=Y5.prototype={fork(){const e=new Y5(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),pse(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let a=n.get(e.parent.$ref);a?(r.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),r.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const a in e.data){const o=n.data[a]||(n.data[a]={});e.data[a].forEach(s=>o[s]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Qk(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:cse,parseOperator:yse,parseOperatorParameters:vse,parseParameters:bse,parseStream:$se,parseUpdate:Ose,getState:Dse,setState:Nse};var ku=0,xd=0,kd=0,V5=1e3,Lg,Ed,zg=0,Fs=0,Pg=0,Sd=typeof performance=="object"&&performance.now?performance:Date,X5=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Zk(){return Fs||(X5(Rse),Fs=Sd.now()+Pg)}function Rse(){Fs=0}function jg(){this._call=this._time=this._next=null}jg.prototype=Fse.prototype={constructor:jg,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Zk():+n)+(t==null?0:+t),!this._next&&Ed!==this&&(Ed?Ed._next=this:Lg=this,Ed=this),this._call=e,this._time=n,eE()},stop:function(){this._call&&(this._call=null,this._time=Infinity,eE())}};function Fse(e,t,n){var r=new jg();return r.restart(e,t,n),r}function Ise(){Zk(),++ku;for(var e=Lg,t;e;)(t=Fs-e._time)>=0&&e._call.call(null,t),e=e._next;--ku}function J5(){Fs=(zg=Sd.now())+Pg,ku=xd=0;try{Ise()}finally{ku=0,zse(),Fs=0}}function Lse(){var e=Sd.now(),t=e-zg;t>V5&&(Pg-=t,zg=e)}function zse(){for(var e,t=Lg,n,r=Infinity;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Lg=n);Ed=e,eE(r)}function eE(e){if(ku)return;xd&&(xd=clearTimeout(xd));var t=e-Fs;t>24?(e<Infinity&&(xd=setTimeout(J5,e-Sd.now()-Pg)),kd&&(kd=clearInterval(kd))):(kd||(zg=Sd.now(),kd=setInterval(Lse,V5)),ku=1,X5(J5))}function Pse(e,t,n){var r=new jg(),i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(a,o,s){o=+o,s=s==null?Zk():+s,r._restart(function l(u){u+=i,r._restart(l,i+=o,s),a(u)},o,s)},r.restart(e,t,n),r)}function jse(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),K5(t,e.description()))}function K5(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Use(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const tE="default";function Bse(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:tE,item:null}));e.on(e.events("view","mousemove"),t,(n,r)=>{const i=t.value,a=i?X(i)?i:i.user:tE,o=r.item&&r.item.cursor||null;return i&&a===i.user&&o==i.item?i:{user:a,item:o}}),e.add(null,function(n){let r=n.cursor,i=this.value;return X(r)||(i=r.item,r=r.user),nE(e,r&&r!==tE?r:i||r),i},{cursor:t})}function nE(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Ug(e,t){var n=e._runtime.data;return te(n,t)||L("Unrecognized data set: "+t),n[t]}function qse(e,t){return arguments.length<2?Ug(this,e).values.value:Bg.call(this,e,ns().remove(or).insert(t))}function Bg(e,t){PC(t)||L("Second argument to changes must be a changeset.");const n=Ug(this,e);return n.modified=!0,this.pulse(n.input,t)}function Hse(e,t){return Bg.call(this,e,ns().insert(t))}function Wse(e,t){return Bg.call(this,e,ns().remove(t))}function Q5(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function Z5(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function qg(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Gse(e){var t=qg(e),n=Q5(e),r=Z5(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach(i=>{try{i(n,r)}catch(a){e.error(a)}})}function Yse(e,t,n){var r=e._renderer,i=r&&r.canvas(),a,o,s;return i&&(s=qg(e),o=t.changedTouches?t.changedTouches[0]:t,a=Zp(o,i),a[0]-=s[0],a[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=Vse(e,n,a),t}function Vse(e,t,n){const r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(o){var s=r,l;if(o){for(l=t;l;l=l.mark.group)if(l.mark.name===o){s=l;break}}return s&&s.mark&&s.mark.interactive?s:{}}function a(o){if(!o)return n;X(o)&&(o=i(o));const s=n.slice();for(;o;)s[0]-=o.x||0,s[1]-=o.y||0,o=o.mark&&o.mark.group;return s}return{view:qt(e),item:qt(t||{}),group:i,xy:a,x:o=>a(o)[0],y:o=>a(o)[1]}}const eL="view",Xse="timer",Jse="window",Kse={trap:!1};function Qse(e){const t=ue({defaults:{}},e),n=(r,i)=>{i.forEach(a=>{z(r[a])&&(r[a]=kt(r[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function tL(e,t,n,r){e._eventListeners.push({type:n,sources:J(t),handler:r})}function Zse(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[t]:i?!i[t]:e.preventDefault()}function Hg(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return r===!1||Q(r)&&!r[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function ele(e,t,n){var r=this,i=new Jh(n),a=function(u,c){r.runAsync(null,()=>{e===eL&&Zse(r,t)&&u.preventDefault(),i.receive(Yse(r,u,c))})},o;if(e===Xse)Hg(r,"timer",t)&&r.timer(a,t);else if(e===eL)Hg(r,"view",t)&&r.addEventListener(t,a,Kse);else if(e===Jse?Hg(r,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&(Hg(r,"selector",t)&&(o=document.querySelectorAll(e))),!o)r.warn("Can not resolve event source: "+e);else{for(var s=0,l=o.length;s<l;++s)o[s].addEventListener(t,a);tL(r,o,t,a)}return i}function nL(e){return e.item}function rL(e){return e.item.mark.source}function iL(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function tle(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",nL),rL,iL(e)),this.on(this.events("view","mouseout",nL),rL,iL(t)),this}function nle(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,a;for(r=t.length;--r>=0;)t[r].stop();for(r=n.length;--r>=0;)for(a=n[r],i=a.sources.length;--i>=0;)a.sources[i].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this}function Zn(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const rle="vega-bind",ile="vega-bind-name",ale="vega-bind-radio";function ole(e,t,n){if(!t)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:o=>{o!=e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,o)})}},r.debounce&&(i.update=ev(r.debounce,i.update)));const a=r.input==null&&r.element?sle:ule;return a(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0),i}function sle(e,t,n,r){const i=n.event||"input",a=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,a),tL(r,t,i,a),e.set=o=>{t.value=o,t.dispatchEvent(lle(i))}}function lle(e){return typeof Event!="undefined"?new Event(e):{type:e}}function ule(e,t,n,r){const i=r.signal(n.signal),a=Zn("div",{class:rle}),o=n.input==="radio"?a:a.appendChild(Zn("label"));o.appendChild(Zn("span",{class:ile},n.name||n.signal)),t.appendChild(a);let s=cle;switch(n.input){case"checkbox":s=fle;break;case"select":s=dle;break;case"radio":s=hle;break;case"range":s=ple;break}s(e,o,n,i)}function cle(e,t,n,r){const i=Zn("input");for(const a in n)a!=="signal"&&a!=="element"&&i.setAttribute(a==="input"?"type":a,n[a]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=a=>i.value=a}function fle(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=Zn("input",i);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=o=>a.checked=!!o||null}function dle(e,t,n,r){const i=Zn("select",{name:n.signal}),a=n.labels||[];n.options.forEach((o,s)=>{const l={value:o};Wg(o,r)&&(l.selected=!0),i.appendChild(Zn("option",l,(a[s]||o)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=o=>{for(let s=0,l=n.options.length;s<l;++s)if(Wg(n.options[s],o)){i.selectedIndex=s;return}}}function hle(e,t,n,r){const i=Zn("span",{class:ale}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map((o,s)=>{const l={type:"radio",name:n.signal,value:o};Wg(o,r)&&(l.checked=!0);const u=Zn("input",l);u.addEventListener("change",()=>e.update(o));const c=Zn("label",{},(a[s]||o)+"");return c.prepend(u),i.appendChild(c),u}),e.set=o=>{const s=e.elements,l=s.length;for(let u=0;u<l;++u)Wg(s[u].value,o)&&(s[u].checked=!0)}}function ple(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||aie(a,i,100),s=Zn("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=Zn("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=c=>{s.value=c,l.textContent=c}}function Wg(e,t){return e===t||e+""===t+""}function aL(e,t,n,r,i,a){return t=t||new r(e.loader()),t.initialize(n,Q5(e),Z5(e),qg(e),i,a).background(e.background())}function rE(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function mle(e,t,n,r){const i=new r(e.loader(),rE(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,qg(e),e);return t&&t.handlers().forEach(a=>{i.on(a.type,a.handler)}),i}function gle(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=lm(r);e=n._el=e?iE(n,e,!0):null,jse(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||gf,s=e?a.renderer:a.headless;return n._renderer=s?aL(n,n._renderer,e,s):null,n._handler=mle(n,n._handler,e,o),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=iE(n,t,!0):e.appendChild(Zn("form",{class:"vega-bindings"})),n._bind.forEach(l=>{l.param.element&&i!=="container"&&(l.element=iE(n,l.param.element,!!l.param.input))}),n._bind.forEach(l=>{ole(n,l.element||t,l)})),n}function iE(e,t,n){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const Td=e=>+e||0,yle=e=>({top:e,bottom:e,left:e,right:e});function oL(e){return Q(e)?{top:Td(e.top),bottom:Td(e.bottom),left:Td(e.left),right:Td(e.right)}:yle(Td(e))}async function aE(e,t,n,r){const i=lm(t),a=i&&i.headless;return a||L("Unrecognized renderer type: "+t),await e.runAsync(),aL(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}async function vle(e,t){e!==io.Canvas&&e!==io.SVG&&e!==io.PNG&&L("Unrecognized image type: "+e);const n=await aE(this,e,t);return e===io.SVG?ble(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function ble(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function wle(e,t){const n=await aE(this,io.Canvas,e,t);return n.canvas()}async function xle(e){const t=await aE(this,io.SVG,e);return t.svg()}function kle(e,t,n){return W5(e,Ml,bd,n).parse(t)}function Ele(e){var t=this._runtime.scales;return te(t,e)||L("Unrecognized scale or projection: "+e),t[e].value}var sL="width",lL="height",oE="padding",uL={skip:!0};function cL(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===oE?r.left+r.right:0)}function fL(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===oE?r.top+r.bottom:0)}function Sle(e){var t=e._signals,n=t[sL],r=t[lL],i=t[oE];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,s=>{e._width=s.size,e._viewWidth=cL(e,s.size),a()},{size:n}),e._resizeHeight=e.add(null,s=>{e._height=s.size,e._viewHeight=fL(e,s.size),a()},{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}function Tle(e,t,n,r,i,a){this.runAfter(o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(sL,n,uL),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(lL,r,uL),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==i[0]||o._origin[1]!==i[1])&&(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter(l=>l.resize())},!1,1)}function Ale(e){return this._runtime.getState(e||{data:_le,signals:Cle,recurse:!0})}function _le(e,t){return t.modified&&z(t.input.value)&&e.indexOf("_:vega:_")}function Cle(e,t){return!(e==="parent"||t instanceof Ml.proxy)}function $le(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function Ole(e,t){function n(r){e({timestamp:Date.now(),elapsed:r})}this._timers.push(Pse(n,t))}function Mle(e,t,n,r){const i=e.element();i&&i.setAttribute("title",Dle(r))}function Dle(e){return e==null?"":z(e)?dL(e):Q(e)&&!Ia(e)?Nle(e):e+""}function Nle(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(z(n)?dL(n):hL(n))}).join(`
`)}function dL(e){return"["+e.map(hL).join(", ")+"]"}function hL(e){return z(e)?"[]":Q(e)&&!Ia(e)?"{}":e}function pL(e,t){const n=this;if(t=t||{},Ol.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const a=ue({},e.locale,t.locale);n.locale(RC(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||io.Canvas,n._scenegraph=new Dw();const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||Mle,n._redraw=!0,n._handler=new gf().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=Qse(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=kle(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:ue({},a)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=cL(n,n._width),n._viewHeight=fL(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,Sle(n),Use(n),Bse(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function Gg(e,t){return te(e._signals,t)?e._signals[t]:L("Unrecognized signal name: "+H(t))}function mL(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function gL(e,t,n,r){let i=mL(n,r);return i||(i=rE(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function yL(e,t,n){const r=mL(t,n);return r&&t._targets.remove(r),e}q(pL,Ol,{async evaluate(e,t,n){if(await Ol.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Gse(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&Wh(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&K5(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=Gg(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",oL(e)):oL(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(lm(e)||L("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Ol.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Gg(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:Tle,addEventListener(e,t,n){let r=t;return n&&n.trap===!1||(r=rE(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),r=n.length,i,a;--r>=0;)if(a=n[r].type,i=n[r].handler,e===a&&(t===i||t===i.raw)){this._handler.off(a,i);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return gL(this,e,Gg(this,e),t)},removeSignalListener(e,t){return yL(this,Gg(this,e),t)},addDataListener(e,t){return gL(this,e,Ug(this,e).values,t)},removeDataListener(e,t){return yL(this,Ug(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=nE(this,null);this._globalCursor=!!e,t&&nE(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:Ole,events:ele,finalize:nle,hover:tle,data:qse,change:Bg,insert:Hse,remove:Wse,scale:Ele,initialize:gle,toImageURL:vle,toCanvas:wle,toSVG:xle,getState:Ale,setState:$le});const Rle="view",Yg="[",Vg="]",vL="{",bL="}",Fle=":",wL=",",Ile="@",Lle=">",zle=/[[\]{}]/,Ple={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let xL,kL;function go(e,t,n){return xL=t||Rle,kL=n||Ple,EL(e.trim()).map(sE)}function jle(e){return kL[e]}function Ad(e,t,n,r,i){const a=e.length;let o=0,s;for(;t<a;++t){if(s=e[t],!o&&s===n)return t;i&&i.indexOf(s)>=0?--o:r&&r.indexOf(s)>=0&&++o}return t}function EL(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Ad(e,i,wL,Yg+vL,Vg+bL),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function sE(e){return e[0]==="["?Ule(e):Ble(e)}function Ule(e){const t=e.length;let n=1,r;if(n=Ad(e,n,Vg,Yg,Vg),n===t)throw"Empty between selector: "+e;if(r=EL(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Lle)throw"Expected '>' after between selector: "+e;r=r.map(sE);const i=sE(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function Ble(e){const t={source:xL},n=[];let r=[0,0],i=0,a=0,o=e.length,s=0,l,u;if(e[o-1]===bL){if(s=e.lastIndexOf(vL),s>=0){try{r=qle(e.substring(s+1,o-1))}catch(c){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),o=e.length}else throw"Unmatched right brace: "+e;s=0}if(!o)throw e;if(e[0]===Ile&&(i=++s),l=Ad(e,s,Fle),l<o&&(n.push(e.substring(a,l).trim()),a=s=++l),s=Ad(e,s,Yg),s===o)n.push(e.substring(a,o).trim());else if(n.push(e.substring(a,s).trim()),u=[],a=++s,a===o)throw"Unmatched left bracket: "+e;for(;s<o;){if(s=Ad(e,s,Vg),s===o)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,s).trim()),s<o-1&&e[++s]!==Yg)throw"Expected left bracket: "+e;a=++s}if(!(o=n.length)||zle.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):jle(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),u!=null&&(t.filter=u),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function qle(e){const t=e.split(wL);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}function Hle(e){return Q(e)?e:{type:e||"pad"}}const _d=e=>+e||0,Wle=e=>({top:e,bottom:e,left:e,right:e});function Gle(e){return Q(e)?e.signal?e:{top:_d(e.top),bottom:_d(e.bottom),left:_d(e.left),right:_d(e.right)}:Wle(_d(e))}const $t=e=>Q(e)&&!z(e)?ue({},e):{value:e};function SL(e,t,n,r){if(n!=null){const i=Q(n)&&!z(n)||z(n)&&n.length&&Q(n[0]);return i?e.update[t]=n:e[r||"enter"][t]={value:n},1}else return 0}function Lt(e,t,n){for(const r in t)SL(e,r,t[r]);for(const r in n)SL(e,r,n[r],"update")}function Eu(e,t,n){for(const r in t){if(n&&te(n,r))continue;e[r]=ue(e[r]||{},t[r])}return e}function Su(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const lE="mark",uE="frame",cE="scope",Yle="axis",Vle="axis-domain",Xle="axis-grid",Jle="axis-label",Kle="axis-tick",Qle="axis-title",Zle="legend",eue="legend-band",tue="legend-entry",nue="legend-gradient",TL="legend-label",rue="legend-symbol",iue="legend-title",aue="title",oue="title-text",sue="title-subtitle";function lue(e,t,n,r,i){const a={},o={};let s,l,u,c;l="lineBreak",t==="text"&&i[l]!=null&&!Su(l,e)&&fE(a,l,i[l]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===uE?i.group:n===lE?ue({},i.mark,i[t]):null;for(l in c)u=Su(l,e)||(l==="fill"||l==="stroke")&&(Su("fill",e)||Su("stroke",e)),u||fE(a,l,c[l]);J(r).forEach(f=>{const d=i.style&&i.style[f];for(const h in d)Su(h,e)||fE(a,h,d[h])}),e=ue({},e);for(l in a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=ue(o,e.enter),s&&(e.update=ue(s,e.update)),e}function fE(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const AL=e=>X(e)?H(e):e.signal?"(".concat(e.signal,")"):_L(e);function Xg(e){if(e.gradient!=null)return cue(e);let t=e.signal?"(".concat(e.signal,")"):e.color?uue(e.color):e.field!=null?_L(e.field):e.value!==void 0?H(e.value):void 0;return e.scale!=null&&(t=fue(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t="pow(".concat(t,",").concat(Kg(e.exponent),")")),e.mult!=null&&(t+="*".concat(Kg(e.mult))),e.offset!=null&&(t+="+".concat(Kg(e.offset))),e.round&&(t="round(".concat(t,")")),t}const Jg=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(Xg).join(","),")+'')");function uue(e){return e.c?Jg("hcl",e.h,e.c,e.l):e.h||e.s?Jg("hsl",e.h,e.s,e.l):e.l||e.a?Jg("lab",e.l,e.a,e.b):e.r||e.g||e.b?Jg("rgb",e.r,e.g,e.b):null}function cue(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:H(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(AL(e.gradient)),"gradient(".concat(t.join(","),")")}function Kg(e){return Q(e)?"("+Xg(e)+")":e}function _L(e){return CL(Q(e)?e:{datum:e})}function CL(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):L("Invalid field reference: "+H(e));return e.signal||(r=X(r)?Zr(r).map(H).join("]["):CL(r)),t+"["+r+"]"}function fue(e,t){const n=AL(e.scale);return e.range!=null?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(t!==void 0&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(+e.band===1?"":"*"+Kg(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),t==null&&(t="0")),t}function due(e){let t="";return e.forEach(n=>{const r=Xg(n);t+=n.test?"(".concat(n.test,")?").concat(r,":"):r}),ve(t)===":"&&(t+="null"),t}function $L(e,t,n,r,i,a){const o={};a=a||{},a.encoders={$encode:o},e=lue(e,t,n,r,i.config);for(const s in e)o[s]=hue(e[s],t,a,i);return a}function hue(e,t,n,r){const i={},a={};for(const o in e)e[o]!=null&&(i[o]=mue(pue(e[o]),r,n,a));return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function pue(e){return z(e)?due(e):Xg(e)}function mue(e,t,n,r){const i=Ti(e,t);return i.$fields.forEach(a=>r[a]=1),ue(n,i.$params),i.$expr}const gue="outer",yue=["value","update","init","react","bind"];function OL(e,t){L(e+' for "outer" push: '+H(t))}function ML(e,t){const n=e.name;if(e.push===gue)t.signals[n]||OL("No prior signal definition",n),yue.forEach(r=>{e[r]!==void 0&&OL("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function dE(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Qg(e,t,n,r){return new dE(e,t,n,r)}function Zg(e,t){return Qg("operator",e,t)}function re(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Cd(e,t){return t?{$field:e,$name:t}:{$field:e}}const hE=Cd("key");function DL(e,t){return{$compare:e,$order:t}}function vue(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const bue="ascending",wue="descending";function xue(e){return Q(e)?(e.order===wue?"-":"+")+e0(e.op,e.field):""}function e0(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const pE="scope",mE="view";function yt(e){return e&&e.signal}function kue(e){return e&&e.expr}function t0(e){if(yt(e))return!0;if(Q(e)){for(const t in e)if(t0(e[t]))return!0}return!1}function Pr(e,t){return e??t}function Is(e){return e&&e.signal||e}const NL="timer";function $d(e,t){const n=e.merge?Sue:e.stream?Tue:e.type?Aue:L("Invalid stream specification: "+H(e));return n(e,t)}function Eue(e){return e===pE?mE:e||mE}function Sue(e,t){const n=e.merge.map(i=>$d(i,t)),r=gE({merge:n},e,t);return t.addStream(r).id}function Tue(e,t){const n=$d(e.stream,t),r=gE({stream:n},e,t);return t.addStream(r).id}function Aue(e,t){let n;e.type===NL?(n=t.event(NL,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(Eue(e.source),e.type);const r=gE({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function gE(e,t,n){let r=t.between;return r&&(r.length!==2&&L('Stream "between" parameter must have 2 entries: '+H(t)),e.between=[$d(r[0],n),$d(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(_ue(t.marktype,t.markname,t.markrole)),t.source===pE&&r.push("inScope(event.item)"),r.length&&(e.filter=Ti("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}function _ue(e,t,n){const r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}const Cue={code:"_.$value",ast:{type:"Identifier",value:"value"}};function $ue(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||L("Signal update missing events specification."),X(a)&&(a=go(a,t.isSubscope()?pE:mE)),a=J(a).filter(l=>l.signal||l.scale?(s.push(l),0):1),s.length>1&&(s=[Mue(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),r!=null&&(o&&L("Signal encode and update are mutually exclusive."),o="encode(item(),"+H(r)+")"),i.update=X(o)?Ti(o,t):o.expr!=null?Ti(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:Cue,$params:{$value:t.signalRef(o.signal)}}:L("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach(l=>t.addUpdate(ue(Oue(l,t),i)))}function Oue(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):$d(e,t)}}function Mue(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function Due(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?L("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=Ti(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(i=>$ue(i,t,n.id))}const ze=e=>(t,n,r)=>Qg(e,n,t||void 0,r),RL=ze("aggregate"),Nue=ze("axisticks"),FL=ze("bound"),jr=ze("collect"),IL=ze("compare"),Rue=ze("datajoin"),LL=ze("encode"),Fue=ze("expression"),Iue=ze("facet"),Lue=ze("field"),zue=ze("key"),Pue=ze("legendentries"),jue=ze("load"),Uue=ze("mark"),Bue=ze("multiextent"),que=ze("multivalues"),Hue=ze("overlap"),Wue=ze("params"),zL=ze("prefacet"),Gue=ze("projection"),Yue=ze("proxy"),Vue=ze("relay"),PL=ze("render"),Xue=ze("scale"),Ls=ze("sieve"),Jue=ze("sortitems"),jL=ze("viewlayout"),Kue=ze("values");let Que=0;const UL={min:"min",max:"max",count:"sum"};function Zue(e,t){const n=e.type||"linear";rD(n)||L("Unrecognized scale type: "+H(n)),t.addScale(e.name,{type:n,domain:void 0})}function ece(e,t){const n=t.getScale(e.name).params;let r;n.domain=BL(e.domain,e,t),e.range!=null&&(n.range=HL(e,t,n)),e.interpolate!=null&&cce(e.interpolate,n),e.nice!=null&&(n.nice=uce(e.nice)),e.bins!=null&&(n.bins=lce(e.bins,t));for(r in e){if(te(n,r)||r==="name")continue;n[r]=yr(e[r],t)}}function yr(e,t){return Q(e)?e.signal?t.signalRef(e.signal):L("Unsupported object: "+H(e)):e}function n0(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>yr(n,t))}function r0(e){L("Can not find data set: "+H(e))}function BL(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&L("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(z(e)?tce:e.fields?rce:nce)(e,t,n)}function tce(e,t,n){return e.map(r=>yr(r,n))}function nce(e,t,n){const r=n.getData(e.data);return r||r0(e.data),Gl(t.type)?r.valuesRef(n,e.field,qL(e.sort,!1)):oD(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function rce(e,t,n){const r=e.data,i=e.fields.reduce((a,o)=>(o=X(o)?{data:r,field:o}:z(o)||o.signal?ice(o,n):o,a.push(o),a),[]);return(Gl(t.type)?ace:oD(t.type)?oce:sce)(e,n,i)}function ice(e,t){const n="_:vega:_"+Que++,r=jr({});if(z(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+H(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,Ls({})]),{data:n,field:"data"}}function ace(e,t,n){const r=qL(e.sort,!0);let i,a;const o=n.map(u=>{const c=t.getData(u.data);return c||r0(u.data),c.countsRef(t,u.field,r)}),s={groupby:hE,pulse:o};r&&(i=r.op||"count",a=r.field?e0(i,r.field):"count",s.ops=[UL[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(RL(s));const l=t.add(jr({pulse:re(i)}));return a=t.add(Kue({field:hE,sort:t.sortRef(r),pulse:re(l)})),re(a)}function qL(e,t){return e&&(!e.field&&!e.op?Q(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?L("No field provided for sort aggregate op: "+e.op):t&&e.field&&(e.op&&!UL[e.op]&&L("Multiple domain scales can not be sorted using "+e.op))),e}function oce(e,t,n){const r=n.map(i=>{const a=t.getData(i.data);return a||r0(i.data),a.domainRef(t,i.field)});return re(t.add(que({values:r})))}function sce(e,t,n){const r=n.map(i=>{const a=t.getData(i.data);return a||r0(i.data),a.extentRef(t,i.field)});return re(t.add(Bue({extents:r})))}function lce(e,t){return e.signal||z(e)?n0(e,t):t.objectProperty(e)}function uce(e){return Q(e)?{interval:yr(e.interval),step:yr(e.step)}:yr(e)}function cce(e,t){t.interpolate=yr(e.type||e),e.gamma!=null&&(t.interpolateGamma=yr(e.gamma))}function HL(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(X(i)){if(r&&te(r,i))return e=ue({},e,{range:r[i]}),HL(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=Gl(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:L("Unrecognized scale range value: "+H(i))}else if(i.scheme){n.scheme=z(i.scheme)?n0(i.scheme,t):yr(i.scheme,t),i.extent&&(n.schemeExtent=n0(i.extent,t)),i.count&&(n.schemeCount=yr(i.count,t));return}else if(i.step){n.rangeStep=yr(i.step,t);return}else{if(Gl(e.type)&&!z(i))return BL(i,e,t);z(i)||L("Unsupported range type: "+H(i))}return i.map(a=>(z(a)?n0:yr)(a,t))}function fce(e,t){const n=t.config.projection||{},r={};for(const i in e){if(i==="name")continue;r[i]=yE(e[i],i,t)}for(const i in n)r[i]==null&&(r[i]=yE(n[i],i,t));t.addProjection(e.name,r)}function yE(e,t,n){return z(e)?e.map(r=>yE(r,t,n)):Q(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:L("Unsupported parameter object: "+H(e)):e}const Ur="top",Tu="left",Au="right",yo="bottom",WL="center",dce="vertical",hce="start",pce="middle",mce="end",vE="index",bE="label",gce="offset",_u="perc",yce="perc2",vr="value",Od="guide-label",wE="guide-title",vce="group-title",bce="group-subtitle",GL="symbol",i0="gradient",xE="discrete",kE="size",wce="shape",xce="fill",kce="stroke",Ece="strokeWidth",Sce="strokeDash",Tce="opacity",EE=[kE,wce,xce,kce,Ece,Sce,Tce],Md={name:1,style:1,interactive:1},Ee={value:0},br={value:1},a0="group",YL="rect",SE="rule",Ace="symbol",zs="text";function Dd(e){return e.type=a0,e.interactive=e.interactive||!1,e}function Fn(e,t){const n=(r,i)=>Pr(e[r],Pr(t[r],i));return n.isVertical=r=>dce===Pr(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Pr(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Pr(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Pr(e.columns,Pr(t.columns,+n.isVertical(!0))),n}function VL(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function _ce(e,t,n){const r=t.config.style[n];return r&&r[e]}function o0(e,t,n){return"item.anchor === '".concat(hce,"' ? ").concat(e," : item.anchor === '").concat(mce,"' ? ").concat(t," : ").concat(n)}const TE=o0(H(Tu),H(Au),H(WL));function Cce(e){const t=e("tickBand");let n=e("tickOffset"),r,i;return t?t.signal?(r={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},i={signal:"(".concat(t.signal,") === 'extent'")},Q(n)||(n={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(n)})):t==="extent"?(r=1,i=!0,n=0):(r=.5,i=!1):(r=e("bandPosition"),i=e("tickExtra")),{extra:i,band:r,offset:n}}function XL(e,t){return t?e?Q(e)?Object.assign({},e,{offset:XL(e.offset,t)}):{value:e,offset:t}:t:e}function er(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Eu(e.encode,t,Md)):e.interactive=!1,e}function $ce(e,t,n,r){const i=Fn(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,f,d;a?(u=[0,1],c=[0,0],f=o,d=s):(u=[0,0],c=[1,0],f=s,d=o);const h={enter:l={opacity:Ee,x:Ee,y:Ee,width:$t(f),height:$t(d)},update:ue({},l,{opacity:br,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:Ee}};return Lt(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),er({type:YL,role:nue,encode:h},r)}function Oce(e,t,n,r,i){const a=Fn(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,f,d,h="";o?(u="y",f="y2",c="x",d="width",h="1-"):(u="x",f="x2",c="y",d="height");const p={opacity:Ee,fill:{scale:t,field:vr}};p[u]={signal:h+"datum."+_u,mult:l},p[c]=Ee,p[f]={signal:h+"datum."+yce,mult:l},p[d]=$t(s);const m={enter:p,update:ue({},p,{opacity:br}),exit:{opacity:Ee}};return Lt(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),er({type:YL,role:eue,key:vr,from:i,encode:m},r)}const Mce="datum.".concat(_u,'<=0?"').concat(Tu,'":datum.').concat(_u,'>=1?"').concat(Au,'":"').concat(WL,'"'),Dce="datum.".concat(_u,'<=0?"').concat(yo,'":datum.').concat(_u,'>=1?"').concat(Ur,'":"').concat(pce,'"');function JL(e,t,n,r){const i=Fn(e,t),a=i.isVertical(),o=$t(i.gradientThickness()),s=i.gradientLength();let l=i("labelOverlap"),u,c,f,d,h="";const p={enter:u={opacity:Ee},update:c={opacity:br,text:{field:bE}},exit:{opacity:Ee}};return Lt(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:Pr(e.labelLimit,t.gradientLabelLimit)}),a?(u.align={value:"left"},u.baseline=c.baseline={signal:Dce},f="y",d="x",h="1-"):(u.align=c.align={signal:Mce},u.baseline={value:"top"},f="x",d="y"),u[f]=c[f]={signal:h+"datum."+_u,mult:s},u[d]=c[d]=o,o.offset=Pr(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:i("labelSeparation"),method:l,order:"datum."+vE}:void 0,er({type:zs,role:TL,style:Od,key:vr,from:r,encode:p,overlap:l},n)}function Nce(e,t,n,r,i){const a=Fn(e,t),o=n.entries,s=!!(o&&o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d="(".concat(i,") ? datum.").concat(gce," : datum.").concat(kE),h=u?$t(u):{field:kE},p="datum.".concat(vE),m="max(1, ".concat(i,")");let g,y,v,b,w;h.mult=.5,g={enter:y={opacity:Ee,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:br,x:y.x,y:y.y},exit:{opacity:Ee}};let x=null,E=null;e.fill||(x=t.symbolBaseFillColor,E=t.symbolBaseStrokeColor),Lt(g,{fill:a("symbolFillColor",x),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",E),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),EE.forEach(C=>{e[C]&&(v[C]=y[C]={scale:e[C],field:vr})});const k=er({type:Ace,role:rue,key:vr,from:f,clip:u?!0:void 0,encode:g},n.symbols),S=$t(c);S.offset=a("labelOffset"),g={enter:y={opacity:Ee,x:{signal:d,offset:S},y:h},update:v={opacity:br,text:{field:bE},x:y.x,y:y.y},exit:{opacity:Ee}},Lt(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const A=er({type:zs,role:TL,style:Od,key:vr,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:Ee,height:u?$t(u):Ee,opacity:Ee},exit:{opacity:Ee},update:v={opacity:br,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),w={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(m,")"),v.column.signal="".concat(p," % ").concat(m),w={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),r={facet:{data:r,name:"value",groupby:vE}},Dd({role:cE,from:r,encode:Eu(g,o,Md),marks:[k,A],name:l,interactive:s,sort:w})}function Rce(e,t){const n=Fn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const AE='item.orient === "left"',_E='item.orient === "right"',s0="(".concat(AE," || ").concat(_E,")"),Fce="datum.vgrad && ".concat(s0),Ice=o0('"top"','"bottom"','"middle"'),Lce=o0('"right"','"left"','"center"'),zce="datum.vgrad && ".concat(_E," ? (").concat(Lce,") : (").concat(s0," && !(datum.vgrad && ").concat(AE,')) ? "left" : ').concat(TE),Pce="item._anchor || (".concat(s0,' ? "middle" : "start")'),jce="".concat(Fce," ? (").concat(AE," ? -90 : 90) : 0"),Uce="".concat(s0," ? (datum.vgrad ? (").concat(_E,' ? "bottom" : "top") : ').concat(Ice,') : "top"');function Bce(e,t,n,r){const i=Fn(e,t),a={enter:{opacity:Ee},update:{opacity:br,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Ee}};return Lt(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:Pce},angle:{signal:jce},align:{signal:zce},baseline:{signal:Uce},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),er({type:zs,role:iue,style:wE,from:r,encode:a},n)}function qce(e,t){let n;return Q(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+KL(e.path)+")":e.sphere&&(n="geoShape("+KL(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function KL(e){return Q(e)&&e.signal?e.signal:H(e)}function QL(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===a0?cE:t||lE}function Hce(e){return{marktype:e.type,name:e.name||void 0,role:e.role||QL(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Wce(e,t){return e&&e.signal?t.signalRef(e.signal):!(e===!1)}function CE(e,t){const n=VC(e.type);n||L("Unrecognized transform type: "+H(e.type));const r=Qg(n.type.toLowerCase(),null,ZL(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function ZL(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const o=e.params[a];r[o.name]=Gce(o,t,n)}return r}function Gce(e,t,n){const r=e.type,i=t[e.name];if(r==="index")return Yce(e,t,n);if(i===void 0){e.required&&L("Missing required "+H(t.type)+" parameter: "+H(e.name));return}else{if(r==="param")return Vce(e,t,n);if(r==="projection")return n.projectionRef(t[e.name])}return e.array&&!yt(i)?i.map(a=>ez(e,a,n)):ez(e,i,n)}function ez(e,t,n){const r=e.type;if(yt(t))return nz(r)?L("Expression references can not be signals."):$E(r)?n.fieldRef(t):rz(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||$E(r);return i&&Xce(t)?n.exprRef(t.expr,t.as):i&&Jce(t)?Cd(t.field,t.as):nz(r)?Ti(t,n):Kce(r)?re(n.getData(t).values):$E(r)?Cd(t):rz(r)?n.compareRef(t):t}}function Yce(e,t,n){return X(t.from)||L('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Vce(e,t,n){const r=t[e.name];return e.array?(z(r)||L("Expected an array of sub-parameters. Instead: "+H(r)),r.map(i=>tz(e,i,n))):tz(e,r,n)}function tz(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const s in i.key)if(i.key[s]!==t[s]){i=null;break}if(i)break}i||L("Unsupported parameter: "+H(t));const a=ue(ZL(i,t,n),i.key);return re(n.add(Wue(a)))}const Xce=e=>e&&e.expr,Jce=e=>e&&e.field,Kce=e=>e==="data",nz=e=>e==="expr",$E=e=>e==="field",rz=e=>e==="compare";function Qce(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||L("Only group marks can be faceted."),r.field!=null?o=s=l0(r,n):(e.data?s=re(n.getData(e.data).aggregate):(a=CE(ue({type:"aggregate",groupby:J(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=l0(r,n),o=s=re(n.add(a))),i=n.keyRef(r.groupby,!0))):o=re(n.add(jr(null,[{}]))),o||(o=l0(e,n)),{key:i,pulse:o,parent:s}}function l0(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:re(t.getData(e.data).output)}function Ps(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}Ps.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&a.type==="load"&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=re(t[s-1]),e.add(t[s]),t[s].type==="aggregate"&&(o=t[s]);return new Ps(e,a,i,r,o)};function iz(e){return X(e)?e:null}function az(e,t,n){const r=e0(n.op,n.field);let i;if(t.ops){for(let a=0,o=t.as.length;a<o;++a)if(t.as[a]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function Nd(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=xue(a);let u=iz(i),c,f;if(u!=null&&(e=t.scope,u=u+(l?"|"+l:""),c=s[u]),!c){const d=a?{field:hE,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:re(t.output)};l&&(d.sort=e.sortRef(a)),f=e.add(Qg(r,void 0,d)),o&&(t.index[i]=f),c=re(f),u!=null&&(s[u]=c)}return c}Ps.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=iz(t);let o,s,l;return a!=null&&(e=r.scope,o=i[a]),o?n&&n.field&&az(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:re(r.output)},n&&n.field&&az(e,l,n),s=e.add(RL(l)),o=e.add(jr({pulse:re(s)})),o={agg:s,ref:re(o)},a!=null&&(i[a]=o)),o.ref},tuplesRef(){return re(this.values)},extentRef(e,t){return Nd(e,this,"extent","extent",t,!1)},domainRef(e,t){return Nd(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Nd(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Nd(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Nd(e,this,"indata","tupleindex",t,!0,!0)}};function Zce(e,t,n){const r=e.from.facet,i=r.name,a=l0(r,t);let o;r.name||L("Facet must have a name: "+H(r)),r.data||L("Facet must reference a data set: "+H(r)),r.field?o=t.add(zL({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(Iue({key:t.keyRef(r.groupby),group:re(t.proxy(n.parent)),pulse:a})):L("Facet must specify groupby or field: "+H(r));const s=t.fork(),l=s.add(jr()),u=s.add(Ls({pulse:re(l)}));s.addData(i,new Ps(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}function efe(e,t,n){const r=t.add(zL({pulse:n.pulse})),i=t.fork();i.add(Ls()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}function oz(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(Zg()),u="if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map(f=>f??"null").join(",")+"),0)",c=Ti(u,t);l.update=c.$expr,l.params=c.$params}function u0(e,t){const n=QL(e),r=e.type===a0,i=e.from&&e.from.facet,a=e.overlap;let o=e.layout||n===cE||n===uE,s,l,u,c,f,d,h;const p=n===lE||o||i,m=Qce(e.from,r,t);l=t.add(Rue({key:m.key||(e.key?Cd(e.key):void 0),pulse:m.pulse,clean:!r}));const g=re(l);l=u=t.add(jr({pulse:g})),l=t.add(Uue({markdef:Hce(e),interactive:Wce(e.interactive,t),clip:qce(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:re(l)}));const y=re(l);l=c=t.add(LL($L(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),l.params.parent=t.encode(),e.transform&&e.transform.forEach(E=>{const k=CE(E,t),S=k.metadata;(S.generates||S.changes)&&L("Mark transforms should not generate new data."),S.nomod||(c.params.mod=!0),k.params.pulse=re(l),t.add(l=k)}),e.sort&&(l=t.add(Jue({sort:t.compareRef(e.sort),pulse:re(l)})));const v=re(l);(i||o)&&(o=t.add(jL({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),d=re(o));const b=t.add(FL({mark:y,pulse:d||v}));h=re(b),r&&(p&&(s=t.operators,s.pop(),o&&s.pop()),t.pushState(v,d||h,g),i?Zce(e,t,m):p?efe(e,t,m):t.parse(e),t.popState(),p&&(o&&s.push(o),s.push(b))),a&&(h=tfe(a,h,t));const w=t.add(PL({pulse:h})),x=t.add(Ls({pulse:re(w)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Ps(t,u,w,x)),e.on&&e.on.forEach(E=>{(E.insert||E.remove||E.toggle)&&L("Marks only support modify triggers."),oz(E,t,f)}))}function tfe(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:yt(a)?n.signalRef(a.signal):a,method:yt(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const s=i.tolerance;o.boundTolerance=yt(s)?n.signalRef(s.signal):+s,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return re(n.add(Hue(o)))}function nfe(e,t){const n=t.config.legend,r=e.encode||{},i=Fn(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c=0,f,d,h;EE.forEach(b=>e[b]?(u[b]=e[b],c=c||e[b]):0),c||L("Missing valid scale for legend.");const p=rfe(e,t.scaleType(c)),m={title:e.title!=null,scales:u,type:p,vgrad:p!=="symbol"&&i.isVertical()},g=re(t.add(jr(null,[m]))),y={enter:{x:{value:0},y:{value:0}}},v=re(t.add(Pue(d={type:p,scale:t.scaleRef(c),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===i0?(h=[$ce(e,c,n,r.gradient),JL(e,n,r.labels,v)],d.count=d.count||t.signalRef("max(2,2*floor((".concat(Is(i.gradientLength()),")/100))"))):p===xE?h=[Oce(e,c,n,r.gradient,v),JL(e,n,r.labels,v)]:(f=Rce(e,n),h=[Nce(e,n,r,v,Is(f.columns))],d.size=ofe(e,t,h[0].marks)),h=[Dd({role:tue,from:g,encode:y,marks:h,layout:f,interactive:s})],m.title&&h.push(Bce(e,n,r.title,g)),u0(Dd({role:Zle,from:g,encode:Eu(afe(i,e,n),a,Md),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}function rfe(e,t){let n=e.type||GL;return!e.type&&ife(e)===1&&(e.fill||e.stroke)&&(n=V1(t)?i0:X1(t)?xE:GL),n!==i0?n:X1(t)?xE:i0}function ife(e){return EE.reduce((t,n)=>t+(e[n]?1:0),0)}function afe(e,t,n){const r={enter:{},update:{}};return Lt(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function ofe(e,t,n){const r=Is(sz("size",e,n)),i=Is(sz("strokeWidth",e,n)),a=Is(sfe(n[1].encode,t,Od));return Ti("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}function sz(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):VL(e,n[0].encode)}function sfe(e,t,n){return VL("fontSize",e)||_ce("fontSize",t,n)}const lfe='item.orient==="'.concat(Tu,'"?-90:item.orient==="').concat(Au,'"?90:0');function ufe(e,t){e=X(e)?{text:e}:e;const n=Fn(e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u={},c=re(t.add(jr(null,[u])));return l.push(dfe(e,n,cfe(e),c)),e.subtitle&&l.push(hfe(e,n,r.subtitle,c)),u0(Dd({role:aue,from:c,encode:ffe(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function cfe(e){const t=e.encode;return t&&t.title||ue({name:e.name,interactive:e.interactive,style:e.style},t)}function ffe(e,t){const n={enter:{},update:{}};return Lt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:TE},angle:{signal:lfe},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Eu(n,t,Md)}function dfe(e,t,n,r){const i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Lt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),er({type:zs,role:oue,style:vce,from:r,encode:o},n)}function hfe(e,t,n,r){const i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Lt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),er({type:zs,role:sue,style:bce,from:r,encode:o},n)}function pfe(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(CE(r,t))}),e.on&&e.on.forEach(r=>{oz(r,t,e.name)}),t.addDataPipeline(e.name,mfe(e,t,n))}function mfe(e,t,n){const r=[];let i=null,a=!1,o=!1,s,l,u,c,f;for(e.values?yt(e.values)||t0(e.format)?(r.push(lz(t,e)),r.push(i=js())):r.push(i=js({$ingest:e.values,$format:e.format})):e.url?t0(e.url)||t0(e.format)?(r.push(lz(t,e)),r.push(i=js())):r.push(i=js({$request:e.url,$format:e.format})):e.source&&(i=s=J(e.source).map(d=>re(t.getData(d).output)),r.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!i&&!f.source&&r.push(i=js()),r.push(c),f.generates&&(o=!0),f.modifies&&!o&&(a=!0),f.source?i=c:f.changes&&(i=null);return s&&(u=s.length-1,r[0]=Vue({derive:a,pulse:u?s:s[0]}),(a||u)&&r.splice(1,0,js())),i||r.push(js()),r.push(Ls({})),r}function js(e){const t=jr({},e);return t.metadata={source:!0},t}function lz(e,t){return jue({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const uz=e=>e===yo||e===Ur,c0=(e,t,n)=>yt(e)?bfe(e.signal,t,n):e===Tu||e===Ur?t:n,Ot=(e,t,n)=>yt(e)?yfe(e.signal,t,n):uz(e)?t:n,Br=(e,t,n)=>yt(e)?vfe(e.signal,t,n):uz(e)?n:t,cz=(e,t,n)=>yt(e)?wfe(e.signal,t,n):e===Ur?{value:t}:{value:n},gfe=(e,t,n)=>yt(e)?xfe(e.signal,t,n):e===Au?{value:t}:{value:n},yfe=(e,t,n)=>fz("".concat(e," === '").concat(Ur,"' || ").concat(e," === '").concat(yo,"'"),t,n),vfe=(e,t,n)=>fz("".concat(e," !== '").concat(Ur,"' && ").concat(e," !== '").concat(yo,"'"),t,n),bfe=(e,t,n)=>OE("".concat(e," === '").concat(Tu,"' || ").concat(e," === '").concat(Ur,"'"),t,n),wfe=(e,t,n)=>OE("".concat(e," === '").concat(Ur,"'"),t,n),xfe=(e,t,n)=>OE("".concat(e," === '").concat(Au,"'"),t,n),fz=(e,t,n)=>(t=t!=null?$t(t):t,n=n!=null?$t(n):n,dz(t)&&dz(n)?(t=t?t.signal||H(t.value):null,n=n?n.signal||H(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[ue({test:e},t)].concat(n||[])),dz=e=>e==null||Object.keys(e).length===1,OE=(e,t,n)=>({signal:"".concat(e," ? (").concat(Cu(t),") : (").concat(Cu(n),")")}),kfe=(e,t,n,r,i)=>({signal:(r!=null?"".concat(e," === '").concat(Tu,"' ? (").concat(Cu(r),") : "):"")+(n!=null?"".concat(e," === '").concat(yo,"' ? (").concat(Cu(n),") : "):"")+(i!=null?"".concat(e," === '").concat(Au,"' ? (").concat(Cu(i),") : "):"")+(t!=null?"".concat(e," === '").concat(Ur,"' ? (").concat(Cu(t),") : "):"")+"(null)"}),Cu=e=>yt(e)?e.signal:e==null?null:H(e),Efe=(e,t)=>t===0?0:yt(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t},$u=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Ou(e,t,n,r){let i;if(t&&te(t,e))return t[e];if(te(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[wE][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[Od][i]}return null}function hz(e){const t={};for(const n of e){if(!n)continue;for(const r in n)t[r]=1}return Object.keys(t)}function Sfe(e,t){var n=t.config,r=n.style,i=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,l,u;if(yt(o)){const f=hz([n.axisX,n.axisY]),d=hz([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(u of f)s[u]=Ot(o,Ou(u,n.axisX,i,r),Ou(u,n.axisY,i,r));l={};for(u of d)l[u]=kfe(o.signal,Ou(u,n.axisTop,i,r),Ou(u,n.axisBottom,i,r),Ou(u,n.axisLeft,i,r),Ou(u,n.axisRight,i,r))}else s=o===Ur||o===yo?n.axisX:n.axisY,l=n["axis"+o[0].toUpperCase()+o.slice(1)];const c=s||l||a?ue({},i,s,l,a):i;return c}function Tfe(e,t,n,r){const i=Fn(e,t),a=e.orient;let o,s;const l={enter:o={opacity:Ee},update:s={opacity:br},exit:{opacity:Ee}};Lt(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=pz(e,0),c=pz(e,1);return o.x=s.x=Ot(a,u,Ee),o.x2=s.x2=Ot(a,c),o.y=s.y=Br(a,u,Ee),o.y2=s.y2=Br(a,c),er({type:SE,role:Vle,from:r,encode:l},n)}function pz(e,t){return{scale:e.scale,range:t}}function Afe(e,t,n,r,i){const a=Fn(e,t),o=e.orient,s=e.gridScale,l=c0(o,1,-1),u=_fe(e.offset,l);let c,f,d;const h={enter:c={opacity:Ee},update:d={opacity:br},exit:f={opacity:Ee}};Lt(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:vr,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=Ot(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:ue(m,{mult:l,offset:u});return c.x=d.x=Ot(o,p,g),c.y=d.y=Br(o,p,g),c.x2=d.x2=Br(o,y),c.y2=d.y2=Ot(o,y),f.x=Ot(o,p),f.y=Br(o,p),er({type:SE,role:Xle,key:vr,from:r,encode:h},n)}function _fe(e,t){if(!(t===1))if(!Q(e))e=yt(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);else{let n=e=ue({},e);for(;n.mult!=null;)if(Q(n.mult))n=n.mult=ue({},n.mult);else return n.mult=yt(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n.mult=t}return e}function Cfe(e,t,n,r,i,a){const o=Fn(e,t),s=e.orient,l=c0(s,-1,1);let u,c,f;const d={enter:u={opacity:Ee},update:f={opacity:br},exit:c={opacity:Ee}};Lt(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=$t(i);h.mult=l;const p={scale:e.scale,field:vr,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=u.y=Ot(s,Ee,p),f.y2=u.y2=Ot(s,h),c.x=Ot(s,p),f.x=u.x=Br(s,Ee,p),f.x2=u.x2=Br(s,h),c.y=Br(s,p),er({type:SE,role:Kle,key:vr,from:r,encode:d},n)}function ME(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function $fe(e,t,n,r,i,a){const o=Fn(e,t),s=e.orient,l=e.scale,u=c0(s,-1,1),c=Is(o("labelFlush")),f=Is(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p=c===0||!!c,m;const g=$t(i);g.mult=u,g.offset=$t(o("labelPadding")||0),g.offset.mult=u;const y={scale:l,field:vr,band:.5,offset:XL(a.offset,o("labelOffset"))},v=Ot(s,p?ME(l,c,'"left"','"right"','"center"'):{value:"center"},gfe(s,"left","right")),b=Ot(s,cz(s,"bottom","top"),p?ME(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),w=ME(l,c,"-(".concat(f,")"),f,0);p=p&&f;const x={opacity:Ee,x:Ot(s,y,g),y:Br(s,y,g)},E={enter:x,update:m={opacity:br,text:{field:bE},x:x.x,y:x.y,align:v,baseline:b},exit:{opacity:Ee,x:x.x,y:x.y}};Lt(E,{dx:!d&&p?Ot(s,w):null,dy:!h&&p?Br(s,w):null}),Lt(E,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const k=o("labelBound");let S=o("labelOverlap");return S=S||k?{separation:o("labelSeparation"),method:S,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,m.align!==v&&(m.align=$u(m.align,v)),m.baseline!==b&&(m.baseline=$u(m.baseline,b)),er({type:zs,role:Jle,style:Od,key:vr,from:r,encode:E,overlap:S},n)}function Ofe(e,t,n,r){const i=Fn(e,t),a=e.orient,o=c0(a,-1,1);let s,l;const u={enter:s={opacity:Ee,anchor:$t(i("titleAnchor",null)),align:{signal:TE}},update:l=ue({},s,{opacity:br,text:$t(e.title)}),exit:{opacity:Ee}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(o0(0,1,.5),")")};return l.x=Ot(a,c),l.y=Br(a,c),s.angle=Ot(a,Ee,Efe(o,90)),s.baseline=Ot(a,cz(a,yo,Ur),{value:yo}),l.angle=s.angle,l.baseline=s.baseline,Lt(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),Mfe(i,a,u,n),u.update.align=$u(u.update.align,s.align),u.update.angle=$u(u.update.angle,s.angle),u.update.baseline=$u(u.update.baseline,s.baseline),er({type:zs,role:Qle,style:wE,from:r,encode:u},n)}function Mfe(e,t,n,r){const i=(s,l)=>s!=null?(n.update[l]=$u($t(s),n.update[l]),!1):!Su(l,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?$t(o):Ot(t,$t(o),$t(a))}function Dfe(e,t){const n=Sfe(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=Fn(e,n),u=Cce(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:e.title!=null},f=re(t.add(jr({},[c]))),d=re(t.add(Nue({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let p;return c.grid&&h.push(Afe(e,n,r.grid,d,u)),c.ticks&&(p=l("tickSize"),h.push(Cfe(e,n,r.ticks,d,p,u))),c.labels&&(p=c.ticks?p:0,h.push($fe(e,n,r.labels,d,p,u))),c.domain&&h.push(Tfe(e,n,r.domain,f)),c.title&&h.push(Ofe(e,n,r.title,f)),u0(Dd({role:Yle,from:f,encode:Eu(Nfe(l,e),i,Md),marks:h,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function Nfe(e,t){const n={enter:{},update:{}};return Lt(n,{orient:e("orient"),offset:e("offset")||0,position:Pr(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function mz(e,t,n){const r=J(e.signals),i=J(e.scales);return n||r.forEach(a=>ML(a,t)),J(e.projections).forEach(a=>fce(a,t)),i.forEach(a=>Zue(a,t)),J(e.data).forEach(a=>pfe(a,t)),i.forEach(a=>ece(a,t)),(n||r).forEach(a=>Due(a,t)),J(e.axes).forEach(a=>Dfe(a,t)),J(e.marks).forEach(a=>u0(a,t)),J(e.legends).forEach(a=>nfe(a,t)),e.title&&ufe(e.title,t),t.parseLambdas(),t}const Rfe=e=>Eu({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Ffe(e,t){const n=t.config,r=re(t.root=t.add(Zg())),i=Ife(e,n);i.forEach(u=>ML(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(jr()),o=t.add(LL($L(Rfe(e.encode),a0,uE,e.style,t,{pulse:re(a)}))),s=t.add(jL({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:re(o)}));t.operators.pop(),t.pushState(re(o),re(s),null),mz(e,t,i),t.operators.push(s);let l=t.add(FL({mark:r,pulse:re(s)}));return l=t.add(PL({pulse:re(l)})),l=t.add(Ls({pulse:re(l)})),t.addData("root",new Ps(t,a,a,l)),t}function Rd(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Ife(e,t){const n=o=>Pr(e[o],t[o]),r=[Rd("background",n("background")),Rd("autosize",Hle(n("autosize"))),Rd("padding",Gle(n("padding"))),Rd("width",n("width")||0),Rd("height",n("height")||0)],i=r.reduce((o,s)=>(o[s.name]=s,o),{}),a={};return J(e.signals).forEach(o=>{te(i,o.name)?o=ue(i[o.name],o):r.push(o),a[o.name]=o}),J(t.signals).forEach(o=>{!te(a,o.name)&&!te(i,o.name)&&r.push(o)}),r}function gz(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function yz(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}gz.prototype=yz.prototype={parse(e){return mz(e,this)},fork(){return new yz(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof dE?re(e):e;return this.add(Yue({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,a){let o,s;r&&(o=r.data||(r.data={}),s=o[i]||(o[i]=[]),s.push(a))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(re(this.add(Ls({pulse:e})))),this._parent.push(t),this._lookup.push(n?re(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ve(this._parent)},encode(){return ve(this._encode)},lookup(){return ve(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(X(e))return Cd(e,t);e.signal||L("Unsupported field reference: "+H(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=re(this.add(Lue(i)))}return r},compareRef(e){let t=!1;const n=a=>yt(a)?(t=!0,this.signalRef(a.signal)):kue(a)?(t=!0,this.exprRef(a.expr)):a,r=J(e.field).map(n),i=J(e.order).map(n);return t?re(this.add(IL({fields:r,orders:i}))):DL(r,i)},keyRef(e,t){let n=!1;const r=a=>yt(a)?(n=!0,re(i[a.signal])):a,i=this.signals;return e=J(e).map(r),n?re(this.add(zue({fields:e,flat:t}))):vue(e,t)},sortRef(e){if(!e)return e;const t=e0(e.op,e.field),n=e.order||bue;return n.signal?re(this.add(IL({fields:t,orders:this.signalRef(n.signal)}))):DL(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return te(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&L("Duplicate signal name: "+H(e));const n=t instanceof dE?t:this.add(Zg(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||L("Unrecognized signal name: "+H(e)),this.signals[e]},signalRef(e){return this.signals[e]?re(this.signals[e]):(te(this.lambdas,e)||(this.lambdas[e]=this.add(Zg(null))),re(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=Ti(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!Q(e)?e:this.signalRef(e.signal||DE(e))},exprRef(e,t){const n={expr:Ti(e,this)};return t&&(n.expr.$name=t),re(this.add(Fue(n)))},addBinding(e,t){this.bindings||L("Nested signals do not support binding: "+H(e)),this.bindings.push(ue({signal:e},t))},addScaleProj(e,t){te(this.scales,e)&&L("Duplicate scale or projection name: "+H(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,Xue(t))},addProjection(e,t){this.addScaleProj(e,Gue(t))},getScale(e){return this.scales[e]||L("Unrecognized scale name: "+H(e)),this.scales[e]},scaleRef(e){return re(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return te(this.data,e)&&L("Duplicate data set name: "+H(e)),this.data[e]=t},getData(e){return this.data[e]||L("Undefined data set name: "+H(e)),this.data[e]},addDataPipeline(e,t){return te(this.data,e)&&L("Duplicate data set name: "+H(e)),this.addData(e,Ps.fromEntries(this,t))}};function DE(e){return(z(e)?Lfe:zfe)(e)}function Lfe(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const i=e[r];n+=(r>0?",":"")+(Q(i)?i.signal||DE(i):H(i))}return n+"]"}function zfe(e){let t="{",n=0,r,i;for(r in e)i=e[r],t+=(++n>1?",":"")+H(r)+":"+(Q(i)?i.signal||DE(i):H(i));return t+"}"}function Pfe(){const e="sans-serif",t=30,n=2,r="#4c78a8",i="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:n},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:n},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function jfe(e,t,n){return Q(e)||L("Input Vega specification must be an object."),t=bl(Pfe(),t,e.config),Ffe(e,new gz(t,n)).toRuntime()}var Ufe="vega",Bfe="5.20.2",qfe="The Vega visualization grammar.",Hfe=["vega","visualization","interaction","dataflow","library","data","d3"],Wfe="BSD-3-Clause",Gfe="UW Interactive Data Lab (http://idl.cs.washington.edu)",Yfe="build/vega-node.js",Vfe="build/vega.module.js",Xfe="build/vega.min.js",Jfe="build/vega.min.js",Kfe="index.d.ts",Qfe="vega/vega",Zfe={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"},ede={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.4","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.4","vega-typings":"~0.21.0","vega-util":"~1.16.1","vega-view":"~5.10.1","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"},tde={"vega-schema":"*"},nde="e251dbc61ab6645689d9f349e7dd9d15ddb85bce",rde={name:Ufe,version:Bfe,description:qfe,keywords:Hfe,license:Wfe,author:Gfe,main:Yfe,module:Vfe,unpkg:Xfe,jsdelivr:Jfe,types:Kfe,repository:Qfe,scripts:Zfe,dependencies:ede,devDependencies:tde,gitHead:nde};ue(Ml,XH,OK,MQ,Yee,jte,pre,qne,gre,Nre,qre,tie);const ide=rde.version;var ade=Object.freeze({__proto__:null,version:ide,Dataflow:Ol,EventStream:Jh,MultiPulse:Pv,Operator:Be,Parameters:Xh,Pulse:Ua,Transform:F,changeset:ns,definition:VC,ingest:Oe,isTuple:Gh,transform:XC,transforms:Ml,tupleid:ne,interpolate:J1,interpolateColors:Np,interpolateRange:sD,quantizeInterpolator:lD,scale:Ce,scheme:K1,projection:n2,View:pL,defaultLocale:Iv,formatLocale:Bh,locale:RC,resetDefaultLocale:nq,timeFormatLocale:$c,expressionFunction:ct,parse:jfe,runtimeContext:W5,codegenExpression:R3,parseExpression:yk,parseSelector:go,Debug:jA,Error:Yy,Info:PA,None:zA,Warn:Vy,accessor:En,accessorFields:jt,accessorName:tt,array:J,ascending:Dh,clampRange:QA,compare:Zy,constant:qt,debounce:ev,error:L,extend:ue,extent:ei,extentIndex:ZA,falsy:Ra,fastmap:wl,field:Sn,flush:e_,hasOwnProperty:te,id:lc,identity:Ut,inherits:q,inrange:xl,isArray:z,isBoolean:Fa,isDate:Ia,isFunction:le,isIterable:t_,isNumber:Le,isObject:Q,isRegExp:n_,isString:X,key:tv,lerp:r_,logger:Xy,lruCache:i_,merge:a_,mergeConfig:bl,one:vl,pad:o_,panLinear:GA,panLog:YA,panPow:VA,panSymlog:XA,peek:ve,quarter:JA,repeat:cc,span:fc,splitAccessPath:Zr,stringValue:H,toBoolean:nv,toDate:rv,toNumber:Bt,toSet:kt,toString:iv,truncate:s_,truthy:or,utcquarter:KA,visitArray:La,writeConfig:uc,zero:Na,zoomLinear:Jy,zoomLog:Ky,zoomPow:Mh,zoomSymlog:Qy,bandwidthNRD:Wv,bin:e$,bootstrapCI:t$,cumulativeLogNormal:Kv,cumulativeNormal:ep,cumulativeUniform:tb,densityLogNormal:Jv,densityNormal:Gv,densityUniform:eb,dotbin:n$,quantileLogNormal:Qv,quantileNormal:tp,quantileUniform:nb,quantiles:qv,quartiles:Hv,get random(){return lr},randomInteger:Vq,randomKDE:Vv,randomLCG:Yq,randomLogNormal:i$,randomMixture:a$,randomNormal:Yv,randomUniform:o$,regressionExp:l$,regressionLinear:rb,regressionLoess:h$,regressionLog:s$,regressionPoly:c$,regressionPow:u$,regressionQuad:ib,sampleCurve:rp,sampleLogNormal:Xv,sampleNormal:Zh,sampleUniform:Zv,setRandom:Wq,DATE:_n,DAY:Wt,DAYOFYEAR:ti,HOURS:Hn,MILLISECONDS:Cr,MINUTES:Wn,MONTH:Ht,QUARTER:An,SECONDS:sr,TIME_UNITS:gv,WEEK:ht,YEAR:Nt,dayofyear:P_,timeBin:iC,timeFloor:G_,timeInterval:Sl,timeOffset:X_,timeSequence:Q_,timeUnitSpecifier:z_,timeUnits:vv,utcFloor:Y_,utcInterval:Tl,utcOffset:J_,utcSequence:Z_,utcdayofyear:B_,utcweek:q_,week:j_,read:FC,inferType:c_,inferTypes:f_,typeParsers:av,format:Fh,formats:fv,responseType:b_,loader:qh,Bounds:mt,CanvasHandler:gf,CanvasRenderer:om,Gradient:SD,GroupItem:Pp,Handler:no,Item:zp,Marks:Gn,RenderType:io,Renderer:hi,ResourceLoader:lw,SVGHandler:Lw,SVGRenderer:Hw,SVGStringRenderer:Yw,Scenegraph:Dw,boundClip:BN,boundContext:sf,boundItem:Mw,boundMark:rN,boundStroke:ea,domChild:$n,domClear:Dr,domCreate:to,domFind:Nw,font:Kp,fontFamily:df,fontSize:di,intersect:zN,intersectBoxLine:Jl,intersectPath:mw,intersectPoint:gw,intersectRule:BD,lineHeight:Za,markup:qw,multiLineOffset:Cw,pathCurves:nw,pathEqual:qN,pathParse:Yl,pathRectangle:MD,pathRender:tf,pathSymbols:OD,pathTrail:DD,point:Zp,renderModule:lm,resetSVGClipId:RD,resetSVGDefIds:GJ,sceneEqual:Xw,sceneFromJSON:aN,scenePickVisit:Gp,sceneToJSON:iN,sceneVisit:Mr,sceneZOrder:yw,serializeXML:_N,textMetrics:fi});const ode="vega-lite",sde='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',lde="5.1.0",ude=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],cde="https://vega.github.io/vega-lite/",fde="Vega-Lite is a concise high-level language for interactive visualization.",dde="build/vega-lite.js",hde="build/vega-lite.min.js",pde="build/vega-lite.min.js",mde="build/src/index",gde="build/src/index.d.ts",yde={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},vde={test:"test"},bde=["bin","build","src","vega-lite*","tsconfig.json"],wde={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:cover":"jest --collectCoverage test/","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"jest --watch test/"},xde={type:"git",url:"https://github.com/vega/vega-lite.git"},kde="BSD-3-Clause",Ede={url:"https://github.com/vega/vega-lite/issues"},Sde={"@babel/core":"^7.13.15","@babel/preset-env":"^7.13.15","@babel/preset-typescript":"^7.13.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^18.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.1","@types/chai":"^4.2.16","@types/d3":"^6.3.0","@types/jest":"^26.0.22","@types/mkdirp":"^1.0.1","@types/pako":"^1.0.1","@typescript-eslint/eslint-plugin":"^4.22.0","@typescript-eslint/parser":"^4.22.0",ajv:"^8.1.0","ajv-formats":"^2.0.2",chai:"^4.3.4",cheerio:"^1.0.0-rc.6","conventional-changelog-cli":"^2.1.1",d3:"^6.7.0","del-cli":"^3.0.1",eslint:"^7.24.0","eslint-config-prettier":"^8.2.0","eslint-plugin-jest":"^24.3.5","eslint-plugin-prettier":"^3.4.0","gh-pages":"^3.1.0","highlight.js":"^10.7.2",jest:"^26.6.3","jest-dev-server":"^5.0.0",mkdirp:"^1.0.4",pako:"^2.0.3",prettier:"^2.2.1",puppeteer:"^8.0.0",rollup:"^2.45.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^11.3.2",terser:"^5.6.1","ts-json-schema-generator":"^0.90.0",typescript:"~4.2.4","vega-cli":"^5.20.2","vega-datasets":"~2.2.0","vega-embed":"^6.17.0","vega-tooltip":"^0.25.1","yaml-front-matter":"^4.1.1"},Tde={"@types/clone":"~2.1.0","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.2.0","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.1",yargs:"~16.2.0"},Ade={vega:"^5.20.0"},_de={testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1,setupFiles:["./test/jest.overrides.ts"]};var Cde={name:ode,author:sde,version:lde,collaborators:ude,homepage:cde,description:fde,main:dde,unpkg:hde,jsdelivr:pde,module:mde,types:gde,bin:yde,directories:vde,files:bde,scripts:wde,repository:xde,license:kde,bugs:Ede,devDependencies:Sde,dependencies:Tde,peerDependencies:Ade,jest:_de};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var $de=dA(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var r;try{r=Map}catch(d){r=function(){}}var i;try{i=Set}catch(d){i=function(){}}var a;try{a=Promise}catch(d){a=function(){}}function o(d,h,p,m,g){typeof h=="object"&&(p=h.depth,m=h.prototype,g=h.includeNonEnumerable,h=h.circular);var y=[],v=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof p=="undefined"&&(p=Infinity);function w(x,E){if(x===null)return null;if(E===0)return x;var k,S;if(typeof x!="object")return x;if(n(x,r))k=new r();else if(n(x,i))k=new i();else if(n(x,a))k=new a(function(P,W){x.then(function(B){P(w(B,E-1))},function(B){W(w(B,E-1))})});else if(o.__isArray(x))k=[];else if(o.__isRegExp(x))k=new RegExp(x.source,f(x)),x.lastIndex&&(k.lastIndex=x.lastIndex);else if(o.__isDate(x))k=new Date(x.getTime());else{if(b&&Buffer.isBuffer(x))return Buffer.allocUnsafe?k=Buffer.allocUnsafe(x.length):k=new Buffer(x.length),x.copy(k),k;n(x,Error)?k=Object.create(x):typeof m=="undefined"?(S=Object.getPrototypeOf(x),k=Object.create(S)):(k=Object.create(m),S=m)}if(h){var A=y.indexOf(x);if(A!=-1)return v[A];y.push(x),v.push(k)}n(x,r)&&x.forEach(function(P,W){var B=w(W,E-1),se=w(P,E-1);k.set(B,se)}),n(x,i)&&x.forEach(function(P){var W=w(P,E-1);k.add(W)});for(var C in x){var _;if(S&&(_=Object.getOwnPropertyDescriptor(S,C)),_&&_.set==null)continue;k[C]=w(x[C],E-1)}if(Object.getOwnPropertySymbols)for(var D=Object.getOwnPropertySymbols(x),C=0;C<D.length;C++){var M=D[C],N=Object.getOwnPropertyDescriptor(x,M);if(N&&!N.enumerable&&!g)continue;k[M]=w(x[M],E-1),N.enumerable||Object.defineProperty(k,M,{enumerable:!1})}if(g)for(var T=Object.getOwnPropertyNames(x),C=0;C<T.length;C++){var O=T[C],N=Object.getOwnPropertyDescriptor(x,O);if(N&&N.enumerable)continue;k[O]=w(x[O],E-1),Object.defineProperty(k,O,{enumerable:!1})}return k}return w(d,p)}o.clonePrototype=function(h){if(h===null)return null;var p=function(){};return p.prototype=h,new p()};function s(d){return Object.prototype.toString.call(d)}o.__objToStr=s;function l(d){return typeof d=="object"&&s(d)==="[object Date]"}o.__isDate=l;function u(d){return typeof d=="object"&&s(d)==="[object Array]"}o.__isArray=u;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)}),Ode=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},NE=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(a){return function(o){return function(s,l){var u={key:s,value:o[s]},c={key:l,value:o[l]};return a(u,c)}}}(t.cmp),i=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var s,l;if(Array.isArray(o)){for(l="[",s=0;s<o.length;s++)s&&(l+=","),l+=a(o[s])||"null";return l+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=i.push(o)-1,c=Object.keys(o).sort(r&&r(o));for(l="",s=0;s<c.length;s++){var f=c[s],d=a(o[f]);if(!d)continue;l&&(l+=","),l+=JSON.stringify(f)+":"+d}return i.splice(u,1),"{"+l+"}"}(e)};function RE(e){return!!e.or}function FE(e){return!!e.and}function IE(e){return!!e.not}function f0(e,t){if(IE(e))f0(e.not,t);else if(FE(e))for(const n of e.and)f0(n,t);else if(RE(e))for(const n of e.or)f0(n,t);else t(e)}function Mu(e,t){return IE(e)?{not:Mu(e.not,t)}:FE(e)?{and:e.and.map(n=>Mu(n,t))}:RE(e)?{or:e.or.map(n=>Mu(n,t))}:t(e)}const Ai=Ode,fe=$de;function Du(e,t){const n={};for(const r of t)te(e,r)&&(n[r]=e[r]);return n}function tr(e,t){const n={...e};for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>NE(e)).join(",")})`};const We=NE;function be(e){if(Le(e))return e;const t=X(e)?e:NE(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);n=(n<<5)-n+i,n=n&n}return n}function LE(e){return e===!1||e===null}function de(e,t){return e.includes(t)}function Nu(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function zE(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function vz(e,...t){for(const n of t)Mde(e,n??{});return e}function Mde(e,t){for(const n of j(t))uc(e,n,t[n],!0)}function _i(e,t){const n=[],r={};let i;for(const a of e){if(i=t(a),i in r)continue;r[i]=1,n.push(a)}return n}function Dde(e,t){const n=j(e),r=j(t);if(n.length!==r.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0}function bz(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function PE(e,t){for(const n of e)if(t.has(n))return!0;return!1}function jE(e){const t=new Set();for(const n of e){const r=Zr(n),i=r.map((o,s)=>s===0?o:`[${o}]`),a=i.map((o,s)=>i.slice(0,s+1).join(""));for(const o of a)t.add(o)}return t}function UE(e,t){return e===void 0||t===void 0?!0:PE(jE(e),jE(t))}function Pe(e){return j(e).length===0}const j=Object.keys,gn=Object.values,vo=Object.entries;function Fd(e){return e===!0||e===!1}function Je(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Id(e,t){return IE(e)?`!(${Id(e.not,t)})`:FE(e)?`(${e.and.map(n=>Id(n,t)).join(") && (")})`:RE(e)?`(${e.or.map(n=>Id(n,t)).join(") || (")})`:t(e)}function d0(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&d0(e[n],t)&&delete e[n],Pe(e)}function Ld(e){return e.charAt(0).toUpperCase()+e.substr(1)}function BE(e,t="datum"){const n=Zr(e),r=[];for(let i=1;i<=n.length;i++){const a=`[${n.slice(0,i).map(H).join("][")}]`;r.push(`${t}${a}`)}return r.join(" && ")}function wz(e,t="datum"){return`${t}[${H(Zr(e).join("."))}]`}function Nde(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function wr(e){return`${Zr(e).map(Nde).join("\\.")}`}function Us(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function qE(e){return`${Zr(e).join(".")}`}function Ru(e){return e?Zr(e).length:0}function ft(...e){for(const t of e)if(t!==void 0)return t;return}let xz=42;function kz(e){const t=++xz;return e?String(e)+t:t}function Rde(){xz=42}function Ez(e){return Sz(e)?e:`__${e}`}function Sz(e){return e.startsWith("__")}function zd(e){return e===void 0?void 0:(e%360+360)%360}function h0(e){return Le(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const pa="row",ma="column",p0="facet",et="x",vt="y",qr="x2",Ci="y2",$i="radius",ga="radius2",Hr="theta",ya="theta2",Oi="latitude",Mi="longitude",Wr="latitude2",xr="longitude2",In="color",Di="fill",Ni="stroke",Ln="shape",va="size",Bs="angle",ba="opacity",bo="fillOpacity",wo="strokeOpacity",xo="strokeWidth",ko="strokeDash",Pd="text",jd="order",Ud="detail",m0="key",qs="tooltip",g0="href",y0="url",v0="description",Fde={x:1,y:1,x2:1,y2:1},Tz={theta:1,theta2:1,radius:1,radius2:1};function Az(e){return e in Tz}const HE={longitude:1,longitude2:1,latitude:1,latitude2:1};function Ide(e){switch(e){case Oi:return"y";case Wr:return"y2";case Mi:return"x";case xr:return"x2"}}function Lde(e){return e in HE}const zde=j(HE),_z={...Fde,...Tz,...HE,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Fu(e){return e===In||e===Di||e===Ni}const Cz={row:1,column:1,facet:1},kr=j(Cz),WE={..._z,...Cz},Pde=j(WE),{order:Ywe,detail:Vwe,tooltip:Xwe,...jde}=WE,{row:Jwe,column:Kwe,facet:Qwe,...Ude}=jde;function Bde(e){return!!Ude[e]}function $z(e){return!!WE[e]}const qde=[qr,Ci,Wr,xr,ya,ga];function Oz(e){const t=Hs(e);return t!==e}function Hs(e){switch(e){case qr:return et;case Ci:return vt;case Wr:return Oi;case xr:return Mi;case ya:return Hr;case ga:return $i}return e}function Eo(e){if(Az(e))switch(e){case Hr:return"startAngle";case ya:return"endAngle";case $i:return"outerRadius";case ga:return"innerRadius"}return e}function wa(e){switch(e){case et:return qr;case vt:return Ci;case Oi:return Wr;case Mi:return xr;case Hr:return ya;case $i:return ga}return}function Er(e){switch(e){case et:case qr:return"width";case vt:case Ci:return"height"}return}function Hde(e){switch(e){case et:return"xOffset";case vt:return"yOffset";case qr:return"x2Offset";case Ci:return"y2Offset";case Hr:return"thetaOffset";case $i:return"radiusOffset";case ya:return"theta2Offset";case ga:return"radius2Offset"}return}const{x:Zwe,y:exe,x2:txe,y2:nxe,latitude:rxe,longitude:ixe,latitude2:axe,longitude2:oxe,theta:sxe,theta2:lxe,radius:uxe,radius2:cxe,...GE}=_z,Wde=j(GE),So={x:1,y:1},Ri=j(So);function Fi(e){return e in So}const YE={theta:1,radius:1},Gde=j(YE);function b0(e){return e==="width"?et:vt}const{text:fxe,tooltip:dxe,href:hxe,url:pxe,description:mxe,detail:gxe,key:yxe,order:vxe,...Mz}=GE,Yde=j(Mz);function Vde(e){return!!GE[e]}function Xde(e){switch(e){case In:case Di:case Ni:case va:case Ln:case ba:case xo:case ko:return!0;case bo:case wo:case Bs:return!1}}const Dz={...So,...YE,...Mz},w0=j(Dz);function To(e){return!!Dz[e]}function Jde(e,t){return Qde(e)[t]}const Nz={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:bxe,...Kde}=Nz;function Qde(e){switch(e){case In:case Di:case Ni:case v0:case Ud:case m0:case qs:case g0:case jd:case ba:case bo:case wo:case xo:case p0:case pa:case ma:return Nz;case et:case vt:case Oi:case Mi:return Kde;case qr:case Ci:case Wr:case xr:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case va:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case ko:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Ln:return{point:"always",geoshape:"always"};case Pd:return{text:"always"};case Bs:return{point:"always",square:"always",text:"always"};case y0:return{image:"always"};case Hr:return{text:"always",arc:"always"};case $i:return{text:"always",arc:"always"};case ya:case ga:return{arc:"always"}}}function VE(e){switch(e){case et:case vt:case Hr:case $i:case va:case Bs:case xo:case ba:case bo:case wo:case qr:case Ci:case ya:case ga:return;case p0:case pa:case ma:case Ln:case ko:case Pd:case qs:case g0:case y0:case v0:return"discrete";case In:case Di:case Ni:return"flexible";case Oi:case Mi:case Wr:case xr:case Ud:case m0:case jd:return}}const Zde={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},ehe={count:1,min:1,max:1};function xa(e){return!!e&&!!e.argmin}function Ao(e){return!!e&&!!e.argmax}function XE(e){return X(e)&&!!Zde[e]}const the=["count","valid","missing","distinct"];function Rz(e){return X(e)&&de(the,e)}function nhe(e){return X(e)&&de(["min","max"],e)}const rhe=["count","sum","distinct","valid","missing"],ihe=["mean","average","median","q1","q3","min","max"],ahe=kt(ihe);function Fz(e){return Fa(e)&&(e=j0(e,void 0)),"bin"+j(e).map(t=>x0(e[t])?Je(`_${t}_${vo(e[t])}`):Je(`_${t}_${e[t]}`)).join("")}function Ge(e){return e===!0||Ws(e)&&!e.binned}function yn(e){return e==="binned"||Ws(e)&&e.binned===!0}function Ws(e){return Q(e)}function x0(e){return e?.param}function Iz(e){switch(e){case pa:case ma:case va:case In:case Di:case Ni:case xo:case ba:case bo:case wo:case Ln:return 6;case ko:return 4;default:return 10}}function Bd(e){return e&&!!e.expr}function zn(e){const t=j(e||{}),n={};for(const r of t)n[r]=nr(e[r]);return n}function Lz(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d,...h}=e,p={...h,...a?{fill:a}:{}},m={...t?{anchor:t}:{},...n?{frame:n}:{},...r?{offset:r}:{},...i?{orient:i}:{}},g={...o?{subtitleColor:o}:{},...s?{subtitleFont:s}:{},...l?{subtitleFontSize:l}:{},...u?{subtitleFontStyle:u}:{},...c?{subtitleFontWeight:c}:{},...f?{subtitleLineHeight:f}:{},...d?{subtitlePadding:d}:{}},y=Du(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:y,nonMark:m,subtitle:g}}function _o(e){return X(e)||z(e)&&X(e[0])}function ie(e){return e&&!!e.signal}function Co(e){return!!e.step}function ohe(e){return z(e)?!1:"fields"in e&&!("data"in e)}function she(e){return z(e)?!1:"fields"in e&&"data"in e}function ka(e){return z(e)?!1:"field"in e&&"data"in e}const lhe={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},uhe=j(lhe),che={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},JE=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function zz(e){const t=z(e.condition)?e.condition.map(Pz):Pz(e.condition);return{...nr(e),condition:t}}function nr(e){if(Bd(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Pz(e){if(Bd(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Ke(e){if(Bd(e)){const{expr:t,...n}=e;return{signal:t,...n}}return ie(e)?e:e!==void 0?{value:e}:void 0}function jz(e){return ie(e)?e.signal:H(e.value)}function Ea(e){return ie(e)?e.signal:e==null?null:H(e)}function fhe(e,t,n){for(const r of n){const i=Gs(r,t.markDef,t.config);i!==void 0&&(e[r]=Ke(i))}return e}function Uz(e){return[].concat(e.type,e.style??[])}function Ne(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:a&&(!i||i===e)?void 0:Gs(e,t,n,r)}function Gs(e,t,n,{vgChannel:r}={}){return ft(r?k0(e,t,n.style):void 0,k0(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function k0(e,t,n){return Bz(e,Uz(t),n)}function Bz(e,t,n){t=J(t);let r;for(const i of t){const a=n[i];a&&a[e]!==void 0&&(r=a[e])}return r}function qz(e,t){return J(e).reduce((n,r)=>(n.field.push(Y(r,t)),n.order.push(r.sort??"ascending"),n),{field:[],order:[]})}function Hz(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(Ai(i,r))return;n.push(r)}),n}function Wz(e,t){return Ai(e,t)||!t?e:e?[...J(e),...J(t)].join(", "):t}function Gz(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((_o(n)||ie(n))&&(_o(r)||ie(r)))return{explicit:e.explicit,value:Wz(n,r)};if(_o(n)||ie(n))return{explicit:e.explicit,value:n};if(_o(r)||ie(r))return{explicit:e.explicit,value:r};if(!_o(n)&&!ie(n)&&!_o(r)&&!ie(r))return{explicit:e.explicit,value:Hz(n,r)};throw new Error("It should never reach here")}function KE(e){return`Invalid specification ${We(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const dhe='Autosize "fit" only works for single views and layered views.';function Yz(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function Vz(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function Xz(e){return e?`Dropping "fit-${e}" because spec has discrete ${Er(e)}.`:'Dropping "fit" because spec has discrete size.'}function QE(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Jz(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function hhe(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function phe(e){return`The "nearest" transform is not supported for ${e} marks.`}function Kz(e){return`Selection not supported for ${e} yet.`}function mhe(e){return`Cannot find a selection named "${e}".`}const ghe="Scale bindings are currently only supported for scales with unbinned, continuous domains.",yhe="Legend bindings are only supported for selections over an individual field or encoding channel.";function vhe(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function bhe(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const whe="The same selection must be used to override scale domains in a layered view.",xhe='Interval selections should be initialized using "x" and/or "y" keys.';function khe(e){return`Unknown repeated value "${e}".`}function Qz(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Ehe="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function She(e){return`Unrecognized parse "${e}".`}function Zz(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const The="Attempt to add the same child twice.";function Ahe(e){return`Ignoring an invalid transform: ${We(e)}.`}const _he='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function eP(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Che(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${We(t)} is overridden by a child projection ${We(n)}.`}const $he="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Ohe(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${We(n)}}.`}function tP(e){return`Invalid field type "${e}".`}function Mhe(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function Dhe(e){return`Invalid aggregation operator "${e}".`}function nP(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function Nhe(e){return`Position range does not support relative band size for ${e}.`}function ZE(e,t){return`Dropping ${We(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const Rhe="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function E0(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function Fhe(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function Ihe(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Lhe(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function zhe(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function eS(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function Phe(e){return`The ${e} for range marks cannot be an expression`}function jhe(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function Uhe(e,t){return`Specified orient "${e}" overridden with "${t}".`}function Bhe(e){return`Cannot use the scale property "${e}" with non-color channel.`}function qhe(e){return`Cannot use the relative band size with ${e} scale.`}function Hhe(e){return`Using unaggregated domain with raw field has no effect (${We(e)}).`}function Whe(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ghe(e){return`Unaggregated domain is currently unsupported for log scale (${We(e)}).`}function Yhe(e){return`Cannot apply size to non-oriented mark "${e}".`}function Vhe(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Xhe(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function rP(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function iP(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Jhe(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${We(n)} and ${We(r)}). Using ${We(n)}.`}function Khe(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${We(n)} and ${We(r)}). Using the union of the two domains.`}function Qhe(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Zhe(e){return`Dropping sort property ${We(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const aP="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",epe="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",tpe="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",npe="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function rpe(e){return`Cannot stack "${e}" if there is already "${e}2".`}function ipe(e){return`Cannot stack non-linear scale (${e}).`}function ape(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function S0(e,t){return`Invalid ${e}: ${We(t)}.`}function ope(e){return`Dropping day from datetime ${We(e)} as day cannot be combined with other units.`}function spe(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function lpe(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function upe(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function oP(e){return`1D error band does not support ${e}.`}function sP(e){return`Channel ${e} is required for "binned" bin.`}function cpe(e){return`Channel ${e} should not be used with "binned" bin.`}function fpe(e){return`Domain for ${e} is required for threshold scale.`}var wxe=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},xxe=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};const lP=Xy(Vy);let Iu=lP;function dpe(e){return Iu=e,Iu}function hpe(){return Iu=lP,Iu}function U(...e){Iu.warn(...e)}function ppe(...e){Iu.debug(...e)}function Ys(e){if(e&&Q(e)){for(const t of nS)if(t in e)return!0}return!1}const uP=["january","february","march","april","may","june","july","august","september","october","november","december"],mpe=uP.map(e=>e.substr(0,3)),cP=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],gpe=cP.map(e=>e.substr(0,3));function ype(e){if(h0(e)&&(e=+e),Le(e))return e>4&&U(S0("quarter",e)),e-1;throw new Error(S0("quarter",e))}function vpe(e){if(h0(e)&&(e=+e),Le(e))return e-1;{const t=e.toLowerCase(),n=uP.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=mpe.indexOf(r);if(i!==-1)return i;throw new Error(S0("month",e))}}function bpe(e){if(h0(e)&&(e=+e),Le(e))return e%7;{const t=e.toLowerCase(),n=cP.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=gpe.indexOf(r);if(i!==-1)return i;throw new Error(S0("day",e))}}function tS(e,t){const n=[];if(t&&e.day!==void 0&&(j(e).length>1&&(U(ope(e)),e=fe(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?vpe(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?ype(e.quarter):e.quarter;n.push(Le(r)?r*3:`${r}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?bpe(e.day):e.day;n.push(Le(r)?r+1:`${r}+1`)}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(typeof i=="undefined"?0:i)}return n}function qd(e){const t=tS(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function wpe(e){const t=tS(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function xpe(e){const t=tS(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const fP={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},nS=j(fP);function kpe(e){return!!fP[e]}function rS(e){return e.startsWith("utc")}function Epe(e){return e.substr(3)}const Spe={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function iS(e){return nS.filter(t=>dP(e,t))}function dP(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function Tpe(e,t,{end:n}={end:!1}){const r=BE(t),i=rS(e)?"utc":"";function a(l){return l==="quarter"?`(${i}quarter(${r})-1)`:`${i}${l}(${r})`}let o;const s={};for(const l of nS)dP(e,l)&&(s[l]=a(l),o=l);return n&&(s[o]+="+1"),wpe(s)}function hP(e){if(!e)return;const t=iS(e);return`timeUnitSpecifier(${We(t)}, ${We(Spe)})`}function Ape(e,t,n){if(!e)return;const r=hP(e),i=n||rS(e);return`${i?"utc":"time"}Format(${t}, ${r})`}function vn(e){if(!e)return;let t;return X(e)?t={unit:e}:Q(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),rS(t.unit)&&(t.utc=!0,t.unit=Epe(t.unit)),t}function _pe(e){const{utc:t,...n}=vn(e);return n.unit?(t?"utc":"")+j(n).map(r=>Je(`${r==="unit"?"":`_${r}_`}${n[r]}`)).join(""):(t?"utc":"")+"timeunit"+j(n).map(r=>Je(`_${r}_${n[r]}`)).join("")}function Cpe(e){return e?.param}function aS(e){return e&&!!e.field&&e.equal!==void 0}function oS(e){return e&&!!e.field&&e.lt!==void 0}function sS(e){return e&&!!e.field&&e.lte!==void 0}function lS(e){return e&&!!e.field&&e.gt!==void 0}function uS(e){return e&&!!e.field&&e.gte!==void 0}function cS(e){if(e&&e.field){if(z(e.range)&&e.range.length===2)return!0;if(ie(e.range))return!0}return!1}function fS(e){return e&&!!e.field&&(z(e.oneOf)||z(e.in))}function $pe(e){return e&&!!e.field&&e.valid!==void 0}function pP(e){return fS(e)||aS(e)||cS(e)||oS(e)||lS(e)||sS(e)||uS(e)}function Ii(e,t){return U0(e,{timeUnit:t,wrapTime:!0})}function Ope(e,t){return e.map(n=>Ii(n,t))}function mP(e,t=!0){const{field:n}=e,r=vn(e.timeUnit)?.unit,i=r?`time(${Tpe(r,n)})`:Y(e,{expr:"datum"});if(aS(e))return`${i}===${Ii(e.equal,r)}`;if(oS(e)){const a=e.lt;return`${i}<${Ii(a,r)}`}else if(lS(e)){const a=e.gt;return`${i}>${Ii(a,r)}`}else if(sS(e)){const a=e.lte;return`${i}<=${Ii(a,r)}`}else if(uS(e)){const a=e.gte;return`${i}>=${Ii(a,r)}`}else{if(fS(e))return`indexof([${Ope(e.oneOf,r).join(",")}], ${i}) !== -1`;if($pe(e))return dS(i,e.valid);if(cS(e)){const{range:a}=e,o=ie(a)?{signal:`${a.signal}[0]`}:a[0],s=ie(a)?{signal:`${a.signal}[1]`}:a[1];if(o!==null&&s!==null&&t)return"inrange("+i+", ["+Ii(o,r)+", "+Ii(s,r)+"])";const l=[];return o!==null&&l.push(`${i} >= ${Ii(o,r)}`),s!==null&&l.push(`${i} <= ${Ii(s,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${We(e)}`)}function dS(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function Mpe(e){return pP(e)&&e.timeUnit?{...e,timeUnit:vn(e.timeUnit)?.unit}:e}const Hd={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Vs=Hd.quantitative,hS=Hd.ordinal,Lu=Hd.temporal,pS=Hd.nominal,zu=Hd.geojson;function Dpe(e){if(e){e=e.toLowerCase();switch(e){case"q":case Vs:return"quantitative";case"t":case Lu:return"temporal";case"o":case hS:return"ordinal";case"n":case pS:return"nominal";case zu:return"geojson"}}return}const bt={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},mS={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Npe(e,t){const n=mS[e],r=mS[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const Rpe={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function gP(e){return Rpe[e]}const yP=["linear","log","pow","sqrt","symlog","time","utc"],Fpe=kt(yP),Ipe=["linear","log","pow","sqrt","symlog"],Lpe=kt(Ipe);function zpe(e){return e in Lpe}const Ppe=["quantile","quantize","threshold"],jpe=kt(Ppe),Upe=yP.concat(["quantile","quantize","threshold","sequential","identity"]),Bpe=kt(Upe),qpe=["ordinal","bin-ordinal","point","band"],Hpe=kt(qpe);function en(e){return e in Hpe}function rr(e){return e in Bpe}function Gr(e){return e in Fpe}function Wd(e){return e in jpe}const Wpe={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Gpe(e){return!X(e)&&!!e.name}function vP(e){return e?.param}function Ype(e){return e&&e.unionWith}const Vpe={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:kxe,domain:Exe,range:Sxe,rangeMax:Txe,rangeMin:Axe,scheme:_xe,...Xpe}=Vpe,Jpe=j(Xpe);function gS(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Gr(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Gr(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Gr(e);case"nice":return Gr(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return rr(e)&&!de(["log","time","utc","threshold","quantile"],e)}}function bP(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Fu(e)?void 0:Bhe(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Kpe(e,t){return de([hS,pS],t)?e===void 0||en(e):t===Lu?de([bt.TIME,bt.UTC,void 0],e):t===Vs?de([bt.LOG,bt.POW,bt.SQRT,bt.SYMLOG,bt.QUANTILE,bt.QUANTIZE,bt.THRESHOLD,bt.LINEAR,void 0],e):!0}function Qpe(e,t){if(!To(e))return!1;switch(e){case et:case vt:case Hr:case $i:return Gr(t)||de(["band","point"],t);case va:case xo:case ba:case bo:case wo:case Bs:return Gr(t)||Wd(t)||de(["band","point","ordinal"],t);case In:case Di:case Ni:return t!=="band";case ko:case Ln:return t==="ordinal"||Wd(t)}}const bn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},wP=bn.arc,T0=bn.area,A0=bn.bar,Zpe=bn.image,_0=bn.line,C0=bn.point,eme=bn.rect,$0=bn.rule,xP=bn.text,yS=bn.tick,tme=bn.trail,vS=bn.circle,bS=bn.square,kP=bn.geoshape;function $o(e){return["line","area","trail"].includes(e)}function EP(e){return["rect","bar","image","arc"].includes(e)}const SP=j(bn);function Li(e){return e.type}const Cxe=kt(SP),nme=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],rme=["fill","fillOpacity"],ime=[...nme,...rme],ame={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},TP=j(ame),ome={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},sme={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},lme={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},AP=j(lme);function Pu(e){return e&&e.band!=null}const ume={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},_P=5,cme={binSpacing:1,continuousBandSize:_P,timeUnitBandPosition:.5},fme={binSpacing:0,continuousBandSize:_P,timeUnitBandPosition:.5},dme={thickness:1};function hme(e){return Li(e)?e.type:e}function wS(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=$P(e);return V(n)&&!Rz(n.aggregate)&&i&&Gr(i.get("type"))&&i.get("zero")===!1?CP({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function CP({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){if($o(n.type))return r;const a=Ne("invalid",n,i);return a===null?r:[pme(e,t),r]}function pme(e,t){const n=xS(e,!0),r=Hs(t),i=r==="y"?{field:{group:"height"}}:{value:0};return{test:n,...i}}function xS(e,t=!0){return dS(X(e)?e:Y(e,{expr:"datum"}),!t)}function mme(e){const{datum:t}=e;return Ys(t)?qd(t):`${We(t)}`}function Xs(e,t,n,r){const i={};if(t&&(i.scale=t),Mo(e)){const{datum:a}=e;Ys(a)?i.signal=qd(a):ie(a)?i.signal=a.signal:Bd(a)?i.signal=a.expr:i.value=a}else i.field=Y(e,n);if(r){const{offset:a,band:o}=r;a&&(i.offset=a),o&&(i.band=o)}return i}function O0({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,bandPosition:a=.5}){const o=0<a&&a<1?"datum":void 0,s=Y(t,{expr:o,suffix:i}),l=n!==void 0?Y(n,{expr:o}):Y(t,{suffix:"end",expr:o}),u={};if(a===0||a===1){u.scale=e;const c=a===0?s:l;u.field=c}else{const c=ie(a)?`${a.signal} * ${s} + (1-${a.signal}) * ${l}`:`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${c})`}return r&&(u.offset=r),u}function $P({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,bandPosition:c}){if(t){if(ae(t)){if(Sr(t)){c??(c=UP({fieldDef:t,fieldDef2:n,markDef:r,config:i}));const{bin:d,timeUnit:h,type:p}=t;if(Ge(d)||c&&h&&p===Lu)return s&&s.impute?Xs(t,a,{binSuffix:"mid"},{offset:l}):c?O0({scaleName:a,fieldOrDatumDef:t,bandPosition:c,offset:l}):Xs(t,a,Vd(t,e)?{binSuffix:"range"}:{},{offset:l});if(yn(d)){if(V(n))return O0({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:l});{const m=e===et?qr:Ci;U(sP(m))}}}const f=o?.get("type");return Xs(t,a,en(f)?{binSuffix:"range"}:{},{offset:l,band:f==="band"?c??t.bandPosition??.5:void 0})}else if(Yr(t)){const f=t.value,d=l?{offset:l}:{};return{...Gd(e,f),...d}}}return le(u)&&(u=u()),u&&{...u,...l?{offset:l}:{}}}function Gd(e,t){return de(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:de(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Ke(t)}function Js(e){return e&&e!=="number"&&e!=="time"}function OP(e,t,n){return`${e}(${t}${n?`, ${We(n)}`:""})`}const gme="  ";function kS({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){if(Js(n))return ES({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const o=MP(e,r,i);if(qu(e)){const s=vme(o,V(e)?vn(e.timeUnit)?.unit:void 0,t,a.timeFormat,ju(e)&&e.scale?.type===bt.UTC);return s?{signal:s}:void 0}if(t=RP(Oo(e),t,a),V(e)&&Ge(e.bin)){const s=Y(e,{expr:r,binSuffix:"end"});return{signal:M0(o,s,t,n,a)}}else return t||Oo(e)==="quantitative"?{signal:`${FP(o,t)}`}:{signal:`isValid(${o}) ? ${o} : ""+${o}`}}function MP(e,t,n){return V(e)?n?`${Y(e,{expr:t,suffix:"end"})}-${Y(e,{expr:t,suffix:"start"})}`:Y(e,{expr:t}):mme(e)}function ES({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){if(o??(o=MP(e,r,i)),V(e)&&Ge(e.bin)){const s=Y(e,{expr:r,binSuffix:"end"});return{signal:M0(o,s,t,n,a)}}return{signal:OP(n,o,t)}}function DP(e,t,n,r,i,a){if(Js(r))return;if(qu(e)){const o=V(e)?vn(e.timeUnit)?.unit:void 0;return yme(n,o,i,a)}return RP(t,n,i)}function NP(e,t,n){return e&&(ie(e)||e==="number"||e==="time")?e:qu(t)&&n!=="time"&&n!=="utc"?"time":void 0}function RP(e,t,n){return X(t)?t:e===Vs?n.numberFormat:void 0}function yme(e,t,n,r){return e||(t?{signal:hP(t)}:r?void 0:n.timeFormat)}function FP(e,t){return`format(${e}, "${t||""}")`}function IP(e,t,n,r){return Js(n)?OP(n,e,t):FP(e,(X(t)?t:void 0)??r.numberFormat)}function M0(e,t,n,r,i){const a=IP(e,n,r,i),o=IP(t,n,r,i);return`${dS(e,!1)} ? "null" : ${a} + "${gme}" + ${o}`}function vme(e,t,n,r,i){return!t||n?(n=X(n)?n:r,`${i?"utc":"time"}Format(${e}, '${n}')`):Ape(t,e,i)}const D0="min",bme={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function LP(e){return e in bme}function zP(e){return!!e&&!!e.encoding}function zi(e){return!!e&&(e.op==="count"||!!e.field)}function PP(e){return!!e&&z(e)}function Yd(e){return"row"in e||"column"in e}function SS(e){return!!e&&"header"in e}function N0(e){return"facet"in e}function wme(e){return e.param}function xme(e){return e&&!X(e)&&"repeat"in e}function jP(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return{...n?{timeUnit:n}:{},...r?{bin:r}:{},...i?{aggregate:i}:{},field:t}}function TS(e){return"sort"in e}function UP({fieldDef:e,fieldDef2:t,markDef:n,config:r}){if(ae(e)&&e.bandPosition!==void 0)return e.bandPosition;if(V(e)){const{timeUnit:i,bin:a}=e;if(i&&!t)return EP(n.type)?0:Gs("timeUnitBandPosition",n,r);if(Ge(a))return .5}return}function BP({channel:e,fieldDef:t,fieldDef2:n,markDef:r,config:i,scaleType:a,useVlSizeChannel:o}){const s=Er(e),l=Ne(o?"size":s,r,i,{vgChannel:s});if(l!==void 0)return l;if(V(t)){const{timeUnit:u,bin:c}=t;if(u&&!n)return{band:Gs("timeUnitBandSize",r,i)};if(Ge(c)&&!en(a))return{band:1}}return EP(r.type)?a?en(a)?i[r.type]?.discreteBandSize||{band:1}:i[r.type]?.continuousBandSize:i[r.type]?.discreteBandSize:void 0}function qP(e,t,n,r){return Ge(e.bin)||e.timeUnit&&Sr(e)&&e.type==="temporal"?UP({fieldDef:e,fieldDef2:t,markDef:n,config:r})!==void 0:!1}function R0(e){return!!e&&"condition"in e}function F0(e){const t=e&&e.condition;return!!t&&!z(t)&&V(t)}function I0(e){const t=e&&e.condition;return!!t&&!z(t)&&ae(t)}function kme(e){const t=e&&e.condition;return!!t&&(z(t)||Yr(t))}function V(e){return!!e&&(!!e.field||e.aggregate==="count")}function Oo(e){return e&&e.type}function Mo(e){return!!e&&"datum"in e}function Pi(e){return Sr(e)&&!L0(e)||AS(e)}function AS(e){return Mo(e)&&Le(e.datum)}function ae(e){return V(e)||Mo(e)}function Sr(e){return!!e&&("field"in e||e.aggregate==="count")&&"type"in e}function Yr(e){return e&&"value"in e&&"value"in e}function ju(e){return!!e&&("scale"in e||"sort"in e)}function _S(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function HP(e){return!!e&&"legend"in e}function WP(e){return!!e&&("format"in e||"formatType"in e)}function Eme(e){return tr(e,["legend","axis","header","scale"])}function Sme(e){return"op"in e}function Y(e,t={}){let n=e.field;const r=t.prefix;let i=t.suffix,a="";if(Ame(e))n=Ez("count");else{let o;if(!t.nofn)if(Sme(e))o=e.op;else{const{bin:s,aggregate:l,timeUnit:u}=e;Ge(s)?(o=Fz(s),i=(t.binSuffix??"")+(t.suffix??"")):l?Ao(l)?(a=`["${n}"]`,n=`argmax_${l.argmax}`):xa(l)?(a=`["${n}"]`,n=`argmin_${l.argmin}`):o=String(l):u&&(o=_pe(u),i=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(t.suffix??""))}o&&(n=n?`${o}_${n}`:o)}return i&&(n=`${n}_${i}`),r&&(n=`${r}_${n}`),t.forAs?qE(n):t.expr?wz(n,t.expr)+a:wr(n)+a}function L0(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return V(e)&&!!e.bin;case"temporal":return!1}throw new Error(tP(e.type))}function Tme(e){return ju(e)&&Wd(e.scale?.type)}function Ame(e){return e.aggregate==="count"}function _me(e,t){const{field:n,bin:r,timeUnit:i,aggregate:a}=e;if(a==="count")return t.countTitle;if(Ge(r))return`${n} (binned)`;if(i){const o=vn(i)?.unit;if(o)return`${n} (${iS(o).join("-")})`}else if(a)return Ao(a)?`${n} for max ${a.argmax}`:xa(a)?`${n} for min ${a.argmin}`:`${Ld(a)} of ${n}`;return n}function Cme(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(Ao(t))return`${i} for argmax(${t.argmax})`;if(xa(t))return`${i} for argmin(${t.argmin})`;const a=vn(r),o=t||a?.unit||a?.maxbins&&"timeunit"||Ge(n)&&"bin";return o?`${o.toUpperCase()}(${i})`:i}const GP=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Cme(e);default:return _me(e,t)}};let YP=GP;function VP(e){YP=e}function $me(){VP(GP)}function Uu(e,t,{allowDisabling:n,includeDefault:r=!0}){const i=CS(e)?.title;if(!V(e))return i;const a=e,o=r?$S(a,t):void 0;return n?ft(i,a.title,o):i??a.title??o}function CS(e){return _S(e)&&e.axis?e.axis:HP(e)&&e.legend?e.legend:SS(e)&&e.header?e.header:void 0}function $S(e,t){return YP(e,t)}function z0(e){if(WP(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}else{const t=CS(e)??{},{format:n,formatType:r}=t;return{format:n,formatType:r}}}function Ome(e,t){switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(TS(e)&&z(e.sort))return"ordinal";const{aggregate:n,bin:r,timeUnit:i}=e;if(i)return"temporal";if(r||n&&!Ao(n)&&!xa(n))return"quantitative";if(ju(e)&&e.scale?.type)switch(mS[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function ji(e){return V(e)?e:F0(e)?e.condition:void 0}function wt(e){return ae(e)?e:I0(e)?e.condition:void 0}function XP(e,t,n,r={}){if(X(e)||Le(e)||Fa(e)){const i=X(e)?"string":Le(e)?"number":"boolean";return U(Ohe(t,i,e)),{value:e}}return ae(e)?P0(e,t,n,r):I0(e)?{...e,condition:P0(e.condition,t,n,r)}:e}function P0(e,t,n,r){if(WP(e)){const{format:i,formatType:a,...o}=e;if(Js(a)&&!n.customFormatTypes)return U(eP(t)),P0(o,t,n,r)}else{const i=_S(e)?"axis":HP(e)?"legend":SS(e)?"header":null;if(i&&e[i]){const{format:a,formatType:o,...s}=e[i];if(Js(o)&&!n.customFormatTypes)return U(eP(t)),P0({...e,[i]:s},t,n,r)}}return V(e)?OS(e,t,r):Mme(e)}function Mme(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Le(n)?"quantitative":X(n)?"nominal":Ys(n)?"temporal":void 0,{...e,type:t}}function OS(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s={...e};if(!n&&r&&!XE(r)&&!Ao(r)&&!xa(r)&&(U(Dhe(r)),delete s.aggregate),i&&(s.timeUnit=vn(i)),o&&(s.field=`${o}`),Ge(a)&&(s.bin=j0(a,t)),yn(a)&&!Fi(t)&&U(cpe(t)),Sr(s)){const{type:l}=s,u=Dpe(l);l!==u&&(s.type=u),l!=="quantitative"&&(Rz(r)&&(U(Mhe(l,r)),s.type="quantitative"))}else if(!Oz(t)){const l=Ome(s,t);s.type=l}if(Sr(s)){const{compatible:l,warning:u}=Dme(s,t)||{};l===!1&&U(u)}if(TS(s)&&X(s.sort)){const{sort:l}=s;if(LP(l))return{...s,sort:{encoding:l}};const u=l.substr(1);if(l.charAt(0)==="-"&&LP(u))return{...s,sort:{encoding:u,order:"descending"}}}if(SS(s)){const{header:l}=s;if(l){const{orient:u,...c}=l;if(u)return{...s,header:{...c,labelOrient:l.labelOrient||u,titleOrient:l.titleOrient||u}}}}return s}function j0(e,t){return Fa(e)?{maxbins:Iz(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:Iz(t)}:e}const Bu={compatible:!0};function Dme(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case pa:case ma:case p0:return L0(e)?Bu:{compatible:!1,warning:Ihe(t)};case et:case vt:case In:case Di:case Ni:case Pd:case Ud:case m0:case qs:case g0:case y0:case Bs:case Hr:case $i:case v0:return Bu;case Mi:case xr:case Oi:case Wr:return n!==Vs?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Bu;case ba:case bo:case wo:case xo:case va:case ya:case ga:case qr:case Ci:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Bu;case Ln:case ko:return!L0(e)&&!Tme(e)?{compatible:!1,warning:Lhe(t)}:Bu;case jd:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Bu}}function qu(e){const{formatType:t}=z0(e);return t==="time"||!t&&Nme(e)}function Nme(e){return e&&(e.type==="temporal"||V(e)&&!!e.timeUnit)}function U0(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){const a=t&&vn(t)?.unit;let o=a||n==="temporal",s;return Bd(e)?s=e.expr:ie(e)?s=e.signal:Ys(e)?(o=!0,s=qd(e)):(X(e)||Le(e))&&(o&&(s=`datetime(${We(e)})`,kpe(a)&&((Le(e)&&e<1e4||X(e)&&isNaN(Date.parse(e)))&&(s=qd({[a]:e}))))),s?r&&o?`time(${s})`:s:i?void 0:We(e)}function JP(e,t){const{type:n}=e;return t.map(r=>{const i=U0(r,{timeUnit:V(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function Vd(e,t){return Ge(e.bin)?To(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const KP={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Xd(e){return e&&e.condition}const QP=["domain","grid","labels","ticks","title"],Rme={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},ZP={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Fme={...ZP,style:1,labelExpr:1,encoding:1};function e6(e){return!!Fme[e]}const Ime={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},t6=j(Ime);function Sa(e){return"mark"in e}class B0{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return Sa(e)?hme(e.mark)===this.name:!1}}function Ks(e,t){const n=e&&e[t];return n?z(n)?Nu(n,r=>!!r.field):V(n)||F0(n):!1}function MS(e){return Nu(Pde,t=>{if(Ks(e,t)){const n=e[t];if(z(n))return Nu(n,r=>!!r.aggregate);{const r=ji(n);return r&&!!r.aggregate}}return!1})}function n6(e,t){const n=[],r=[],i=[],a=[],o={};return DS(e,(s,l)=>{if(V(s)){const{field:u,aggregate:c,bin:f,timeUnit:d,...h}=s;if(c||d||f){const p=CS(s),m=p&&p.title;let g=Y(s,{forAs:!0});const y={...m?[]:{title:Uu(s,t,{allowDisabling:!0})},...h,field:g};if(c){let v;if(Ao(c)?(v="argmax",g=Y({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${g}.${u}`):xa(c)?(v="argmin",g=Y({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${g}.${u}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(v=c),v){const b={op:v,as:g};u&&(b.field=u),a.push(b)}}else if(n.push(g),Sr(s)&&Ge(f)){if(r.push({bin:f,field:u,as:g}),n.push(Y(s,{binSuffix:"end"})),Vd(s,l)&&n.push(Y(s,{binSuffix:"range"})),Fi(l)){const v={field:`${g}_end`};o[`${l}2`]=v}y.bin="binned",Oz(l)||(y.type=Vs)}else if(d){i.push({timeUnit:d,field:u,as:g});const v=Sr(s)&&s.type!==Lu&&"time";v&&(l===Pd||l===qs?y.formatType=v:Vde(l)?y.legend={formatType:v,...y.legend}:Fi(l)&&(y.axis={formatType:v,...y.axis}))}o[l]=y}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function Lme(e,t,n){const r=Jde(t,n);if(r){if(r==="binned"){const i=e[t===qr?et:vt];return!!(V(i)&&V(e[t])&&yn(i.bin))}}else return!1;return!0}function zme(e,t,n,r){return j(e).reduce((i,a)=>{if(!$z(a))return U(Fhe(a)),i;const o=e[a];if(a==="angle"&&t==="arc"&&!e.theta&&(U($he),a=Hr),!Lme(e,a,t))return U(E0(a,t)),i;if(a===va&&t==="line"){const s=ji(e[a]);if(s?.aggregate)return U(Rhe),i}if(a===In&&(n?"fill"in e:"stroke"in e))return U(nP("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===Ud||a===jd&&!z(o)&&!Yr(o)||a===qs&&z(o))o&&(i[a]=J(o).reduce((s,l)=>(V(l)?s.push(OS(l,a)):U(ZE(l,a)),s),[]));else{if(a===qs&&o===null)i[a]=null;else if(!V(o)&&!Mo(o)&&!Yr(o)&&!R0(o)&&!ie(o))return U(ZE(o,a)),i;i[a]=XP(o,a,r)}return i},{})}function q0(e,t){const n={};for(const r of j(e)){const i=XP(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function Pme(e){const t=[];for(const n of j(e))if(Ks(e,n)){const r=e[n],i=J(r);for(const a of i)V(a)?t.push(a):F0(a)&&t.push(a.condition)}return t}function DS(e,t,n){if(!e)return;for(const r of j(e)){const i=e[r];if(z(i))for(const a of i)t.call(n,a,r);else t.call(n,i,r)}}function jme(e,t,n,r){return e?j(e).reduce((i,a)=>{const o=e[a];return z(o)?o.reduce((s,l)=>t.call(r,s,l,a),i):t.call(r,i,o,a)},n):n}function r6(e,t){return j(t).reduce((n,r)=>{switch(r){case et:case vt:case g0:case v0:case y0:case qr:case Ci:case Hr:case ya:case $i:case ga:case Oi:case Mi:case Wr:case xr:case Pd:case Ln:case Bs:case qs:return n;case jd:if(e==="line"||e==="trail")return n;case Ud:case m0:{const i=t[r];if(z(i)||V(i))for(const a of J(i))a.aggregate||n.push(Y(a,{}));return n}case va:if(e==="trail")return n;case In:case Di:case Ni:case ba:case bo:case wo:case ko:case xo:{const i=ji(t[r]);return i&&!i.aggregate&&n.push(Y(i,{})),n}}},[])}function Ume(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let r,i;if(z(t)){for(const a of t)a.aggregate?(r||(r=[]),r.push(a)):(i||(i=[]),i.push(a));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return z(i)&&i.length===1&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function NS(e,t,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};const i=e.map(({fieldPrefix:o,titlePrefix:s})=>{const l=r?` of ${RS(t)}`:"";return{field:o+t.field,type:t.type,title:ie(s)?{signal:`${s}"${escape(l)}"`}:s+l}}),a=Pme(n).map(Eme);return{tooltip:[...i,..._i(a,be)]}}function RS(e){const{title:t,field:n}=e;return ft(t,n)}function FS(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=RS(n);return i6(e,s,i,{mark:l,encoding:{[t]:{field:`${u}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...a!==void 0?{scale:a}:{},...o!==void 0?{axis:o}:{}},...X(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{},...r,...f}})}}function i6(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||e[t]===void 0&&n[t]?[{...r,mark:{...n[t],...i?{clip:i}:{},...a?{color:a}:{},...o?{opacity:o}:{},...Li(r.mark)?r.mark:{type:r.mark},style:`${s}-${t}`,...Fa(e[t])?{}:e[t]}}]:[]}function a6(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",a=r[i],o=r[`${i}2`],s=r[`${i}Error`],l=r[`${i}Error2`];return{continuousAxisChannelDef:H0(a,n),continuousAxisChannelDef2:H0(o,n),continuousAxisChannelDefError:H0(s,n),continuousAxisChannelDefError2:H0(l,n),continuousAxis:i}}function H0(e,t){if(e&&e.aggregate){const{aggregate:n,...r}=e;return n!==t&&U(upe(n,t)),r}else return e}function o6(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(Li(n)&&n.orient)return n.orient;if(Pi(i)){if(Pi(a)){const o=V(i)&&i.aggregate,s=V(a)&&a.aggregate;if(!o&&s===t)return"vertical";if(!s&&o===t)return"horizontal";if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return qu(a)&&!qu(i)?"horizontal":"vertical"}return"horizontal"}else{if(Pi(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}const W0="boxplot",Bme=["box","median","outliers","rule","ticks"],qme=new B0(W0,l6);function s6(e){return Le(e)?"tukey":e}function l6(e,{config:t}){e={...e,encoding:q0(e.encoding,t)};const{mark:n,encoding:r,params:i,projection:a,...o}=e,s=Li(n)?n:{type:n};i&&U(Kz("boxplot"));const l=s.extent??t.boxplot.extent,u=Ne("size",s,t),c=s6(l),{bins:f,timeUnits:d,transform:h,continuousAxisChannelDef:p,continuousAxis:m,groupby:g,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:w,customTooltipWithoutAggregatedField:x}=Hme(e,l,t),{color:E,size:k,...S}=v,A=Me=>FS(s,m,p,Me,t.boxplot),C=A(S),_=A(v),D=A({...S,...k?{size:k}:{}}),M=NS([{fieldPrefix:c==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:c==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,v),N={type:"tick",color:"black",opacity:1,orient:b,invalid:null,aria:!1},T=c==="min-max"?M:NS([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,v),O=[...C({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:T}),...C({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:T}),...C({partName:"ticks",mark:N,positionPrefix:"lower_whisker",extraEncoding:T}),...C({partName:"ticks",mark:N,positionPrefix:"upper_whisker",extraEncoding:T})],P=[...c!=="tukey"?O:[],..._({partName:"box",mark:{type:"bar",...u?{size:u}:{},orient:w,invalid:null,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...D({partName:"median",mark:{type:"tick",invalid:null,...Q(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...u?{size:u}:{},orient:b,aria:!1},positionPrefix:"mid_box",extraEncoding:M})];if(c==="min-max")return{...o,transform:(o.transform??[]).concat(h),layer:P};const W=`datum["lower_box_${p.field}"]`,B=`datum["upper_box_${p.field}"]`,se=`(${B} - ${W})`,me=`${W} - ${l} * ${se}`,we=`${B} + ${l} * ${se}`,ye=`datum["${p.field}"]`,Se={joinaggregate:u6(p.field),groupby:g},Ue={transform:[{filter:`(${me} <= ${ye}) && (${ye} <= ${we})`},{aggregate:[{op:"min",field:p.field,as:`lower_whisker_${p.field}`},{op:"max",field:p.field,as:`upper_whisker_${p.field}`},{op:"min",field:`lower_box_${p.field}`,as:`lower_box_${p.field}`},{op:"max",field:`upper_box_${p.field}`,as:`upper_box_${p.field}`},...y],groupby:g}],layer:O},{tooltip:Pn,...jn}=S,{scale:zt,axis:R}=p,G=RS(p),K=tr(R,["title"]),$=i6(s,"outliers",t.boxplot,{transform:[{filter:`(${ye} < ${me}) || (${ye} > ${we})`}],mark:"point",encoding:{[m]:{field:p.field,type:p.type,...G!==void 0?{title:G}:{},...zt!==void 0?{scale:zt}:{},...Pe(K)?{}:{axis:K}},...jn,...E?{color:E}:{},...x?{tooltip:x}:{}}})[0];let ge;const Z=[...f,...d,Se];return $?ge={transform:Z,layer:[$,Ue]}:(ge=Ue,ge.transform.unshift(...Z)),{...o,layer:[ge,{transform:h,layer:P}]}}function u6(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function Hme(e,t,n){const r=o6(e,W0),{continuousAxisChannelDef:i,continuousAxis:a}=a6(e,r,W0),o=i.field,s=s6(t),l=[...u6(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}],u=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],{[a]:c,...f}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:h}=Ume(f),{bins:p,timeUnits:m,aggregate:g,groupby:y,encoding:v}=n6(h,n),b=r==="vertical"?"horizontal":"vertical",w=r,x=[...p,...m,{aggregate:[...g,...l],groupby:y},...u];return{bins:p,timeUnits:m,transform:x,groupby:y,aggregate:g,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:w,customTooltipWithoutAggregatedField:d}}const IS="errorbar",Wme=["ticks","rule"],Gme=new B0(IS,c6);function c6(e,{config:t}){e={...e,encoding:q0(e.encoding,t)};const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=f6(e,IS,t);delete a.size;const c=FS(s,i,r,a,t.errorbar),f=s.thickness,d=s.size,h={type:"tick",orient:o,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return{...l,transform:n,...p.length>1?{layer:p}:{...p[0]}}}function Yme(e,t){const{encoding:n}=e;if(Vme(n))return{orient:o6(e,t),inputType:"raw"};const r=Xme(n),i=Jme(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,l=n.y2;if(ae(s)&&ae(l))throw new Error(`${t} cannot have both x2 and y2`);if(ae(s)){if(Pi(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(ae(l)){if(Pi(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,l=n.xError2,u=n.yError,c=n.yError2;if(ae(l)&&!ae(s))throw new Error(`${t} cannot have xError2 without xError`);if(ae(c)&&!ae(u))throw new Error(`${t} cannot have yError2 without yError`);if(ae(s)&&ae(u))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(ae(s)){if(Pi(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(ae(u)){if(Pi(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Vme(e){return(ae(e.x)||ae(e.y))&&!ae(e.x2)&&!ae(e.y2)&&!ae(e.xError)&&!ae(e.xError2)&&!ae(e.yError)&&!ae(e.yError2)}function Xme(e){return ae(e.x2)||ae(e.y2)}function Jme(e){return ae(e.xError)||ae(e.xError2)||ae(e.yError)||ae(e.yError2)}function f6(e,t,n){const{mark:r,encoding:i,params:a,projection:o,...s}=e,l=Li(r)?r:{type:r};a&&U(Kz(t));const{orient:u,inputType:c}=Yme(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:h,continuousAxisChannelDefError2:p,continuousAxis:m}=a6(e,u,t),{errorBarSpecificAggregate:g,postAggregateCalculates:y,tooltipSummary:v,tooltipTitleWithFieldName:b}=Kme(l,f,d,h,p,c,t,n),{[m]:w,[m==="x"?"x2":"y2"]:x,[m==="x"?"xError":"yError"]:E,[m==="x"?"xError2":"yError2"]:k,...S}=i,{bins:A,timeUnits:C,aggregate:_,groupby:D,encoding:M}=n6(S,n),N=[..._,...g],T=c!=="raw"?[]:D,O=NS(v,f,M,b);return{transform:[...s.transform??[],...A,...C,...N.length===0?[]:[{aggregate:N,groupby:T}],...y],groupby:T,continuousAxisChannelDef:f,continuousAxis:m,encodingWithoutContinuousAxis:M,ticksOrient:u==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:s,tooltipEncoding:O}}function Kme(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if(a==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,p=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(p==="iqr")&&U(lpe(h,p,o)),p==="stderr"||p==="stdev")l=[{op:p,field:c,as:`extent_${c}`},{op:h,field:c,as:`center_${c}`}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:Ld(h)},{fieldPrefix:"upper_",titlePrefix:d6(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:d6(h,p,"-")}],d=!0;else{let m,g,y;p==="ci"?(m="mean",g="ci0",y="ci1"):(m="median",g="q1",y="q3"),l=[{op:g,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:m,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:Uu({field:c,aggregate:y,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Uu({field:c,aggregate:g,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Uu({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&U(spe(e.center,e.extent)),a==="aggregated-upper-lower"?(f=[],u=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]):a==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:`upper_${c}`}],i?u.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:`lower_${c}`}):u.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:`lower_${c}`}));for(const h of u)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Us(Us(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}function d6(e,t,n){return`${Ld(e)} ${n} ${t}`}const LS="errorband",Qme=["band","borders"],Zme=new B0(LS,h6);function h6(e,{config:t}){e={...e,encoding:q0(e.encoding,t)};const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=f6(e,LS,t),u=o,c=FS(u,i,r,a,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p={...u.interpolate?{interpolate:u.interpolate}:{},...u.tension&&u.interpolate?{tension:u.tension}:{}};return f?(d={...d,...p,ariaRoleDescription:"errorband"},h={...h,...p,aria:!1}):u.interpolate?U(oP("interpolate")):u.tension&&U(oP("tension")),{...s,transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:l})]}}const p6={};function zS(e,t,n){const r=new B0(e,t);p6[e]={normalizer:r,parts:n}}function ege(){return j(p6)}zS(W0,l6,Bme),zS(IS,c6,Wme),zS(LS,h6,Qme);const tge=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],m6={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},g6={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},nge=j(m6),rge=j(g6),ige={header:1,headerRow:1,headerColumn:1,headerFacet:1},y6=j(ige),v6=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],age={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},oge={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Jd="_vgsid_",sge={point:{on:"click",fields:[Jd],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function PS(e){return!!e&&(e==="legend"||!!e.legend)}function jS(e){return PS(e)&&Q(e)}function US(e){return!!e.select}function b6(e){const t=[];for(const n of e||[]){if(US(n))continue;const{expr:r,bind:i,...a}=n;if(i&&r){const o={...a,bind:i,init:r};t.push(o)}else{const o={...a,...r?{update:r}:{},...i?{bind:i}:{}};t.push(o)}}return t}function lge(e){return G0(e)||qS(e)||BS(e)}function BS(e){return"concat"in e}function G0(e){return"vconcat"in e}function qS(e){return"hconcat"in e}function Ui(e){return Q(e)&&e.step!==void 0}function w6(e){return e.view||e.width||e.height}const x6=20,uge={align:1,bounds:1,center:1,columns:1,spacing:1},cge=j(uge);function fge(e,t,n){const r=n[t],i={},{spacing:a,columns:o}=r;a!==void 0&&(i.spacing=a),o!==void 0&&((N0(e)&&!Yd(e.facet)||BS(e))&&(i.columns=o)),G0(e)&&(i.columns=1);for(const s of cge)if(e[s]!==void 0)if(s==="spacing"){const l=e[s];i[s]=Le(l)?l:{row:l.row??a,column:l.column??a}}else i[s]=e[s];return i}function HS(e,t){return e[t]??e[t==="width"?"continuousWidth":"continuousHeight"]}function Y0(e,t){const n=Kd(e,t);return Ui(n)?n.step:k6}function Kd(e,t){const n=e[t]??e[t==="width"?"discreteWidth":"discreteHeight"];return ft(n,{step:e.step})}const k6=20,dge={continuousWidth:200,continuousHeight:200,step:k6},hge={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:dge,mark:sme,arc:{},area:{},bar:cme,circle:{},geoshape:{},image:{},line:{},point:{},rect:fme,rule:{color:"black"},square:{},text:{color:"black"},tick:dme,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Wpe,projection:{},legend:age,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:sge,style:{},title:{},facet:{spacing:x6},concat:{spacing:x6}},Ta=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],E6={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},S6={blue:Ta[0],orange:Ta[1],red:Ta[2],teal:Ta[3],green:Ta[4],yellow:Ta[5],purple:Ta[6],pink:Ta[7],brown:Ta[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function pge(e={}){return{signals:[{name:"color",value:Q(e)?{...S6,...e}:S6}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function mge(e){return{signals:[{name:"fontSize",value:Q(e)?{...E6,...e}:E6}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function gge(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function T6(e){const t=j(e||{}),n={};for(const r of t){const i=e[r];n[r]=Xd(i)?zz(i):nr(i)}return n}function yge(e){const t=j(e),n={};for(const r of t)n[r]=T6(e[r]);return n}const vge=[...AP,...t6,...y6,"background","padding","legend","lineBreak","scale","style","title","view"];function A6(e={}){const{color:t,font:n,fontSize:r,...i}=e,a=bl({},hge,n?gge(n):{},t?pge(t):{},r?mge(r):{},i||{}),o=tr(a,vge);for(const s of["background","lineBreak","padding"])a[s]&&(o[s]=nr(a[s]));for(const s of AP)a[s]&&(o[s]=zn(a[s]));for(const s of t6)a[s]&&(o[s]=T6(a[s]));for(const s of y6)a[s]&&(o[s]=zn(a[s]));return a.legend&&(o.legend=zn(a.legend)),a.scale&&(o.scale=zn(a.scale)),a.style&&(o.style=yge(a.style)),a.title&&(o.title=zn(a.title)),a.view&&(o.view=zn(a.view)),o}const bge=["view",...SP],wge=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],xge={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...ome};function kge(e){e=fe(e);for(const t of wge)delete e[t];if(e.axis)for(const t in e.axis)Xd(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of tge)delete e.legend[t];if(e.mark){for(const t of TP)delete e.mark[t];e.mark.tooltip&&Q(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(b6(e.params)),delete e.params);for(const t of bge){for(const r of TP)delete e[t][r];const n=xge[t];if(n)for(const r of n)delete e[t][r];Sge(e,t)}for(const t of ege())delete e[t];Ege(e);for(const t in e)Q(e[t])&&Pe(e[t])&&delete e[t];return Pe(e)?void 0:e}function Ege(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=Lz(e.title);Pe(t)||(e.style["group-title"]={...e.style["group-title"],...t}),Pe(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),Pe(r)?delete e.title:e.title=r}function Sge(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const a={...i,...e.style[n??t]};Pe(a)||(e.style[n??t]=a),r||delete e[t]}function V0(e){return"layer"in e}function Tge(e){return"repeat"in e}function Age(e){return!z(e.repeat)&&e.repeat.layer}class WS{map(e,t){return N0(e)?this.mapFacet(e,t):Tge(e)?this.mapRepeat(e,t):qS(e)?this.mapHConcat(e,t):G0(e)?this.mapVConcat(e,t):BS(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(V0(e))return this.mapLayer(e,t);if(Sa(e))return this.mapUnit(e,t);throw new Error(KE(e))}mapLayer(e,t){return{...e,layer:e.layer.map(n=>this.mapLayerOrUnit(n,t))}}mapHConcat(e,t){return{...e,hconcat:e.hconcat.map(n=>this.map(n,t))}}mapVConcat(e,t){return{...e,vconcat:e.vconcat.map(n=>this.map(n,t))}}mapConcat(e,t){const{concat:n,...r}=e;return{...r,concat:n.map(i=>this.map(i,t))}}mapFacet(e,t){return{...e,spec:this.map(e.spec,t)}}mapRepeat(e,t){return{...e,spec:this.map(e.spec,t)}}}const _ge={zero:1,center:1,normalize:1};function Cge(e){return e in _ge}const $ge=new Set([wP,A0,T0,$0,C0,vS,bS,_0,xP,yS]),Oge=new Set([A0,T0,wP]);function _6(e,t){const n=t==="x"?"y":"radius",r=e[t],i=e[n];if(V(r)&&V(i))if(Oo(r)==="quantitative"&&Oo(i)==="quantitative"){if(r.stack)return t;if(i.stack)return n;const a=V(r)&&!!r.aggregate,o=V(i)&&!!i.aggregate;if(a!==o)return a?t:n;{const s=r.scale?.type,l=i.scale?.type;if(s&&s!=="linear")return n;if(l&&l!=="linear")return t}}else{if(Oo(r)==="quantitative")return t;if(Oo(i)==="quantitative")return n}else{if(Oo(r)==="quantitative")return t;if(Oo(i)==="quantitative")return n}return}function Mge(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function C6(e,t,n={}){const r=Li(e)?e.type:e;if(!$ge.has(r))return null;const i=_6(t,"x")||_6(t,"theta");if(!i)return null;const a=t[i],o=V(a)?Y(a,{}):void 0;let s=Mge(i),l=t[s],u=V(l)?Y(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=Wde.reduce((d,h)=>{if(h!=="tooltip"&&Ks(t,h)){const p=t[h];for(const m of J(p)){const g=ji(m);if(g.aggregate)continue;const y=Y(g,{});(!y||y!==u)&&d.push({channel:h,fieldDef:g})}}return d},[]);let f;if(a.stack!==void 0?Fa(a.stack)?f=a.stack?"zero":null:f=a.stack:Oge.has(r)&&(f="zero"),!f||!Cge(f))return null;if(MS(t)&&c.length===0)return null;if(a?.scale?.type&&a?.scale?.type!==bt.LINEAR){if(n.disallowNonLinearStack)return null;U(ipe(a.scale.type))}return ae(t[wa(i)])?(a.stack!==void 0&&U(rpe(i)),null):(V(a)&&a.aggregate&&!de(rhe,a.aggregate)&&U(ape(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:a.impute===null?!1:$o(r),stackBy:c,offset:f})}function Dge(e){const{point:t,line:n,...r}=e;return j(r).length>1?r:r.type}function Nge(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:tr(e[t],["point","line"])});return e}function GS(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Q(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Q(t.point)?t.point:{}:void 0}function $6(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Rge{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Sa(e)){const{mark:n,encoding:r}=e,i=Li(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!GS(i,t[i.type],r);case"area":return!!GS(i,t[i.type],r)||!!$6(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{params:i,projection:a,mark:o,encoding:s,...l}=e,u=q0(s,r),c=Li(o)?o:{type:o},f=GS(c,r[c.type],u),d=c.type==="area"&&$6(c,r[c.type]),h=[{...i?{params:i}:{},mark:Dge({...c.type==="area"&&c.opacity===void 0&&c.fillOpacity===void 0?{opacity:.7}:{},...c}),encoding:tr(u,["shape"])}],p=C6(c,u);let m=u;if(p){const{fieldChannel:g,offset:y}=p;m={...u,[g]:{...u[g],...y?{stack:y}:{}}}}return d&&h.push({...a?{projection:a}:{},mark:{type:"line",...Du(c,["clip","interpolate","tension","tooltip"]),...d},encoding:m}),f&&h.push({...a?{projection:a}:{},mark:{type:"point",opacity:1,filled:!0,...Du(c,["clip","tooltip"]),...f},encoding:m}),n({...l,layer:h},{...t,config:Nge(r)})}}function Fge(e,t){return t?Yd(e)?N6(e,t):O6(e,t):e}function YS(e,t){return t?N6(e,t):e}function VS(e,t,n){const r=t[e];if(xme(r)){if(r.repeat in n)return{...t,[e]:n[r.repeat]};U(khe(r.repeat));return}return t}function O6(e,t){if(e=VS("field",e,t),e===void 0)return;if(e===null)return null;if(TS(e)&&zi(e.sort)){const n=VS("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}function M6(e,t){if(V(e))return O6(e,t);{const n=VS("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function D6(e,t){if(ae(e)){const n=M6(e,t);if(n)return n;if(R0(e))return{condition:e.condition}}else{if(I0(e)){const n=M6(e.condition,t);if(n)return{...e,condition:n};{const{condition:r,...i}=e;return i}}return e}return}function N6(e,t){const n={};for(const r in e)if(te(e,r)){const i=e[r];if(z(i))n[r]=i.map(a=>D6(a,t)).filter(a=>a);else{const a=D6(i,t);a!==void 0&&(n[r]=a)}}return n}class Ige{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Sa(e)){const{encoding:t,mark:n}=e;if(n==="line"||Li(n)&&n.type==="line")for(const r of qde){const i=Hs(r),a=t[i];if(t[r]&&(V(a)&&!yn(a.bin)||Mo(a)))return!0}}return!1}run(e,t,n){const{encoding:r,mark:i}=e;return U(jhe(!!r.x2,!!r.y2)),console.log(i),n({...e,mark:Q(i)?{...i,type:"rule"}:"rule"},t)}}class Lge extends WS{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[qme,Gme,Zme,new Rge(),new Ige()]}map(e,t){if(Sa(e)){const n=Ks(e.encoding,pa),r=Ks(e.encoding,ma),i=Ks(e.encoding,p0);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=YS(e.encoding,t.repeater),a={...e,...i?{encoding:i}:{}};if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const s of this.nonFacetUnitNormalizers)if(s.hasMatchingType(a,t.config))return s.run(a,t,o);return a}mapRepeat(e,t){return Age(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r,...i}=e,{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat({...e,repeat:{...a?{row:a}:{},...o?{column:o}:{}},spec:{repeat:{layer:s},spec:r}},t):{...i,layer:s.map(c=>{const f={...l,layer:c},d=`${(r.name||"")+u}child__layer_${Je(c)}`,h=this.mapLayerOrUnit(r,{...t,repeater:f,repeaterPrefix:d});return h.name=d,h})}}mapNonLayerRepeat(e,t){const{repeat:n,spec:r,data:i,...a}=e;!z(n)&&e.columns&&(e=tr(e,["columns"]),U(Qz("repeat")));const o=[],{repeater:s={},repeaterPrefix:l=""}=t,u=!z(n)&&n.row||[s?s.row:null],c=!z(n)&&n.column||[s?s.column:null],f=z(n)&&n||[s?s.repeat:null];for(const h of f)for(const p of u)for(const m of c){const g={repeat:h,row:p,column:m,layer:s.layer},y=(r.name||"")+l+"child__"+(z(n)?`${Je(h)}`:(n.row?`row_${Je(p)}`:"")+(n.column?`column_${Je(m)}`:"")),v=this.map(r,{...t,repeater:g,repeaterPrefix:y});v.name=y,o.push(tr(v,["data"]))}const d=z(n)?e.columns:n.column?n.column.length:1;return{data:r.data??i,align:"all",...a,columns:d,concat:o}}mapFacet(e,t){const{facet:n}=e;return Yd(n)&&e.columns&&(e=tr(e,["columns"]),U(Qz("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=F6({parentProjection:a,projection:r}),l=R6({parentEncoding:i,encoding:YS(n,t.repeater)});return this.mapUnit({...e,...s?{projection:s}:{},...l?{encoding:l}:{}},{config:o})}mapFacetedUnit(e,t){const{row:n,column:r,facet:i,...a}=e.encoding,{mark:o,width:s,projection:l,height:u,view:c,params:f,encoding:d,...h}=e,{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:n,column:r,facet:i},t),g=YS(a,t.repeater);return this.mapFacet({...h,...m,facet:p,spec:{...s?{width:s}:{},...u?{height:u}:{},...c?{view:c}:{},...l?{projection:l}:{},mark:o,encoding:g,...f?{params:f}:{}}},t)}getFacetMappingAndLayout(e,t){const{row:n,column:r,facet:i}=e;if(n||r){i&&U(zhe([...n?[pa]:[],...r?[ma]:[]]));const a={},o={};for(const s of[pa,ma]){const l=e[s];if(l){const{align:u,center:c,spacing:f,columns:d,...h}=l;a[s]=h;for(const p of["align","center","spacing"])l[p]!==void 0&&(o[p]??(o[p]={}),o[p][s]=l[p])}}return{facetMapping:a,layout:o}}else{const{align:a,center:o,spacing:s,columns:l,...u}=i;return{facetMapping:Fge(u,t.repeater),layout:{...a?{align:a}:{},...o?{center:o}:{},...s?{spacing:s}:{},...l?{columns:l}:{}}}}}mapLayer(e,{parentEncoding:t,parentProjection:n,...r}){const{encoding:i,projection:a,...o}=e,s={...r,parentEncoding:R6({parentEncoding:t,encoding:i,layer:!0}),parentProjection:F6({parentProjection:n,projection:a})};return super.mapLayer(o,s)}}function R6({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...j(e),...j(t)]);for(const a of i){const o=t[a],s=e[a];if(ae(o)){const l={...s,...o};r[a]=l}else I0(o)?r[a]={...o,condition:{...s,...o.condition}}:o||o===null?r[a]=o:(n||Yr(s)||ie(s)||ae(s)||z(s))&&(r[a]=s)}}else r=t;return!r||Pe(r)?void 0:r}function F6(e){const{parentProjection:t,projection:n}=e;return t&&n&&U(Che({parentProjection:t,projection:n})),n??t}function XS(e){return"filter"in e}function zge(e){return e?.stop!==void 0}function I6(e){return"lookup"in e}function Pge(e){return"data"in e}function jge(e){return"param"in e}function Uge(e){return"pivot"in e}function Bge(e){return"density"in e}function qge(e){return"quantile"in e}function Hge(e){return"regression"in e}function Wge(e){return"loess"in e}function Gge(e){return"sample"in e}function Yge(e){return"window"in e}function Vge(e){return"joinaggregate"in e}function Xge(e){return"flatten"in e}function Jge(e){return"calculate"in e}function L6(e){return"bin"in e}function Kge(e){return"impute"in e}function Qge(e){return"timeUnit"in e}function Zge(e){return"aggregate"in e}function e0e(e){return"stack"in e}function t0e(e){return"fold"in e}function n0e(e){return e.map(t=>XS(t)?{filter:Mu(t.filter,Mpe)}:t)}class r0e extends WS{map(e,t){return t.emptySelections??(t.emptySelections={}),t.selectionPredicates??(t.selectionPredicates={}),e=z6(e,t),super.map(e,t)}mapLayerOrUnit(e,t){if(e=z6(e,t),e.encoding){const n={};for(const[r,i]of vo(e.encoding))n[r]=P6(i,t);e={...e,encoding:n}}return super.mapLayerOrUnit(e,t)}mapUnit(e,t){const{selection:n,...r}=e;return n?{...r,params:vo(n).map(([i,a])=>{const{init:o,bind:s,empty:l,...u}=a;u.type==="single"?(u.type="point",u.toggle=!1):u.type==="multi"&&(u.type="point"),t.emptySelections[i]=l!=="none";for(const c of gn(t.selectionPredicates[i]??{}))c.empty=l!=="none";return{name:i,value:o,select:u,bind:s}})}:e}}function z6(e,t){const{transform:n,...r}=e;if(n){const i=n.map(a=>{if(XS(a))return{filter:JS(a,t)};if(L6(a)&&Ws(a.bin))return{...a,bin:j6(a.bin)};if(I6(a)){const{selection:o,...s}=a.from;return o?{...a,from:{param:o,...s}}:a}return a});return{...r,transform:i}}return e}function P6(e,t){const n=fe(e);if(V(n)&&Ws(n.bin)&&(n.bin=j6(n.bin)),ju(n)&&n.scale?.domain?.selection){const{selection:r,...i}=n.scale.domain;n.scale.domain={...i,...r?{param:r}:{}}}if(R0(n))if(z(n.condition))n.condition=n.condition.map(r=>{const{selection:i,param:a,test:o,...s}=r;return a?r:{...s,test:JS(r,t)}});else{const{selection:r,param:i,test:a,...o}=P6(n.condition,t);n.condition=i?n.condition:{...o,test:JS(n.condition,t)}}return n}function j6(e){const t=e.extent;if(t?.selection){const{selection:n,...r}=t;return{...e,extent:{...r,param:n}}}return e}function JS(e,t){const n=r=>Mu(r,i=>{var a;const o=t.emptySelections[i]??!0,s={param:i,empty:o};return(a=t.selectionPredicates)[i]??(a[i]=[]),t.selectionPredicates[i].push(s),s});return e.selection?n(e.selection):Mu(e.test||e.filter,r=>r.selection?n(r.selection):r)}class KS extends WS{map(e,t){const n=t.selections??[];if(e.params&&!Sa(e)){const r=[];for(const i of e.params)US(i)?n.push(i):r.push(i);e.params=r}return t.selections=n,super.map(e,U6(e,t))}mapUnit(e,t){const n=t.selections;if(!n||!n.length)return e;const r=(t.path??[]).concat(e.name),i=[];for(const a of n)if(!a.views||!a.views.length)i.push(a);else for(const o of a.views)(X(o)&&(o===e.name||r.indexOf(o)>=0)||z(o)&&o.map(s=>r.indexOf(s)).every((s,l,u)=>s!==-1&&(l===0||s>u[l-1])))&&i.push(a);return i.length&&(e.params=i),e}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=KS.prototype[e];KS.prototype[e]=function(n,r){return t.call(this,n,U6(n,r))}}function U6(e,t){return e.name?{...t,path:(t.path??[]).concat(e.name)}:t}function B6(e,t){t===void 0&&(t=A6(e.config));const n=s0e(e,t),{width:r,height:i}=e,a=l0e(n,{width:r,height:i,autosize:e.autosize},t);return{...n,...a?{autosize:a}:{}}}const i0e=new Lge(),a0e=new r0e(),o0e=new KS();function s0e(e,t={}){const n={config:t};return o0e.map(i0e.map(a0e.map(e,n),n),n)}function q6(e){return X(e)?{type:e}:e??{}}function l0e(e,t,n){let{width:r,height:i}=t;const a=Sa(e)||V0(e),o={};a?r=="container"&&i=="container"?(o.type="fit",o.contains="padding"):r=="container"?(o.type="fit-x",o.contains="padding"):i=="container"&&(o.type="fit-y",o.contains="padding"):(r=="container"&&(U(Yz("width")),r=void 0),i=="container"&&(U(Yz("height")),i=void 0));const s={type:"pad",...o,...n?q6(n.autosize):{},...q6(e.autosize)};return s.type==="fit"&&!a&&(U(dhe),s.type="pad"),r=="container"&&!(s.type=="fit"||s.type=="fit-x")&&U(Vz("width")),i=="container"&&!(s.type=="fit"||s.type=="fit-y")&&U(Vz("height")),Ai(s,{type:"pad"})?void 0:s}function u0e(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function c0e(e){return e?`fit-${b0(e)}`:"fit"}const f0e=["background","padding"];function H6(e,t){const n={};for(const r of f0e)e&&e[r]!==void 0&&(n[r]=nr(e[r]));return t&&(n.params=e.params),n}class Do{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Do(fe(this.explicit),fe(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(e){return ft(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,{value:t,explicit:n}){t!==void 0&&this.set(e,t,n)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,{explicit:t,implicit:n}){t[e]!==void 0?this.set(e,t[e],!0):n[e]!==void 0&&this.set(e,n[e],!1)}copyKeyFromObject(e,t){t[e]!==void 0&&this.set(e,t[e],!0)}copyAll(e){for(const t of j(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function Aa(e){return{explicit:!0,value:e}}function ir(e){return{explicit:!1,value:e}}function W6(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:X0(t,n,r,i)}}function X0(e,t,n,r){return e.explicit&&t.explicit&&U(Jhe(n,r,e.value,t.value)),e}function No(e,t,n,r,i=X0){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Ai(e.value,t.value)?e:i(e,t,n,r)}class d0e extends Do{constructor(e={},t={},n=!1){super(e,t);this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function Qd(e){return"url"in e}function J0(e){return"values"in e}function G6(e){return"name"in e&&!Qd(e)&&!J0(e)&&!Qs(e)}function Qs(e){return e&&(Y6(e)||V6(e)||QS(e))}function Y6(e){return"sequence"in e}function V6(e){return"sphere"in e}function QS(e){return"graticule"in e}var Ye;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(Ye||(Ye={}));function Hu(e,t=!0,n=Ut){if(z(e)){const r=e.map(i=>Hu(i,t,n));return t?`[${r.join(", ")}]`:r}else if(Ys(e))return n(t?qd(e):xpe(e));return t?n(We(e)):e}function h0e(e,t){for(const n of gn(e.component.selection??{})){const r=n.name;let i=`${r}${Io}, ${n.resolve==="global"?"true":`{unit: ${Gu(e)}}`}`;for(const a of ty){if(!a.defined(n))continue;a.signals&&(t=a.signals(e,n,t)),a.modifyExpr&&(i=a.modifyExpr(e,n,i))}t.push({name:r+H0e,on:[{events:{signal:n.name+Io},update:`modify(${H(n.name+Zs)}, ${i})`}]})}return ZS(t)}function p0e(e,t){if(e.component.selection&&j(e.component.selection).length){const n=H(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:go("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return ZS(t)}function m0e(e,t){let n=!1;for(const r of gn(e.component.selection??{})){const i=r.name,a=H(i+Zs),o=t.filter(s=>s.name===i);if(o.length===0){const s=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${g4}(${a}, ${H(s)}${l}`})}n=!0;for(const s of ty)s.defined(r)&&s.topLevelSignals&&(t=s.topLevelSignals(e,r,t))}if(n){const r=t.filter(i=>i.name==="unit");r.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return ZS(t)}function g0e(e,t){const n=[...t];for(const r of gn(e.component.selection??{})){const i={name:r.name+Zs};if(r.init){const o=r.project.items.map(s=>{const{signals:l,...u}=s;return u});i.values=r.init.map(s=>({unit:Gu(e,{escape:!1}),fields:o,values:Hu(s,!1)}))}const a=n.filter(o=>o.name===r.name+Zs);a.length||n.push(i)}return n}function X6(e,t){for(const n of gn(e.component.selection??{}))for(const r of ty)r.defined(n)&&r.marks&&(t=r.marks(e,n,t));return t}function y0e(e,t){for(const n of e.children)dt(n)&&(t=X6(n,t));return t}function v0e(e,t,n,r){const i=x4(e,t.param,t);return{signal:rr(n.get("type"))&&z(r)&&r[0]>r[1]?`isValid(${i}) && reverse(${i})`:i}}function ZS(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class je{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){if(this._children.includes(e)){U(The);return}t!==void 0?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class wn extends je{constructor(e,t,n,r){super(e,t);this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor();return e.debugName=`clone_${this.debugName}`,e._source=this._source,e._name=`clone_${this._name}`,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${kz()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class _a extends je{constructor(e,t){super(e);this.formula=t}clone(){return new _a(null,fe(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((r,i)=>{const{field:a,timeUnit:o}=i;if(o){const s=Y(i,{forAs:!0});r[be({as:s,field:a,timeUnit:o})]={as:s,field:a,timeUnit:o}}return r},{});return Pe(n)?null:new _a(e,n)}static makeFromTransform(e,t){const{timeUnit:n,...r}={...t},i=vn(n),a={...r,timeUnit:i};return new _a(e,{[be(a)]:a})}merge(e){this.formula={...this.formula};for(const t in e.formula)this.formula[t]||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of vo(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(gn(this.formula).map(e=>e.as))}dependentFields(){return new Set(gn(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${be(this.formula)}`}assemble(){const e=[];for(const t of gn(this.formula)){const{field:n,as:r,timeUnit:i}=t,{unit:a,utc:o,...s}=vn(i);e.push({field:wr(n),type:"timeunit",...a?{units:iS(a)}:{},...o?{timezone:"utc"}:{},...s,as:[r,`${r}_end`]})}return e}}const Zd="_tuple_fields";class b0e{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const w0e={defined:()=>!0,parse:(e,t,n)=>{const r=t.name,i=t.project??(t.project=new b0e()),a={},o={},s=new Set(),l=(p,m)=>{const g=m==="visual"?p.channel:p.field;let y=Je(`${r}_${g}`);for(let v=1;s.has(y);v++)y=Je(`${r}_${g}_${v}`);return s.add(y),{[m]:y}},u=t.type,c=e.config.selection[u],f=n.value!==void 0?J(n.value):null;let{fields:d,encodings:h}=Q(n.select)?n.select:{};if(!d&&!h&&f)for(const p of f){if(!Q(p))continue;for(const m of j(p))Bde(m)?(h||(h=[])).push(m):u==="interval"?(U(xhe),h=c.encodings):(d||(d=[])).push(m)}!d&&!h&&(h=c.encodings,d=c.fields);for(const p of h??[]){const m=e.fieldDef(p);if(m){let g=m.field;if(m.aggregate){U(hhe(p,m.aggregate));continue}else if(!g){U(Jz(p));continue}if(m.timeUnit){g=e.vgField(p);const y={timeUnit:m.timeUnit,as:g,field:m.field};o[be(y)]=y}if(!a[g]){let y="E";if(u==="interval"){const b=e.getScaleComponent(p).get("type");rr(b)&&(y="R")}else m.bin&&(y="R-RE");const v={field:g,channel:p,type:y};v.signals={...l(v,"data"),...l(v,"visual")},i.items.push(a[g]=v),i.hasField[g]=i.hasChannel[p]=a[g]}}else U(Jz(p))}for(const p of d??[]){if(i.hasField[p])continue;const m={type:"E",field:p};m.signals={...l(m,"data")},i.items.push(m),i.hasField[p]=m}f&&(t.init=f.map(p=>i.items.map(m=>Q(p)?p[m.channel]!==void 0?p[m.channel]:p[m.field]:p))),Pe(o)||(i.timeUnit=new _a(null,o))},signals:(e,t,n)=>{const r=t.name+Zd,i=n.filter(a=>a.name===r);return i.length>0?n:n.concat({name:r,value:t.project.items.map(a=>{const{signals:o,hasLegend:s,...l}=a;return l.field=wr(l.field),l})})}},Ro={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!To(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!rr(o)){U(ghe);continue}a.set("selectionExtent",{param:t.name,field:r.field},!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(o=>n.filter(s=>s.name===o.signals.data).length===0);if(!e.parent||tT(e)||r.length===0)return n;const i=n.filter(o=>o.name===t.name)[0];let a=i.update;if(a.indexOf(g4)>=0)i.update=`{${r.map(o=>`${H(wr(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of r){const s=`${H(wr(o.field))}: ${o.signals.data}`;a.includes(s)||(a=`${a.substring(0,a.length-1)}, ${s}}`)}i.update=a}return n.concat(r.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!tT(e))for(const r of t.scales){const i=n.filter(a=>a.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function eT(e,t){const n=H(e.scaleName(t));return`domain(${n})`}function tT(e){return e.parent&&Ku(e.parent)&&(!e.parent.parent??tT(e.parent.parent))}const eh="_brush",nT="_scale_trigger",x0e={defined:e=>e.type==="interval",signals:(e,t,n)=>{const r=t.name,i=r+Zd,a=Ro.defined(t),o=t.init?t.init[0]:null,s=[],l=[];if(t.translate&&!a){const c=`!event.item || event.item.mark.name !== ${H(r+eh)}`;J6(t,(f,d)=>{var h;const p=J((h=d.between[0]).filter??(h.filter=[]));return p.includes(c)||p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==et&&d!==vt){U("Interval selections only support x and y encoding channels.");return}const h=o?o[f]:null,p=k0e(e,t,c,h),m=c.signals.data,g=c.signals.visual,y=H(e.scaleName(d)),v=e.getScaleComponent(d).get("type"),b=rr(v)?"+":"";n.push(...p),s.push(m),l.push({scaleName:e.scaleName(d),expr:`(!isArray(${m}) || (${b}invert(${y}, ${g})[0] === ${b}${m}[0] && ${b}invert(${y}, ${g})[1] === ${b}${m}[1]))`})}),a||n.push({name:r+nT,value:{},on:[{events:l.map(c=>({scale:c.scaleName})),update:`${l.map(c=>c.expr).join(" && ")} ? ${r+nT} : {}`}]});const u=`unit: ${Gu(e)}, fields: ${i}, values`;return n.concat({name:r+Io,...o?{init:`{${u}: ${Hu(o)}}`}:{},on:[{events:[{signal:s.join(" || ")}],update:`${s.join(" && ")} ? {${u}: [${s}]} : null`}]})},marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${H(t.name+Zs)})`;if(Ro.defined(t))return n;const u={x:i!==void 0?{signal:`${o}[0]`}:{value:0},y:a!==void 0?{signal:`${s}[0]`}:{value:0},x2:i!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:a!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of j(u))u[m]=[{test:`${l}.length && ${l}[0].unit === ${Gu(e)}`,...u[m]},{value:0}];const{fill:c,fillOpacity:f,cursor:d,...h}=t.mark,p=j(h).reduce((m,g)=>(m[g]=[{test:[i!==void 0&&`${o}[0] !== ${o}[1]`,a!==void 0&&`${s}[0] !== ${s}[1]`].filter(y=>y).join(" && "),value:h[g]},{value:null}],m),{});return[{name:`${r+eh}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:c},fillOpacity:{value:f}},update:u}},...n,{name:r+eh,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...u,...p}}}]}};function k0e(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=Ro.defined(t),l=H(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,f=m=>`scale(${l}, ${m})`,d=e.getSizeSignalRef(i===et?"width":"height").signal,h=`${i}(unit)`,p=J6(t,(m,g)=>[...m,{events:g.between[0],update:`[${h}, ${h}]`},{events:g,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+nT},update:rr(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[{name:a,...r?{init:Hu(r,!0,f)}:{value:[]},on:p},{name:o,...r?{init:Hu(r)}:{},on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]}]}function J6(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(U(`${r} is not an ordered event stream for interval selections.`),n),[])}const E0e={defined:e=>e.type==="point",signals:(e,t,n)=>{const r=t.name,i=r+Zd,a=t.project,o="(item().isVoronoi ? datum.datum : datum)",s=a.items.map(c=>{const f=e.fieldDef(c.channel);return f&&f.bin?`[${o}[${H(e.vgField(c.channel,{}))}], ${o}[${H(e.vgField(c.channel,{binSuffix:"end"}))}]]`:`${o}[${H(c.field)}]`}).join(", "),l=`unit: ${Gu(e)}, fields: ${i}, values`,u=t.events;return n.concat([{name:r+Io,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${l}: [${s}]} : null`,force:!0}]:[]}])}};function Wu(e,t,n,r){const i=R0(t)&&t.condition,a=r(t);if(i){const o=J(i),s=o.map(l=>{const u=r(l);if(wme(l)){const{param:c,empty:f}=l,d=w4(e,{param:c,empty:f});return{test:d,...u}}else{const c=ny(e,l.test);return{test:c,...u}}});return{[n]:[...s,...a!==void 0?[a]:[]]}}else return a!==void 0?{[n]:a}:{}}function rT(e,t="text"){const n=e.encoding[t];return Wu(e,n,t,r=>K0(r,e.config))}function K0(e,t,n="datum"){if(e){if(Yr(e))return Ke(e.value);if(ae(e)){const{format:r,formatType:i}=z0(e);return kS({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}return}function K6(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(z(o))return{tooltip:Z6({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return Wu(e,o,"tooltip",l=>{const u=K0(l,i,s);if(u)return u;if(l===null)return;let c=Ne("tooltip",r,i);return c===!0&&(c={content:"encoding"}),X(c)?{value:c}:Q(c)?ie(c)?c:c.content==="encoding"?Z6(n,a,i,t):{signal:s}:void 0})}}function Q6(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(u,c){const f=Hs(c),d=Sr(u)?u:{...u,type:e[f].type},h=d.title||$S(d,n),p=J(h).join(", ");let m;if(Fi(c)){const g=c==="x"?"x2":"y2",y=ji(e[g]);if(yn(d.bin)&&y){const v=Y(d,{expr:a}),b=Y(y,{expr:a}),{format:w,formatType:x}=z0(d);m=M0(v,b,w,x,n),i[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:b}=z0(d);m=kS({fieldOrDatumDef:d,format:v,formatType:b,expr:a,config:n,normalizeStack:!0}).signal}}m??(m=K0(d,n,a).signal),o.push({channel:c,key:p,value:m})}DS(e,(u,c)=>{V(u)?s(u,c):F0(u)&&s(u.condition,c)});const l={};for(const{channel:u,key:c,value:f}of o)!i[u]&&!l[c]&&(l[c]=f);return l}function Z6(e,t,n,{reactiveGeom:r}={}){const i=Q6(e,t,n,{reactiveGeom:r}),a=vo(i).map(([o,s])=>`"${o}": ${s}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function S0e(e){const{markDef:t,config:n}=e,r=Ne("aria",t,n);return r===!1?{}:{...r?{aria:r}:{},...T0e(e),...A0e(e)}}function T0e(e){const{mark:t,markDef:n,config:r}=e;if(r.aria===!1)return{};const i=Ne("ariaRoleDescription",n,r);return i!=null?{ariaRoleDescription:{value:i}}:t in che?{}:{ariaRoleDescription:{value:t}}}function A0e(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return Wu(e,a,"description",l=>K0(l,e.config));const o=Ne("description",n,r);if(o!=null)return{description:Ke(o)};if(r.aria===!1)return{};const s=Q6(t,i,r);return Pe(s)?void 0:{description:{signal:vo(s).map(([l,u],c)=>`"${c>0?"; ":""}${l}: " + (${u})`).join(" + ")}}}function Mt(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;s===void 0&&(l??(l=Ne(e,r,a,{vgChannel:o,ignoreVgConfig:!0})),l!==void 0&&(s=Ke(l)));const u=i[e];return Wu(t,u,o??e,c=>$P({channel:e,channelDef:c,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function e4(e,t={filled:void 0}){const{markDef:n,encoding:r,config:i}=e,{type:a}=n,o=t.filled??Ne("filled",n,i),s=de(["bar","point","circle","square","geoshape"],a)?"transparent":void 0,l=Ne(o===!0?"color":void 0,n,i,{vgChannel:"fill"})??i.mark[o===!0&&"color"]??s,u=Ne(o===!1?"color":void 0,n,i,{vgChannel:"stroke"})??i.mark[o===!1&&"color"],c=o?"fill":"stroke",f={...l?{fill:Ke(l)}:{},...u?{stroke:Ke(u)}:{}};return n.color&&(o?n.fill:n.stroke)&&U(nP("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...Mt("color",e,{vgChannel:c,defaultValue:o?l:u}),...Mt("fill",e,{defaultValue:r.fill?l:void 0}),...Mt("stroke",e,{defaultValue:r.stroke?u:void 0})}}function _0e(e){const{encoding:t,mark:n}=e,r=t.order;return!$o(n)&&Yr(r)?Wu(e,r,"zindex",i=>Ke(i.value)):{}}function th(e,t){const n=Hde(e),r=t[n];return r||void 0}function tn(e,t,{defaultPos:n,vgChannel:r}){const{encoding:i,markDef:a,config:o,stack:s}=t,l=i[e],u=i[wa(e)],c=t.scaleName(e),f=t.getScaleComponent(e),d=th(e,a),h=iT({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),p=!l&&Fi(e)&&(i.latitude||i.longitude)?{field:t.getName(e)}:C0e({channel:e,channelDef:l,channel2Def:u,markDef:a,config:o,scaleName:c,scale:f,stack:s,offset:d,defaultRef:h});return p?{[r||e]:p}:void 0}function C0e(e){const{channel:t,channelDef:n,scaleName:r,stack:i,offset:a,markDef:o}=e;if(ae(n)&&i&&t===i.fieldChannel){if(V(n)){let s=n.bandPosition;if(s===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(s=.5),s!==void 0)return O0({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",bandPosition:s,offset:a})}return Xs(n,r,{suffix:"end"},{offset:a})}return wS(e)}function iT({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=Hs(n),l=Eo(n),u=Ne(n,a,o,{vgChannel:l});if(u!==void 0)return Gd(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const c=i.get("type");if(!de([bt.LOG,bt.TIME,bt.UTC],c)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[Er(n)];return{...c,mult:.5}}}return}}const $0e={left:"x",center:"xc",right:"x2"},O0e={top:"y",middle:"yc",bottom:"y2"};function t4(e,t,n,r="middle"){if(e==="radius"||e==="theta")return Eo(e);const i=e==="x"?"align":"baseline",a=Ne(i,t,n);let o;return ie(a)?(U(Phe(i)),o=void 0):o=a,e==="x"?$0e[o||(r==="top"?"left":"center")]:O0e[o||r]}function Q0(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?n4(e,t,{defaultPos:n,defaultPos2:r}):tn(e,t,{defaultPos:n})}function n4(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=wa(e),s=Er(e),l=M0e(t,r,o),u=l[s]?t4(e,i,a):Eo(e);return{...tn(e,t,{defaultPos:n,vgChannel:u}),...l}}function M0e(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=Hs(n),u=Er(n),c=Eo(n),f=r[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=n in r||n in a?th(n,e.markDef):th(l,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(r.latitude||r.longitude)){const g=Er(n),y=e.markDef[g];return y!=null?{[g]:{value:y}}:{[c]:{field:e.getName(n)}}}const m=D0e({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return m!==void 0?{[c]:m}:Z0(n,a)||Z0(n,{[n]:k0(n,a,s.style),[u]:k0(u,a,s.style)})||Z0(n,s[i])||Z0(n,s.mark)||{[c]:iT({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function D0e({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return ae(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?Xs(t,a,{suffix:"start"},{offset:l}):wS({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}function Z0(e,t){const n=Er(e),r=Eo(e);if(t[r]!==void 0)return{[r]:Gd(e,t[r])};if(t[e]!==void 0)return{[r]:Gd(e,t[e])};if(t[n]){const i=t[n];if(Pu(i))U(Nhe(n));else return{[n]:Gd(e,i)}}return}function Fo(e,t,n){const{config:r,encoding:i,markDef:a}=e,o=wa(t),s=Er(t),l=i[t],u=i[o],c=e.getScaleComponent(t),f=c?c.get("type"):void 0,d=e.scaleName(t),h=a.orient,p=i[s]??i.size??Ne("size",a,r,{vgChannel:s}),m=n==="bar"&&(t==="x"?h==="vertical":h==="horizontal");if(V(l)&&(Ge(l.bin)||yn(l.bin)||l.timeUnit&&!u)&&!(p&&!Pu(p))&&!en(f)){const g=BP({channel:t,fieldDef:l,markDef:a,config:r,scaleType:f}),y=e.component.axes[t]?.[0],v=y?.get("translate")??.5;return F0e({fieldDef:l,fieldDef2:u,channel:t,markDef:a,scaleName:d,bandSize:g,axisTranslate:v,spacing:Fi(t)?Ne("binSpacing",a,r):void 0,reverse:c.get("reverse"),config:r})}else return(ae(l)&&en(f)||m)&&!u?R0e(l,t,e):n4(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function N0e(e,t,n,r,i){if(Pu(i))if(n){const o=n.get("type");if(o==="band")return{scale:t,band:i.band};i.band!==1&&(U(qhe(o)),i=void 0)}else return{mult:i.band,field:{group:e}};else{if(ie(i))return i;if(i)return{value:i}}if(n){const o=n.get("range");if(Co(o)&&Le(o.step))return{value:o.step-2}}const a=Y0(r.view,e);return{value:a-2}}function R0e(e,t,n){const{markDef:r,encoding:i,config:a,stack:o}=n,s=r.orient,l=n.scaleName(t),u=n.getScaleComponent(t),c=Er(t),f=wa(t),d=s==="horizontal"&&t==="y"||s==="vertical"&&t==="x";let h;(i.size||r.size)&&(d?h=Mt("size",n,{vgChannel:c,defaultRef:Ke(r.size)}):U(Yhe(r.type)));const p=BP({channel:t,fieldDef:e,markDef:r,config:a,scaleType:u?.get("type"),useVlSizeChannel:d});h=h||{[c]:N0e(c,l,u,a,p)};const m=u?.get("type")!=="band"||!("band"in h[c])?"middle":"top",g=t4(t,r,a,m),y=g==="xc"||g==="yc",v=th(t,r),b=wS({channel:t,channelDef:e,markDef:r,config:a,scaleName:l,scale:u,stack:o,offset:v,defaultRef:iT({model:n,defaultPos:"mid",channel:t,scaleName:l,scale:u}),bandPosition:y?.5:ie(p)?{signal:`(1-${p})/2`}:Pu(p)?(1-p.band)/2:0});if(c)return{[g]:b,...h};{const w=Eo(f),x=h[c],E=v?{...x,offset:v}:x;return{[g]:b,[w]:z(b)?[b[0],{...b[1],offset:E}]:{...b,offset:E}}}}function nh(e,t,n,r,i){if(Az(e))return 0;const a=e==="x"||e==="y2"?-t/2:t/2;if(ie(n)||ie(i)||ie(r)){const o=Ea(n),s=Ea(i),l=Ea(r),u=l?`${l} + `:"",c=o?`(${o} ? -1 : 1) * `:"",f=s?`(${s} + ${a})`:a;return{signal:u+c+f}}else return i=i||0,r+(n?-i-a:+i+a)}function F0e({fieldDef:e,fieldDef2:t,channel:n,bandSize:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=wa(n),f=Eo(n),d=Eo(c),h=th(n,a),p=ie(r)?{signal:`(1-${r.signal})/2`}:Pu(r)?(1-r.band)/2:.5;if(Ge(e.bin)||e.timeUnit)return{[d]:r4({channel:n,fieldDef:e,scaleName:i,markDef:a,bandPosition:p,offset:nh(c,o,l,s,h),config:u}),[f]:r4({channel:n,fieldDef:e,scaleName:i,markDef:a,bandPosition:ie(p)?{signal:`1-${p.signal}`}:1-p,offset:nh(n,o,l,s,h),config:u})};if(yn(e.bin)){const m=Xs(e,i,{},{offset:nh(c,o,l,s,h)});if(V(t))return{[d]:m,[f]:Xs(t,i,{},{offset:nh(n,o,l,s,h)})};if(Ws(e.bin)&&e.bin.step)return{[d]:m,[f]:{signal:`scale("${i}", ${Y(e,{expr:"datum"})} + ${e.bin.step})`,offset:nh(n,o,l,s,h)}}}U(sP(c));return}function r4({channel:e,fieldDef:t,scaleName:n,markDef:r,bandPosition:i,offset:a,config:o}){const s=O0({scaleName:n,fieldOrDatumDef:t,bandPosition:i,offset:a});return CP({fieldDef:t,channel:e,markDef:r,ref:s,config:o})}const I0e=new Set(["aria","width","height"]);function Tr(e,t){const{fill:n=void 0,stroke:r=void 0}=t.color==="include"?e4(e):{};return{...L0e(e.markDef,t),...i4(e,"fill",n),...i4(e,"stroke",r),...Mt("opacity",e),...Mt("fillOpacity",e),...Mt("strokeOpacity",e),...Mt("strokeWidth",e),...Mt("strokeDash",e),..._0e(e),...K6(e),...rT(e,"href"),...S0e(e)}}function i4(e,t,n){const{config:r,mark:i,markDef:a}=e,o=Ne("invalid",a,r);if(o==="hide"&&n&&!$o(i)){const s=z0e(e,{invalid:!0,channels:w0});if(s)return{[t]:[{test:s,value:null},...J(n)]}}return n?{[t]:n}:{}}function L0e(e,t){return uhe.reduce((n,r)=>(!I0e.has(r)&&e[r]!==void 0&&t[r]!=="ignore"&&(n[r]=Ke(e[r])),n),{})}function z0e(e,{invalid:t=!1,channels:n}){const r=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&rr(l)&&(a[u]=!0)}return a},{}),i=j(r);if(i.length>0){const a=t?"||":"&&";return i.map(o=>xS(o,t)).join(` ${a} `)}return}function aT(e){const{config:t,markDef:n}=e,r=Ne("invalid",n,t);if(r){const i=P0e(e,{channels:Ri});if(i)return{defined:{signal:i}}}return{}}function P0e(e,{invalid:t=!1,channels:n}){const r=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&rr(l)&&(a[u]=!0)}return a},{}),i=j(r);if(i.length>0){const a=t?"||":"&&";return i.map(o=>xS(o,t)).join(` ${a} `)}return}function a4(e,t){return t!==void 0?{[e]:Ke(t)}:void 0}const oT="voronoi",o4={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(oT)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if($o(a))return U(phe(a)),n;const o={name:e.getName(oT),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...K6(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((u,c)=>{const f=u.name??"";f===e.component.mark[0].name?s=c:f.indexOf(oT)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}},s4={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!PS(e.bind),parse:(e,t,n)=>y4(t,n),topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=o4.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((l,u)=>{const c=Je(`${r}_${l.field}`),f=n.filter(d=>d.name===c);f.length||n.unshift({name:c,...o?{init:Hu(o[u])}:{value:null},on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${H(l.field)}] : null`}]:[],bind:a[l.field]??a[l.channel]??a})}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter(u=>u.name===r+Io)[0],o=r+Zd,s=i.items.map(u=>Je(`${r}_${u.field}`)),l=s.map(u=>`${u} !== null`).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},ey="_toggle",l4={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+ey,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Io,r=t.name+ey;return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${Gu(e)}}, `)+`${r} ? ${n} : null`}},j0e={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=X(t.clear)?go(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(s4.defined(t))for(const r of t.project.items){const i=n.findIndex(a=>a.name===Je(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,a){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:a})}if(t.type==="interval")for(const i of t.project.items){const a=n.findIndex(o=>o.name===i.signals.visual);if(r(a,"[0, 0]"),a===-1){const o=n.findIndex(s=>s.name===i.signals.data);r(o,"null")}}else{let i=n.findIndex(a=>a.name===t.name+Io);r(i,"null"),l4.defined(t)&&(i=n.findIndex(a=>a.name===t.name+ey),r(i,"false"))}return n}},u4={defined:e=>{const t=e.resolve==="global"&&e.bind&&PS(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Jd;return t&&!n&&U(yhe),t&&n},parse:(e,t,n)=>{const r=fe(n);if(r.select=X(r.select)?{type:r.select,toggle:t.toggle}:{...r.select,toggle:t.toggle},y4(t,r),Q(n.select)&&(n.select.on||n.select.clear)){const o='event.item && indexof(event.item.mark.role, "legend") < 0';for(const s of t.events)s.filter=J(s.filter??[]),s.filter.includes(o)||s.filter.push(o)}const i=jS(t.bind)?t.bind.legend:"click",a=X(i)?go(i,"view"):J(i);t.bind={legend:{merge:a}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=jS(t.bind)&&t.bind.legend,a=o=>s=>{const l=fe(s);return l.markname=o,l};for(const o of t.project.items){if(!o.hasLegend)continue;const s=`${Je(o.field)}_legend`,l=`${r}_${s}`,u=n.filter(c=>c.name===l);if(u.length===0){const c=i.merge.map(a(`${s}_symbols`)).concat(i.merge.map(a(`${s}_labels`))).concat(i.merge.map(a(`${s}_entries`)));n.unshift({name:l,...t.init?{}:{value:null},on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]})}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find(d=>d.name===r+Io),o=r+Zd,s=i.items.filter(d=>d.hasLegend).map(d=>Je(`${r}_${Je(d.field)}_legend`)),l=s.map(d=>`${d} !== null`).join(" && "),u=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(d=>({signal:d})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find(d=>d.name===r+ey),f=jS(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push({...c.on[0],events:f}):c.on[0].events=f),n}};function U0e(e,t,n){const r=e.fieldDef(t)?.field;for(const i of gn(e.component.selection??{})){const a=i.project.hasField[r]??i.project.hasChannel[t];if(a&&u4.defined(i)){const o=n.get("selections")??[];o.push(i.name),n.set("selections",o,!1),a.hasLegend=!0}}}const c4="_translate_anchor",f4="_translate_delta",B0e={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=Ro.defined(t),a=r+c4,{x:o,y:s}=t.project.hasChannel;let l=go(t.translate,"scope");return i||(l=l.map(u=>(u.between[0].markname=r+eh,u))),n.push({name:a,value:{},on:[{events:l.map(u=>u.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${i?eT(e,et):`slice(${o.signals.visual})`}`:"")+(s!==void 0?`, extent_y: ${i?eT(e,vt):`slice(${s.signals.visual})`}`:"")+"}"}]},{name:r+f4,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),o!==void 0&&d4(e,t,o,"width",n),s!==void 0&&d4(e,t,s,"height",n),n}};function d4(e,t,n,r,i){const a=t.name,o=a+c4,s=a+f4,l=n.channel,u=Ro.defined(t),c=i.filter(x=>x.name===n.signals[u?"data":"visual"])[0],f=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(l),h=d.get("type"),p=d.get("reverse"),m=u?l===et?p?"":"-":p?"-":"":"",g=`${o}.extent_${l}`,y=`${m}${s}.${l} / ${u?`${f}`:`span(${g})`}`,v=u?h==="log"?"panLog":h==="symlog"?"panSymlog":h==="pow"?"panPow":"panLinear":"panLinear",b=u?h==="pow"?`, ${d.get("exponent")??1}`:h==="symlog"?`, ${d.get("constant")??1}`:"":"",w=`${v}(${g}, ${y}${b})`;c.on.push({events:{signal:s},update:u?w:`clampRange(${w}, 0, ${f})`})}const h4="_zoom_anchor",p4="_zoom_delta",q0e={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=Ro.defined(t),a=r+p4,{x:o,y:s}=t.project.hasChannel,l=H(e.scaleName(et)),u=H(e.scaleName(vt));let c=go(t.zoom,"scope");return i||(c=c.map(f=>(f.markname=r+eh,f))),n.push({name:r+h4,on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&m4(e,t,o,"width",n),s!==void 0&&m4(e,t,s,"height",n),n}};function m4(e,t,n,r,i){const a=t.name,o=n.channel,s=Ro.defined(t),l=i.filter(v=>v.name===n.signals[s?"data":"visual"])[0],u=e.getSizeSignalRef(r).signal,c=e.getScaleComponent(o),f=c.get("type"),d=s?eT(e,o):l.name,h=a+p4,p=`${a}${h4}.${o}`,m=s?f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear":"zoomLinear",g=s?f==="pow"?`, ${c.get("exponent")??1}`:f==="symlog"?`, ${c.get("constant")??1}`:"":"",y=`${m}(${d}, ${p}, ${h}${g})`;l.on.push({events:{signal:h},update:s?y:`clampRange(${y}, 0, ${u})`})}const Zs="_store",Io="_tuple",H0e="_modify",g4="vlSelectionResolve",ty=[E0e,x0e,w0e,l4,s4,Ro,u4,j0e,B0e,q0e,o4];function W0e(e){let t=e.parent;for(;t&&!Xr(t);)t=t.parent;return t}function Gu(e,{escape:t}={escape:!0}){let n=t?H(e.name):e.name;const r=W0e(e);if(r){const{facet:i}=r;for(const a of kr)i[a]&&(n+=` + '__facet_${a}_' + (facet[${H(r.vgField(a))}])`)}return n}function sT(e){return gn(e.component.selection??{}).reduce((t,n)=>t||n.project.items.some(r=>r.field===Jd),!1)}function y4(e,t){(X(t.select)||!t.select.on)&&delete e.events,(X(t.select)||!t.select.clear)&&delete e.clear,(X(t.select)||!t.select.toggle)&&delete e.toggle}function lT(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...lT(e.object)),t.push(...lT(e.property))),t)}function v4(e){return e.object.type==="MemberExpression"?v4(e.object):e.object.name==="datum"}function b4(e){const t=yk(e),n=new Set();return t.visit(r=>{r.type==="MemberExpression"&&v4(r)&&n.add(lT(r).slice(1).join("."))}),n}class rh extends je{constructor(e,t,n){super(e);this.model=t,this.filter=n,this.expr=ny(this.model,this.filter,this),this._dependentFields=b4(this.expr)}clone(){return new rh(null,this.model,fe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function G0e(e,t){const n={},r=e.config.selection;if(!t||!t.length)return n;for(const i of t){const a=Je(i.name),o=i.select,s=X(o)?o:o.type,l=Q(o)?fe(o):{type:s},{fields:u,encodings:c,...f}=r[s];for(const h in f)h==="mark"&&(l[h]={...f[h],...l[h]}),(l[h]===void 0||l[h]===!0)&&(l[h]=f[h]??l[h]);const d=n[a]={...l,name:a,type:s,init:i.value,bind:i.bind,events:X(l.on)?go(l.on,"scope"):J(fe(l.on))};for(const h of ty)h.defined(d)&&h.parse&&h.parse(e,d,i)}return n}function w4(e,t,n,r="datum"){const i=X(t)?t:t.param,a=Je(i),o=H(a+Zs);let s;try{s=e.getSelectionComponent(a,i)}catch(c){return`!!${a}`}if(s.project.timeUnit){const c=n??e.component.data.raw,f=s.project.timeUnit.clone();c.parent?f.insertAsParentOf(c):c.parent=f}const l=`vlSelectionTest(${o}, ${r}${s.resolve==="global"?")":`, ${H(s.resolve)})`}`,u=`length(data(${o}))`;return t.empty===!1?`${u} && ${l}`:`!${u} || ${l}`}function x4(e,t,n){const r=Je(t),i=n.encoding;let a=n.field,o;try{o=e.getSelectionComponent(r,t)}catch(s){return r}if(!i&&!a)a=o.project.items[0].field,o.project.items.length>1&&U(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${H(a)}.`);else if(i&&!a){const s=o.project.items.filter(l=>l.channel===i);!s.length||s.length>1?(a=o.project.items[0].field,U((s.length?"Multiple ":"No ")+`matching ${H(i)} encoding found for selection ${H(n.param)}. Using "field": ${H(a)}.`)):a=s[0].field}return`${o.name}[${H(wr(a))}]`}function Y0e(e,t){for(const[n,r]of vo(e.component.selection??{})){const i=e.getName(`lookup_${n}`);e.component.data.outputNodes[i]=r.materialized=new wn(new rh(t,e,{param:n}),i,Ye.Lookup,e.component.data.outputNodeRefCounts)}}function ny(e,t,n){return Id(t,r=>X(r)?r:Cpe(r)?w4(e,r,n):mP(r))}function V0e(e,t){return e?z(e)&&!_o(e)?e.map(n=>$S(n,t)).join(", "):e:void 0}function uT(e,t,n,r){var i,a;e.encode??(e.encode={}),(i=e.encode)[t]??(i[t]={}),(a=e.encode[t]).update??(a.update={}),e.encode[t].update[n]=r}function ih(e,t,n,r={header:!1}){const{disable:i,orient:a,scale:o,labelExpr:s,title:l,zindex:u,...c}=e.combine();if(i)return;for(const f in c){const d=Rme[f],h=c[f];if(d&&d!==t&&d!=="both")delete c[f];else if(Xd(h)){const{condition:p,...m}=h,g=J(p),y=KP[f];if(y){const{vgProp:v,part:b}=y,w=[...g.map(x=>{const{test:E,...k}=x;return{test:ny(null,E),...k}}),m];uT(c,b,v,w),delete c[f]}else if(y===null){const v={signal:g.map(b=>{const{test:w,...x}=b;return`${ny(null,w)} ? ${jz(x)} : `}).join("")+jz(m)};c[f]=v}}else if(ie(h)){const p=KP[f];if(p){const{vgProp:m,part:g}=p;uT(c,g,m,h),delete c[f]}}de(["labelAlign","labelBaseline"],f)&&c[f]===null&&delete c[f]}if(t==="grid"){if(!c.grid)return;if(c.encode){const{grid:f}=c.encode;c.encode={...f?{grid:f}:{}},Pe(c.encode)&&delete c.encode}return{scale:o,orient:a,...c,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ft(u,0)}}else{if(!r.header&&e.mainExtracted)return;if(s!==void 0){let d=s;c.encode?.labels?.update&&ie(c.encode.labels.update.text)&&(d=Us(s,"datum.label",c.encode.labels.update.text.signal)),uT(c,"labels","text",{signal:d})}if(c.labelAlign===null&&delete c.labelAlign,c.encode){for(const d of QP)e.hasAxisPart(d)||delete c.encode[d];Pe(c.encode)&&delete c.encode}const f=V0e(l,n);return{scale:o,orient:a,grid:!1,...f?{title:f}:{},...c,...n.aria===!1?{aria:!1}:{},zindex:ft(u,0)}}}function k4(e){const{axes:t}=e.component,n=[];for(const r of Ri)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const a=r==="x"?"height":"width",o=e.getSizeSignalRef(a).signal;a!==o&&n.push({name:a,update:o})}}return n}function X0e(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(i=>ih(i,"grid",t)),...r.map(i=>ih(i,"grid",t)),...n.map(i=>ih(i,"main",t)),...r.map(i=>ih(i,"main",t))].filter(i=>i)}function E4(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const a=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},l=new Set([...j(o),...j(s)]),u={};for(const c of l.values())u[c]={signal:`${r.signal} === "${a}" ? ${Ea(o[c])} : ${Ea(s[c])}`};return u}return t[i]})])}function J0e(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:zpe(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],a=e==="x"?"axisX":"axisY",o=ie(n)?"axisOrient":`axis${Ld(n)}`,s=[...i,...i.map(u=>a+u.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:E4(s,r,e,n),vgAxisConfig:E4(l,r,e,n),axisConfigStyle:K0e([...l,...s],r)}}function K0e(e,t){const n=[{}];for(const r of e){let i=t[r]?.style;if(i){i=J(i);for(const a of i)n.push(t.style[a])}}return Object.assign.apply(null,n)}function cT(e,t,n,r={}){const i=Bz(e,n,t);if(i!==void 0)return{configFrom:"style",configValue:i};for(const a of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(r[a]?.[e]!==void 0)return{configFrom:a,configValue:r[a][e]};return{}}const S4={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return DP(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return NP(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>t.grid??Q0e(n,e),gridScale:({model:e,channel:t})=>Z0e(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||A4(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||T4(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>e.labelFlush??tye(t.type,n),labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>e.labelOverlap??nye(t.type,n,V(t)&&!!t.timeUnit,V(t)?t.sort:void 0),orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{const a=e==="x"?"width":e==="y"?"height":void 0,o=a?t.getSizeSignalRef(a):void 0;return n.tickCount??iye({fieldOrDatumDef:r,scaleType:i,size:o,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=_4(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),a=n==="x"?"x2":"y2",o=t.fieldDef(a);return Hz(i?[jP(i)]:[],V(o)?[jP(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>aye(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>e.zindex??oye(n,t)};function Q0e(e,t){return!en(e)&&V(t)&&!Ge(t?.bin)&&!yn(t?.bin)}function Z0e(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function eye(e,t,n,r,i){const a=t?.labelAngle;if(a!==void 0)return ie(a)?a:zd(a);{const{configValue:o}=cT("labelAngle",r,t?.style,i);return o!==void 0?zd(o):n===et&&de([pS,hS],e.type)&&!(V(e)&&e.timeUnit)?270:void 0}}function fT(e){return`(((${e.signal} % 360) + 360) % 360)`}function T4(e,t,n,r){if(e!==void 0)if(n==="x"){if(ie(e)){const i=fT(e),a=ie(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${a} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(ie(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(ie(e)){const i=fT(e),a=ie(t)?`(${t.signal} === "left")`:t==="left",o=r?'"middle"':"null";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${o} : (45 <= ${i} && ${i} <= 135) === ${a} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(ie(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function A4(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,a=r?"bottom":"left";if(ie(e)){const o=fT(e),s=ie(t)?`(${t.signal} === "${a}")`:t===a;return{signal:`(${i?`(${o} + 90)`:o} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${o} && ${o} < ${180+i}) === ${s} ? "left" : "right"`}}if((e+i)%180===0)return r?null:"center";if(ie(t)){const o=i<e&&e<180+i?"===":"!==",s=`${t.signal} ${o} "${a}"`;return{signal:`${s} ? "left" : "right"`}}return(i<e&&e<180+i)===(t===a)?"left":"right"}function tye(e,t){return t==="x"&&de(["quantitative","temporal"],e)?!0:void 0}function nye(e,t,n,r){return n&&!Q(r)||e!=="nominal"&&e!=="ordinal"?t==="log"||t==="symlog"?"greedy":!0:void 0}function rye(e){return e==="x"?"bottom":"left"}function iye({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){if(!r&&!en(t)&&t!=="log"){if(V(e)){if(Ge(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&de(["month","hours","day","quarter"],vn(e.timeUnit)?.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function _4(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?Wz(a,o):a||(o||(a!==void 0?a:o!==void 0?o:void 0))}function aye(e,t){const n=e.values;return z(n)?JP(t,n):ie(n)?n:void 0}function oye(e,t){return e==="rect"&&L0(t)?1:0}class ah extends je{constructor(e,t){super(e);this.transform=t,this._dependentFields=b4(this.transform.calculate)}clone(){return new ah(null,fe(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((n,r)=>{if(!ju(n))return;if(PP(n.sort)){const{field:i,timeUnit:a}=n,o=n.sort,s=o.map((l,u)=>`${mP({field:i,timeUnit:a,equal:l})} ? ${u} : `).join("")+o.length;e=new ah(e,{calculate:s,as:Yu(n,r,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${be(this.transform)}`}}function Yu(e,t,n){return Y(e,{prefix:t,suffix:"sort_index",...n??{}})}function ry(e,t){return de(["top","bottom"],t)?"column":de(["left","right"],t)||e==="row"?"row":"column"}function Vu(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return ft((t||{})[e],i[e],n.header[e])}function iy(e,t,n,r){const i={};for(const a of e){const o=Vu(a,t||{},n,r);o!==void 0&&(i[a]=o)}return i}const dT=["row","column"],hT=["header","footer"];function sye(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=iy(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=ry(t,s),u=zd(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...$4(u,l),...C4(l,u,a),...O4(r,i,t,nge,m6)}}}function C4(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=A4(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function $4(e,t){const n=T4(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function lye(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of hT)if(n[i])for(const a of n[i]){const o=cye(e,t,i,n,a);o!=null&&r.push(o)}return r}function uye(e,t){const{sort:n}=e;return zi(n)?{field:Y(n,{expr:"datum"}),order:n.order??"ascending"}:z(n)?{field:Yu(e,t,{expr:"datum"}),order:"ascending"}:{field:Y(e,{expr:"datum"}),order:n??"ascending"}}function pT(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=iy(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=kS({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=ry(t,s);return{text:{signal:l?Us(Us(l,"datum.label",u),"datum.value",Y(e,{expr:"parent"})):u},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...$4(a,c),...C4(c,a,o),...O4(n,e,t,rge,g6)}}function cye(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:f}=iy(["labelOrient"],o.header,s,t);(t==="row"&&!de(["top","bottom"],f)||t==="column"&&!de(["left","right"],f))&&(a=pT(o,t,s))}const l=Xr(e)&&!Yd(e.facet),u=i.axes,c=u?.length>0;if(a||c){const f=t==="row"?"height":"width";return{name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`,...r.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:uye(o,t)}:{},...c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{},...a?{title:a}:{},...i.sizeSignal?{encode:{update:{[f]:i.sizeSignal}}}:{},...c?{axes:u}:{}}}}return null}const fye={column:{start:0,end:1},row:{start:1,end:0}};function dye(e,t){return fye[t][e]}function hye(e,t){const n={};for(const r of kr){const i=e[r];if(i?.facetFieldDef){const{titleAnchor:a,titleOrient:o}=iy(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),s=ry(r,o),l=dye(a,s);l!==void 0&&(n[s]=l)}}return Pe(n)?void 0:n}function O4(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const s=Vu(o,t?.header,e,n);s!==void 0&&(a[i[o]]=s)}return a}function mT(e){return[...ay(e,"width"),...ay(e,"height"),...ay(e,"childWidth"),...ay(e,"childHeight")]}function ay(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const a=e.getScaleComponent(n);if(a){const o=a.get("type"),s=a.get("range");if(en(o)&&Co(s)){const l=e.scaleName(n);if(Xr(e.parent)){const u=e.parent.component.resolve;if(u.scale[n]==="independent")return[M4(l,s)]}return[M4(l,s),{name:i,update:D4(l,a,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){const a=i.endsWith("width"),o=a?"containerSize()[0]":"containerSize()[1]",s=HS(e.config.view,a?"width":"height"),l=`isFinite(${o}) ? ${o} : ${s}`;return[{name:i,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:i,value:r}]}function M4(e,t){return{name:`${e}_step`,value:t.step}}function D4(e,t,n){const r=t.get("type"),i=t.get("padding"),a=ft(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o=r==="band"?o!==void 0?o:i:1,`bandspace(${n}, ${Ea(o)}, ${Ea(a)}) * ${e}_step`}function N4(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function R4(e,t){return j(e).reduce((n,r)=>{const i=e[r];return{...n,...Wu(t,i,r,a=>Ke(a.value))}},{})}function F4(e,t){if(Ku(t)||Xr(t))return"shared";if(OT(t))return Fi(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function gT(e,t){const n=e.scale[t],r=Fi(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&U(Qhe(t)),"independent"):e[r][t]||"shared"}const pye={...oge,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},I4=j(pye);class mye extends Do{}const L4={symbols:gye,gradient:yye,labels:vye,entries:bye};function gye(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){if(a!=="symbol")return;const{markDef:o,encoding:s,config:l,mark:u}=n,c=o.filled&&u!=="trail";let f={...fhe({},n,ime),...e4(n,{filled:c})};const d=i.get("symbolOpacity")??l.legend.symbolOpacity,h=i.get("symbolFillColor")??l.legend.symbolFillColor,p=i.get("symbolStrokeColor")??l.legend.symbolStrokeColor,m=d===void 0?z4(s.opacity)??o.opacity:void 0;if(f.fill){if(r==="fill"||c&&r===In)delete f.fill;else if(f.fill.field)h?delete f.fill:(f.fill=Ke(l.legend.symbolBaseFillColor??"black"),f.fillOpacity=Ke(m??1));else if(z(f.fill)){const g=yT(s.fill??s.color)??o.fill??(c&&o.color);g&&(f.fill=Ke(g))}}if(f.stroke){if(r==="stroke"||!c&&r===In)delete f.stroke;else if(f.stroke.field||p)delete f.stroke;else if(z(f.stroke)){const g=ft(yT(s.stroke||s.color),o.stroke,c?o.color:void 0);g&&(f.stroke={value:g})}}if(r!==ba){const g=V(t)&&j4(n,i,t);g?f.opacity=[{test:g,...Ke(m??1)},Ke(l.legend.unselectedOpacity)]:m&&(f.opacity=Ke(m))}return f={...f,...e},Pe(f)?void 0:f}function yye(e,{model:t,legendType:n,legendCmpt:r}){if(n!=="gradient")return;const{config:i,markDef:a,encoding:o}=t;let s={};const l=r.get("gradientOpacity")??i.legend.gradientOpacity,u=l===void 0?z4(o.opacity)||a.opacity:void 0;return u&&(s.opacity=Ke(u)),s={...s,...e},Pe(s)?void 0:s}function vye(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=V(t)?j4(n,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=Js(c)?ES({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d={...l?{opacity:l}:{},...f?{text:f}:{},...e};return Pe(d)?void 0:d}function bye(e,{legendCmpt:t}){const n=t.get("selections");return n?.length?{...e,fill:{value:"transparent"}}:e}function z4(e){return P4(e,(t,n)=>Math.max(t,n.value))}function yT(e){return P4(e,(t,n)=>ft(t,n.value))}function P4(e,t){return kme(e)?J(e.condition).reduce(t,e.value):Yr(e)?e.value:void 0}function j4(e,t,n){const r=t.get("selections");if(!r?.length)return;const i=H(n.field);return r.map(a=>{const o=H(Je(a)+Zs);return`(!length(data(${o})) || (${a}[${i}] && indexof(${a}[${i}], datum.value) >= 0))`}).join(" || ")}const U4={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return DP(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return NP(r,t,n)},gradientLength:e=>{const{legend:t,legendConfig:n}=e;return t.gradientLength??n.gradientLength??Aye(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>e.labelOverlap??t.labelOverlap??_ye(n),symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>e.symbolType??xye(t.type,n,r.shape,t.shape),title:({fieldOrDatumDef:e,config:t})=>Uu(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Fu(n)&&Gr(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>wye(t,e)};function wye(e,t){const n=e.values;return z(n)?JP(t,n):ie(n)?n:void 0}function xye(e,t,n,r){if(t!=="shape"){const i=yT(n)??r;if(i)return i}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function kye(e){const{legend:t}=e;return ft(t.type,Eye(e))}function Eye({channel:e,timeUnit:t,scaleType:n}){if(Fu(e)){if(de(["quarter","month","day"],t))return"symbol";if(Gr(n))return"gradient"}return"symbol"}function Sye({legendConfig:e,legendType:t,orient:n,legend:r}){return r.direction??e[t?"gradientDirection":"symbolDirection"]??Tye(n,t)}function Tye(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Aye({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;return Gr(i)?n==="horizontal"?r==="top"||r==="bottom"?B4(t,"width",o,a):o:B4(t,"height",l,s):void 0}function B4(e,t,n,r){const i=e.getSizeSignalRef(t).signal;return{signal:`clamp(${i}, ${n}, ${r})`}}function _ye(e){return de(["quantile","threshold","log","symlog"],e)?"greedy":void 0}function q4(e){const t=dt(e)?Cye(e):Dye(e);return e.component.legends=t,t}function Cye(e){const{encoding:t}=e,n={};for(const r of[In,...v6]){const i=wt(t[r]);if(!i||!e.getScaleComponent(r))continue;if(r===Ln&&V(i)&&i.type===zu)continue;n[r]=Mye(e,r)}return n}function $ye(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Oye(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!n?.values;case"title":if(t==="title"&&e===r?.title)return!0}return e===(n||{})[t]}function Mye(e,t){let n=e.legend(t);const{markDef:r,encoding:i,config:a}=e,o=a.legend,s=new mye({},$ye(e,t));U0e(e,t,s);const l=n!==void 0?!n:o.disable;if(s.set("disable",l,n!==void 0),l)return s;n=n||{};const u=e.getScaleComponent(t).get("type"),c=wt(i[t]),f=V(c)?vn(c.timeUnit)?.unit:void 0,d=n.orient||a.legend.orient||"right",h=kye({legend:n,channel:t,timeUnit:f,scaleType:u}),p=Sye({legend:n,legendType:h,orient:d,legendConfig:o}),m={legend:n,channel:t,model:e,markDef:r,encoding:i,fieldOrDatumDef:c,legendConfig:o,config:a,scaleType:u,orient:d,legendType:h,direction:p};for(const w of I4){if(h==="gradient"&&w.startsWith("symbol")||h==="symbol"&&w.startsWith("gradient"))continue;const x=w in U4?U4[w](m):n[w];if(x!==void 0){const E=Oye(x,w,n,e.fieldDef(t));(E||a.legend[w]===void 0)&&s.set(w,x,E)}}const g=n?.encoding??{},y=s.get("selections"),v={},b={fieldOrDatumDef:c,model:e,channel:t,legendCmpt:s,legendType:h};for(const w of["labels","legend","title","symbols","gradient","entries"]){const x=R4(g[w]??{},e),E=w in L4?L4[w](x,b):x;E!==void 0&&!Pe(E)&&(v[w]={...y?.length&&V(c)?{name:`${Je(c.field)}_legend_${w}`}:{},...y?.length?{interactive:!!y}:{},update:E})}return Pe(v)||s.set("encode",v,!!n?.encoding),s}function Dye(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){q4(r);for(const i of j(r.component.legends))n.legend[i]=gT(e.component.resolve,i),n.legend[i]==="shared"&&(t[i]=H4(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of j(t))for(const i of e.children){if(!i.component.legends[r])continue;n.legend[r]==="shared"&&delete i.component.legends[r]}return t}function H4(e,t){if(!e)return t.clone();const n=e.getWithExplicit("orient"),r=t.getWithExplicit("orient");if(n.explicit&&r.explicit&&n.value!==r.value)return;let i=!1;for(const a of I4){const o=No(e.getWithExplicit(a),t.getWithExplicit(a),a,"legend",(s,l)=>{switch(a){case"symbolType":return Nye(s,l);case"title":return Gz(s,l);case"type":return i=!0,ir("symbol")}return X0(s,l,a,"legend")});e.setWithExplicit(a,o)}return i&&(e.implicit?.encode?.gradient&&d0(e.implicit,["encode","gradient"]),e.explicit?.encode?.gradient&&d0(e.explicit,["encode","gradient"])),e}function Nye(e,t){return t.value==="circle"?t:e}function Rye(e,t,n,r){var i,a;e.encode??(e.encode={}),(i=e.encode)[t]??(i[t]={}),(a=e.encode[t]).update??(a.update={}),e.encode[t].update[n]=r}function W4(e){const t=e.component.legends,n={};for(const i of j(t)){const a=e.getScaleComponent(i),o=We(a.get("domains"));if(n[o])for(const s of n[o]){const l=H4(s,t[i]);l||n[o].push(t[i])}else n[o]=[t[i].clone()]}const r=gn(n).flat().map(i=>Fye(i,e.config)).filter(i=>i!==void 0);return r}function Fye(e,t){const{disable:n,labelExpr:r,selections:i,...a}=e.combine();if(n)return;if(t.aria===!1&&a.aria==null&&(a.aria=!1),a.encode?.symbols){const o=a.encode.symbols.update;o.fill&&o.fill.value!=="transparent"&&!o.stroke&&!a.stroke&&(o.stroke={value:"transparent"});for(const s of v6)a[s]&&delete o[s]}if(a.title||delete a.title,r!==void 0){let o=r;a.encode?.labels?.update&&ie(a.encode.labels.update.text)&&(o=Us(r,"datum.label",a.encode.labels.update.text.signal)),Rye(a,"labels","text",{signal:o})}return a}function Iye(e){return Ku(e)||OT(e)?Lye(e):G4(e)}function Lye(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),G4(e))}function G4(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},a=t.data.reduce((o,s)=>{const l=ie(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return de(o,l)||o.push(l),o},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]},...n}]}else return[{name:r,translate:{signal:"[width / 2, height / 2]"},...n}]}const zye=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Y4 extends Do{constructor(e,t,n,r){super({...t},{name:e});this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function V4(e){e.component.projection=dt(e)?Pye(e):Bye(e)}function Pye(e){if(e.hasProjection){const t=zn(e.specifiedProjection),n=!(t&&(t.scale!=null||t.translate!=null)),r=n?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,i=n?jye(e):void 0,a=new Y4(e.projectionName(!0),{...zn(e.config.projection)??{},...t??{}},r,i);return a.get("type")||a.set("type","equalEarth",!1),a}return}function jye(e){const t=[],{encoding:n}=e;for(const r of[[Mi,Oi],[xr,Wr]])(wt(n[r[0]])||wt(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Ln)&&e.typedFieldDef(Ln).type===zu&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Ye.Main)),t}function Uye(e,t){const n=zE(zye,i=>!te(e.explicit,i)&&!te(t.explicit,i)?!0:!!(te(e.explicit,i)&&te(t.explicit,i)&&Ai(e.get(i),t.get(i)))),r=Ai(e.size,t.size);if(r){if(n)return e;if(Ai(e.explicit,{}))return t;if(Ai(t.explicit,{}))return e}return null}function Bye(e){if(e.children.length===0)return;let t;for(const r of e.children)V4(r);const n=zE(e.children,r=>{const i=r.component.projection;if(i)if(t){const a=Uye(t,i);return a&&(t=a),!!a}else return t=i,!0;else return!0});if(t&&n){const r=e.projectionName(!0),i=new Y4(r,t.specifiedProjection,t.size,fe(t.data));for(const a of e.children){const o=a.component.projection;o&&(o.isFit&&i.data.push(...a.component.projection.data),a.renameProjection(o.get("name"),r),o.merged=!0)}return i}return}function qye(e,t,n,r){if(Vd(t,n)){const i=dt(e)?e.axis(n)??e.legend(n)??{}:{},a=Y(t,{expr:"datum"}),o=Y(t,{expr:"datum",binSuffix:"end"});return{formulaAs:Y(t,{binSuffix:"range",forAs:!0}),formula:M0(a,o,i.format,i.formatType,r)}}return{}}function X4(e,t){return`${Fz(e)}_${t}`}function Hye(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function vT(e,t,n){const r=j0(n,void 0)??{},i=X4(r,t);return e.getName(`${i}_bins`)}function Wye(e){return"as"in e}function J4(e,t,n){let r,i;Wye(e)?r=X(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:r=[Y(e,{forAs:!0}),Y(e,{binSuffix:"end",forAs:!0})];const a={...j0(t,void 0)},o=X4(a,e.field),{signal:s,extentSignal:l}=Hye(n,o);if(x0(a.extent)){const c=a.extent;i=x4(n,c.param,c),delete a.extent}const u={bin:a,field:e.field,as:[r],...s?{signal:s}:{},...l?{extentSignal:l}:{},...i?{span:i}:{}};return{key:o,binComponent:u}}class Ca extends je{constructor(e,t){super(e);this.bins=t}clone(){return new Ca(null,fe(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((r,i,a)=>{if(Sr(i)&&Ge(i.bin)){const{key:o,binComponent:s}=J4(i,i.bin,t);r[o]={...s,...r[o],...qye(t,i,a,t.config)}}return r},{});return Pe(n)?null:new Ca(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=J4(t,t.bin,n);return new Ca(e,{[r]:i})}merge(e,t){for(const n of j(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=_i([...this.bins[n].as,...e.bins[n].as],be)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(gn(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(gn(this.bins).map(e=>e.field))}hash(){return`Bin ${be(this.bins)}`}assemble(){return gn(this.bins).flatMap(e=>{const t=[],[n,...r]=e.as,{extent:i,...a}=e.bin,o={type:"bin",field:wr(e.field),as:n,signal:e.signal,...x0(i)?{extent:null}:{extent:i},...e.span?{span:{signal:`span(${e.span})`}}:{},...a};!i&&e.extentSignal&&(t.push({type:"extent",field:wr(e.field),signal:e.extentSignal}),o.extent={signal:e.extentSignal}),t.push(o);for(const s of r)for(let l=0;l<2;l++)t.push({type:"formula",expr:Y({field:n[l]},{expr:"datum"}),as:s[l]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}function Gye(e,t,n,r){const i=dt(r)?r.encoding[wa(t)]:void 0;if(Sr(n)&&dt(r)&&qP(n,i,r.markDef,r.config))e.add(Y(n,{})),e.add(Y(n,{suffix:"end"})),n.bin&&Vd(n,t)&&e.add(Y(n,{binSuffix:"range"}));else if(Lde(t)){const a=Ide(t);e.add(r.getName(a))}else e.add(Y(n));return e}function Yye(e,t){for(const n of j(t)){const r=t[n];for(const i of j(r))n in e?e[n][i]=new Set([...e[n][i]??[],...r[i]]):e[n]={[i]:r[i]}}}class Bi extends je{constructor(e,t,n){super(e);this.dimensions=t,this.measures=n}clone(){return new Bi(null,new Set(this.dimensions),fe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(a=>{a.aggregate&&(n=!0)});const r={},i=new Set();return n?(t.forEachFieldDef((a,o)=>{const{aggregate:s,field:l}=a;if(s)if(s==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([Y(a,{forAs:!0})]);else{if(xa(s)||Ao(s)){const u=xa(s)?"argmin":"argmax",c=s[u];r[c]??(r[c]={}),r[c][u]=new Set([Y({op:u,field:c},{forAs:!0})])}else r[l]??(r[l]={}),r[l][s]=new Set([Y(a,{forAs:!0})]);To(o)&&t.scaleDomain(o)==="unaggregated"&&(r[l]??(r[l]={}),r[l].min=new Set([Y({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([Y({field:l,aggregate:"max"},{forAs:!0})]))}else Gye(i,o,a,t)}),i.size+j(r).length===0?null:new Bi(e,i,r)):null}static makeFromTransform(e,t){const n=new Set(),r={};for(const i of t.aggregate){const{op:a,field:o,as:s}=i;a&&(a==="count"?(r["*"]??(r["*"]={}),r["*"].count=new Set([s||Y(i,{forAs:!0})])):(r[o]??(r[o]={}),r[o][a]=new Set([s||Y(i,{forAs:!0})])))}for(const i of t.groupby??[])n.add(i);return n.size+j(r).length===0?null:new Bi(e,n,r)}merge(e){return bz(this.dimensions,e.dimensions)?(Yye(this.measures,e.measures),!0):(ppe("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...j(this.measures)])}producedFields(){const e=new Set();for(const t of j(this.measures))for(const n of j(this.measures[t])){const r=this.measures[t][n];r.size===0?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${be({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const i of j(this.measures))for(const a of j(this.measures[i]))for(const o of this.measures[i][a])n.push(o),e.push(a),t.push(i==="*"?null:wr(i));const r={type:"aggregate",groupby:[...this.dimensions].map(wr),ops:e,fields:t,as:n};return r}}class Xu extends je{constructor(e,t,n,r){super(e);this.model=t,this.name=n,this.data=r;for(const i of kr){const a=t.facet[i];if(a){const{bin:o,sort:s}=a;this[i]={name:t.getName(`${i}_domain`),fields:[Y(a),...Ge(o)?[Y(a,{binSuffix:"end"})]:[]],...zi(s)?{sortField:s}:z(s)?{sortIndexField:Yu(a,i)}:{}}}}this.childModel=t.child}hash(){let e="Facet";for(const t of kr)this[t]&&(e+=` ${t.charAt(0)}:${be(this[t])}`);return e}get fields(){const e=[];for(const t of kr)this[t]?.fields&&e.push(...this[t].fields);return e}dependentFields(){const e=new Set(this.fields);for(const t of kr)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of Ri){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(en(r)&&Co(i)){const a=uy(this.childModel,t),o=CT(a);o?e[t]=o:U(QE(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x",facet:void 0}[e],i=[],a=[],o=[];r&&n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:u=D0,field:c}=s;i.push(c),a.push(u),o.push(Y(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:t??this.data,transform:[{type:"aggregate",groupby:this[e].fields,...i.length?{fields:i,ops:a,as:o}:{}}]}}assembleFacetHeaderData(e){const{columns:t}=this.model.layout,{layoutHeaders:n}=this.model.component,r=[],i={};for(const s of dT){for(const l of hT){const u=(n[s]&&n[s][l])??[];for(const c of u)if(c.axes?.length>0){i[s]=!0;break}}if(i[s]){const l=`length(data("${this.facet.name}"))`,u=s==="row"?t?{signal:`ceil(${l} / ${t})`}:1:t?{signal:`min(${l}, ${t})`}:{signal:l};r.push({name:`${this.facet.name}_${s}`,transform:[{type:"sequence",start:0,stop:u}]})}}const{row:a,column:o}=i;return(a||o)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,e)),r}assemble(){const e=[];let t=null;const n=this.getChildIndependentFieldsWithStep(),{column:r,row:i,facet:a}=this;if(r&&i&&(n.x||n.y)){t=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(n.x??[],n.y??[]),s=o.map(()=>"distinct");e.push({name:t,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:s}]})}for(const o of[ma,pa])this[o]&&e.push(this.assembleRowColumnHeaderData(o,t,n));if(a){const o=this.assembleFacetHeaderData(n);o&&e.push(...o)}return e}}function K4(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function Vye(e,t){const n=BE(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const r=K4(t.slice(5,t.length));return`timeParse(${n},'${r}')`}else if(t.startsWith("utc:")){const r=K4(t.slice(4,t.length));return`utcParse(${n},'${r}')`}else return U(She(t)),null}function Xye(e){const t={};return f0(e.filter,n=>{if(pP(n)){let r=null;aS(n)?r=nr(n.equal):sS(n)?r=nr(n.lte):oS(n)?r=nr(n.lt):lS(n)?r=nr(n.gt):uS(n)?r=nr(n.gte):cS(n)?r=n.range[0]:fS(n)&&(r=(n.oneOf??n.in)[0]),r&&(Ys(r)?t[n.field]="date":Le(r)?t[n.field]="number":X(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Jye(e){const t={};function n(r){qu(r)?t[r.field]="date":r.type==="quantitative"&&nhe(r.aggregate)?t[r.field]="number":Ru(r.field)>1?r.field in t||(t[r.field]="flatten"):ju(r)&&zi(r.sort)&&Ru(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((dt(e)||Xr(e))&&e.forEachFieldDef((r,i)=>{if(Sr(r))n(r);else{const a=Hs(i),o=e.fieldDef(a);n({...r,type:o.type})}}),dt(e)){const{mark:r,markDef:i,encoding:a}=e;if($o(r)&&!e.encoding.order){const o=i.orient==="horizontal"?"y":"x",s=a[o];V(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function Kye(e){const t={};if(dt(e)&&e.component.selection)for(const n of j(e.component.selection)){const r=e.component.selection[n];for(const i of r.project.items)!i.channel&&Ru(i.field)>1&&(t[i.field]="flatten")}return t}class xn extends je{constructor(e,t){super(e);this._parse=t}clone(){return new xn(null,fe(this._parse))}hash(){return`Parse ${be(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!Qs(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const o of j(n)){const s=r.getWithExplicit(o);s.value!==void 0&&(s.explicit||s.value===n[o]||s.value==="derived"||n[o]==="flatten"?delete n[o]:U(Zz(o,n[o],s.value)))}for(const o of j(t)){const s=r.get(o);s!==void 0&&(s===t[o]?delete t[o]:U(Zz(o,t[o],s)))}const i=new Do(t,n);r.copyAll(i);const a={};for(const o of j(i.combine())){const s=i.get(o);s!==null&&(a[o]=s)}return j(a).length===0||r.parseNothing?null:new xn(e,a)}get parse(){return this._parse}merge(e){this._parse={...this._parse,...e.parse},e.remove()}assembleFormatParse(){const e={};for(const t of j(this._parse)){const n=this._parse[t];Ru(t)===1&&(e[t]=n)}return e}producedFields(){return new Set(j(this._parse))}dependentFields(){return new Set(j(this._parse))}assembleTransforms(e=!1){return j(this._parse).filter(t=>e?Ru(t)>1:!0).map(t=>{const n=Vye(t,this._parse[t]);if(!n)return null;const r={type:"formula",expr:n,as:qE(t)};return r}).filter(t=>t!==null)}}class el extends je{clone(){return new el(null)}constructor(e){super(e)}dependentFields(){return new Set()}producedFields(){return new Set([Jd])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Jd}}}class oy extends je{constructor(e,t){super(e);this.params=t}clone(){return new oy(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${be(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class sy extends je{constructor(e,t){super(e);this.params=t}clone(){return new sy(null,this.params)}dependentFields(){return new Set()}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${be(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class tl extends je{constructor(e){super(null);e??(e={name:"source"});let t;if(Qs(e)||(t=e.format?{...tr(e.format,["parse"])}:{}),J0(e))this._data={values:e.values};else if(Qd(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];de(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else V6(e)?this._data={values:[{type:"Sphere"}]}:(G6(e)||Qs(e))&&(this._data={});this._generator=Qs(e),e.name&&(this._name=e.name),t&&!Pe(t)&&(this._data.format=t)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var Q4=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},Qye=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},oh;function bT(e){return e instanceof tl||e instanceof oy||e instanceof sy}class wT{constructor(){oh.set(this,void 0),Q4(this,oh,!1)}setModified(){Q4(this,oh,!0)}get modifiedFlag(){return Qye(this,oh)}}oh=new WeakMap();class nl extends wT{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=this.getNodeDepths(e,0,new Map()),n=[...t.entries()].sort((r,i)=>i[1]-r[1]);for(const r of n)this.run(r[0]);return this.modifiedFlag}}class xT extends wT{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class Zye extends xT{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map(r=>r.hash()),n={};for(let r=0;r<t.length;r++)n[t[r]]===void 0?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const r of j(n))n[r].length>1&&(this.setModified(),this.mergeNodes(e,n[r]))}}class eve extends xT{constructor(e){super();this.requiresSelectionId=e&&sT(e)}run(e){e instanceof el&&(this.requiresSelectionId&&(bT(e.parent)||e.parent instanceof Bi||e.parent instanceof xn)||(this.setModified(),e.remove()))}}class tve extends wT{optimize(e){return this.run(e,new Set()),this.modifiedFlag}run(e,t){let n=new Set();e instanceof _a&&(n=e.producedFields(),PE(n,t)&&(this.setModified(),e.removeFormulas(t),e.producedFields.length===0&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class nve extends xT{constructor(){super()}run(e){e instanceof wn&&!e.isRequired()&&(this.setModified(),e.remove())}}class rve extends nl{run(e){if(bT(e))return;if(e.numChildren()>1)return;for(const t of e.children)if(t instanceof xn)if(e instanceof xn)this.setModified(),e.merge(t);else{if(UE(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}return}}class ive extends nl{run(e){const t=[...e.children],n=e.children.filter(r=>r instanceof xn);if(e.numChildren()>1&&n.length>=1){const r={},i=new Set();for(const a of n){const o=a.parse;for(const s of j(o))s in r?r[s]!==o[s]&&i.add(s):r[s]=o[s]}for(const a of i)delete r[a];if(!Pe(r)){this.setModified();const a=new xn(e,r);for(const o of t){if(o instanceof xn)for(const s of j(r))delete o.parse[s];e.removeChild(o),o.parent=a,o instanceof xn&&j(o.parse).length===0&&o.remove()}}}}}class ave extends nl{run(e){e instanceof wn||e.numChildren()>0||e instanceof Xu||(e instanceof tl||(this.setModified(),e.remove()))}}class ove extends nl{run(e){const t=e.children.filter(r=>r instanceof _a),n=t.pop();for(const r of t)this.setModified(),n.merge(r)}}class sve extends nl{run(e){const t=e.children.filter(r=>r instanceof Bi),n={};for(const r of t){const i=be(r.groupBy);i in n||(n[i]=[]),n[i].push(r)}for(const r of j(n)){const i=n[r];if(i.length>1){const a=i.pop();for(const o of i)a.merge(o)&&(e.removeChild(o),o.parent=a,o.remove(),this.setModified())}}}}class lve extends nl{constructor(e){super();this.model=e}run(e){const t=!(bT(e)||e instanceof rh||e instanceof xn||e instanceof el),n=[],r=[];for(const i of e.children)i instanceof Ca&&(t&&!UE(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const i=n.pop();for(const a of n)i.merge(a,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof Ca?e.merge(i,this.model.renameSignal.bind(this.model)):i.swapWithParent()}if(r.length>1){const i=r.pop();for(const a of r)i.merge(a,this.model.renameSignal.bind(this.model));this.setModified()}}}class uve extends nl{run(e){const t=[...e.children],n=Nu(t,a=>a instanceof wn);if(!n||e.numChildren()<=1)return;const r=[];let i;for(const a of t)if(a instanceof wn){let o=a;for(;o.numChildren()===1;){const[s]=o.children;if(s instanceof wn)o=s;else break}r.push(...o.children),i?(e.removeChild(a),a.parent=i.parent,i.parent.removeChild(i),i.parent=o,this.setModified()):i=o}else r.push(a);if(r.length){this.setModified();for(const a of r)a.parent.removeChild(a),a.parent=i}}}class Ju extends je{constructor(e,t){super(e);this.transform=t}clone(){return new Ju(null,fe(this.transform))}addDimensions(e){this.transform.groupby=_i(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){return e.as??Y(e)}hash(){return`JoinAggregateTransform ${be(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const i of this.transform.joinaggregate)t.push(i.op),n.push(this.getDefaultName(i)),e.push(i.field===void 0?null:i.field);const r=this.transform.groupby;return{type:"joinaggregate",as:n,ops:t,fields:e,...r!==void 0?{groupby:r}:{}}}}function cve(e){return e.stack.stackBy.reduce((t,n)=>{const r=n.fieldDef,i=Y(r);return i&&t.push(i),t},[])}function fve(e){return z(e)&&e.every(t=>X(t))&&e.length>1}class Lo extends je{constructor(e,t){super(e);this._stack=t}clone(){return new Lo(null,fe(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(t.sort!==void 0)for(const c of t.sort)o.push(c.field),s.push(ft(c.order,"ascending"));const l={field:o,order:s};let u;return fve(i)?u=i:X(i)?u=[i,`${i}_end`]:u=[`${t.stack}_start`,`${t.stack}_end`],new Lo(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;if(i){const d=r[i];l=ji(d)}const u=cve(t),c=t.encoding.order;let f;return z(c)||V(c)?f=qz(c):f=u.reduce((d,h)=>(d.field.push(h),d.order.push(a==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Lo(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set();return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${be(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[Y(e,{binSuffix:"mid"})]:[Y(e,{}),Y(e,{binSuffix:"end"})]:[Y(e)]:n??[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{bandPosition:u=.5,bin:c}=n;c&&e.push({type:"formula",expr:`${u}*`+Y(n,{expr:"datum"})+`+${1-u}*`+Y(n,{expr:"datum",binSuffix:"end"}),as:Y(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:Y(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class sh extends je{constructor(e,t){super(e);this.transform=t}clone(){return new sh(null,fe(this.transform))}addDimensions(e){this.transform.groupby=_i(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return(this.transform.groupby??[]).forEach(e.add,e),(this.transform.sort??[]).forEach(t=>e.add(t.field)),this.transform.window.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){return e.as??Y(e)}hash(){return`WindowTransform ${be(this.transform)}`}assemble(){const e=[],t=[],n=[],r=[];for(const c of this.transform.window)t.push(c.op),n.push(this.getDefaultName(c)),r.push(c.param===void 0?null:c.param),e.push(c.field===void 0?null:c.field);const i=this.transform.frame,a=this.transform.groupby;if(i&&i[0]===null&&i[1]===null&&t.every(c=>XE(c)))return{type:"joinaggregate",as:n,ops:t,fields:e,...a!==void 0?{groupby:a}:{}};const o=[],s=[];if(this.transform.sort!==void 0)for(const c of this.transform.sort)o.push(c.field),s.push(c.order??"ascending");const l={field:o,order:s},u=this.transform.ignorePeers;return{type:"window",params:r,as:n,ops:t,fields:e,sort:l,...u!==void 0?{ignorePeers:u}:{},...a!==void 0?{groupby:a}:{},...i!==void 0?{frame:i}:{}}}}function dve(e){function t(n){if(!(n instanceof Xu)){const r=n.clone();if(r instanceof wn){const i=ET+r.getSource();r.setSource(i),e.model.component.data.outputNodes[i]=r}else(r instanceof Bi||r instanceof Lo||r instanceof sh||r instanceof Ju)&&r.addDimensions(e.fields);for(const i of n.children.flatMap(t))i.parent=r;return[r]}return n.children.flatMap(t)}return t}function kT(e){if(e instanceof Xu)if(e.numChildren()===1&&!(e.children[0]instanceof wn)){const t=e.children[0];(t instanceof Bi||t instanceof Lo||t instanceof sh||t instanceof Ju)&&t.addDimensions(e.fields),t.swapWithParent(),kT(e)}else{const t=e.model.component.data.main;Z4(t);const n=dve(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else e.children.map(kT)}function Z4(e){if(e instanceof wn&&e.type===Ye.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Xu||(t.swapWithParent(),Z4(e))}}const ET="scale_",ly=5;function ST(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!ST(t.children))return!1}return!0}function Vr(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function e8(e,t,n){let r=e.sources,i=!1;return i=Vr(new nve(),r)||i,i=Vr(new eve(t),r)||i,r=r.filter(a=>a.numChildren()>0),i=Vr(new ave(),r)||i,r=r.filter(a=>a.numChildren()>0),n||(i=Vr(new rve(),r)||i,i=Vr(new lve(t),r)||i,i=Vr(new tve(),r)||i,i=Vr(new ive(),r)||i,i=Vr(new sve(),r)||i,i=Vr(new ove(),r)||i,i=Vr(new Zye(),r)||i,i=Vr(new uve(),r)||i),e.sources=r,i}function hve(e,t){ST(e.sources);let n=0,r=0;for(let i=0;i<ly&&e8(e,t,!0);i++)n++;e.sources.map(kT);for(let i=0;i<ly&&e8(e,t,!1);i++)r++;ST(e.sources),Math.max(n,r)===ly&&U(`Maximum optimization runs(${ly}) reached.`)}class ar{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new ar(()=>e(t))}}function t8(e){dt(e)?pve(e):mve(e)}function pve(e){const t=e.component.scales;for(const n of j(t)){const r=yve(e,n),i=t[n];if(i.setWithExplicit("domains",r),bve(e,n),e.component.data.isFaceted){let a=e;for(;!Xr(a)&&a.parent;)a=a.parent;const o=a.component.resolve.scale[n];if(o==="shared")for(const s of r.value)ka(s)&&(s.data=ET+s.data.replace(ET,""))}}}function mve(e){for(const n of e.children)t8(n);const t=e.component.scales;for(const n of j(t)){let r,i=null;for(const a of e.children){const o=a.component.scales[n];if(o){r===void 0?r=o.getWithExplicit("domains"):r=No(r,o.getWithExplicit("domains"),"domains","scale",_T);const s=o.get("selectionExtent");i&&s&&i.param!==s.param&&U(whe),i=s}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}function gve(e,t,n,r){if(e==="unaggregated"){const{valid:i,reason:a}=n8(t,n);if(!i){U(a);return}}else if(e===void 0&&r.useUnaggregatedDomain){const{valid:i}=n8(t,n);if(i)return"unaggregated"}return e}function yve(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=gve(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:i}),t==="x"&&wt(r.x2)?wt(r.x)?No(zo(n,i,e,"x"),zo(n,i,e,"x2"),"domain","scale",_T):zo(n,i,e,"x2"):t==="y"&&wt(r.y2)?wt(r.y)?No(zo(n,i,e,"y"),zo(n,i,e,"y2"),"domain","scale",_T):zo(n,i,e,"y2"):zo(n,i,e,t)}function vve(e,t,n){return e.map(r=>{const i=U0(r,{timeUnit:n,type:t});return{signal:`{data: ${i}}`}})}function TT(e,t,n){const r=vn(n)?.unit;return t==="temporal"||r?vve(e,t,r):[e]}function zo(e,t,n,r){const{encoding:i}=n,a=wt(i[r]),{type:o}=a,s=a.timeUnit;if(Ype(t)){const f=zo(e,void 0,n,r),d=TT(t.unionWith,o,s);return Aa([...f.value,...d])}else{if(ie(t))return Aa([t]);if(t&&t!=="unaggregated"&&!vP(t))return Aa(TT(t,o,s))}const l=n.stack;if(l&&r===l.fieldChannel){if(l.offset==="normalize")return ir([[0,1]]);const f=n.requestDataName(Ye.Main);return ir([{data:f,field:n.vgField(r,{suffix:"start"})},{data:f,field:n.vgField(r,{suffix:"end"})}])}const u=To(r)&&V(a)?wve(n,r,e):void 0;if(Mo(a)){const f=TT([a.datum],o,s);return ir(f)}const c=a;if(t==="unaggregated"){const f=n.requestDataName(Ye.Main),{field:d}=a;return ir([{data:f,field:Y({field:d,aggregate:"min"})},{data:f,field:Y({field:d,aggregate:"max"})}])}else if(Ge(c.bin)){if(en(e))return e==="bin-ordinal"?ir([]):ir([{data:Fd(u)?n.requestDataName(Ye.Main):n.requestDataName(Ye.Raw),field:n.vgField(r,Vd(c,r)?{binSuffix:"range"}:{}),sort:u===!0||!Q(u)?{field:n.vgField(r,{}),op:"min"}:u}]);{const{bin:f}=c;if(Ge(f)){const d=vT(n,c.field,f);return ir([new ar(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return ir([{data:n.requestDataName(Ye.Main),field:n.vgField(r,{})}])}}else if(c.timeUnit&&de(["time","utc"],e)&&qP(c,dt(n)?n.encoding[wa(r)]:void 0,n.markDef,n.config)){const f=n.requestDataName(Ye.Main);return ir([{data:f,field:n.vgField(r)},{data:f,field:n.vgField(r,{suffix:"end"})}])}else return ir(u?[{data:Fd(u)?n.requestDataName(Ye.Main):n.requestDataName(Ye.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(Ye.Main),field:n.vgField(r)}])}function AT(e,t){const{op:n,field:r,order:i}=e;return{op:n??(t?"sum":D0),...r?{field:wr(r)}:{},...i?{order:i}:{}}}function bve(e,t){const n=e.component.scales[t],r=e.specifiedScales[t].domain,i=e.fieldDef(t)?.bin,a=vP(r)&&r,o=Ws(i)&&x0(i.extent)&&i.extent;(a||o)&&n.set("selectionExtent",a??o,!0)}function wve(e,t,n){if(!en(n))return;const r=e.fieldDef(t),i=r.sort;if(PP(i))return{op:"min",field:Yu(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(s=>s.fieldDef.field)]:void 0;if(zi(i)){const s=a&&!de(o,i.field);return AT(i,s)}else if(zP(i)){const{encoding:s,order:l}=i,u=e.fieldDef(s),{aggregate:c,field:f}=u,d=a&&!de(o,f);if(xa(c)||Ao(c))return AT({field:Y(u),order:l},d);if(XE(c)||!c)return AT({op:c,field:f,order:l},d)}else{if(i==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(de(["ascending",void 0],i))return!0}return}function n8(e,t){const{aggregate:n,type:r}=e;return n?X(n)&&!ahe[n]?{valid:!1,reason:Whe(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:Ghe(e)}:{valid:!0}:{valid:!1,reason:Hhe(e)}}function _T(e,t,n,r){return e.explicit&&t.explicit&&U(Khe(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function xve(e){const t=_i(e.map(o=>{if(ka(o)){const{sort:s,...l}=o;return l}return o}),be),n=_i(e.map(o=>{if(ka(o)){const s=o.sort;return s!==void 0&&!Fd(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}return}).filter(o=>o!==void 0),be);if(t.length===0)return;if(t.length===1){const o=e[0];if(ka(o)&&n.length>0){let s=n[0];if(n.length>1)U(aP),s=!0;else if(Q(s)&&"field"in s){const l=s.field;o.field===l&&(s=s.order?{order:s.order}:!0)}return{...o,sort:s}}return o}const r=_i(n.map(o=>Fd(o)||!("op"in o)||X(o.op)&&o.op in ehe?o:(U(Zhe(o)),!0)),be);let i;r.length===1?i=r[0]:r.length>1&&(U(aP),i=!0);const a=_i(e.map(o=>ka(o)?o.data:null),o=>o);if(a.length===1&&a[0]!==null){const o={data:a[0],fields:t.map(s=>s.field),...i?{sort:i}:{}};return o}return{fields:t,...i?{sort:i}:{}}}function CT(e){if(ka(e)&&X(e.field))return e.field;if(ohe(e)){let t;for(const n of e.fields)if(ka(n)&&X(n.field)){if(!t)t=n.field;else if(t!==n.field)return U(epe),t}return U(tpe),t}else if(she(e)){U(npe);const t=e.fields[0];return X(t)?t:void 0}return}function uy(e,t){const n=e.component.scales[t],r=n.get("domains").map(i=>(ka(i)&&(i.data=e.lookupDataSource(i.data)),i));return xve(r)}function r8(e){return Ku(e)||OT(e)?e.children.reduce((t,n)=>t.concat(r8(n)),i8(e)):i8(e)}function i8(e){return j(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c,...f}=i,d=kve(i.range,a,n,e),h=uy(e,n),p=s?v0e(e,s,r,h):null;return t.push({name:a,type:o,...h?{domain:h}:{},...p?{domainRaw:p}:{},range:d,...c!==void 0?{reverse:c}:{},...f}),t},[])}function kve(e,t,n,r){if(Fi(n)){if(Co(e))return{step:{signal:`${t}_step`}}}else if(Q(e)&&ka(e))return{...e,data:r.lookupDataSource(e.data)};return e}class a8 extends Do{constructor(e,t){super({},{name:e});this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:Nu(this.get("domains"),e=>z(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const Eve=["range","scheme"];function o8(e){return e==="x"?"width":e==="y"?"height":void 0}function Sve(e){const t=e.component.scales;for(const n of w0){const r=t[n];if(!r)continue;const i=Tve(n,e);r.setWithExplicit("range",i)}}function s8(e,t){const n=e.fieldDef(t);if(n?.bin){const{bin:r,field:i}=n,a=o8(t),o=e.getName(a);if(Q(r)&&r.binned&&r.step!==void 0)return new ar(()=>{const s=e.scaleName(t),l=`(domain("${s}")[1] - domain("${s}")[0]) / ${r.step}`;return`${e.getSignalName(o)} / (${l})`});if(Ge(r)){const s=vT(e,i,r);return new ar(()=>{const l=e.getSignalName(s),u=`(${l}.stop - ${l}.start) / ${l}.step`;return`${e.getSignalName(o)} / (${u})`})}}return}function Tve(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e),a=i.get("type");for(const u of Eve)if(n[u]!==void 0){const c=gS(a,u),f=bP(e,u);if(!c)U(rP(a,u,e));else if(f)U(f);else switch(u){case"range":{const d=n.range;if(z(d)){if(Fi(e))return Aa(d.map(h=>{if(h==="width"||h==="height"){const p=t.getName(h),m=t.getSignalName.bind(t);return ar.fromName(m,p)}return h}))}else if(Q(d))return Aa({data:t.requestDataName(Ye.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return Aa(d)}case"scheme":return Aa(Ave(n[u]))}}if(e===et||e===vt){const u=e===et?"width":"height",c=r[u];if(Ui(c)){if(en(a))return Aa({step:c.step});U(iP(u))}}const{rangeMin:o,rangeMax:s}=n,l=_ve(e,t);return(o!==void 0||s!==void 0)&&gS(a,"rangeMin")&&z(l)&&l.length===2?Aa([o??l[0],s??l[1]]):ir(l)}function Ave(e){return Gpe(e)?{scheme:e.name,...tr(e,["name"])}:{scheme:e}}function _ve(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=wt(a[e]),l=t.getScaleComponent(e),u=l.get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case et:case vt:{if(de(["point","band"],u)){if(e===et&&!n.width){const p=Kd(r.view,"width");if(Ui(p))return p}else if(e===vt&&!n.height){const p=Kd(r.view,"height");if(Ui(p))return p}}const d=o8(e),h=t.getName(d);return e===vt&&rr(u)?[ar.fromName(o,h),0]:[0,ar.fromName(o,h)]}case va:{const d=t.component.scales[e].get("zero"),h=l8(i,d,r),p=Ove(i,n,t,r);return Wd(u)?$ve(h,p,Cve(u,r,c,e)):[h,p]}case Hr:return[0,Math.PI*2];case Bs:return[0,360];case $i:return[0,new ar(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case xo:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case ko:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Ln:return"symbol";case In:case Di:case Ni:return u==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":i==="rect"||i==="geoshape"?"heatmap":"ramp";case ba:case bo:case wo:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Cve(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&z(n)?n.length+1:(U(fpe(r)),3)}}function $ve(e,t,n){const r=()=>{const i=Ea(t),a=Ea(e),o=`(${i} - ${a}) / (${n} - 1)`;return`sequence(${a}, ${i} + ${o}, ${o})`};return ie(t)?new ar(r):{signal:r()}}function l8(e,t,n){if(t)return ie(t)?{signal:`${t.signal} ? 0 : ${l8(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(E0("size",e))}const u8=.95;function Ove(e,t,n,r){const i={x:s8(n,"x"),y:s8(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==void 0)return r.scale.maxBandSize;const a=c8(t,i,r.view);return Le(a)?a-1:new ar(()=>`${a.signal} - 1`)}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const a=c8(t,i,r.view);return Le(a)?Math.pow(u8*a,2):new ar(()=>`pow(${u8} * ${a.signal}, 2)`)}}throw new Error(E0("size",e))}function c8(e,t,n){const r=Ui(e.width)?e.width.step:Y0(n,"width"),i=Ui(e.height)?e.height.step:Y0(n,"height");return t.x||t.y?new ar(()=>{const a=[t.x?t.x.signal:r,t.y?t.y.signal:i];return`min(${a.join(", ")})`}):Math.min(r,i)}function f8(e,t){dt(e)?Mve(e,t):p8(e,t)}function Mve(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of j(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=wt(i[s]),d=l[t],h=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=gS(h,t),y=bP(s,t);if(d!==void 0&&(g?y&&U(y):U(rP(h,t,s))),g&&y===void 0)if(d!==void 0){const v=f.timeUnit,b=f.type;switch(t){case"domainMax":case"domainMin":Ys(l[t])||b==="temporal"||v?u.set(t,{signal:U0(l[t],{type:b,timeUnit:v})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const v=t in d8?d8[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];v!==void 0&&u.set(t,v,!1)}}}const d8={bins:({model:e,fieldOrDatumDef:t})=>V(t)?Dve(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>Nve(e,t.type),nice:({scaleType:e,channel:t,domain:n,fieldOrDatumDef:r})=>Rve(e,t,n,r),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>Fve(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>Ive(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>Lve(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>{const i=V(e)?e.sort:void 0;return zve(t,i,n,r.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>Pve(e,t,n,r,i)};function h8(e){dt(e)?Sve(e):p8(e,"range")}function p8(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?h8(r):f8(r,t);for(const r of j(n)){let i;for(const a of e.children){const o=a.component.scales[r];if(o){const s=o.getWithExplicit(t);i=No(i,s,t,"scale",W6((l,u)=>{switch(t){case"range":return l.step&&u.step?l.step-u.step:0}return 0}))}}n[r].setWithExplicit(t,i)}}function Dve(e,t){const n=t.bin;if(Ge(n)){const r=vT(e,t.field,n);return new ar(()=>e.getSignalName(r))}else if(yn(n)&&Ws(n)&&n.step!==void 0)return{step:n.step};return}function Nve(e,t){return de([In,Di,Ni],e)&&t!=="nominal"?"hcl":void 0}function Rve(e,t,n,r){return ji(r)?.bin||z(n)||de([bt.TIME,bt.UTC],e)?void 0:t in So?!0:void 0}function Fve(e,t,n,r,i,a){if(e in So){if(Gr(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:s}=i;if(o==="bar"&&!(V(r)&&(r.bin||r.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return a.continuousBandSize}if(t===bt.POINT)return n.pointPadding}return}function Ive(e,t,n,r){if(e!==void 0)return;if(t in So){const{bandPaddingInner:i,barBandPaddingInner:a,rectBandPaddingInner:o}=r;return ft(i,n==="bar"?a:o)}return}function Lve(e,t,n,r,i,a){if(e!==void 0)return;if(t in So&&n===bt.BAND){const{bandPaddingOuter:o}=a;return ft(o,ie(i)?{signal:`${i.signal}/2`}:i/2)}return}function zve(e,t,n,r){return n==="x"&&r.xReverse!==void 0?rr(e)&&t==="descending"?ie(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse:rr(e)&&t==="descending"?!0:void 0}function Pve(e,t,n,r,i){const a=!!n&&n!=="unaggregated";if(a&&rr(i)){if(z(n)){const o=n[0],s=n[n.length-1];if(o<=0&&s>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Wd(i))return!0;if(!(V(t)&&t.bin)&&de([...Ri,...Gde],e)){const{orient:o,type:s}=r;return!(de(["bar","area","line","trail"],s)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function jve(e,t,n,r){const i=Uve(t,n,r),{type:a}=e;return To(t)?a!==void 0?Qpe(t,a)?V(n)&&!Kpe(a,n.type)?(U(Xhe(a,i)),i):a:(U(Vhe(t,a,i)),i):i:null}function Uve(e,t,n){switch(t.type){case"nominal":case"ordinal":{if(Fu(e)||VE(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&U(eS(e,"ordinal")),"ordinal";if(e in So){if(de(["rect","bar","image","rule"],n.type))return"band"}else if(n.type==="arc"&&e in YE)return"band";const r=n[Er(e)];return Pu(r)||_S(t)&&t.axis?.tickBand?"band":"point"}case"temporal":return Fu(e)?"time":VE(e)==="discrete"?(U(eS(e,"temporal")),"ordinal"):V(t)&&t.timeUnit&&vn(t.timeUnit).utc?"utc":"time";case"quantitative":return Fu(e)?V(t)&&Ge(t.bin)?"bin-ordinal":"linear":VE(e)==="discrete"?(U(eS(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(tP(t.type))}function Bve(e,{ignoreRange:t}={}){m8(e),t8(e);for(const n of Jpe)f8(e,n);t||h8(e)}function m8(e){dt(e)?e.component.scales=qve(e):e.component.scales=Wve(e)}function qve(e){const{encoding:t,mark:n,markDef:r}=e;return w0.reduce((i,a)=>{const o=wt(t[a]);if(o&&n===kP&&a===Ln&&o.type===zu)return i;let s=o&&o.scale;if(o&&s!==null&&s!==!1){s??(s={});const l=jve(s,a,o,r);i[a]=new a8(e.scaleName(`${a}`,!0),{value:l,explicit:s.type===l})}return i},{})}const Hve=W6((e,t)=>gP(e)-gP(t));function Wve(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const a of e.children){m8(a);for(const o of j(a.component.scales))if((t=i.scale)[o]??(t[o]=F4(o,e)),i.scale[o]==="shared"){const s=r[o],l=a.component.scales[o].getWithExplicit("type");s?Npe(s.value,l.value)?r[o]=No(s,l,"type","scale",Hve):(i.scale[o]="independent",delete r[o]):r[o]=l}}for(const a of j(r)){const o=e.scaleName(a,!0),s=r[a];n[a]=new a8(o,s);for(const l of e.children){const u=l.component.scales[a];u&&(l.renameScale(u.get("name"),o),u.merged=!0)}}return n}class $T{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function dt(e){return e?.type==="unit"}function Xr(e){return e?.type==="facet"}function OT(e){return e?.type==="concat"}function Ku(e){return e?.type==="layer"}class MT{constructor(e,t,n,r,i,a,o){this.type=t,this.parent=n,this.config=i,this.correctDataNames=s=>(s.from&&s.from.data&&(s.from.data=this.lookupDataSource(s.from.data)),s.from&&s.from.facet&&s.from.facet.data&&(s.from.facet.data=this.lookupDataSource(s.from.facet.data)),s),this.parent=n,this.config=i,this.view=zn(o),this.name=e.name??r,this.title=_o(e.title)?{text:e.title}:e.title?zn(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new $T(),this.projectionNameMap=n?n.projectionNameMap:new $T(),this.signalNameMap=n?n.signalNameMap:new $T(),this.data=e.data,this.description=e.description,this.transforms=n0e(e.transform??[]),this.layout=t==="layer"||t==="unit"?{}:fge(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:N0(e)||n&&n.component.data.isFaceted&&e.data===void 0},layoutSize:new Do(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...a?fe(a):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Bve(this)}parseProjection(){V4(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){q4(this)}assembleGroupStyle(){return this.type==="unit"||this.type==="layer"?this.view?.style??"cell":void 0}assembleEncodeFromView(e){const{style:t,...n}=e,r={};for(const i of j(n)){const a=n[i];a!==void 0&&(r[i]=Ke(a))}return r}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(t.description=Ke(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...t??{}}:Pe(t)?void 0:t}assembleLayout(){if(!this.layout)return;const{spacing:e,...t}=this.layout,{component:n,config:r}=this,i=hye(n.layoutHeaders,r);return{padding:e,...this.assembleDefaultLayout(),...t,...i?{titleBand:i}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of kr)e[n].title&&t.push(sye(this,n));for(const n of dT)t=t.concat(lye(this,n));return t}assembleAxes(){return X0e(this.component.axes,this.config)}assembleLegends(){return W4(this)}assembleProjections(){return Iye(this)}assembleTitle(){const{encoding:e,...t}=this.title??{},n={...Lz(this.config.title).nonMark,...t,...e?{encode:{update:e}}:{}};return n.text?(de(["unit","layer"],this.type)?de(["middle",void 0],n.anchor)&&(n.frame??(n.frame="group")):n.anchor??(n.anchor="start"),Pe(n)?void 0:n):void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Xr(this.parent)?r8(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return Je((this.name?`${this.name}_`:"")+e)}getDataName(e){return this.getName(Ye[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(Xr(this.parent)){const t=N4(e),n=b0(t),r=this.component.scales[n];if(r&&!r.merged){const i=r.get("type"),a=r.get("range");if(en(i)&&Co(a)){const o=r.get("name"),s=uy(this,n),l=CT(s);if(l){const u=Y({aggregate:"distinct",field:l},{expr:"datum"});return{signal:D4(o,r,u)}}else return U(QE(n)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):$z(e)&&To(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(mhe(t));return n}hasAxisOrientSignalRef(){return this.component.axes.x?.some(e=>e.hasOrientSignalRef())||this.component.axes.y?.some(e=>e.hasOrientSignalRef())}}class g8 extends MT{vgField(e,t={}){const n=this.fieldDef(e);return n?Y(n,t):void 0}reduceFieldDef(e,t){return jme(this.getMapping(),(n,r,i)=>{const a=ji(r);return a?e(n,a,i):n},t)}forEachFieldDef(e,t){DS(this.getMapping(),(n,r)=>{const i=ji(n);i&&e(i,r)},t)}}class DT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const n=this.transform.as??[void 0,void 0];this.transform.as=[n[0]??"value",n[1]??"density"]}clone(){return new DT(null,fe(this.transform))}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${be(this.transform)}`}assemble(){const{density:e,...t}=this.transform,n={type:"kde",field:e,...t};return n}}class cy extends je{constructor(e,t){super(e);this.filter=t}clone(){return new cy(null,{...this.filter})}static make(e,t){const{config:n,mark:r,markDef:i}=t,a=Ne("invalid",i,n);if(a!=="filter")return null;const o=t.reduceFieldDef((s,l,u)=>{const c=To(u)&&t.getScaleComponent(u);if(c){const f=c.get("type");rr(f)&&l.aggregate!=="count"&&!$o(r)&&(s[l.field]=l)}return s},{});return j(o).length?new cy(e,o):null}dependentFields(){return new Set(j(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${be(this.filter)}`}assemble(){const e=j(this.filter).reduce((t,n)=>{const r=this.filter[n],i=Y(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?t.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`):r.type==="quantitative"&&(t.push(`isValid(${i})`),t.push(`isFinite(+${i})`))),t},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class NT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map((i,a)=>r[a]??i)}clone(){return new NT(this.parent,fe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${be(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class RT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const n=this.transform.as??[void 0,void 0];this.transform.as=[n[0]??"key",n[1]??"value"]}clone(){return new RT(null,fe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${be(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class lh extends je{constructor(e,t,n,r){super(e);this.fields=t,this.geojson=n,this.signal=r}clone(){return new lh(null,fe(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[Mi,Oi],[xr,Wr]]){const i=r.map(a=>{const o=wt(t.encoding[a]);return V(o)?o.field:Mo(o)?{expr:`${o.datum}`}:Yr(o)?{expr:`${o.value}`}:void 0});(i[0]||i[1])&&(e=new lh(e,i,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(Ln)){const r=t.typedFieldDef(Ln);r.type===zu&&(e=new lh(e,null,r.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){const e=(this.fields??[]).filter(X);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${be(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class fy extends je{constructor(e,t,n,r){super(e);this.projection=t,this.fields=n,this.as=r}clone(){return new fy(null,this.projection,fe(this.fields),fe(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[Mi,Oi],[xr,Wr]]){const r=n.map(a=>{const o=wt(t.encoding[a]);return V(o)?o.field:Mo(o)?{expr:`${o.datum}`}:Yr(o)?{expr:`${o.value}`}:void 0}),i=n[0]===xr?"2":"";(r[0]||r[1])&&(e=new fy(e,t.projectionName(),r,[t.getName(`x${i}`),t.getName(`y${i}`)]))}return e}dependentFields(){return new Set(this.fields.filter(X))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${be(this.fields)} ${be(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Qu extends je{constructor(e,t){super(e);this.transform=t}clone(){return new Qu(null,fe(this.transform))}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e,i=[t,n,...r?[r]:[]].join(",");return{signal:`sequence(${i})`}}static makeFromTransform(e,t){return new Qu(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(V(r)&&V(i)){const a=r.impute?r:i.impute?i:void 0;if(a===void 0)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=r6(t.mark,n);return new Qu(e,{impute:a.field,key:o.field,...s?{method:s}:{},...l!==void 0?{value:l}:{},...u?{frame:u}:{},...c!==void 0?{keyvals:c}:{},...f.length?{groupby:f}:{}})}return null}hash(){return`Impute ${be(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s={type:"impute",field:e,key:t,...n?{keyvals:zge(n)?this.processSequence(n):n}:{},method:"value",...i?{groupby:i}:{},value:!r||r==="value"?a:null};if(r&&r!=="value"){const l={type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1,...i?{groupby:i}:{}},u={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,l,u]}else return[s]}}class FT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const n=this.transform.as??[void 0,void 0];this.transform.as=[n[0]??t.on,n[1]??t.loess]}clone(){return new FT(null,fe(this.transform))}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${be(this.transform)}`}assemble(){const{loess:e,on:t,...n}=this.transform,r={type:"loess",x:t,y:e,...n};return r}}class dy extends je{constructor(e,t,n){super(e);this.transform=t,this.secondary=n}clone(){return new dy(null,fe(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(Pge(a)){let s=w8(a.data,i);s||(s=new tl(a.data),i.push(s));const l=t.getName(`lookup_${r}`);o=new wn(s,l,Ye.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[l]=o}else if(jge(a)){const s=a.param;n={as:s,...n};let l;try{l=t.getSelectionComponent(Je(s),s)}catch(u){throw new Error(vhe(s))}if(o=l.materialized,!o)throw new Error(bhe(s))}return new dy(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?J(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${be({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e={values:this.transform.from.fields,...this.transform.as?{as:J(this.transform.as)}:{}};else{let t=this.transform.as;X(t)||(U(_he),t="_lookup"),e={as:[t]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...e,...this.transform.default?{default:this.transform.default}:{}}}}class IT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const n=this.transform.as??[void 0,void 0];this.transform.as=[n[0]??"prob",n[1]??"value"]}clone(){return new IT(null,fe(this.transform))}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${be(this.transform)}`}assemble(){const{quantile:e,...t}=this.transform,n={type:"quantile",field:e,...t};return n}}class LT extends je{constructor(e,t){super(e);this.transform=t,this.transform=fe(t);const n=this.transform.as??[void 0,void 0];this.transform.as=[n[0]??t.on,n[1]??t.regression]}clone(){return new LT(null,fe(this.transform))}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${be(this.transform)}`}assemble(){const{regression:e,on:t,...n}=this.transform,r={type:"regression",x:t,y:e,...n};return r}}class zT extends je{constructor(e,t){super(e);this.transform=t}clone(){return new zT(null,fe(this.transform))}addDimensions(e){this.transform.groupby=_i((this.transform.groupby??[]).concat(e),t=>t)}producedFields(){return}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${be(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return{type:"pivot",field:e,value:t,...r!==void 0?{limit:r}:{},...i!==void 0?{op:i}:{},...n!==void 0?{groupby:n}:{}}}}class PT extends je{constructor(e,t){super(e);this.transform=t}clone(){return new PT(null,fe(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${be(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function y8(e){let t=0;function n(r,i){if(r instanceof tl&&(!r.isGenerator&&!Qd(r.data))){e.push(i);const a={name:null,source:i.name,transform:[]};i=a}if(r instanceof xn&&(r.parent instanceof tl&&!i.source?(i.format={...i.format??{},parse:r.assembleFormatParse()},i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Xu){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source,e.push(...r.assemble());return}if((r instanceof oy||r instanceof sy||r instanceof cy||r instanceof rh||r instanceof ah||r instanceof fy||r instanceof Bi||r instanceof dy||r instanceof sh||r instanceof Ju||r instanceof RT||r instanceof NT||r instanceof DT||r instanceof FT||r instanceof IT||r instanceof LT||r instanceof el||r instanceof PT||r instanceof zT)&&i.transform.push(r.assemble()),(r instanceof Ca||r instanceof _a||r instanceof Qu||r instanceof Lo||r instanceof lh)&&i.transform.push(...r.assemble()),r instanceof wn){if(i.source&&i.transform.length===0)r.setSource(i.source);else if(r.parent instanceof wn)r.setSource(i.name);else if(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1){e.push(i);const a={name:null,source:i.name,transform:[]};i=a}}switch(r.numChildren()){case 0:r instanceof wn&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const o of r.children){const s={name:null,source:a,transform:[]};n(o,s)}break}}}return n}function Gve(e){const t=[],n=y8(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}function Yve(e,t){const n=[],r=y8(n);let i=0;for(const o of e.sources){o.hasName()||(o.dataName=`source_${i++}`);const s=o.assemble();r(o,s)}for(const o of n)o.transform.length===0&&delete o.transform;let a=0;for(const[o,s]of n.entries())(s.transform??[]).length===0&&!s.source&&n.splice(a++,0,n.splice(o,1)[0]);for(const o of n)for(const s of o.transform??[])s.type==="lookup"&&(s.from=e.outputNodes[s.from].getSource());for(const o of n)o.name in t&&(o.values=t[o.name]);return n}function Vve(e){return e==="top"||e==="left"||ie(e)?"header":"footer"}function Xve(e){for(const t of kr)Jve(e,t);b8(e,"x"),b8(e,"y")}function Jve(e,t){const{facet:n,config:r,child:i,component:a}=e;if(e.channelHasField(t)){const o=n[t],s=Vu("title",null,r,t);let l=Uu(o,r,{allowDisabling:!0,includeDefault:s===void 0||!!s});i.component.layoutHeaders[t].title&&(l=z(l)?l.join(", "):l,l+=` / ${i.component.layoutHeaders[t].title}`,i.component.layoutHeaders[t].title=null);const u=Vu("labelOrient",o.header,r,t),c=o.header!==null?ft(o.header?.labels,r.header.labels,!0):!1,f=de(["bottom","right"],u)?"footer":"header";a.layoutHeaders[t]={title:o.header!==null?l:null,facetFieldDef:o,[f]:t==="facet"?[]:[v8(e,t,c)]}}}function v8(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function b8(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:r,resolve:i}=e.component;if(i.axis[t]=gT(i,t),i.axis[t]==="shared"){const a=t==="x"?"column":"row",o=r[a];for(const s of n.component.axes[t]){const l=Vve(s.get("orient"));o[l]??(o[l]=[v8(e,a,!1)]);const u=ih(s,"main",e.config,{header:!0});u&&o[l][0].axes.push(u),s.mainExtracted=!0}}}}function Kve(e){jT(e),hy(e,"width"),hy(e,"height")}function Qve(e){jT(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";hy(e,t),hy(e,n)}function jT(e){for(const t of e.children)t.parseLayoutSize()}function hy(e,t){const n=N4(t),r=b0(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const l=s.component.layoutSize.getWithExplicit(n),u=i.scale[r]??F4(r,e);if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=No(o,l,n,"")}else o=l}if(o){for(const s of e.children)e.renameSignal(s.getName(n),e.getName(t)),s.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function Zve(e){const{size:t,component:n}=e;for(const r of Ri){const i=Er(r);if(t[i]){const a=t[i];n.layoutSize.set(i,Ui(a)?"step":a,!0)}else{const a=ebe(e,i);n.layoutSize.set(i,a,!1)}}}function ebe(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const a=i.get("type"),o=i.get("range");if(en(a)){const s=Kd(r.view,t);return Co(o)||Ui(s)?"step":s}else return HS(r.view,t)}else{if(e.hasProjection||e.mark==="arc")return HS(r.view,t);{const a=Kd(r.view,t);return Ui(a)?a.step:a}}}function UT(e,t,n){return Y(t,{suffix:`by_${Y(e)}`,...n??{}})}class py extends g8{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve);this.child=HT(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!Yd(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=j(e),n={};for(const r of t){if(![pa,ma].includes(r)){U(E0(r,"facet"));break}const i=e[r];if(i.field===void 0){U(ZE(i,r));break}n[r]=this.initFacetFieldDef(i,r)}return n}initFacetFieldDef(e,t){const n=OS(e,t);return n.header?n.header=zn(n.header):n.header===null&&(n.header=null),n}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=my(this),this.child.parseData()}parseLayoutSize(){jT(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),Xve(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){const e={};for(const t of kr)for(const n of hT){const r=this.component.layoutHeaders[t],i=r[n],{facetFieldDef:a}=r;if(a){const o=Vu("titleOrient",a.header,this.config,t);if(["right","bottom"].includes(o)){const s=ry(t,o);e.titleAnchor??(e.titleAnchor={}),e.titleAnchor[s]="end"}}if(i?.[0]){const o=t==="row"?"height":"width",s=n==="header"?"headerBand":"footerBand";t!=="facet"&&!this.child.component.layoutSize.get(o)&&(e[s]??(e[s]={}),e[s][t]=.5),r.title&&(e.offset??(e.offset={}),e.offset[t==="row"?"rowTitle":"columnTitle"]=10)}}return e}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(!t&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...n?{columns:n}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof py)return;{const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof py?{...this.channelHasField("column")?{encode:{update:{columns:{field:Y(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(e)}:super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof py){if(this.child.channelHasField("column")){const r=Y(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of Ri){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(en(a)&&Co(o)){const s=uy(this.child,r),l=CT(s);l?(e.push(l),t.push("distinct"),n.push(`distinct_${l}`)):U(QE(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of kr){const c=this.facet[u];if(c){s.push(Y(c));const{bin:f,sort:d}=c;if(Ge(f)&&s.push(Y(c,{binSuffix:"end"})),zi(d)){const{field:h,op:p=D0}=d,m=UT(c,d);n&&r?(i.push(m),a.push("max"),o.push(m)):(i.push(h),a.push(p),o.push(m))}else if(z(d)){const h=Yu(c,u);i.push(h),a.push("max"),o.push(h)}}}const l=!!n&&!!r;return{name:e,data:t,groupby:s,...l||i.length>0?{aggregate:{...l?{cross:l}:{},...i.length?{fields:i,ops:a,as:o}:{}}}:{}}}facetSortFields(e){const{facet:t}=this,n=t[e];return n?zi(n.sort)?[UT(n,n.sort,{expr:"datum"})]:z(n.sort)?[Yu(n,e,{expr:"datum"})]:[Y(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:r}=n,i=(zi(r)?r.order:!z(r)&&r)||"ascending";return[i]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return pT(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const r of dT)if(e[r]){const i=Vu("labelOrient",e[r]?.header,t,r);if(n[r].includes(i))return pT(e[r],r,t)}return}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=Gve(t),r=e.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o={name:this.getName("cell"),type:"group",...i?{title:i}:{},...a?{style:a}:{},from:{facet:this.assembleFacet()},sort:{field:kr.map(s=>this.facetSortFields(s)).flat(),order:kr.map(s=>this.facetSortOrder(s)).flat()},...n.length>0?{data:n}:{},...r?{encode:{update:r}}:{},...e.assembleGroup(p0e(this,[]))};return[o]}getMapping(){return this.facet}}function tbe(e,t){const{row:n,column:r}=t;if(n&&r){let i=null;for(const a of[n,r])if(zi(a.sort)){const{field:o,op:s=D0}=a.sort;e=i=new Ju(e,{joinaggregate:[{op:s,field:o,as:UT(a,a.sort,{forAs:!0})}],groupby:[Y(a)]})}return i}return null}function w8(e,t){for(const n of t){const r=n.data;if(e.name&&n.hasName()&&e.name!==n.dataName)continue;const i=e.format?.mesh,a=r.format?.feature;if(i&&a)continue;const o=e.format?.feature;if((o||a)&&o!==a)continue;const s=r.format?.mesh;if((i||s)&&i!==s)continue;if(J0(e)&&J0(r)){if(Ai(e.values,r.values))return n}else if(Qd(e)&&Qd(r)){if(e.url===r.url)return n}else if(G6(e)&&e.name===n.dataName)return n}return null}function nbe(e,t){if(e.data||!e.parent){if(e.data===null){const r=new tl({values:[]});return t.push(r),r}const n=w8(e.data,t);if(n)return Qs(e.data)||(n.data.format=vz({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new tl(e.data);return t.push(r),r}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function rbe(e,t,n){let r=0;for(const i of t.transforms){let a,o;if(Jge(i))o=e=new ah(e,i),a="derived";else if(XS(i)){const s=Xye(i);o=e=xn.makeWithAncestors(e,{},s,n)??e,e=new rh(e,t,i.filter)}else if(L6(i))o=e=Ca.makeFromTransform(e,i,t),a="number";else if(Qge(i)){a="date";const s=n.getWithExplicit(i.field);s.value===void 0&&(e=new xn(e,{[i.field]:a}),n.set(i.field,a,!1)),o=e=_a.makeFromTransform(e,i)}else if(Zge(i))o=e=Bi.makeFromTransform(e,i),a="number",sT(t)&&(e=new el(e));else if(I6(i))o=e=dy.make(e,t,i,r++),a="derived";else if(Yge(i))o=e=new sh(e,i),a="number";else if(Vge(i))o=e=new Ju(e,i),a="number";else if(e0e(i))o=e=Lo.makeFromTransform(e,i),a="derived";else if(t0e(i))o=e=new RT(e,i),a="derived";else if(Xge(i))o=e=new NT(e,i),a="derived";else if(Uge(i))o=e=new zT(e,i),a="derived";else if(Gge(i))e=new PT(e,i);else if(Kge(i))o=e=Qu.makeFromTransform(e,i),a="derived";else if(Bge(i))o=e=new DT(e,i),a="derived";else if(qge(i))o=e=new IT(e,i),a="derived";else if(Hge(i))o=e=new LT(e,i),a="derived";else if(Wge(i))o=e=new FT(e,i),a="derived";else{U(Ahe(i));continue}if(o&&a!==void 0)for(const s of o.producedFields()??[])n.set(s,a,!1)}return e}function my(e){let t=nbe(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:r}=e.component.data,i=e.parent?e.parent.component.data.ancestorParse.clone():new d0e(),a=e.data;Qs(a)?(Y6(a)?t=new sy(t,a.sequence):QS(a)&&(t=new oy(t,a.graticule)),i.parseNothing=!0):a?.format?.parse===null&&(i.parseNothing=!0),t=xn.makeExplicit(t,e,i)??t,t=new el(t);const o=e.parent&&Ku(e.parent);(dt(e)||Xr(e))&&(o&&(t=Ca.makeFromEncoding(t,e)??t)),e.transforms.length>0&&(t=rbe(t,e,i));const s=Kye(e),l=Jye(e);t=xn.makeWithAncestors(t,{},{...s,...l},i)??t,dt(e)&&(t=lh.parseAll(t,e),t=fy.parseAll(t,e)),(dt(e)||Xr(e))&&(o||(t=Ca.makeFromEncoding(t,e)??t),t=_a.makeFromEncoding(t,e)??t,t=ah.parseAllForSortIndex(t,e));const u=e.getDataName(Ye.Raw),c=new wn(t,u,Ye.Raw,r);if(n[u]=c,t=c,dt(e)){const p=Bi.makeFromEncoding(t,e);p&&(t=p,sT(e)&&(t=new el(t))),t=Qu.makeFromEncoding(t,e)??t,t=Lo.makeFromEncoding(t,e)??t}dt(e)&&(t=cy.make(t,e)??t);const f=e.getDataName(Ye.Main),d=new wn(t,f,Ye.Main,r);n[f]=d,t=d,dt(e)&&Y0e(e,d);let h=null;if(Xr(e)){const p=e.getName("facet");t=tbe(t,e.facet)??t,h=new Xu(t,e,p,d.getSource()),n[p]=h}return{...e.component.data,outputNodes:n,outputNodeRefCounts:r,raw:c,main:d,facetRoot:h,ancestorParse:i}}class ibe extends MT{constructor(e,t,n,r){super(e,"concat",t,n,r,e.resolve);(e.resolve?.axis?.x==="shared"||e.resolve?.axis?.y==="shared")&&U(Ehe),this.children=this.getChildren(e).map((i,a)=>HT(i,this,this.getName(`concat_${a}`),void 0,r))}parseData(){this.component.data=my(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of j(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return G0(e)?e.vconcat:qS(e)?e.hconcat:e.concat}parseLayoutSize(){Qve(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=mT(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return{type:"group",name:e.getName("group"),...t?{title:t}:{},...n?{style:n}:{},...r?{encode:{update:r}}:{},...e.assembleGroup()}})}assembleDefaultLayout(){const e=this.layout.columns;return{...e!=null?{columns:e}:{},bounds:"full",align:"each"}}}function abe(e){return e===!1||e===null}const obe={disable:1,gridScale:1,scale:1,...ZP,labelExpr:1,encode:1},x8=j(obe);class k8 extends Do{constructor(e={},t={},n=!1){super();this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new k8(fe(this.explicit),fe(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!abe(this.get(e))}hasOrientSignalRef(){return ie(this.explicit.orient)}}function sbe(e,t,n){const{encoding:r,config:i}=e,a=wt(r[t])??wt(r[wa(t)]),o=e.axis(t)||{},{format:s,formatType:l}=o;return Js(l)?{text:ES({fieldOrDatumDef:a,field:"datum.value",format:s,formatType:l,config:i}),...n}:n}function lbe(e){return Ri.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[mbe(n,e)]),t),{})}const ube={bottom:"top",top:"bottom",left:"right",right:"left"};function cbe(e){const{axes:t,resolve:n}=e.component,r={top:0,bottom:0,right:0,left:0};for(const i of e.children){i.parseAxesAndHeaders();for(const a of j(i.component.axes))n.axis[a]=gT(e.component.resolve,a),n.axis[a]==="shared"&&(t[a]=fbe(t[a],i.component.axes[a]),t[a]||(n.axis[a]="independent",delete t[a]))}for(const i of Ri){for(const a of e.children){if(!a.component.axes[i])continue;if(n.axis[i]==="independent"){t[i]=(t[i]??[]).concat(a.component.axes[i]);for(const o of a.component.axes[i]){const{value:s,explicit:l}=o.getWithExplicit("orient");if(ie(s))continue;if(r[s]>0&&!l){const u=ube[s];r[s]>r[u]&&o.set("orient",u,!1)}r[s]++}}delete a.component.axes[i]}if(n.axis[i]==="independent"&&t[i]&&t[i].length>1)for(const a of t[i])!!a.get("grid")&&!a.explicit.grid&&(a.implicit.grid=!1)}}function fbe(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],a=t[r];if(!!i!==!!a)return;if(i&&a){const o=i.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[r]=dbe(i,a)}}}else return t.map(n=>n.clone());return e}function dbe(e,t){for(const n of x8){const r=No(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,a)=>{switch(n){case"title":return Gz(i,a);case"gridScale":return{explicit:i.explicit,value:ft(i.value,a.value)}}return X0(i,a,n,"axis")});e.setWithExplicit(n,r)}return e}function hbe(e,t,n,r,i){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(ie(n.labelAngle)?n.labelAngle:zd(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===_4(r,i))return!0}return e===n[t]}const pbe=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function mbe(e,t){let n=t.axis(e);const r=new k8(),i=wt(t.encoding[e]),{mark:a,config:o}=t,s=n?.orient||o[e==="x"?"axisX":"axisY"]?.orient||o.axis?.orient||rye(e),l=t.getScaleComponent(e).get("type"),u=J0e(e,l,s,t.config),c=n!==void 0?!n:cT("disable",o.style,n?.style,u).configValue;if(r.set("disable",c,n!==void 0),c)return r;n=n||{};const f=eye(i,n,e,o.style,u),d={fieldOrDatumDef:i,axis:n,channel:e,model:t,scaleType:l,orient:s,labelAngle:f,mark:a,config:o};for(const m of x8){const g=m in S4?S4[m](d):e6(m)?n[m]:void 0,y=g!==void 0,v=hbe(g,m,n,t,e);if(y&&v)r.set(m,g,v);else{const{configValue:b=void 0,configFrom:w=void 0}=e6(m)&&m!=="values"?cT(m,o.style,n.style,u):{},x=b!==void 0;y&&!x?r.set(m,g,v):(!(w==="vgAxisConfig")||pbe.has(m)&&x||Xd(b)||ie(b))&&r.set(m,b,!1)}}const h=n.encoding??{},p=QP.reduce((m,g)=>{if(!r.hasAxisPart(g))return m;const y=R4(h[g]??{},t),v=g==="labels"?sbe(t,e,y):y;return v!==void 0&&!Pe(v)&&(m[g]={update:v}),m},{});return Pe(p)||r.set("encode",p,!!n.encoding||n.labelAngle!==void 0),r}function gbe({encoding:e,size:t}){for(const n of Ri){const r=Er(n);Ui(t[r])&&(Pi(e[n])&&(delete t[r],U(iP(r))))}return t}function ybe(e,t,n){const r=zn(e),i=Ne("orient",r,n);if(r.orient=xbe(r.type,t,i),i!==void 0&&i!==r.orient&&U(Uhe(r.orient,i)),r.type==="bar"&&r.orient){const s=Ne("cornerRadiusEnd",r,n);if(s!==void 0){const l=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:ume[r.orient];for(const u of l)r[u]=s;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const a=Ne("opacity",r,n);a===void 0&&(r.opacity=bbe(r.type,t));const o=Ne("cursor",r,n);return o===void 0&&(r.cursor=vbe(r,t,n)),r}function vbe(e,t,n){return t.href||e.href||Ne("href",e,n)?"pointer":e.cursor}function bbe(e,t){return de([C0,yS,vS,bS],e)&&!MS(t)?.7:void 0}function wbe(e,t,{graticule:n}){if(n)return!1;const r=Gs("filled",e,t),i=e.type;return ft(r,i!==C0&&i!==_0&&i!==$0)}function xbe(e,t,n){switch(e){case C0:case vS:case bS:case xP:case eme:case Zpe:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case A0:if(V(r)&&(yn(r.bin)||V(i)&&i.aggregate&&!r.aggregate))return"vertical";if(V(i)&&(yn(i.bin)||V(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(V(r)&&r.type===Vs&&!Ge(r.bin)||AS(r)))return"horizontal";if(!o&&(V(i)&&i.type===Vs&&!Ge(i.bin)||AS(i)))return"vertical"}case $0:if(a&&!(V(r)&&yn(r.bin))&&o&&!(V(i)&&yn(i.bin)))return;case T0:if(o)return V(i)&&yn(i.bin)?"horizontal":"vertical";if(a)return V(r)&&yn(r.bin)?"vertical":"horizontal";if(e===$0){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case _0:case yS:{const s=Pi(r),l=Pi(i);if(n)return n;if(s&&!l)return e!=="tick"?"horizontal":"vertical";if(!s&&l)return e!=="tick"?"vertical":"horizontal";if(s&&l){const u=r,c=i,f=u.type===Lu,d=c.type===Lu;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!u.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":u.aggregate&&!c.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const kbe={vgMark:"arc",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...tn("x",e,{defaultPos:"mid"}),...tn("y",e,{defaultPos:"mid"}),...Fo(e,"radius","arc"),...Fo(e,"theta","arc")})},Ebe={vgMark:"area",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...Q0("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...Q0("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...aT(e)})},Sbe={vgMark:"rect",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Fo(e,"x","bar"),...Fo(e,"y","bar")})},Tbe={vgMark:"shape",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,r={type:"geoshape",projection:e.projectionName(),...n&&V(n)&&n.type===zu?{field:Y(n,{expr:"datum"})}:{}};return[r]}},Abe={vgMark:"image",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Fo(e,"x","image"),...Fo(e,"y","image"),...rT(e,"url")})},_be={vgMark:"line",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...tn("x",e,{defaultPos:"mid"}),...tn("y",e,{defaultPos:"mid"}),...Mt("size",e,{vgChannel:"strokeWidth"}),...aT(e)})},Cbe={vgMark:"trail",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...tn("x",e,{defaultPos:"mid"}),...tn("y",e,{defaultPos:"mid"}),...Mt("size",e),...aT(e)})};function BT(e,t){const{config:n}=e;return{...Tr(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...tn("x",e,{defaultPos:"mid"}),...tn("y",e,{defaultPos:"mid"}),...Mt("size",e),...Mt("angle",e),...$be(e,n,t)}}function $be(e,t,n){return n?{shape:{value:n}}:Mt("shape",e)}const Obe={vgMark:"symbol",encodeEntry:e=>BT(e)},Mbe={vgMark:"symbol",encodeEntry:e=>BT(e,"circle")},Dbe={vgMark:"symbol",encodeEntry:e=>BT(e,"square")},Nbe={vgMark:"rect",encodeEntry:e=>({...Tr(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Fo(e,"x","rect"),...Fo(e,"y","rect")})},Rbe={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...Tr(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Q0("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...Q0("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...Mt("size",e,{vgChannel:"strokeWidth"})}}},Fbe={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...Tr(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...tn("x",e,{defaultPos:"mid"}),...tn("y",e,{defaultPos:"mid"}),...rT(e),...Mt("size",e,{vgChannel:"fontSize"}),...Mt("angle",e),...a4("align",Ibe(e.markDef,n,t)),...a4("baseline",Lbe(e.markDef,n,t)),...tn("radius",e,{defaultPos:null}),...tn("theta",e,{defaultPos:null})}}};function Ibe(e,t,n){const r=Ne("align",e,n);return r===void 0?"center":void 0}function Lbe(e,t,n){const r=Ne("baseline",e,n);return r===void 0?"middle":void 0}const zbe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",a=r==="horizontal"?"height":"width";return{...Tr(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...tn("x",e,{defaultPos:"mid",vgChannel:"xc"}),...tn("y",e,{defaultPos:"mid",vgChannel:"yc"}),...Mt("size",e,{defaultValue:Pbe(e),vgChannel:i}),[a]:Ke(Ne("thickness",n,t))}}};function Pbe(e){const{config:t,markDef:n}=e,{orient:r}=n,i=r==="horizontal"?"width":"height",a=e.getScaleComponent(r==="horizontal"?"x":"y"),o=Ne("size",n,t,{vgChannel:i})??t.tick.bandSize;if(o!==void 0)return o;{const s=a?a.get("range"):void 0;if(s&&Co(s)&&Le(s.step))return s.step*3/4;const l=Y0(t.view,i);return l*3/4}}const gy={arc:kbe,area:Ebe,bar:Sbe,circle:Mbe,geoshape:Tbe,image:Abe,line:_be,point:Obe,rect:Nbe,rule:Rbe,square:Dbe,text:Fbe,tick:zbe,trail:Cbe};function jbe(e){if(de([_0,T0,tme],e.mark)){const t=r6(e.mark,e.encoding);if(t.length>0)return Ube(e,t)}else if(e.mark===A0){const t=JE.some(n=>Ne(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return Bbe(e)}return qT(e)}const E8="faceted_path_";function Ube(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:E8+e.requestDataName(Ye.Main),data:e.requestDataName(Ye.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:qT(e,{fromPrefix:E8})}]}const S8="stack_group_";function Bbe(e){const[t]=qT(e,{fromPrefix:S8}),n=e.scaleName(e.stack.fieldChannel),r=(u={})=>e.vgField(e.stack.fieldChannel,u),i=(u,c)=>{const f=[r({prefix:"min",suffix:"start",expr:c}),r({prefix:"max",suffix:"start",expr:c}),r({prefix:"min",suffix:"end",expr:c}),r({prefix:"max",suffix:"end",expr:c})];return`${u}(${f.map(d=>`scale('${n}',${d})`).join(",")})`};let a,o;e.stack.fieldChannel==="x"?(a={...Du(t.encode.update,["y","yc","y2","height",...JE]),x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}},o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...tr(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(a={...Du(t.encode.update,["x","xc","x2","width"]),y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}},o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...tr(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const u of JE){const c=Gs(u,e.markDef,e.config);t.encode.update[u]?(a[u]=t.encode.update[u],delete t.encode.update[u]):c&&(a[u]=Ke(c)),c&&(t.encode.update[u]={value:0})}const s=[];if(e.stack.groupbyChannel){const u=e.fieldDef(e.stack.groupbyChannel),c=Y(u);c&&s.push(c),(u?.bin||u?.timeUnit)&&s.push(Y(u,{binSuffix:"end"}))}const l=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return a=l.reduce((u,c)=>{if(t.encode.update[c])return{...u,[c]:t.encode.update[c]};{const f=Gs(c,e.markDef,e.config);return f!==void 0?{...u,[c]:Ke(f)}:u}},a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Ye.Main),name:S8+e.requestDataName(Ye.Main),groupby:s,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function qbe(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!z(o)&&Yr(o)&&LE(o.value)||!o&&LE(Ne("order",i,a)))return;if((z(o)||V(o))&&!n)return qz(o,{expr:"datum"});if($o(r)){const s=i.orient==="horizontal"?"y":"x",l=t[s];if(V(l)){const u=l.sort;if(z(u))return{field:Y(l,{prefix:s,suffix:"sort_index",expr:"datum"})};if(zi(u))return{field:Y({aggregate:MS(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(zP(u)){const c=e.fieldDef(u.encoding);return{field:Y(c,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:Y(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function qT(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=ft(r.clip,Hbe(e),Wbe(e)),s=Uz(r),l=i.key,u=qbe(e),c=Gbe(e),f=Ne("aria",r,a),d=gy[n].postEncodingTransform?gy[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:gy[n].vgMark,...o?{clip:!0}:{},...s?{style:s}:{},...l?{key:l.field}:{},...u?{sort:u}:{},...c||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(Ye.Main)},encode:{update:gy[n].encodeEntry(e)},...d?{transform:d}:{}}]}function Hbe(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function Wbe(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Gbe(e){if(!e.component.selection)return null;const t=j(e.component.selection).length;let n=t,r=e.parent;for(;r&&n===0;)n=j(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class T8 extends g8{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,w6(e)?e.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=Li(e.mark)?{...e.mark}:{type:e.mark},o=a.type;a.filled===void 0&&(a.filled=wbe(a,i,{graticule:e.data&&QS(e.data)}));const s=this.encoding=zme(e.encoding||{},o,a.filled,i);this.markDef=ybe(a,s,i),this.size=gbe({encoding:s,size:w6(e)?{...r,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}}:r}),this.stack=C6(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=(e.params??[]).filter(l=>US(l))}get hasProjection(){const{encoding:e}=this,t=this.mark===kP,n=e&&zde.some(r=>ae(e[r]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return w0.reduce((n,r)=>{const i=wt(t[r]);return i&&(n[r]=this.initScale(i.scale??{})),n},{})}initScale(e){const{domain:t,range:n}=e,r=zn(e);return z(t)&&(r.domain=t.map(nr)),z(n)&&(r.range=n.map(nr)),r}initAxes(e){return Ri.reduce((t,n)=>{const r=e[n];if(ae(r)||n===et&&ae(e.x2)||n===vt&&ae(e.y2)){const i=ae(r)?r.axis:void 0;t[n]=i&&this.initAxis({...i})}return t},{})}initAxis(e){const t=j(e),n={};for(const r of t){const i=e[r];n[r]=Xd(i)?zz(i):nr(i)}return n}initLegends(e){return Yde.reduce((t,n)=>{const r=wt(e[n]);if(r&&Xde(n)){const i=r.legend;t[n]=i&&zn(i)}return t},{})}parseData(){this.component.data=my(this)}parseLayoutSize(){Zve(this)}parseSelections(){this.component.selection=G0e(this,this.selection)}parseMarkGroup(){this.component.mark=jbe(this)}parseAxesAndHeaders(){this.component.axes=lbe(this)}assembleSelectionTopLevelSignals(e){return m0e(this,e)}assembleSignals(){return[...k4(this),...h0e(this,[])]}assembleSelectionData(e){return g0e(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return mT(this)}assembleMarks(){let e=this.component.mark??[];return(!this.parent||!Ku(this.parent))&&(e=X6(this,e)),e.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return Ks(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return ji(t)}typedFieldDef(e){const t=this.fieldDef(e);return Sr(t)?t:null}}class A8 extends MT{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a={...r,...e.width?{width:e.width}:{},...e.height?{height:e.height}:{}};this.children=e.layer.map((o,s)=>{if(V0(o))return new A8(o,this,this.getName(`layer_${s}`),a,i);if(Sa(o))return new T8(o,this,this.getName(`layer_${s}`),a,i);throw new Error(KE(o))})}parseData(){this.component.data=my(this);for(const e of this.children)e.parseData()}parseLayoutSize(){Kve(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of j(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){cbe(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),k4(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),mT(this))}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e;return}assembleLayout(){return null}assembleMarks(){return y0e(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),W4(this))}}function HT(e,t,n,r,i){if(N0(e))return new py(e,t,n,i);if(V0(e))return new A8(e,t,n,r,i);if(Sa(e))return new T8(e,t,n,r,i);if(lge(e))return new ibe(e,t,n,i);throw new Error(KE(e))}function Ybe(e,t={}){t.logger&&dpe(t.logger),t.fieldTitle&&VP(t.fieldTitle);try{const n=A6(bl(t.config,e.config)),r=B6(e,n),i=HT(r,null,"",void 0,n);i.parse(),hve(i.component.data,i);const a=Xbe(i,Vbe(e,r.autosize,n,i),e.datasets,e.usermeta);return{spec:a,normalized:r}}finally{t.logger&&hpe(),t.fieldTitle&&$me()}}function Vbe(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):X(t)&&(t={type:t}),i&&a&&u0e(t.type)){if(i==="step"&&a==="step")U(Xz()),t.type="pad";else if(i==="step"||a==="step"){const o=i==="step"?"width":"height";U(Xz(b0(o)));const s=o==="width"?"height":"width";t.type=c0e(s)}}return{...j(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...H6(n,!1),...H6(e,!0)}}function Xbe(e,t,n={},r){const i=e.config?kge(e.config):void 0,a=[].concat(e.assembleSelectionData([]),Yve(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(t[h.name]=+h.value,!1):!0);const{params:f,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...s?{title:s}:{},...l?{style:l}:{},...u?{encode:{update:u}}:{},data:a,...o.length>0?{projections:o}:{},...e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...b6(f)]),...i?{config:i}:{},...r?{usermeta:r}:{}}}const Jbe=Cde.version;var Kbe=Object.freeze({__proto__:null,version:Jbe,compile:Ybe,normalize:B6,deepEqual:Ai,duplicate:fe,pick:Du,omit:tr,stringify:We,hash:be,isNullOrFalse:LE,contains:de,some:Nu,every:zE,mergeDeep:vz,unique:_i,isEqual:Dde,setEqual:bz,hasIntersection:PE,prefixGenerator:jE,fieldIntersection:UE,isEmpty:Pe,keys:j,vals:gn,entries:vo,isBoolean:Fd,varName:Je,logicalExpr:Id,deleteNestedProperty:d0,titleCase:Ld,accessPathWithDatum:BE,flatAccessWithDatum:wz,replacePathInField:wr,replaceAll:Us,removePathFromField:qE,accessPathDepth:Ru,getFirstDefined:ft,uniqueId:kz,resetIdCounter:Rde,internalField:Ez,isInternalField:Sz,normalizeAngle:zd,isNumeric:h0});function _8(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Qbe="vega-themes",Zbe="2.10.0",e1e="Themes for stylized Vega and Vega-Lite visualizations.",t1e=["vega","vega-lite","themes","style"],n1e="BSD-3-Clause",r1e={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},i1e=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],a1e="build/vega-themes.js",o1e="build/vega-themes.module.js",s1e="build/vega-themes.min.js",l1e="build/vega-themes.min.js",u1e="build/vega-themes.module.d.ts",c1e={type:"git",url:"https://github.com/vega/vega-themes.git"},f1e=["src","build"],d1e={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"},h1e={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"},p1e={vega:"*","vega-lite":"*"},m1e={name:Qbe,version:Zbe,description:e1e,keywords:t1e,license:n1e,author:r1e,contributors:i1e,main:a1e,module:o1e,unpkg:s1e,jsdelivr:l1e,types:u1e,repository:c1e,files:f1e,scripts:d1e,devDependencies:h1e,peerDependencies:p1e};const Zu="#fff",g1e="#888",y1e={background:"#333",title:{color:Zu,subtitleColor:Zu},style:{"guide-label":{fill:Zu},"guide-title":{fill:Zu}},axis:{domainColor:Zu,gridColor:g1e,tickColor:Zu}},rl="#4572a7",v1e={background:"#fff",arc:{fill:rl},area:{fill:rl},line:{stroke:rl,strokeWidth:2},path:{stroke:rl},rect:{fill:rl},shape:{stroke:rl},symbol:{fill:rl,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},il="#30a2da",WT="#cbcbcb",b1e="#999",w1e="#333",C8="#f0f0f0",$8="#333",x1e={arc:{fill:il},area:{fill:il},axis:{domainColor:WT,grid:!0,gridColor:WT,gridWidth:1,labelColor:b1e,labelFontSize:10,titleColor:w1e,tickColor:WT,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:C8,group:{fill:C8},legend:{labelColor:$8,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:$8,titleFontSize:14,titlePadding:10},line:{stroke:il,strokeWidth:2},path:{stroke:il,strokeWidth:.5},rect:{fill:il},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:il},bar:{binSpacing:2,fill:il,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},al="#000",k1e={group:{fill:"#e5e5e5"},arc:{fill:al},area:{fill:al},line:{stroke:al},path:{stroke:al},rect:{fill:al},shape:{stroke:al},symbol:{fill:al,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},E1e=22,S1e="normal",O8="Benton Gothic, sans-serif",M8=11.5,T1e="normal",ol="#82c6df",GT="Benton Gothic Bold, sans-serif",D8="normal",N8=13,uh={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},A1e={background:"#ffffff",title:{anchor:"start",color:"#000000",font:GT,fontSize:E1e,fontWeight:S1e},arc:{fill:ol},area:{fill:ol},line:{stroke:ol,strokeWidth:2},path:{stroke:ol},rect:{fill:ol},shape:{stroke:ol},symbol:{fill:ol,size:30},axis:{labelFont:O8,labelFontSize:M8,labelFontWeight:T1e,titleFont:GT,titleFontSize:N8,titleFontWeight:D8},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:O8,labelFontSize:M8,symbolType:"square",titleFont:GT,titleFontSize:N8,titleFontWeight:D8},range:{category:uh["category-6"],diverging:uh["fireandice-6"],heatmap:uh["fire-7"],ordinal:uh["fire-7"],ramp:uh["fire-7"]}},sl="#ab5787",yy="#979797",_1e={background:"#f9f9f9",arc:{fill:sl},area:{fill:sl},line:{stroke:sl},path:{stroke:sl},rect:{fill:sl},shape:{stroke:sl},symbol:{fill:sl,size:30},axis:{domainColor:yy,domainWidth:.5,gridWidth:.2,labelColor:yy,tickColor:yy,tickWidth:.2,titleColor:yy},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},ll="#3e5c69",C1e={background:"#fff",arc:{fill:ll},area:{fill:ll},line:{stroke:ll},path:{stroke:ll},rect:{fill:ll},shape:{stroke:ll},symbol:{fill:ll},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Ar="#1696d2",R8="#000000",$1e="#FFFFFF",vy="Lato",YT="Lato",O1e="Lato",M1e="#DEDDDD",D1e=18,ch={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},N1e={background:$1e,title:{anchor:"start",fontSize:D1e,font:vy},axisX:{domain:!0,domainColor:R8,domainWidth:1,grid:!1,labelFontSize:12,labelFont:YT,labelAngle:0,tickColor:R8,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:vy},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:M1e,gridWidth:1,labelFontSize:12,labelFont:YT,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:vy,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:YT,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:vy,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:ch["six-groups-cat-1"],diverging:ch["diverging-colors"],heatmap:ch["diverging-colors"],ordinal:ch["six-groups-seq"],ramp:ch["shades-blue"]},area:{fill:Ar},rect:{fill:Ar},line:{color:Ar,stroke:Ar,strokeWidth:5},trail:{color:Ar,stroke:Ar,strokeWidth:0,size:1},path:{stroke:Ar,strokeWidth:.5},point:{filled:!0},text:{font:O1e,color:Ar,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Ar,stroke:null}},arc:{fill:Ar},shape:{stroke:Ar},symbol:{fill:Ar,size:30}},ul="#3366CC",F8="#ccc",by="Arial, sans-serif",R1e={arc:{fill:ul},area:{fill:ul},path:{stroke:ul},rect:{fill:ul},shape:{stroke:ul},symbol:{stroke:ul},circle:{fill:ul},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:by,fontSize:12},"guide-title":{font:by,fontSize:12},"group-title":{font:by,fontSize:12}},title:{font:by,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:F8,tickColor:F8,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},F1e=m1e.version;var I1e=Object.freeze({__proto__:null,dark:y1e,excel:v1e,fivethirtyeight:x1e,ggplot2:k1e,googlecharts:R1e,latimes:A1e,quartz:_1e,urbaninstitute:N1e,version:F1e,vox:C1e}),L1e=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const I8="vg-tooltip-element",z1e={offsetX:10,offsetY:10,id:I8,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:P1e,maxDepth:2};function P1e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function j1e(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return L1e.toString().replace(I8,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function U1e(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function B1e(e,t,n){if(z(e))return`[${e.map(r=>t(X(r)?r:L8(r,n))).join(", ")}]`;if(Q(e)){let r="";const i=e,{title:a,image:o}=i,s=U1e(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const u of l){let c=s[u];if(c===void 0)continue;Q(c)&&(c=L8(c,n)),r+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`}r+="</table>"}return r||"{}"}return t(e)}function q1e(e){const t=[];return function(n,r){if(typeof r!="object"||r===null)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}function L8(e,t){return JSON.stringify(e,q1e(t))}function H1e(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}class W1e{constructor(e){this.options=Object.assign(Object.assign({},z1e),e);const t=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=j1e(t);const r=document.head;r.childNodes.length>0?r.insertBefore(n,r.childNodes[0]):r.appendChild(n)}}tooltipHandler(e,t,n,r){this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el));const i=document.fullscreenElement!=null?document.fullscreenElement:document.body;if(i.appendChild(this.el),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=B1e(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:a,y:o}=H1e(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${o}px; left: ${a}px`)}}function G1e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z8(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(u){n(u);return}s.done?t(l):Promise.resolve(l).then(r,i)}function wy(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(l){z8(a,r,i,o,s,"next",l)}function s(l){z8(a,r,i,o,s,"throw",l)}o(void 0)})}}var P8=Object.prototype,cl=P8.hasOwnProperty,qi,VT=typeof Symbol=="function"?Symbol:{},xy=VT.iterator||"@@iterator",Y1e=VT.asyncIterator||"@@asyncIterator",ky=VT.toStringTag||"@@toStringTag";function j8(e,t,n,r){var i=t&&t.prototype instanceof JT?t:JT,a=Object.create(i.prototype),o=new eA(r||[]);return a._invoke=Q1e(e,n,o),a}function XT(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}var U8="suspendedStart",V1e="suspendedYield",B8="executing",Ey="completed",Jr={};function JT(){}function Sy(){}function ec(){}var KT={};KT[xy]=function(){return this};var QT=Object.getPrototypeOf,Ty=QT&&QT(QT(tA([])));Ty&&Ty!==P8&&cl.call(Ty,xy)&&(KT=Ty);var tc=ec.prototype=JT.prototype=Object.create(KT);Sy.prototype=tc.constructor=ec,ec.constructor=Sy,ec[ky]=Sy.displayName="GeneratorFunction";function q8(e){["next","throw","return"].forEach(function(t){e[t]=function(n){return this._invoke(t,n)}})}function H8(e){var t=typeof e=="function"&&e.constructor;return t?t===Sy||(t.displayName||t.name)==="GeneratorFunction":!1}function X1e(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,ec):(e.__proto__=ec,ky in e||(e[ky]="GeneratorFunction")),e.prototype=Object.create(tc),e}function J1e(e){return{__await:e}}function Ay(e,t){function n(a,o,s,l){var u=XT(e[a],e,o);if(u.type==="throw")l(u.arg);else{var c=u.arg,f=c.value;return f&&typeof f=="object"&&cl.call(f,"__await")?t.resolve(f.__await).then(function(d){n("next",d,s,l)},function(d){n("throw",d,s,l)}):t.resolve(f).then(function(d){c.value=d,s(c)},function(d){return n("throw",d,s,l)})}}var r;function i(a,o){function s(){return new t(function(l,u){n(a,o,l,u)})}return r=r?r.then(s,s):s()}this._invoke=i}q8(Ay.prototype),Ay.prototype[Y1e]=function(){return this};function K1e(e,t,n,r,i){i===void 0&&(i=Promise);var a=new Ay(j8(e,t,n,r),i);return H8(t)?a:a.next().then(function(o){return o.done?o.value:a.next()})}function Q1e(e,t,n){var r=U8;return function(a,o){if(r===B8)throw new Error("Generator is already running");if(r===Ey){if(a==="throw")throw o;return G8()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var l=W8(s,n);if(l){if(l===Jr)continue;return l}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(r===U8)throw r=Ey,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);r=B8;var u=XT(e,t,n);if(u.type==="normal"){if(r=n.done?Ey:V1e,u.arg===Jr)continue;return{value:u.arg,done:n.done}}else u.type==="throw"&&(r=Ey,n.method="throw",n.arg=u.arg)}}}function W8(e,t){var n=e.iterator[t.method];if(n===qi){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=qi,W8(e,t),t.method==="throw"))return Jr;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return Jr}var r=XT(n,e.iterator,t.arg);if(r.type==="throw")return t.method="throw",t.arg=r.arg,t.delegate=null,Jr;var i=r.arg;if(!i)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,Jr;if(i.done)t[e.resultName]=i.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=qi);else return i;return t.delegate=null,Jr}q8(tc),tc[ky]="Generator",tc[xy]=function(){return this},tc.toString=function(){return"[object Generator]"};function Z1e(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function ZT(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function eA(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Z1e,this),this.reset(!0)}function ewe(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var i=t.pop();if(i in e)return r.value=i,r.done=!1,r}return r.done=!0,r}}function tA(e){if(e){var t=e[xy];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var n=-1,r=function i(){for(;++n<e.length;)if(cl.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=qi,i.done=!0,i};return r.next=r}}return{next:G8}}function G8(){return{value:qi,done:!0}}eA.prototype={constructor:eA,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=qi,this.done=!1,this.delegate=null,this.method="next",this.arg=qi,this.tryEntries.forEach(ZT),!t)for(var n in this)n.charAt(0)==="t"&&cl.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=qi)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(u,c){return o.type="throw",o.arg=t,n.next=u,c&&(n.method="next",n.arg=qi),!!c}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if(a.tryLoc==="root")return r("end");if(a.tryLoc<=this.prev){var s=cl.call(a,"catchLoc"),l=cl.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else if(l){if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&cl.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&(t==="break"||t==="continue")&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=n,a?(this.method="next",this.next=a.finallyLoc,Jr):this.complete(o)},complete:function(t,n){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&n&&(this.next=n),Jr},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),ZT(r),Jr}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var i=r.completion;if(i.type==="throw"){var a=i.arg;ZT(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:tA(t),resultName:n,nextLoc:r},this.method==="next"&&(this.arg=qi),Jr}};var Po={wrap:j8,isGeneratorFunction:H8,AsyncIterator:Ay,mark:X1e,awrap:J1e,async:K1e,keys:ewe,values:tA};function twe(e,t,n){var r=e.open(t),i=1e4,a=250,o=new URL(t),s=o.origin,l=~~(i/a);function u(f){f.source===r&&(l=0,e.removeEventListener("message",u,!1))}e.addEventListener("message",u,!1);function c(){if(l<=0)return;r.postMessage(n,s),setTimeout(c,a),l-=1}setTimeout(c,a)}var nwe=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper.fit-x {
    width: 100%; }
  .vega-embed .chart-wrapper.fit-y {
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function Y8(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];rwe(e,o)}return e}function rwe(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];uc(e,i,t[i],!0)}}var nA;function V8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function jo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V8(Object(n),!0).forEach(function(r){G1e(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V8(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Uo=ade,fh=Kbe,_y=typeof window!="undefined"?window:void 0;fh===void 0&&_y!==null&&_y!==void 0&&(nA=_y.vl)!==null&&nA!==void 0&&nA.compile&&(fh=_y.vl);var iwe={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},awe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},dh={vega:"Vega","vega-lite":"Vega-Lite"},Cy={vega:Uo.version,"vega-lite":fh?fh.version:"not available"},owe={vega:e=>e,"vega-lite":(e,t)=>fh.compile(e,{config:t}).spec},swe=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,lwe="chart-wrapper";function uwe(e){return typeof e=="function"}function X8(e,t,n,r){var i="<html><head>".concat(t,'</head><body><pre><code class="json">'),a="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(i+e+a),o.document.title="".concat(dh[r]," JSON Source")}function cwe(e,t){if(e.$schema){var n=_8(e.$schema);if(t&&t!==n.library){var r;console.warn("The given visualization spec is written in ".concat(dh[n.library],", but mode argument sets ").concat((r=dh[t])!==null&&r!==void 0?r:t,"."))}var i=n.library;return IA.satisfies(Cy[i],"^".concat(n.version.slice(1)))||console.warn("The input spec uses ".concat(dh[i]," ").concat(n.version,", but the current version of ").concat(dh[i]," is v").concat(Cy[i],".")),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function fwe(e){return!!(e&&"load"in e)}function J8(e){return fwe(e)?e:Uo.loader(e)}function K8(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function dwe(e,t){return rA.apply(this,arguments)}function rA(){return rA=wy(Po.mark(function e(t,n){var r,i,a,o,s,l,u,c,f,d,h=arguments;return Po.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(a=h.length>2&&h[2]!==void 0?h[2]:{},!X(n)){m.next=10;break}return s=J8(a.loader),m.t0=JSON,m.next=6,s.load(n);case 6:m.t1=m.sent,o=m.t0.parse.call(m.t0,m.t1),m.next=11;break;case 10:o=n;case 11:return l=K8(o).loader,(!s||l)&&(s=J8((u=a.loader)!==null&&u!==void 0?u:l)),m.next=15,Q8(K8(o),s);case 15:return c=m.sent,m.next=18,Q8(a,s);case 18:return f=m.sent,d=jo(jo({},Y8(f,c)),{},{config:bl((r=f.config)!==null&&r!==void 0?r:{},(i=c.config)!==null&&i!==void 0?i:{})}),m.next=22,pwe(t,o,d,s);case 22:return m.abrupt("return",m.sent);case 23:case"end":return m.stop()}},e)})),rA.apply(this,arguments)}function Q8(e,t){return iA.apply(this,arguments)}function iA(){return iA=wy(Po.mark(function e(t,n){var r,i,a;return Po.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!X(t.config)){s.next=8;break}return s.t1=JSON,s.next=4,n.load(t.config);case 4:s.t2=s.sent,s.t0=s.t1.parse.call(s.t1,s.t2),s.next=9;break;case 8:s.t0=(r=t.config)!==null&&r!==void 0?r:{};case 9:if(i=s.t0,!X(t.patch)){s.next=18;break}return s.t4=JSON,s.next=14,n.load(t.patch);case 14:s.t5=s.sent,s.t3=s.t4.parse.call(s.t4,s.t5),s.next=19;break;case 18:s.t3=t.patch;case 19:return a=s.t3,s.abrupt("return",jo(jo(jo({},t),a?{patch:a}:{}),i?{config:i}:{}));case 21:case"end":return s.stop()}},e)})),iA.apply(this,arguments)}function hwe(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot)return{root:t,rootContainer:t};var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}function pwe(e,t){return aA.apply(this,arguments)}function aA(){return aA=wy(Po.mark(function e(t,n){var r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,b,w,x,E,k,S,A,C,_,D,M,N,T,O,P,W,B,se,me,we,ye,Se,Ue,Pn,jn,zt,R,G,K,$,ge,Z=arguments;return Po.wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(ge=function(){se&&document.removeEventListener("click",se),N.finalize()},l=Z.length>2&&Z[2]!==void 0?Z[2]:{},u=Z.length>3?Z[3]:void 0,c=l.theme?bl(I1e[l.theme],(r=l.config)!==null&&r!==void 0?r:{}):l.config,f=Fa(l.actions)?l.actions:Y8({},iwe,(i=l.actions)!==null&&i!==void 0?i:{}),d=jo(jo({},awe),l.i18n),h=(a=l.renderer)!==null&&a!==void 0?a:"canvas",p=(o=l.logLevel)!==null&&o!==void 0?o:Uo.Warn,m=(s=l.downloadFileName)!==null&&s!==void 0?s:"visualization",g=typeof t=="string"?document.querySelector(t):t,g){xe.next=12;break}throw new Error("".concat(t," does not exist"));case 12:return l.defaultStyle!==!1&&(y="vega-embed-style",v=hwe(g),b=v.root,w=v.rootContainer,b.getElementById(y)||(x=document.createElement("style"),x.id=y,x.innerText=l.defaultStyle===void 0||l.defaultStyle===!0?nwe.toString():l.defaultStyle,w.appendChild(x))),E=cwe(n,l.mode),k=owe[E](n,c),E==="vega-lite"&&(k.$schema&&(S=_8(k.$schema),IA.satisfies(Cy.vega,"^".concat(S.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(S.version,", but current version is v").concat(Cy.vega,".")))),g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="",A=g,f&&(C=document.createElement("div"),C.classList.add(lwe),g.appendChild(C),A=C),_=l.patch,_&&(_ instanceof Function?k=_(k):k=ph(k,_,!0,!1).newDocument),l.formatLocale&&Uo.formatLocale(l.formatLocale),l.timeFormatLocale&&Uo.timeFormatLocale(l.timeFormatLocale),D=l.ast,M=Uo.parse(k,E==="vega-lite"?{}:c,{ast:D}),N=new(l.viewClass||Uo.View)(M,jo({loader:u,logLevel:p,renderer:h},D?{expr:Uo.expressionInterpreter}:{})),N.addSignalListener("autosize",(qe,ut)=>{var Un=ut.type;Un=="fit-x"?(A.classList.add("fit-x"),A.classList.remove("fit-y")):Un=="fit-y"?(A.classList.remove("fit-x"),A.classList.add("fit-y")):Un=="fit"?A.classList.add("fit-x","fit-y"):A.classList.remove("fit-x","fit-y")}),l.tooltip!==!1&&(uwe(l.tooltip)?T=l.tooltip:T=new W1e(l.tooltip===!0?{}:l.tooltip).call,N.tooltip(T)),O=l.hover,O===void 0&&(O=E==="vega"),O&&(P=typeof O=="boolean"?{}:O,W=P.hoverSet,B=P.updateSet,N.hover(W,B)),l&&(l.width!=null&&N.width(l.width),l.height!=null&&N.height(l.height),l.padding!=null&&N.padding(l.padding)),xe.next=36,N.initialize(A,l.bind).runAsync();case 36:if(f!==!1){if(me=g,l.defaultStyle!==!1&&(we=document.createElement("details"),we.title=d.CLICK_TO_VIEW_ACTIONS,g.append(we),me=we,ye=document.createElement("summary"),ye.innerHTML=swe,we.append(ye),se=qe=>{we.contains(qe.target)||we.removeAttribute("open")},document.addEventListener("click",se)),Se=document.createElement("div"),me.append(Se),Se.classList.add("vega-actions"),f===!0||f.export!==!1)for(Ue=function(){var ut=jn[Pn];if(f===!0||f.export===!0||f.export[ut]){var Un=d["".concat(ut.toUpperCase(),"_ACTION")],fl=document.createElement("a");fl.text=Un,fl.href="#",fl.target="_blank",fl.download="".concat(m,".").concat(ut),fl.addEventListener("mousedown",function(){var Z8=wy(Po.mark(function oA(e9){var sA;return Po.wrap(function(nc){for(;;)switch(nc.prev=nc.next){case 0:return e9.preventDefault(),nc.next=3,N.toImageURL(ut,l.scaleFactor);case 3:sA=nc.sent,this.href=sA;case 5:case"end":return nc.stop()}},oA,this)}));return function(oA){return Z8.apply(this,arguments)}}()),Se.append(fl)}},Pn=0,jn=["svg","png"];Pn<jn.length;Pn++)Ue();(f===!0||f.source!==!1)&&(zt=document.createElement("a"),zt.text=d.SOURCE_ACTION,zt.href="#",zt.addEventListener("click",function(qe){var ut,Un;X8(Iy(n),(ut=l.sourceHeader)!==null&&ut!==void 0?ut:"",(Un=l.sourceFooter)!==null&&Un!==void 0?Un:"",E),qe.preventDefault()}),Se.append(zt)),E==="vega-lite"&&(f===!0||f.compiled!==!1)&&(R=document.createElement("a"),R.text=d.COMPILED_ACTION,R.href="#",R.addEventListener("click",function(qe){var ut,Un;X8(Iy(k),(ut=l.sourceHeader)!==null&&ut!==void 0?ut:"",(Un=l.sourceFooter)!==null&&Un!==void 0?Un:"","vega"),qe.preventDefault()}),Se.append(R)),(f===!0||f.editor!==!1)&&(K=(G=l.editorUrl)!==null&&G!==void 0?G:"https://vega.github.io/editor/",$=document.createElement("a"),$.text=d.EDITOR_ACTION,$.href="#",$.addEventListener("click",function(qe){twe(window,K,{config:c,mode:E,renderer:h,spec:Iy(n)}),qe.preventDefault()}),Se.append($))}return xe.abrupt("return",{view:N,spec:n,vgSpec:k,finalize:ge});case 38:case"end":return xe.stop()}},e)})),aA.apply(this,arguments)}export default dwe;
