/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Z(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Rf(e,t,n,i){function r(a){return a instanceof n?a:new n(function(o){o(a)})}return new(n||(n=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(f){o(f)}}function l(c){try{u(i.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):r(c.value).then(s,l)}u((i=i.apply(e,t||[])).next())})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var R3=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i())}}(),F3=Object.prototype.hasOwnProperty;function km(e,t){return F3.call(e,t)}function _m(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var t=[];for(var i in e)km(e,i)&&t.push(i);return t}function Dn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Am(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function ro(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function pE(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Sm(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Sm(e[t]))return!0}else if(typeof e=="object"){for(var i=_m(e),r=i.length,t=0;t<r;t++)if(Sm(e[i[t]]))return!0}}return!1}function gE(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var mE=function(e){R3(t,e);function t(n,i,r,a,o){var s=this.constructor,l=e.call(this,gE(n,{name:i,index:r,operation:a,tree:o}))||this;return l.name=i,l.index=r,l.operation=a,l.tree=o,Object.setPrototypeOf(l,s.prototype),l.message=gE(n,{name:i,index:r,operation:a,tree:o}),l}return t}(Error),Ze=mE,N3=Dn,ks={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Ff(n,this.path);i&&(i=Dn(i));var r=ao(n,{op:"remove",path:this.from}).removed;return ao(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Ff(n,this.from);return ao(n,{op:"add",path:this.path,value:Dn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Jl(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},I3={add:function(e,t,n){return Am(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:ks.move,copy:ks.copy,test:ks.test,_get:ks._get};function Ff(e,t){if(t=="")return e;var n={op:"_get",path:t};return ao(e,n),n.value}function ao(e,t,n,i,r,a){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),a===void 0&&(a=0),n&&(typeof n=="function"?n(t,0,e,t.path):If(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Ff(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Jl(e,t.value),o.test===!1)throw new Ze("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Ze("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}}else{i||(e=Dn(e));var s=t.path||"",l=s.split("/"),u=e,c=1,f=l.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=If;;){if(h=l[c],r&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&(d===void 0&&(u[h]===void 0?d=l.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d))),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(n&&!Am(h))throw new Ze("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Am(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>u.length)throw new Ze("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var o=I3[t.op].call(t,u,h,e);if(o.test===!1)throw new Ze("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(h&&h.indexOf("~")!=-1&&(h=pE(h)),c>=f){var o=ks[t.op].call(t,u,h,e);if(o.test===!1)throw new Ze("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}u=u[h]}}}function Nf(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new Ze("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Dn(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=ao(e,t[o],n,!0,r,o),e=a[o].newDocument;return a.newDocument=e,a}function M3(e,t,n){var i=ao(e,t);if(i.test===!1)throw new Ze("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function If(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ze("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ks[e.op]){if(typeof e.path!="string")throw new Ze("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ze('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ze("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ze("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Sm(e.value))throw new Ze("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new Ze("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new Ze("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},s=vE([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ze("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Ze("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function vE(e,t,n){try{if(!Array.isArray(e))throw new Ze("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Nf(Dn(t),Dn(e),n||!0);else{n=n||If;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof Ze)return r;throw r}}function Jl(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,a,o;if(n&&i){if(a=e.length,a!=t.length)return!1;for(r=a;r--!==0;)if(!Jl(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var s=Object.keys(e);if(a=s.length,a!==Object.keys(t).length)return!1;for(r=a;r--!==0;)if(!t.hasOwnProperty(s[r]))return!1;for(r=a;r--!==0;)if(o=s[r],!Jl(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var j3=Object.freeze({__proto__:null,JsonPatchError:Ze,deepClone:N3,getValueByPointer:Ff,applyOperation:ao,applyPatch:Nf,applyReducer:M3,validator:If,validate:vE,_areEquals:Jl});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Om=new WeakMap(),L3=function(){function e(t){this.observers=new Map(),this.obj=t}return e}(),P3=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function z3(e){return Om.get(e)}function B3(e,t){return e.observers.get(t)}function U3(e,t){e.observers.delete(t.callback)}function q3(e,t){t.unobserve()}function W3(e,t){var n=[],i,r=z3(e);if(!r)r=new L3(e),Om.set(e,r);else{var a=B3(r,t);i=a&&a.observer}if(i)return i;if(i={},r.value=Dn(e),t){i.callback=t,i.next=null;var o=function(){Tm(i)},s=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",s),window.addEventListener("keyup",s),window.addEventListener("mousedown",s),window.addEventListener("keydown",s),window.addEventListener("change",s))}return i.patches=n,i.object=e,i.unobserve=function(){Tm(i),clearTimeout(i.next),U3(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",s),window.removeEventListener("keyup",s),window.removeEventListener("mousedown",s),window.removeEventListener("keydown",s),window.removeEventListener("change",s))},r.observers.set(t,new P3(t,i)),i}function Tm(e,t){t===void 0&&(t=!1);var n=Om.get(e.object);Cm(n.value,e.object,e.patches,"",t),e.patches.length&&Nf(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Cm(e,t,n,i,r){if(t===e)return;typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=_m(t),o=_m(e),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=e[u];if(km(t,u)&&!(t[u]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[u];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null?Cm(c,f,n,i+"/"+ro(u),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+ro(u),value:Dn(c)}),n.push({op:"replace",path:i+"/"+ro(u),value:Dn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+ro(u),value:Dn(c)}),n.push({op:"remove",path:i+"/"+ro(u)}),s=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!s&&a.length==o.length)return;for(var l=0;l<a.length;l++){var u=a[l];!km(e,u)&&t[u]!==void 0&&n.push({op:"add",path:i+"/"+ro(u),value:Dn(t[u])})}}function G3(e,t,n){n===void 0&&(n=!1);var i=[];return Cm(e,t,i,"",n),i}var H3=Object.freeze({__proto__:null,unobserve:q3,observe:W3,generate:Tm,compare:G3});Object.assign({},j3,H3,{JsonPatchError:mE,deepClone:Dn,escapePathComponent:ro,unescapePathComponent:pE});var Y3=/("(?:[^\\"]|\\.)*")|[:,]/g,$m=function(t,n){var i,r,a;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?Infinity:n.maxLength===void 0?80:n.maxLength,a=n.replacer,function o(s,l,u){var c,f,d,h,p,g,m,v,y,b,E,x;if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),E=JSON.stringify(s,a),E===void 0)return E;if(m=r-l.length-u,E.length<=m&&(y=E.replace(Y3,function(k,w){return w||k+" "}),y.length<=m))return y;if(a!=null&&(s=JSON.parse(E),a=void 0),typeof s=="object"&&s!==null){if(v=l+i,d=[],f=0,Array.isArray(s))for(b="[",c="]",m=s.length;f<m;f++)d.push(o(s[f],v,f===m-1?0:1)||"null");else for(b="{",c="}",g=Object.keys(s),m=g.length;f<m;f++)h=g[f],p=JSON.stringify(h)+": ",x=o(s[h],v,p.length+(f===m-1?0:1)),x!==void 0&&d.push(p+x);if(d.length>0)return[b,i+d.join(`,
`+v),c].join(`
`+l)}return E}(t,"",0)};function V3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Dm(e,t,n){return n={path:t,exports:{},require:function(i,r){return X3(i,r??n.path)}},e(n,n.exports),n.exports}function X3(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}const J3="2.0.0",K3=256,Q3=Number.MAX_SAFE_INTEGER||9007199254740991,Z3=16;var Mf={SEMVER_SPEC_VERSION:J3,MAX_LENGTH:K3,MAX_SAFE_INTEGER:Q3,MAX_SAFE_COMPONENT_LENGTH:Z3};function yE(){throw new Error("setTimeout has not been defined")}function bE(){throw new Error("clearTimeout has not been defined")}var Jr=yE,Kr=bE;typeof window.setTimeout=="function"&&(Jr=setTimeout),typeof window.clearTimeout=="function"&&(Kr=clearTimeout);function wE(e){if(Jr===setTimeout)return setTimeout(e,0);if((Jr===yE||!Jr)&&setTimeout)return Jr=setTimeout,setTimeout(e,0);try{return Jr(e,0)}catch(t){try{return Jr.call(null,e,0)}catch(n){return Jr.call(this,e,0)}}}function eL(e){if(Kr===clearTimeout)return clearTimeout(e);if((Kr===bE||!Kr)&&clearTimeout)return Kr=clearTimeout,clearTimeout(e);try{return Kr(e)}catch(t){try{return Kr.call(null,e)}catch(n){return Kr.call(this,e)}}}var vr=[],_s=!1,oo,jf=-1;function tL(){if(!_s||!oo)return;_s=!1,oo.length?vr=oo.concat(vr):jf=-1,vr.length&&xE()}function xE(){if(_s)return;var e=wE(tL);_s=!0;for(var t=vr.length;t;){for(oo=vr,vr=[];++jf<t;)oo&&oo[jf].run();jf=-1,t=vr.length}oo=null,_s=!1,eL(e)}function nL(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];vr.push(new EE(e,t)),vr.length===1&&!_s&&wE(xE)}function EE(e,t){this.fun=e,this.array=t}EE.prototype.run=function(){this.fun.apply(null,this.array)};var iL="browser",rL="browser",aL=!0,oL=[],sL="",lL={},uL={},cL={};function so(){}var fL=so,dL=so,hL=so,pL=so,gL=so,mL=so,vL=so;function yL(e){throw new Error("process.binding is not supported")}function bL(){return"/"}function wL(e){throw new Error("process.chdir is not supported")}function xL(){return 0}var As=window.performance||{},EL=As.now||As.mozNow||As.msNow||As.oNow||As.webkitNow||function(){return new Date().getTime()};function kL(e){var t=EL.call(As)*.001,n=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(n=n-e[0],i=i-e[1],i<0&&(n--,i+=1e9)),[n,i]}var _L=new Date();function AL(){var e=new Date(),t=e-_L;return t/1e3}var Lf={nextTick:nL,title:iL,browser:aL,env:{NODE_ENV:"production"},argv:oL,version:sL,versions:lL,on:fL,addListener:dL,once:hL,off:pL,removeListener:gL,removeAllListeners:mL,emit:vL,binding:yL,cwd:bL,chdir:wL,umask:xL,hrtime:kL,platform:rL,release:uL,config:cL,uptime:AL};const SL=typeof Lf=="object"&&Lf.env&&Lf.env.NODE_DEBUG&&/\bsemver\b/i.test(Lf.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Oe=SL,Qr=Dm(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Mf;t=e.exports={};const i=t.re=[],r=t.src=[],a=t.t={};let o=0;const s=(l,u,c)=>{const f=o++;Oe(f,u),a[l]=f,r[f]=u,i[f]=new RegExp(u,c?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})\\.(${r[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})\\.(${r[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${r[a.NUMERICIDENTIFIER]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${r[a.NUMERICIDENTIFIERLOOSE]}|${r[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${r[a.PRERELEASEIDENTIFIER]}(?:\\.${r[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${r[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${r[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${r[a.BUILDIDENTIFIER]}(?:\\.${r[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${r[a.MAINVERSION]}${r[a.PRERELEASE]}?${r[a.BUILD]}?`),s("FULL",`^${r[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${r[a.MAINVERSIONLOOSE]}${r[a.PRERELEASELOOSE]}?${r[a.BUILD]}?`),s("LOOSE",`^${r[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${r[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${r[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:\\.(${r[a.XRANGEIDENTIFIER]})(?:${r[a.PRERELEASE]})?${r[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${r[a.XRANGEIDENTIFIERLOOSE]})(?:${r[a.PRERELEASELOOSE]})?${r[a.BUILD]}?)?)?`),s("XRANGE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${r[a.GTLT]}\\s*${r[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",r[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${r[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${r[a.LONETILDE]}${r[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${r[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${r[a.LONECARET]}${r[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${r[a.LONECARET]}${r[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${r[a.GTLT]}\\s*(${r[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${r[a.GTLT]}\\s*(${r[a.LOOSEPLAIN]}|${r[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${r[a.XRANGEPLAIN]})\\s+-\\s+(${r[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${r[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${r[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")});const kE=/^[0-9]+$/,_E=(e,t)=>{const n=kE.test(e),i=kE.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},OL=(e,t)=>_E(t,e);var Rm={compareIdentifiers:_E,rcompareIdentifiers:OL};const{MAX_LENGTH:AE,MAX_SAFE_INTEGER:Pf}=Mf,{re:SE,t:OE}=Qr,{compareIdentifiers:Kl}=Rm;class Ni{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Ni){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid Version: ${e}`);if(e.length>AE)throw new TypeError(`version is longer than ${AE} characters`);Oe("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?SE[OE.LOOSE]:SE[OE.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Pf||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Pf||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Pf||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const r=+i;if(r>=0&&r<Pf)return r}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Oe("SemVer.compare",this.version,this.options,e),!(e instanceof Ni)){if(typeof e=="string"&&e===this.version)return 0;e=new Ni(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ni||(e=new Ni(e,this.options)),Kl(this.major,e.major)||Kl(this.minor,e.minor)||Kl(this.patch,e.patch)}comparePre(e){if(e instanceof Ni||(e=new Ni(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],i=e.prerelease[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Kl(n,i)}while(++t)}compareBuild(e){e instanceof Ni||(e=new Ni(e,this.options));let t=0;do{const n=this.build[t],i=e.build[t];if(Oe("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Kl(n,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t),this.inc("pre",t);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let n=this.prerelease.length;for(;--n>=0;)typeof this.prerelease[n]=="number"&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var et=Ni;const{MAX_LENGTH:TL}=Mf,{re:TE,t:CE}=Qr,CL=(e,t)=>{if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof et)return e;if(typeof e!="string")return null;if(e.length>TL)return null;const n=t.loose?TE[CE.LOOSE]:TE[CE.FULL];if(!n.test(e))return null;try{return new et(e,t)}catch(i){return null}};var lo=CL;const $L=(e,t)=>{const n=lo(e,t);return n?n.version:null};var DL=$L;const RL=(e,t)=>{const n=lo(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var FL=RL;const NL=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new et(e,n).inc(t,i).version}catch(r){return null}};var IL=NL;const ML=(e,t,n)=>new et(e,n).compare(new et(t,n));var Rn=ML;const jL=(e,t,n)=>Rn(e,t,n)===0;var Fm=jL;const LL=(e,t)=>{if(Fm(e,t))return null;{const n=lo(e),i=lo(t),r=n.prerelease.length||i.prerelease.length,a=r?"pre":"",o=r?"prerelease":"";for(const s in n)if((s==="major"||s==="minor"||s==="patch")&&n[s]!==i[s])return a+s;return o}};var PL=LL;const zL=(e,t)=>new et(e,t).major;var BL=zL;const UL=(e,t)=>new et(e,t).minor;var qL=UL;const WL=(e,t)=>new et(e,t).patch;var GL=WL;const HL=(e,t)=>{const n=lo(e,t);return n&&n.prerelease.length?n.prerelease:null};var YL=HL;const VL=(e,t,n)=>Rn(t,e,n);var XL=VL;const JL=(e,t)=>Rn(e,t,!0);var KL=JL;const QL=(e,t,n)=>{const i=new et(e,n),r=new et(t,n);return i.compare(r)||i.compareBuild(r)};var Nm=QL;const ZL=(e,t)=>e.sort((n,i)=>Nm(n,i,t));var eP=ZL;const tP=(e,t)=>e.sort((n,i)=>Nm(i,n,t));var nP=tP;const iP=(e,t,n)=>Rn(e,t,n)>0;var Ql=iP;const rP=(e,t,n)=>Rn(e,t,n)<0;var zf=rP;const aP=(e,t,n)=>Rn(e,t,n)!==0;var $E=aP;const oP=(e,t,n)=>Rn(e,t,n)>=0;var Im=oP;const sP=(e,t,n)=>Rn(e,t,n)<=0;var Mm=sP;const lP=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return Fm(e,n,i);case"!=":return $E(e,n,i);case">":return Ql(e,n,i);case">=":return Im(e,n,i);case"<":return zf(e,n,i);case"<=":return Mm(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var Bf=lP;const{re:Uf,t:qf}=Qr,uP=(e,t)=>{if(e instanceof et)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Uf[qf.COERCE]);else{let i;for(;(i=Uf[qf.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),Uf[qf.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Uf[qf.COERCERTL].lastIndex=-1}return n===null?null:lo(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var cP=uP;class Wf{constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof Wf)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Wf(e.raw,t);if(e instanceof uo)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){const t=this.options.loose;e=e.trim();const n=t?Ft[kt.HYPHENRANGELOOSE]:Ft[kt.HYPHENRANGE];e=e.replace(n,kP(this.options.includePrerelease)),Oe("hyphen replace",e),e=e.replace(Ft[kt.COMPARATORTRIM],fP),Oe("comparator trim",e,Ft[kt.COMPARATORTRIM]),e=e.replace(Ft[kt.TILDETRIM],dP),e=e.replace(Ft[kt.CARETTRIM],hP),e=e.split(/\s+/).join(" ");const i=t?Ft[kt.COMPARATORLOOSE]:Ft[kt.COMPARATOR];return e.split(" ").map(r=>pP(r,this.options)).join(" ").split(/\s+/).map(r=>EP(r,this.options)).filter(this.options.loose?r=>!!r.match(i):()=>!0).map(r=>new uo(r,this.options))}intersects(e,t){if(!(e instanceof Wf))throw new TypeError("a Range is required");return this.set.some(n=>DE(n,t)&&e.set.some(i=>DE(i,t)&&n.every(r=>i.every(a=>r.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new et(e,this.options)}catch(t){return!1}for(let t=0;t<this.set.length;t++)if(_P(this.set[t],e,this.options))return!0;return!1}}var fn=Wf;const{re:Ft,t:kt,comparatorTrimReplace:fP,tildeTrimReplace:dP,caretTrimReplace:hP}=Qr,DE=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(a=>r.intersects(a,t)),r=i.pop();return n},pP=(e,t)=>(Oe("comp",e,t),e=vP(e,t),Oe("caret",e),e=gP(e,t),Oe("tildes",e),e=bP(e,t),Oe("xrange",e),e=xP(e,t),Oe("stars",e),e),Vt=e=>!e||e.toLowerCase()==="x"||e==="*",gP=(e,t)=>e.trim().split(/\s+/).map(n=>mP(n,t)).join(" "),mP=(e,t)=>{const n=t.loose?Ft[kt.TILDELOOSE]:Ft[kt.TILDE];return e.replace(n,(i,r,a,o,s)=>{Oe("tilde",e,i,r,a,o,s);let l;return Vt(r)?l="":Vt(a)?l=`>=${r}.0.0 <${+r+1}.0.0-0`:Vt(o)?l=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:s?(Oe("replaceTilde pr",s),l=`>=${r}.${a}.${o}-${s} <${r}.${+a+1}.0-0`):l=`>=${r}.${a}.${o} <${r}.${+a+1}.0-0`,Oe("tilde return",l),l})},vP=(e,t)=>e.trim().split(/\s+/).map(n=>yP(n,t)).join(" "),yP=(e,t)=>{Oe("caret",e,t);const n=t.loose?Ft[kt.CARETLOOSE]:Ft[kt.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,a,o,s,l)=>{Oe("caret",e,r,a,o,s,l);let u;return Vt(a)?u="":Vt(o)?u=`>=${a}.0.0${i} <${+a+1}.0.0-0`:Vt(s)?a==="0"?u=`>=${a}.${o}.0${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.0${i} <${+a+1}.0.0-0`:l?(Oe("replaceCaret pr",l),a==="0"?o==="0"?u=`>=${a}.${o}.${s}-${l} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}-${l} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s}-${l} <${+a+1}.0.0-0`):(Oe("no pr"),a==="0"?o==="0"?u=`>=${a}.${o}.${s}${i} <${a}.${o}.${+s+1}-0`:u=`>=${a}.${o}.${s}${i} <${a}.${+o+1}.0-0`:u=`>=${a}.${o}.${s} <${+a+1}.0.0-0`),Oe("caret return",u),u})},bP=(e,t)=>(Oe("replaceXRanges",e,t),e.split(/\s+/).map(n=>wP(n,t)).join(" ")),wP=(e,t)=>{e=e.trim();const n=t.loose?Ft[kt.XRANGELOOSE]:Ft[kt.XRANGE];return e.replace(n,(i,r,a,o,s,l)=>{Oe("xRange",e,i,r,a,o,s,l);const u=Vt(a),c=u||Vt(o),f=c||Vt(s),d=f;return r==="="&&d&&(r=""),l=t.includePrerelease?"-0":"",u?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),s=0,r===">"?(r=">=",c?(a=+a+1,o=0,s=0):(o=+o+1,s=0)):r==="<="&&(r="<",c?a=+a+1:o=+o+1),r==="<"&&(l="-0"),i=`${r+a}.${o}.${s}${l}`):c?i=`>=${a}.0.0${l} <${+a+1}.0.0-0`:f&&(i=`>=${a}.${o}.0${l} <${a}.${+o+1}.0-0`),Oe("xRange return",i),i})},xP=(e,t)=>(Oe("replaceStars",e,t),e.trim().replace(Ft[kt.STAR],"")),EP=(e,t)=>(Oe("replaceGTE0",e,t),e.trim().replace(Ft[t.includePrerelease?kt.GTE0PRE:kt.GTE0],"")),kP=e=>(t,n,i,r,a,o,s,l,u,c,f,d,h)=>(Vt(i)?n="":Vt(r)?n=`>=${i}.0.0${e?"-0":""}`:Vt(a)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,Vt(u)?l="":Vt(c)?l=`<${+u+1}.0.0-0`:Vt(f)?l=`<${u}.${+c+1}.0-0`:d?l=`<=${u}.${c}.${f}-${d}`:e?l=`<${u}.${c}.${+f+1}-0`:l=`<=${l}`,`${n} ${l}`.trim()),_P=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++){if(Oe(e[i].semver),e[i].semver===uo.ANY)continue;if(e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}}return!1}return!0},Zl=Symbol("SemVer ANY");class jm{static get ANY(){return Zl}constructor(e,t){if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),e instanceof jm){if(e.loose===!!t.loose)return e;e=e.value}Oe("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Zl?this.value="":this.value=this.operator+this.semver.version,Oe("comp",this)}parse(e){const t=this.options.loose?RE[FE.COMPARATORLOOSE]:RE[FE.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new et(n[2],this.options.loose):this.semver=Zl}toString(){return this.value}test(e){if(Oe("Comparator.test",e,this.options.loose),this.semver===Zl||e===Zl)return!0;if(typeof e=="string")try{e=new et(e,this.options)}catch(t){return!1}return Bf(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof jm))throw new TypeError("a Comparator is required");if((!t||typeof t!="object")&&(t={loose:!!t,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new fn(e.value,t).test(this.value);if(e.operator==="")return e.value===""?!0:new fn(this.value,t).test(e.semver);const n=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<"),r=this.semver.version===e.semver.version,a=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<="),o=Bf(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<"),s=Bf(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return n||i||r&&a||o||s}}var uo=jm;const{re:RE,t:FE}=Qr,AP=(e,t,n)=>{try{t=new fn(t,n)}catch(i){return!1}return t.test(e)};var Zr=AP;const SP=(e,t)=>new fn(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var OP=SP;const TP=(e,t,n)=>{let i=null,r=null,a=null;try{a=new fn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===-1)&&(i=o,r=new et(i,n)))}),i};var CP=TP;const $P=(e,t,n)=>{let i=null,r=null,a=null;try{a=new fn(t,n)}catch(o){return null}return e.forEach(o=>{a.test(o)&&((!i||r.compare(o)===1)&&(i=o,r=new et(i,n)))}),i};var DP=$P;const RP=(e,t)=>{e=new fn(e,t);let n=new et("0.0.0");if(e.test(n))return n;if(n=new et("0.0.0-0"),e.test(n))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];r.forEach(a=>{const o=new et(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!n||Ql(n,o))&&(n=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}})}return n&&e.test(n)?n:null};var FP=RP;const NP=(e,t)=>{try{return new fn(e,t).range||"*"}catch(n){return null}};var IP=NP;const{ANY:MP}=uo,jP=(e,t,n,i)=>{e=new et(e,i),t=new fn(t,i);let r,a,o,s,l;switch(n){case">":r=Ql,a=Mm,o=zf,s=">",l=">=";break;case"<":r=zf,a=Im,o=Ql,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Zr(e,t,i))return!1;for(let u=0;u<t.set.length;++u){const c=t.set[u];let f=null,d=null;if(c.forEach(h=>{h.semver===MP&&(h=new uo(">=0.0.0")),f=f||h,d=d||h,r(h.semver,f.semver,i)?f=h:o(h.semver,d.semver,i)&&(d=h)}),f.operator===s||f.operator===l)return!1;if((!d.operator||d.operator===s)&&a(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};var Lm=jP;const LP=(e,t,n)=>Lm(e,t,">",n);var PP=LP;const zP=(e,t,n)=>Lm(e,t,"<",n);var BP=zP;const UP=(e,t,n)=>(e=new fn(e,n),t=new fn(t,n),e.intersects(t));var qP=UP,WP=(e,t,n)=>{const i=[];let r=null,a=null;const o=e.sort((c,f)=>Rn(c,f,n));for(const c of o){const f=Zr(c,t,n);f?(a=c,r||(r=c)):(a&&i.push([r,a]),a=null,r=null)}r&&i.push([r,null]);const s=[];for(const[c,f]of i)c===f?s.push(c):!f&&c===o[0]?s.push("*"):f?c===o[0]?s.push(`<=${f}`):s.push(`${c} - ${f}`):s.push(`>=${c}`);const l=s.join(" || "),u=typeof t.raw=="string"?t.raw:String(t);return l.length<u.length?l:t};const{ANY:NE}=uo,GP=(e,t,n)=>{e=new fn(e,n),t=new fn(t,n);let i=!1;e:for(const r of e.set){for(const a of t.set){const o=HP(r,a,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},HP=(e,t,n)=>{if(e.length===1&&e[0].semver===NE)return t.length===1&&t[0].semver===NE;const i=new Set();let r,a;for(const f of e)f.operator===">"||f.operator===">="?r=IE(r,f,n):f.operator==="<"||f.operator==="<="?a=ME(a,f,n):i.add(f.semver);if(i.size>1)return null;let o;if(r&&a){if(o=Rn(r.semver,a.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||a.operator!=="<="))return null}for(const f of i){if(r&&!Zr(f,String(r),n))return null;if(a&&!Zr(f,String(a),n))return null;for(const d of t)if(!Zr(f,String(d),n))return!1;return!0}let s,l,u,c;for(const f of t){if(c=c||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",r){if(f.operator===">"||f.operator===">="){if(s=IE(r,f,n),s===f)return!1}else if(r.operator===">="&&!Zr(r.semver,String(f),n))return!1}if(a){if(f.operator==="<"||f.operator==="<="){if(l=ME(a,f,n),l===f)return!1}else if(a.operator==="<="&&!Zr(a.semver,String(f),n))return!1}if(!f.operator&&(a||r)&&o!==0)return!1}return r&&u&&!a&&o!==0?!1:!(a&&c&&!r&&o!==0)},IE=(e,t,n)=>{if(!e)return t;const i=Rn(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},ME=(e,t,n)=>{if(!e)return t;const i=Rn(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var YP=GP,jE={re:Qr.re,src:Qr.src,tokens:Qr.t,SEMVER_SPEC_VERSION:Mf.SEMVER_SPEC_VERSION,SemVer:et,compareIdentifiers:Rm.compareIdentifiers,rcompareIdentifiers:Rm.rcompareIdentifiers,parse:lo,valid:DL,clean:FL,inc:IL,diff:PL,major:BL,minor:qL,patch:GL,prerelease:YL,compare:Rn,rcompare:XL,compareLoose:KL,compareBuild:Nm,sort:eP,rsort:nP,gt:Ql,lt:zf,eq:Fm,neq:$E,gte:Im,lte:Mm,cmp:Bf,coerce:cP,Comparator:uo,Range:fn,satisfies:Zr,toComparators:OP,maxSatisfying:CP,minSatisfying:DP,minVersion:FP,validRange:IP,outside:Lm,gtr:PP,ltr:BP,intersects:qP,simplifyRange:WP,subset:YP};function dn(e,t,n){return e.fields=t||[],e.fname=n,e}function Ye(e){return e==null?null:e.fname}function Nt(e){return e==null?null:e.fields}function LE(e){return e.length===1?VP(e[0]):XP(e)}const VP=e=>function(t){return t[e]},XP=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function F(e){throw Error(e)}function Ii(e){var t=[],n=null,i=0,r=e.length,a="",o,s,l;e=e+"";function u(){t.push(a+e.substring(o,s)),a="",o=s+1}for(o=s=0;s<r;++s)if(l=e[s],l==="\\")a+=e.substring(o,s),a+=e.substring(++s,++s),o=s;else if(l===n)u(),n=null,i=-1;else{if(n)continue;o===i&&l==='"'||o===i&&l==="'"?(o=s+1,n=l):l==="."&&!i?s>o?u():o=s+1:l==="["?(s>o&&u(),i=o=s+1):l==="]"&&(i||F("Access path missing open bracket: "+e),i>0&&u(),i=0,o=s+1)}return i&&F("Access path missing closing bracket: "+e),n&&F("Access path missing closing quote: "+e),s>o&&(s++,u()),t}function ci(e,t,n){const i=Ii(e);return e=i.length===1?i[0]:e,dn((n&&n.get||LE)(i),[e],t||e)}var eu=[],tu=ci("id"),It=dn(function(e){return e},eu,"identity"),ea=dn(function(){return 0},eu,"zero"),Ss=dn(function(){return 1},eu,"one"),fi=dn(function(){return!0},eu,"true"),ta=dn(function(){return!1},eu,"false");function Gf(e,t,n){var i=[t].concat([].slice.call(n));console[e].apply(console,i)}var PE=0,Pm=1,zm=2,zE=3,BE=4;function Bm(e,t){var n=e||PE;return{level:function(i){return arguments.length?(n=+i,this):n},error:function(){return n>=Pm&&Gf(t||"error","ERROR",arguments),this},warn:function(){return n>=zm&&Gf(t||"warn","WARN",arguments),this},info:function(){return n>=zE&&Gf(t||"log","INFO",arguments),this},debug:function(){return n>=BE&&Gf(t||"log","DEBUG",arguments),this}}}var M=Array.isArray;function K(e){return e===Object(e)}const UE=e=>e!=="__proto__";function Os(...e){return e.reduce((t,n)=>{for(var i in n)if(i==="signals")t.signals=JP(t.signals,n.signals);else{var r=i==="legend"?{layout:1}:i==="style"?!0:null;nu(t,i,n[i],r)}return t},{})}function nu(e,t,n,i){if(!UE(t))return;var r,a;if(K(n)&&!M(n)){a=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?nu(a,r,n[r]):UE(r)&&(a[r]=n[r])}else e[t]=n}function JP(e,t){if(e==null)return t;const n={},i=[];function r(a){n[a.name]||(n[a.name]=1,i.push(a))}return t.forEach(r),e.forEach(r),i}function ve(e){return e[e.length-1]}function Xt(e){return e==null||e===""?null:+e}function qE(e){return function(t){return e*Math.exp(t)}}function WE(e){return function(t){return Math.log(e*t)}}function GE(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function HE(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Hf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Yf(e,t,n,i){var r=n(e[0]),a=n(ve(e)),o=(a-r)*t;return[i(r-o),i(a-o)]}function YE(e,t){return Yf(e,t,Xt,It)}function VE(e,t){var n=Math.sign(e[0]);return Yf(e,t,WE(n),qE(n))}function XE(e,t,n){return Yf(e,t,Hf(n),Hf(1/n))}function JE(e,t,n){return Yf(e,t,GE(n),HE(n))}function Vf(e,t,n,i,r){var a=i(e[0]),o=i(ve(e)),s=t!=null?i(t):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function Um(e,t,n){return Vf(e,t,n,Xt,It)}function qm(e,t,n){var i=Math.sign(e[0]);return Vf(e,t,n,WE(i),qE(i))}function Xf(e,t,n,i){return Vf(e,t,n,Hf(i),Hf(1/i))}function Wm(e,t,n,i){return Vf(e,t,n,GE(i),HE(i))}function KE(e){return 1+~~(new Date(e).getMonth()/3)}function QE(e){return 1+~~(new Date(e).getUTCMonth()/3)}function G(e){return e!=null?M(e)?e:[e]:[]}function ZE(e,t,n){var i=e[0],r=e[1],a;return r<i&&(a=r,r=i,i=a),a=r-i,a>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-a),i+a]}function de(e){return typeof e=="function"}const KP="descending";function Gm(e,t,n){n=n||{},t=G(t)||[];const i=[],r=[],a={},o=n.comparator||QP;return G(e).forEach((s,l)=>{if(s==null)return;i.push(t[l]===KP?-1:1),r.push(s=de(s)?s:ci(s,null,n)),(Nt(s)||[]).forEach(u=>a[u]=1)}),r.length===0?null:dn(o(r,i),Object.keys(a))}const ek=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0,QP=(e,t)=>e.length===1?ZP(e[0],t[0]):e5(e,t,e.length),ZP=(e,t)=>function(n,i){return ek(e(n),e(i))*t},e5=(e,t,n)=>(t.push(0),function(i,r){let a,o=0,s=-1;for(;o===0&&++s<n;)a=e[s],o=ek(a(i),a(r));return o*t[s]});function Mt(e){return de(e)?e:function(){return e}}function Hm(e,t){var n,i;function r(){t(i),n=i=null}return function(a){i=a,n&&clearTimeout(n),n=setTimeout(r,e)}}function ce(e){for(var t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function Mi(e,t){var n=0,i,r,a,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(a=o=r;n<i;++n)r=e[n],r!=null&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(a=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<a&&(a=r),r>o&&(o=r))}return[a,o]}function tk(e,t){var n=-1,i=e.length,r,a,o,s,l;if(t==null){for(;++n<i;)if(a=e[n],a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=e[n],a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}else{for(;++n<i;)if(a=t(e[n],n,e),a!=null&&a>=a){r=o=a;break}if(n===i)return[-1,-1];for(s=l=n;++n<i;)a=t(e[n],n,e),a!=null&&(r>a&&(r=a,s=n),o<a&&(o=a,l=n))}return[s,l]}const t5=Object.prototype.hasOwnProperty;function Q(e,t){return t5.call(e,t)}var Jf={};function Ts(e){var t={},n,i;function r(a){return Q(t,a)&&t[a]!==Jf}return n={size:0,empty:0,object:t,has:r,get(a){return r(a)?t[a]:void 0},set(a,o){return r(a)||(++n.size,t[a]===Jf&&--n.empty),t[a]=o,this},delete(a){return r(a)&&(--n.size,++n.empty,t[a]=Jf),this},clear(){n.size=n.empty=0,n.object=t={}},test(a){return arguments.length?(i=a,n):i},clean(){var a={},o=0,s,l;for(s in t)l=t[s],l!==Jf&&(!i||!i(l))&&(a[s]=l,++o);n.size=o,n.empty=0,n.object=t=a}},e&&Object.keys(e).forEach(function(a){n.set(a,e[a])}),n}function nk(e,t,n,i,r,a){if(!n&&n!==0)return a;var o=e[0],s=ve(e),l=+n,u,c;return s<o&&(u=o,o=s,s=u),u=Math.abs(t-o),c=Math.abs(s-t),u<c&&u<=l?i:c<=l?r:a}function P(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function Cs(e,t,n,i){var r=t[0],a=t[t.length-1],o;return r>a&&(o=r,r=a,a=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=a:e<a)}function na(e){return typeof e=="boolean"}function ia(e){return Object.prototype.toString.call(e)==="[object Date]"}function Ce(e){return typeof e=="number"}function ik(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Y(e){return typeof e=="string"}function Ym(e,t,n){e&&(e=t?G(e).map(s=>s.replace(/\\(.)/g,"$1")):G(e));const i=e&&e.length,r=n&&n.get||LE,a=s=>r(t?[s]:Ii(s));let o;if(!i)o=function(){return""};else if(i===1){const s=a(e[0]);o=function(l){return""+s(l)}}else{const s=e.map(a);o=function(l){let u=""+s[0](l),c=0;for(;++c<i;)u+="|"+s[c](l);return u}}return dn(o,e,"key")}function rk(e,t){const n=e[0],i=ve(e),r=+t;return r?r===1?i:n+r*(i-n):n}const n5=1e4;function ak(e){e=+e||n5;let t,n,i;const r=()=>{t={},n={},i=0},a=(o,s)=>(++i>e&&(n=t,t={},i=1),t[o]=s);return r(),{clear:r,has:o=>Q(t,o)||Q(n,o),get:o=>Q(t,o)?t[o]:Q(n,o)?a(o,n[o]):void 0,set:(o,s)=>Q(t,o)?t[o]=s:a(o,s)}}function ok(e,t,n,i){var r=t.length,a=n.length;if(!a)return t;if(!r)return n;for(var o=i||new t.constructor(r+a),s=0,l=0,u=0;s<r&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<r;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function iu(e,t){for(var n="";--t>=0;)n+=e;return n}function sk(e,t,n,i){var r=n||" ",a=e+"",o=t-a.length;return o<=0?a:i==="left"?iu(r,o)+a:i==="center"?iu(r,~~(o/2))+a+iu(r,Math.ceil(o/2)):a+iu(r,o)}function ru(e){return e&&ve(e)-e[0]||0}function B(e){return M(e)?"["+e.map(B)+"]":K(e)||Y(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Vm(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}function i5(e){return Ce(e)||ia(e)?e:Date.parse(e)}function Xm(e,t){return t=t||i5,e==null||e===""?null:t(e)}function Jm(e){return e==null||e===""?null:e+""}function pt(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function lk(e,t,n,i){var r=i??"â€¦",a=e+"",o=a.length,s=Math.max(0,t-r.length);return o<=t?a:n==="left"?r+a.slice(o-s):n==="center"?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function ra(e,t,n){if(e)if(t)for(var i=0,r=e.length,a;i<r;++i)(a=t(e[i]))&&n(a,i,e);else e.forEach(n)}function Kf(e){var t=e||It,n=[],i={};return n.add=function(r){var a=t(r);return i[a]||(i[a]=1,n.push(r)),n},n.remove=function(r){var a=t(r),o;return i[a]&&(i[a]=0,(o=n.indexOf(r))>=0&&n.splice(o,1)),n},n}async function Qf(e,t){try{await t(e)}catch(n){e.error(n)}}var uk=Symbol("vega_id"),r5=1;function Zf(e){return!!(e&&ee(e))}function ee(e){return e[uk]}function ck(e,t){return e[uk]=t,e}function ke(e){var t=e===Object(e)?e:{data:e};return ee(t)?t:ck(t,r5++)}function Km(e){return Qm(e,ke({}))}function Qm(e,t){for(var n in e)t[n]=e[n];return t}function fk(e,t){return ck(t,ee(e))}function co(e,t){return e?t?(n,i)=>e(n,i)||ee(t(n))-ee(t(i)):(n,i)=>e(n,i)||ee(n)-ee(i):null}function dk(e){return e&&e.constructor===fo}function fo(){var e=[],t=[],n=[],i=[],r=[],a=null,o=!1;return{constructor:fo,insert:function(s){for(var l=G(s),u=0,c=l.length;u<c;++u)e.push(l[u]);return this},remove:function(s){for(var l=de(s)?i:t,u=G(s),c=0,f=u.length;c<f;++c)l.push(u[c]);return this},modify:function(s,l,u){var c={field:l,value:Mt(u)};return de(s)?(c.filter=s,r.push(c)):(c.tuple=s,n.push(c)),this},encode:function(s,l){return de(s)?r.push({filter:s,field:l}):n.push({tuple:s,field:l}),this},clean:function(s){return a=s,this},reflow:function(){return o=!0,this},pulse:function(s,l){var u={},c={},f,d,h,p,g,m;for(f=0,d=l.length;f<d;++f)u[ee(l[f])]=1;for(f=0,d=t.length;f<d;++f)g=t[f],u[ee(g)]=-1;for(f=0,d=i.length;f<d;++f)p=i[f],l.forEach(function(y){p(y)&&(u[ee(y)]=-1)});for(f=0,d=e.length;f<d;++f)g=e[f],m=ee(g),u[m]?u[m]=1:s.add.push(ke(e[f]));for(f=0,d=l.length;f<d;++f)g=l[f],u[ee(g)]<0&&s.rem.push(g);function v(y,b,E){E?y[b]=E(y):s.encode=b,o||(c[ee(y)]=y)}for(f=0,d=n.length;f<d;++f)h=n[f],g=h.tuple,p=h.field,m=u[ee(g)],m>0&&(v(g,p,h.value),s.modifies(p));for(f=0,d=r.length;f<d;++f)h=r[f],p=h.filter,l.forEach(function(y){p(y)&&u[ee(y)]>0&&v(y,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=t.length||i.length?l.filter(function(y){return u[ee(y)]>0}):l.slice();else for(m in c)s.mod.push(c[m]);return(a||a==null&&(t.length||i.length))&&s.clean(!0),s}}}var ed="_:mod:_";function td(){Object.defineProperty(this,ed,{writable:!0,value:{}})}var Zm=td.prototype;Zm.set=function(e,t,n,i){var r=this,a=r[e],o=r[ed];return t!=null&&t>=0?(a[t]!==n||i)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||i)&&(r[e]=n,o[e]=M(n)?1+n.length:-1),r},Zm.modified=function(e,t){var n=this[ed],i;if(arguments.length){if(M(e)){for(i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},Zm.clear=function(){return this[ed]={},this};var a5=0,o5="pulse",s5=new td(),l5=1,u5=2;function Fe(e,t,n,i){this.id=++a5,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}var yr=Fe.prototype;yr.targets=function(){return this._targets||(this._targets=Kf(tu))},yr.set=function(e){return this.value!==e?(this.value=e,1):0};function hk(e){return function(t){var n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}yr.skip=hk(l5),yr.modified=hk(u5),yr.parameters=function(e,t,n){t=t!==!1;var i=this,r=i._argval=i._argval||new td(),a=i._argops=i._argops||[],o=[],s,l,u,c;function f(d,h,p){p instanceof Fe?(p!==i&&(t&&p.targets().add(i),o.push(p)),a.push({op:p,name:d,index:h})):r.set(d,h,p)}for(s in e)if(l=e[s],s===o5)G(l).forEach(function(d){d instanceof Fe?d!==i&&(d.targets().add(i),o.push(d)):F("Pulse parameters must be operator instances.")}),i.source=l;else if(M(l))for(r.set(s,-1,Array(u=l.length)),c=0;c<u;++c)f(s,c,l[c]);else f(s,-1,l);return this.marshall().clear(),n&&(a.initonly=!0),o},yr.marshall=function(e){var t=this._argval||s5,n=this._argops,i,r,a,o,s;if(n){for(r=0,a=n.length;r<a;++r)i=n[r],o=i.op,s=o.modified()&&o.stamp===e,t.set(i.name,i.index,o.value,s);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},yr.detach=function(){var e=this._argops,t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this)},yr.evaluate=function(e){var t=this._update;if(t){var n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},yr.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e};function c5(e,t,n,i){var r=1,a;return e instanceof Fe?a=e:e&&e.prototype instanceof Fe?a=new e():de(e)?a=new Fe(null,e):(r=0,a=new Fe(e,t)),this.rank(a),r&&(i=n,n=t),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a}function f5(e,t){var n=e.rank,i,r;for(i=0,r=t.length;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}var d5=0;function nd(e,t,n){this.id=++d5,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function aa(e,t,n){return new nd(e,t,n)}var di=nd.prototype;di._filter=fi,di._apply=It,di.targets=function(){return this._targets||(this._targets=Kf(tu))},di.consume=function(e){return arguments.length?(this._consume=!!e,this):!!this._consume},di.receive=function(e){if(this._filter(e)){for(var t=this.value=this._apply(e),n=this._targets,i=n?n.length:0,r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},di.filter=function(e){var t=aa(e);return this.targets().add(t),t},di.apply=function(e){var t=aa(null,e);return this.targets().add(t),t},di.merge=function(){var e=aa();this.targets().add(e);for(var t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},di.throttle=function(e){var t=-1;return this.filter(function(){var n=Date.now();return n-t>e?(t=n,1):0})},di.debounce=function(e){var t=aa();return this.targets().add(aa(null,null,Hm(e,function(n){var i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},di.between=function(e,t){var n=!1;return e.targets().add(aa(null,null,function(){n=!0})),t.targets().add(aa(null,null,function(){n=!1})),this.filter(function(){return n})};function h5(e,t,n,i){var r=this,a=aa(n,i),o=function(c){c.dataflow=r;try{a.receive(c)}catch(f){r.error(f)}finally{r.run()}},s;typeof e=="string"&&typeof document!="undefined"?s=document.querySelectorAll(e):s=G(e);for(var l=0,u=s.length;l<u;++l)s[l].addEventListener(t,o);return a}const p5=/^([A-Za-z]+:)?\/\//,g5=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,m5=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,pk="file://";function v5(e,t){return function(n){return{options:n||{},sanitize:b5,load:y5,fileAccess:!!t,file:w5(t),http:E5(e)}}}async function y5(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function b5(e,t){t=ce({},this.options,t);const n=this.fileAccess,i={href:null};let r,a,o;const s=g5.test(e.replace(m5,""));(e==null||typeof e!="string"||!s)&&F("Sanitize failure, invalid URI: "+B(e));const l=p5.test(e);return(o=t.baseURL)&&!l&&(!e.startsWith("/")&&o[o.length-1]!=="/"&&(e="/"+e),e=o+e),a=(r=e.startsWith(pk))||t.mode==="file"||t.mode!=="http"&&!l&&n,r?e=e.slice(pk.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!a}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function w5(e){return e?function(t){return new Promise(function(n,i){e.readFile(t,function(r,a){r?i(r):n(a)})})}:x5}async function x5(){F("No file system access.")}function E5(e){return e?async function(t,n){const i=ce({},this.options.http,n),r=n&&n.response,a=await e(t,i);return a.ok?de(a[r])?a[r]():a.text():F(a.status+""+a.statusText)}:k5}async function k5(){F("No HTTP fetch method available.")}var e0={boolean:Vm,integer:Xt,number:Xt,date:Xm,string:Jm,unknown:It},id=[S5,T5,vk,O5],_5=["boolean","integer","number","date"];function gk(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=id.length,r=id.map((a,o)=>o+1);for(let a=0,o=0,s,l;a<n;++a)for(l=t?e[a][t]:e[a],s=0;s<i;++s)if(r[s]&&A5(l)&&!id[s](l)&&(r[s]=0,++o,o===id.length))return"string";return _5[r.reduce((a,o)=>a===0?o:a,0)-1]}function mk(e,t){return t.reduce(function(n,i){return n[i]=gk(e,i),n},{})}function A5(e){return e!=null&&e===e}function S5(e){return e==="true"||e==="false"||e===!0||e===!1}function O5(e){return!Number.isNaN(Date.parse(e))}function vk(e){return!Number.isNaN(+e)&&!(e instanceof Date)}function T5(e){return vk(e)&&Number.isInteger(+e)}var yk={},t0={},n0=34,au=10,i0=13;function bk(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function C5(e,t){var n=bk(e);return function(i,r){return t(n(i),r,e)}}function wk(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function hn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function $5(e){return e<0?"-"+hn(-e,6):e>9999?"+"+hn(e,6):hn(e,4)}function D5(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":$5(e.getUTCFullYear())+"-"+hn(e.getUTCMonth()+1,2)+"-"+hn(e.getUTCDate(),2)+(r?"T"+hn(t,2)+":"+hn(n,2)+":"+hn(i,2)+"."+hn(r,3)+"Z":i?"T"+hn(t,2)+":"+hn(n,2)+":"+hn(i,2)+"Z":n||t?"T"+hn(t,2)+":"+hn(n,2)+"Z":"")}function R5(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,p,g=r(f,function(m,v){if(h)return h(m,v-1);p=m,h=d?C5(m,d):bk(m)});return g.columns=p||[],g}function r(f,d){var h=[],p=f.length,g=0,m=0,v,y=p<=0,b=!1;f.charCodeAt(p-1)===au&&--p,f.charCodeAt(p-1)===i0&&--p;function E(){if(y)return t0;if(b)return b=!1,yk;var k,w=g,A;if(f.charCodeAt(w)===n0){for(;g++<p&&f.charCodeAt(g)!==n0||f.charCodeAt(++g)===n0;);return(k=g)>=p?y=!0:(A=f.charCodeAt(g++))===au?b=!0:A===i0&&(b=!0,f.charCodeAt(g)===au&&++g),f.slice(w+1,k-1).replace(/""/g,'"')}for(;g<p;){if((A=f.charCodeAt(k=g++))===au)b=!0;else if(A===i0)b=!0,f.charCodeAt(g)===au&&++g;else if(A!==n)continue;return f.slice(w,k)}return y=!0,f.slice(w,p)}for(;(v=E())!==t0;){for(var x=[];v!==yk&&v!==t0;)x.push(v),v=E();if(d&&(x=d(x,m++))==null)continue;h.push(x)}return h}function a(f,d){return f.map(function(h){return d.map(function(p){return c(h[p])}).join(e)})}function o(f,d){return d==null&&(d=wk(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=wk(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?D5(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}function xk(e){const t=function(n,i){const r={delimiter:e};return r0(n,i?ce(i,r):r)};return t.responseType="text",t}function r0(e,t){return t.header&&(e=t.header.map(B).join(t.delimiter)+`
`+e),R5(t.delimiter).parse(e+"")}r0.responseType="text";function F5(e){return typeof Buffer=="function"&&de(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function a0(e,t){const n=t&&t.property?ci(t.property):It;return K(e)&&!F5(e)?N5(n(e)):n(JSON.parse(e))}a0.responseType="json";function N5(e,t){return t&&t.copy?JSON.parse(JSON.stringify(e)):e}function I5(e){return e}function M5(e){if(e==null)return I5;var t,n,i=e.scale[0],r=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=n=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*i+a,f[1]=(n+=s[1])*r+o;u<c;)f[u]=s[u],++u;return f}}function j5(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function L5(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return Ek(e,n)})}:Ek(e,t)}function Ek(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,a=kk(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:a}:i==null?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function kk(e,t){var n=M5(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,p=d.length;h<p;++h)f.push(n(d[h],h));c<0&&j5(f,p)}function a(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}function P5(e,t){var n={},i={},r={},a=[],o=-1;t.forEach(function(u,c){var f=e.arcs[u<0?~u:u],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=u,t[c]=d)}),t.forEach(function(u){var c=s(u),f=c[0],d=c[1],h,p;if(h=r[f])if(delete r[h.end],h.push(u),h.end=d,p=i[d]){delete i[p.start];var g=p===h?h:h.concat(p);i[g.start=h.start]=r[g.end=p.end]=g}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(u),h.start=f,p=r[f]){delete r[p.end];var m=p===h?h:p.concat(h);i[m.start=p.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[u],i[h.start=f]=r[h.end=d]=h});function s(u){var c=e.arcs[u<0?~u:u],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],u<0?[d,f]:[f,d]}function l(u,c){for(var f in u){var d=u[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),a.push(d)}}return l(r,i),l(i,r),t.forEach(function(u){n[u<0?~u:u]||a.push([u])}),a}function z5(e){return kk(e,B5.apply(this,arguments))}function B5(e,t,n){var i,r,a;if(arguments.length>1)i=U5(e,t,n);else for(r=0,i=new Array(a=e.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:P5(e,i)}}function U5(e,t,n){var i=[],r=[],a;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:a})}function s(f){f.forEach(o)}function l(f){f.forEach(s)}function u(f){f.forEach(l)}function c(f){switch(a=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":s(f.arcs);break;case"MultiLineString":case"Polygon":l(f.arcs);break;case"MultiPolygon":u(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}const q5={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function _k(e,t){let n,i,r,a;return e=a0(e,t),t&&t.feature?(n=L5,r=t.feature):t&&t.mesh?(n=z5,r=t.mesh,a=q5[t.filter]):F("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,a):F("Invalid TopoJSON object: "+r),i&&i.features||[i]}_k.responseType="json";const rd={dsv:r0,csv:xk(","),tsv:xk("	"),json:a0,topojson:_k};function o0(e,t){return arguments.length>1?(rd[e]=t,this):Q(rd,e)?rd[e]:null}function Ak(e){const t=o0(e);return t&&t.responseType||"text"}function ou(e){const t={};return n=>t[n]||(t[n]=e(n))}function $s(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ad(e){return e.length===1&&(e=W5(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function W5(e){return function(t,n){return $s(e(t),n)}}var Sk=ad($s),oa=Sk.right,G5=Sk.left;function H5(e,t){let n=0,i,r=0,a=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,a+=i*(o-r));else{let o=-1;for(let s of e)(s=t(s,++o,e))!=null&&(s=+s)>=s&&(i=s-r,r+=i/++n,a+=i*(s-r))}if(n>1)return a/(n-1)}function Y5(e,t){const n=H5(e,t);return n&&Math.sqrt(n)}function ho(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}var s0=Math.sqrt(50),l0=Math.sqrt(10),u0=Math.sqrt(2);function c0(e,t,n){var i,r=-1,a,o,s;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(a=e,e=t,t=a),(s=od(e,t,n))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++r<a;)o[r]=(e+r)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++r<a;)o[r]=(e-r)/s;return i&&o.reverse(),o}function od(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,r);return r>=0?(a>=s0?10:a>=l0?5:a>=u0?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(a>=s0?10:a>=l0?5:a>=u0?2:1)}function sa(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),a=i/r;return a>=s0?r*=10:a>=l0?r*=5:a>=u0&&(r*=2),t<e?-r:r}function po(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function f0(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function Ok(e,t,n=0,i=e.length-1,r=$s){for(;i>n;){if(i-n>600){const l=i-n+1,u=t-n+1,c=Math.log(l),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),h=Math.max(n,Math.floor(t-u*f/l+d)),p=Math.min(i,Math.floor(t+(l-u)*f/l+d));Ok(e,t,h,p,r)}const a=e[t];let o=n,s=i;for(su(e,n,t),r(e[i],a)>0&&su(e,n,i);o<s;){for(su(e,o,s),++o,--s;r(e[o],a)<0;)++o;for(;r(e[s],a)>0;)--s}r(e[n],a)===0?su(e,n,s):(++s,su(e,s,i)),s<=t&&(n=s+1),t<=s&&(i=s-1)}return e}function su(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function V5(e){return e===null?NaN:+e}function*X5(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}function sd(e,t,n){if(e=Float64Array.from(X5(e,n)),!(i=e.length))return;if((t=+t)<=0||i<2)return f0(e);if(t>=1)return po(e);var i,r=(i-1)*t,a=Math.floor(r),o=po(Ok(e,a).subarray(0,a+1)),s=f0(e.subarray(a+1));return o+(s-o)*(r-a)}function J5(e,t,n=V5){if(!(i=e.length))return;if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,a=Math.floor(r),o=+n(e[a],a,e),s=+n(e[a+1],a+1,e);return o+(s-o)*(r-a)}function K5(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let a of e)(a=t(a,++r,e))!=null&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n}function Tk(e,t){return sd(e,.5,t)}function Q5(e,t){return Array.from(t,n=>e[n])}function Ck(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function ld(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Ds(e){return e=ld(Math.abs(e)),e?e[1]:NaN}function Z5(e,t){return function(n,i){for(var r=n.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&!(l+s+1>i&&(s=Math.max(1,i-l)),a.push(n.substring(r-=s,r+s)),(l+=s+1)>i);)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function ez(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var tz=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rs(e){if(!(t=tz.exec(e)))throw new Error("invalid format: "+e);var t;return new d0({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Rs.prototype=d0.prototype;function d0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}d0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function nz(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var $k;function iz(e,t){var n=ld(e,t);if(!n)return e+"";var i=n[0],r=n[1],a=r-($k=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+ld(e,Math.max(0,t+a-1))[0]}function Dk(e,t){var n=ld(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var Rk={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Dk(e*100,t)},r:Dk,s:iz,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Fk(e){return e}var Nk=Array.prototype.map,Ik=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function Mk(e){var t=e.grouping===void 0||e.thousands===void 0?Fk:Z5(Nk.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Fk:ez(Nk.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=Rs(f);var d=f.fill,h=f.align,p=f.sign,g=f.symbol,m=f.zero,v=f.width,y=f.comma,b=f.precision,E=f.trim,x=f.type;x==="n"?(y=!0,x="g"):Rk[x]||(b===void 0&&(b=12),E=!0,x="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var k=g==="$"?n:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",w=g==="$"?i:/[%p]/.test(x)?o:"",A=Rk[x],_=/[defgprs%]/.test(x);b=b===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function O(S){var T=k,D=w,I,C,N;if(x==="c")D=A(S)+D,S="";else{S=+S;var W=S<0||1/S<0;if(S=isNaN(S)?l:A(Math.abs(S),b),E&&(S=nz(S)),W&&+S===0&&p!=="+"&&(W=!1),T=(W?p==="("?p:s:p==="-"||p==="("?"":p)+T,D=(x==="s"?Ik[8+$k/3]:"")+D+(W&&p==="("?")":""),_){for(I=-1,C=S.length;++I<C;)if(N=S.charCodeAt(I),48>N||N>57){D=(N===46?r+S.slice(I+1):S.slice(I))+D,S=S.slice(0,I);break}}}y&&!m&&(S=t(S,Infinity));var X=T.length+S.length+D.length,J=X<v?new Array(v-X+1).join(d):"";y&&m&&(S=t(J+S,J.length?v-D.length:Infinity),J="");switch(h){case"<":S=T+S+D+J;break;case"=":S=T+J+S+D;break;case"^":S=J.slice(0,X=J.length>>1)+T+S+D+J.slice(X);break;default:S=J+T+S+D;break}return a(S)}return O.toString=function(){return f+""},O}function c(f,d){var h=u((f=Rs(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Ds(d)/3)))*3,g=Math.pow(10,-p),m=Ik[8+p/3];return function(v){return h(g*v)+m}}return{format:u,formatPrefix:c}}var ud,cd,h0;rz({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function rz(e){return ud=Mk(e),cd=ud.format,h0=ud.formatPrefix,ud}function jk(e){return Math.max(0,-Ds(Math.abs(e)))}function Lk(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ds(t)/3)))*3-Ds(Math.abs(e)))}function Pk(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ds(t)-Ds(e))+1}function az(e,t){return n=>{var i=e(n),r=i.indexOf(t),a,o;if(r<0)return i;for(a=oz(i,r),o=a<i.length?i.slice(a):"";--a>r;)if(i[a]!=="0"){++a;break}return i.slice(0,a)+o}}function oz(e,t){var n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function zk(e){const t=ou(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){var r=Rs(i||",");if(r.precision==null){r.precision=12;switch(r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return az(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,a,o){o=Rs(o??",f");const s=sa(i,r,a),l=Math.max(Math.abs(i),Math.abs(r));let u;if(o.precision==null)switch(o.type){case"s":return isNaN(u=Lk(s,l))||(o.precision=u),n(o,l);case"":case"e":case"g":case"p":case"r":{isNaN(u=Pk(s,l))||(o.precision=u-(o.type==="e"));break}case"f":case"%":{isNaN(u=jk(s))||(o.precision=u-(o.type==="%")*2);break}}return t(o)}}}let p0;Bk();function Bk(){return p0=zk({format:cd,formatPrefix:h0})}function Uk(e){return zk(Mk(e))}function fd(e){return arguments.length?p0=Uk(e):p0}const _t="year",pn="quarter",jt="month",ot="week",gn="date",Lt="day",ji="dayofyear",Fn="hours",Nn="minutes",qn="seconds",hi="milliseconds",g0=[_t,pn,jt,ot,gn,Lt,ji,Fn,Nn,qn,hi],m0=g0.reduce((e,t,n)=>(e[t]=1+n,e),{});function v0(e){const t=G(e).slice(),n={};t.length||F("Missing time unit."),t.forEach(r=>{Q(m0,r)?n[r]=1:F(`Invalid time unit: ${r}.`)});const i=(n[ot]||n[Lt]?1:0)+(n[pn]||n[jt]||n[gn]?1:0)+(n[ji]?1:0);return i>1&&F(`Incompatible time units: ${e}`),t.sort((r,a)=>m0[r]-m0[a]),t}const sz={[_t]:"%Y ",[pn]:"Q%q ",[jt]:"%b ",[gn]:"%d ",[ot]:"W%U ",[Lt]:"%a ",[ji]:"%j ",[Fn]:"%H:00",[Nn]:"00:%M",[qn]:":%S",[hi]:".%L",[`${_t}-${jt}`]:"%Y-%m ",[`${_t}-${jt}-${gn}`]:"%Y-%m-%d ",[`${Fn}-${Nn}`]:"%H:%M"};function qk(e,t){const n=ce({},sz,t),i=v0(e),r=i.length;let a="",o=0,s,l;for(o=0;o<r;)for(s=i.length;s>o;--s)if(l=i.slice(o,s).join("-"),n[l]!=null){a+=n[l],o=s;break}return a.trim()}var y0=new Date(),b0=new Date();function gt(e,t,n,i){function r(a){return e(a=arguments.length===0?new Date():new Date(+a)),a}return r.floor=function(a){return e(a=new Date(+a)),a},r.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},r.round=function(a){var o=r(a),s=r.ceil(a);return a-o<s-a?o:s},r.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},r.range=function(a,o,s){var l=[],u;if(a=r.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},r.filter=function(a){return gt(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},n&&(r.count=function(a,o){return y0.setTime(+a),b0.setTime(+o),e(y0),e(b0),Math.floor(n(y0,b0))},r.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?r.filter(i?function(o){return i(o)%a===0}:function(o){return r.count(0,o)%a===0}):r}),r}var Fs=gt(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});Fs.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?gt(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):Fs};var dd=1e3,go=6e4,hd=36e5,Wk=864e5,Gk=6048e5,pd=gt(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*dd)},function(e,t){return(t-e)/dd},function(e){return e.getUTCSeconds()}),Hk=gt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*dd)},function(e,t){e.setTime(+e+t*go)},function(e,t){return(t-e)/go},function(e){return e.getMinutes()}),Yk=gt(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*dd-e.getMinutes()*go)},function(e,t){e.setTime(+e+t*hd)},function(e,t){return(t-e)/hd},function(e){return e.getHours()}),mo=gt(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*go)/Wk},function(e){return e.getDate()-1});function vo(e){return gt(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*go)/Gk})}var gd=vo(0),w0=vo(1),$fe=vo(2),Dfe=vo(3),x0=vo(4),Rfe=vo(5),Ffe=vo(6),E0=gt(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),la=gt(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});la.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gt(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var Vk=gt(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*go)},function(e,t){return(t-e)/go},function(e){return e.getUTCMinutes()}),Xk=gt(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*hd)},function(e,t){return(t-e)/hd},function(e){return e.getUTCHours()}),yo=gt(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Wk},function(e){return e.getUTCDate()-1});function bo(e){return gt(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/Gk})}var md=bo(0),k0=bo(1),Nfe=bo(2),Ife=bo(3),_0=bo(4),Mfe=bo(5),jfe=bo(6),A0=gt(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),ua=gt(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ua.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:gt(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const wo=new Date();function S0(e){return wo.setFullYear(e),wo.setMonth(0),wo.setDate(1),wo.setHours(0,0,0,0),wo}function Jk(e){return Qk(new Date(e))}function Kk(e){return O0(new Date(e))}function Qk(e){return mo.count(S0(e.getFullYear())-1,e)}function O0(e){return gd.count(S0(e.getFullYear())-1,e)}function T0(e){return S0(e).getDay()}function lz(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(-1,t,n,i,r,a,o);return s.setFullYear(e),s}return new Date(e,t,n,i,r,a,o)}function Zk(e){return t_(new Date(e))}function e_(e){return C0(new Date(e))}function t_(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return yo.count(t-1,e)}function C0(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return md.count(t-1,e)}function $0(e){return wo.setTime(Date.UTC(e,0,1)),wo.getUTCDay()}function uz(e,t,n,i,r,a,o){if(0<=e&&e<100){var s=new Date(Date.UTC(-1,t,n,i,r,a,o));return s.setUTCFullYear(n.y),s}return new Date(Date.UTC(e,t,n,i,r,a,o))}function n_(e,t,n,i,r){const a=t||1,o=ve(e),s=(v,y,b)=>(b=b||v,cz(n[b],i[b],v===o&&a,y)),l=new Date(),u=pt(e),c=u[_t]?s(_t):Mt(2012),f=u[jt]?s(jt):u[pn]?s(pn):ea,d=u[ot]&&u[Lt]?s(Lt,1,ot+Lt):u[ot]?s(ot,1):u[Lt]?s(Lt,1):u[gn]?s(gn,1):u[ji]?s(ji,1):Ss,h=u[Fn]?s(Fn):ea,p=u[Nn]?s(Nn):ea,g=u[qn]?s(qn):ea,m=u[hi]?s(hi):ea;return function(v){l.setTime(+v);const y=c(l);return r(y,f(l),d(l,y),h(l),p(l),g(l),m(l))}}function cz(e,t,n,i){const r=n<=1?e:i?(a,o)=>i+n*Math.floor((e(a,o)-i)/n):(a,o)=>n*Math.floor(e(a,o)/n);return t?(a,o)=>t(r(a,o),o):r}function Ns(e,t,n){return t+e*7-(n+6)%7}const fz={[_t]:e=>e.getFullYear(),[pn]:e=>Math.floor(e.getMonth()/3),[jt]:e=>e.getMonth(),[gn]:e=>e.getDate(),[Fn]:e=>e.getHours(),[Nn]:e=>e.getMinutes(),[qn]:e=>e.getSeconds(),[hi]:e=>e.getMilliseconds(),[ji]:e=>Qk(e),[ot]:e=>O0(e),[ot+Lt]:(e,t)=>Ns(O0(e),e.getDay(),T0(t)),[Lt]:(e,t)=>Ns(1,e.getDay(),T0(t))},dz={[pn]:e=>3*e,[ot]:(e,t)=>Ns(e,0,T0(t))};function i_(e,t){return n_(e,t||1,fz,dz,lz)}const hz={[_t]:e=>e.getUTCFullYear(),[pn]:e=>Math.floor(e.getUTCMonth()/3),[jt]:e=>e.getUTCMonth(),[gn]:e=>e.getUTCDate(),[Fn]:e=>e.getUTCHours(),[Nn]:e=>e.getUTCMinutes(),[qn]:e=>e.getUTCSeconds(),[hi]:e=>e.getUTCMilliseconds(),[ji]:e=>t_(e),[ot]:e=>C0(e),[Lt]:(e,t)=>Ns(1,e.getUTCDay(),$0(t)),[ot+Lt]:(e,t)=>Ns(C0(e),e.getUTCDay(),$0(t))},pz={[pn]:e=>3*e,[ot]:(e,t)=>Ns(e,0,$0(t))};function r_(e,t){return n_(e,t||1,hz,pz,uz)}const gz={[_t]:la,[pn]:E0.every(3),[jt]:E0,[ot]:gd,[gn]:mo,[Lt]:mo,[ji]:mo,[Fn]:Yk,[Nn]:Hk,[qn]:pd,[hi]:Fs},mz={[_t]:ua,[pn]:A0.every(3),[jt]:A0,[ot]:md,[gn]:yo,[Lt]:yo,[ji]:yo,[Fn]:Xk,[Nn]:Vk,[qn]:pd,[hi]:Fs};function Is(e){return gz[e]}function Ms(e){return mz[e]}function a_(e,t,n){return e?e.offset(t,n):void 0}function o_(e,t,n){return a_(Is(e),t,n)}function s_(e,t,n){return a_(Ms(e),t,n)}function l_(e,t,n,i){return e?e.range(t,n,i):void 0}function u_(e,t,n,i){return l_(Is(e),t,n,i)}function c_(e,t,n,i){return l_(Ms(e),t,n,i)}const lu=1e3,uu=lu*60,cu=uu*60,vd=cu*24,vz=vd*7,f_=vd*30,D0=vd*365,d_=[_t,jt,gn,Fn,Nn,qn,hi],fu=d_.slice(0,-1),du=fu.slice(0,-1),hu=du.slice(0,-1),yz=hu.slice(0,-1),bz=[_t,ot],h_=[_t,jt],p_=[_t],pu=[[fu,1,lu],[fu,5,5*lu],[fu,15,15*lu],[fu,30,30*lu],[du,1,uu],[du,5,5*uu],[du,15,15*uu],[du,30,30*uu],[hu,1,cu],[hu,3,3*cu],[hu,6,6*cu],[hu,12,12*cu],[yz,1,vd],[bz,1,vz],[h_,1,f_],[h_,3,3*f_],[p_,1,D0]];function g_(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(ru(t))/n;let r=ad(s=>s[2]).right(pu,i),a,o;return r===pu.length?(a=p_,o=sa(t[0]/D0,t[1]/D0,n)):r?(r=pu[i/pu[r-1][2]<pu[r][2]/i?r-1:r],a=r[0],o=r[1]):(a=d_,o=Math.max(sa(t[0],t[1],n),1)),{units:a,step:o}}function R0(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function F0(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gu(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function m_(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=mu(r),c=vu(r),f=mu(a),d=vu(a),h=mu(o),p=vu(o),g=mu(s),m=vu(s),v=mu(l),y=vu(l),b={a:W,A:X,b:J,B:xe,c:null,d:w_,e:w_,f:Wz,H:Bz,I:Uz,j:qz,L:x_,m:Gz,M:Hz,p:Pe,q:dt,Q:A_,s:S_,S:Yz,u:Vz,U:Xz,V:Jz,w:Kz,W:Qz,x:null,X:null,y:Zz,Y:e6,Z:t6,"%":__},E={a:ht,A:Qe,b:Rt,B:ui,c:null,d:E_,e:E_,f:a6,H:n6,I:i6,j:r6,L:k_,m:o6,M:s6,p:no,q:Xr,Q:A_,s:S_,S:l6,u:u6,U:c6,V:f6,w:d6,W:h6,x:null,X:null,y:p6,Y:g6,Z:m6,"%":__},x={a:O,A:S,b:T,B:D,c:I,d:y_,e:y_,f:jz,H:b_,I:b_,j:Fz,L:Mz,m:Rz,M:Nz,p:_,q:Dz,Q:Pz,s:zz,S:Iz,u:_z,U:Az,V:Sz,w:kz,W:Oz,x:C,X:N,y:Cz,Y:Tz,Z:$z,"%":Lz};b.x=k(n,b),b.X=k(i,b),b.c=k(t,b),E.x=k(n,E),E.X=k(i,E),E.c=k(t,E);function k(H,ue){return function(me){var L=[],cn=-1,Ie=0,Cn=H.length,$n,io,hE;for(me instanceof Date||(me=new Date(+me));++cn<Cn;)H.charCodeAt(cn)===37&&(L.push(H.slice(Ie,cn)),(io=v_[$n=H.charAt(++cn)])!=null?$n=H.charAt(++cn):io=$n==="e"?" ":"0",(hE=ue[$n])&&($n=hE(me,io)),L.push($n),Ie=cn+1);return L.push(H.slice(Ie,cn)),L.join("")}}function w(H,ue){return function(me){var L=gu(1900,void 0,1),cn=A(L,H,me+="",0),Ie,Cn;if(cn!=me.length)return null;if("Q"in L)return new Date(L.Q);if("s"in L)return new Date(L.s*1e3+("L"in L?L.L:0));if(ue&&!("Z"in L)&&(L.Z=0),"p"in L&&(L.H=L.H%12+L.p*12),L.m===void 0&&(L.m="q"in L?L.q:0),"V"in L){if(L.V<1||L.V>53)return null;"w"in L||(L.w=1),"Z"in L?(Ie=F0(gu(L.y,0,1)),Cn=Ie.getUTCDay(),Ie=Cn>4||Cn===0?k0.ceil(Ie):k0(Ie),Ie=yo.offset(Ie,(L.V-1)*7),L.y=Ie.getUTCFullYear(),L.m=Ie.getUTCMonth(),L.d=Ie.getUTCDate()+(L.w+6)%7):(Ie=R0(gu(L.y,0,1)),Cn=Ie.getDay(),Ie=Cn>4||Cn===0?w0.ceil(Ie):w0(Ie),Ie=mo.offset(Ie,(L.V-1)*7),L.y=Ie.getFullYear(),L.m=Ie.getMonth(),L.d=Ie.getDate()+(L.w+6)%7)}else("W"in L||"U"in L)&&("w"in L||(L.w="u"in L?L.u%7:"W"in L?1:0),Cn="Z"in L?F0(gu(L.y,0,1)).getUTCDay():R0(gu(L.y,0,1)).getDay(),L.m=0,L.d="W"in L?(L.w+6)%7+L.W*7-(Cn+5)%7:L.w+L.U*7-(Cn+6)%7);return"Z"in L?(L.H+=L.Z/100|0,L.M+=L.Z%100,F0(L)):R0(L)}}function A(H,ue,me,L){for(var cn=0,Ie=ue.length,Cn=me.length,$n,io;cn<Ie;){if(L>=Cn)return-1;if($n=ue.charCodeAt(cn++),$n===37){if($n=ue.charAt(cn++),io=x[$n in v_?ue.charAt(cn++):$n],!io||(L=io(H,me,L))<0)return-1}else if($n!=me.charCodeAt(L++))return-1}return L}function _(H,ue,me){var L=u.exec(ue.slice(me));return L?(H.p=c[L[0].toLowerCase()],me+L[0].length):-1}function O(H,ue,me){var L=h.exec(ue.slice(me));return L?(H.w=p[L[0].toLowerCase()],me+L[0].length):-1}function S(H,ue,me){var L=f.exec(ue.slice(me));return L?(H.w=d[L[0].toLowerCase()],me+L[0].length):-1}function T(H,ue,me){var L=v.exec(ue.slice(me));return L?(H.m=y[L[0].toLowerCase()],me+L[0].length):-1}function D(H,ue,me){var L=g.exec(ue.slice(me));return L?(H.m=m[L[0].toLowerCase()],me+L[0].length):-1}function I(H,ue,me){return A(H,t,ue,me)}function C(H,ue,me){return A(H,n,ue,me)}function N(H,ue,me){return A(H,i,ue,me)}function W(H){return o[H.getDay()]}function X(H){return a[H.getDay()]}function J(H){return l[H.getMonth()]}function xe(H){return s[H.getMonth()]}function Pe(H){return r[+(H.getHours()>=12)]}function dt(H){return 1+~~(H.getMonth()/3)}function ht(H){return o[H.getUTCDay()]}function Qe(H){return a[H.getUTCDay()]}function Rt(H){return l[H.getUTCMonth()]}function ui(H){return s[H.getUTCMonth()]}function no(H){return r[+(H.getUTCHours()>=12)]}function Xr(H){return 1+~~(H.getUTCMonth()/3)}return{format:function(H){var ue=k(H+="",b);return ue.toString=function(){return H},ue},parse:function(H){var ue=w(H+="",!1);return ue.toString=function(){return H},ue},utcFormat:function(H){var ue=k(H+="",E);return ue.toString=function(){return H},ue},utcParse:function(H){var ue=w(H+="",!0);return ue.toString=function(){return H},ue}}}var v_={"-":"",_:" ","0":"0"},mt=/^\s*\d+/,wz=/^%/,xz=/[\\^$*+?|[\]().{}]/g;function $e(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function Ez(e){return e.replace(xz,"\\$&")}function mu(e){return new RegExp("^(?:"+e.map(Ez).join("|")+")","i")}function vu(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function kz(e,t,n){var i=mt.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function _z(e,t,n){var i=mt.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function Az(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function Sz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function Oz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function Tz(e,t,n){var i=mt.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function Cz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function $z(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Dz(e,t,n){var i=mt.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function Rz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function y_(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Fz(e,t,n){var i=mt.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function b_(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function Nz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function Iz(e,t,n){var i=mt.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function Mz(e,t,n){var i=mt.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function jz(e,t,n){var i=mt.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Lz(e,t,n){var i=wz.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function Pz(e,t,n){var i=mt.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function zz(e,t,n){var i=mt.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function w_(e,t){return $e(e.getDate(),t,2)}function Bz(e,t){return $e(e.getHours(),t,2)}function Uz(e,t){return $e(e.getHours()%12||12,t,2)}function qz(e,t){return $e(1+mo.count(la(e),e),t,3)}function x_(e,t){return $e(e.getMilliseconds(),t,3)}function Wz(e,t){return x_(e,t)+"000"}function Gz(e,t){return $e(e.getMonth()+1,t,2)}function Hz(e,t){return $e(e.getMinutes(),t,2)}function Yz(e,t){return $e(e.getSeconds(),t,2)}function Vz(e){var t=e.getDay();return t===0?7:t}function Xz(e,t){return $e(gd.count(la(e)-1,e),t,2)}function Jz(e,t){var n=e.getDay();return e=n>=4||n===0?x0(e):x0.ceil(e),$e(x0.count(la(e),e)+(la(e).getDay()===4),t,2)}function Kz(e){return e.getDay()}function Qz(e,t){return $e(w0.count(la(e)-1,e),t,2)}function Zz(e,t){return $e(e.getFullYear()%100,t,2)}function e6(e,t){return $e(e.getFullYear()%1e4,t,4)}function t6(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+$e(t/60|0,"0",2)+$e(t%60,"0",2)}function E_(e,t){return $e(e.getUTCDate(),t,2)}function n6(e,t){return $e(e.getUTCHours(),t,2)}function i6(e,t){return $e(e.getUTCHours()%12||12,t,2)}function r6(e,t){return $e(1+yo.count(ua(e),e),t,3)}function k_(e,t){return $e(e.getUTCMilliseconds(),t,3)}function a6(e,t){return k_(e,t)+"000"}function o6(e,t){return $e(e.getUTCMonth()+1,t,2)}function s6(e,t){return $e(e.getUTCMinutes(),t,2)}function l6(e,t){return $e(e.getUTCSeconds(),t,2)}function u6(e){var t=e.getUTCDay();return t===0?7:t}function c6(e,t){return $e(md.count(ua(e)-1,e),t,2)}function f6(e,t){var n=e.getUTCDay();return e=n>=4||n===0?_0(e):_0.ceil(e),$e(_0.count(ua(e),e)+(ua(e).getUTCDay()===4),t,2)}function d6(e){return e.getUTCDay()}function h6(e,t){return $e(k0.count(ua(e)-1,e),t,2)}function p6(e,t){return $e(e.getUTCFullYear()%100,t,2)}function g6(e,t){return $e(e.getUTCFullYear()%1e4,t,4)}function m6(){return"+0000"}function __(){return"%"}function A_(e){return+e}function S_(e){return Math.floor(+e/1e3)}var js,N0,O_,I0,T_;v6({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function v6(e){return js=m_(e),N0=js.format,O_=js.parse,I0=js.utcFormat,T_=js.utcParse,js}function C_(e,t,n){n=n||{},K(n)||F(`Invalid time multi-format specifier: ${n}`);const i=t(qn),r=t(Nn),a=t(Fn),o=t(gn),s=t(ot),l=t(jt),u=t(pn),c=t(_t),f=e(n[hi]||".%L"),d=e(n[qn]||":%S"),h=e(n[Nn]||"%I:%M"),p=e(n[Fn]||"%I %p"),g=e(n[gn]||n[Lt]||"%a %d"),m=e(n[ot]||"%b %d"),v=e(n[jt]||"%B"),y=e(n[pn]||"%B"),b=e(n[_t]||"%Y");return E=>(i(E)<E?f:r(E)<E?d:a(E)<E?h:o(E)<E?p:l(E)<E?s(E)<E?g:m:c(E)<E?u(E)<E?v:y:b)(E)}function $_(e){const t=ou(e.format),n=ou(e.utcFormat);return{timeFormat:i=>Y(i)?t(i):C_(t,Is,i),utcFormat:i=>Y(i)?n(i):C_(n,Ms,i),timeParse:ou(e.parse),utcParse:ou(e.utcParse)}}let M0;D_();function D_(){return M0=$_({format:N0,parse:O_,utcFormat:I0,utcParse:T_})}function R_(e){return $_(m_(e))}function yu(e){return arguments.length?M0=R_(e):M0}const j0=(e,t)=>ce({},e,t);function F_(e,t){const n=e?Uk(e):fd(),i=t?R_(t):yu();return j0(n,i)}function L0(e,t){const n=arguments.length;return n&&n!==2&&F("defaultLocale expects either zero or two arguments."),n?j0(fd(e),yu(t)):j0(fd(),yu())}function y6(){return Bk(),D_(),L0()}function N_(e,t,n,i){t=t||{};const r=o0(t.type||"json");return r||F("Unknown data format type: "+t.type),e=r(e,t),t.parse&&b6(e,t.parse,n,i),Q(e,"columns")&&delete e.columns,e}function b6(e,t,n,i){if(!e.length)return;const r=yu();n=n||r.timeParse,i=i||r.utcParse;var a=e.columns||Object.keys(e[0]),o,s,l,u,c,f,d;for(t==="auto"&&(t=mk(e,a)),a=Object.keys(t),o=a.map(function(h){var p=t[h],g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:"))){g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1));const v=g[0]==="utc"?i:n;return v(m)}if(!e0[p])throw Error("Illegal format pattern: "+h+":"+p);return e0[p]}),u=0,f=e.length,d=a.length;u<f;++u)for(s=e[u],c=0;c<d;++c)l=a[c],s[l]=o[c](s[l])}var yd=v5(typeof fetch!="undefined"&&fetch,null);function w6(e,t){const n=this.locale();return N_(e,t,n.timeParse,n.utcParse)}function x6(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function E6(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:Ak(t&&t.type)});try{r=n.parse(r,t)}catch(a){i=-2,n.warn("Data ingestion failed",e,a)}}catch(a){i=-1,n.warn("Loading failed",e,a)}return{data:r,status:i}}async function k6(e,t,n){const i=this,r=i._pending||_6(i);r.requests+=1;const a=await i.request(t,n);return i.pulse(e,i.changeset().remove(fi).insert(a.data||[])),r.done(),a}function _6(e){var t=new Promise(function(i){n=i}),n;return t.requests=0,t.done=function(){--t.requests===0&&(e._pending=null,n(e))},e._pending=t}var A6={skip:!0};function S6(e,t,n,i,r){var a=e instanceof Fe?T6:O6;return a(this,e,t,n,i,r),this}function O6(e,t,n,i,r,a){var o=ce({},a,A6),s,l;de(n)||(n=Mt(n)),i===void 0?s=u=>e.touch(n(u)):de(i)?(l=new Fe(null,i,r,!1),s=u=>{l.evaluate(u);const c=n(u),f=l.value;dk(f)?e.pulse(c,f,a):e.update(c,f,o)}):s=u=>e.update(n(u),i,o),t.apply(s)}function T6(e,t,n,i,r,a){if(i===void 0)t.targets().add(n);else{const o=a||{},s=new Fe(null,C6(n,i),r,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}function C6(e,t){return t=de(t)?t:Mt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function $6(e){e.rank=++this._rank}function D6(e){for(var t=[e],n,i,r;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&F("Cycle detected in dataflow graph.")}const bd={},Li=1<<0,ca=1<<1,br=1<<2,R6=Li|ca,I_=Li|br,Ls=Li|ca|br,M_=1<<3,bu=1<<4,j_=1<<5,L_=1<<6;function fa(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const ze=fa.prototype;ze.StopPropagation=bd,ze.ADD=Li,ze.REM=ca,ze.MOD=br,ze.ADD_REM=R6,ze.ADD_MOD=I_,ze.ALL=Ls,ze.REFLOW=M_,ze.SOURCE=bu,ze.NO_SOURCE=j_,ze.NO_FIELDS=L_,ze.fork=function(e){return new fa(this.dataflow).init(this,e)},ze.clone=function(){const e=this.fork(Ls);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Ls|bu)},ze.addAll=function(){let e=this;return!e.source||e.source.length===e.add.length||(e=new fa(this.dataflow).init(this),e.add=e.source),e},ze.init=function(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&L_)&&(n.fields=e.fields),t&Li?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&ca?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&br?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&j_?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},ze.runAfter=function(e){this.dataflow.runAfter(e)},ze.changed=function(e){var t=e||Ls;return t&Li&&this.add.length||t&ca&&this.rem.length||t&br&&this.mod.length},ze.reflow=function(e){if(e)return this.fork(Ls).reflow();var t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(br,P_(this,Li))),this},ze.clean=function(e){return arguments.length?(this.cleans=!!e,this):this.cleans},ze.modifies=function(e){var t=this.fields||(this.fields={});return M(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},ze.modified=function(e,t){var n=this.fields;return(t||this.mod.length)&&n?arguments.length?M(e)?e.some(i=>n[i]):n[e]:!!n:!1},ze.filter=function(e,t){var n=this;return e&Li&&(n.addF=wd(n.addF,t)),e&ca&&(n.remF=wd(n.remF,t)),e&br&&(n.modF=wd(n.modF,t)),e&bu&&(n.srcF=wd(n.srcF,t)),n};function wd(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}ze.materialize=function(e){e=e||Ls;var t=this;return e&Li&&t.addF&&(t.add=P0(t.add,t.addF),t.addF=null),e&ca&&t.remF&&(t.rem=P0(t.rem,t.remF),t.remF=null),e&br&&t.modF&&(t.mod=P0(t.mod,t.modF),t.modF=null),e&bu&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t};function P0(e,t){var n=[];return ra(e,t,i=>n.push(i)),n}function P_(e,t){var n={};return e.visit(t,function(i){n[ee(i)]=1}),i=>n[ee(i)]?null:i}ze.visit=function(e,t){var n=this,i=t,r,a;return e&bu?(ra(n.source,n.srcF,i),n):(e&Li&&ra(n.add,n.addF,i),e&ca&&ra(n.rem,n.remF,i),e&br&&ra(n.mod,n.modF,i),e&M_&&(r=n.source)&&(a=n.add.length+n.mod.length,a===r.length||(a?ra(r,P_(n,I_),i):ra(r,n.srcF,i))),n)};function z0(e,t,n,i){var r=this,a=0,o,s,l,u,c;for(this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n,l=0,u=n.length;l<u;++l){if(o=n[l],o.stamp!==t)continue;if(o.fields){s=r.fields||(r.fields={});for(c in o.fields)s[c]=1}o.changed(r.ADD)&&(a|=r.ADD),o.changed(r.REM)&&(a|=r.REM),o.changed(r.MOD)&&(a|=r.MOD)}this.changes=a}var Ps=P(z0,fa);Ps.fork=function(e){var t=new fa(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,function(n){return t.add.push(n)}),e&t.REM&&this.visit(t.REM,function(n){return t.rem.push(n)}),e&t.MOD&&this.visit(t.MOD,function(n){return t.mod.push(n)})),t},Ps.changed=function(e){return this.changes&e},Ps.modified=function(e){var t=this,n=t.fields;return n&&t.changes&t.MOD?M(e)?e.some(function(i){return n[i]}):n[e]:0},Ps.filter=function(){F("MultiPulse does not support filtering.")},Ps.materialize=function(){F("MultiPulse does not support materialization.")},Ps.visit=function(e,t){var n=this,i=n.pulses,r=i.length,a=0;if(e&n.SOURCE)for(;a<r;++a)i[a].visit(e,t);else for(;a<r;++a)i[a].stamp===n.stamp&&i[a].visit(e,t);return n};async function F6(e,t,n){const i=this,r=[];if(i._pulse)return z_(i);if(i._pending&&await i._pending,t&&await Qf(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const a=++i._clock;i._pulse=new fa(i,a,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=Kf(tu);let o=0,s,l,u;try{for(;i._heap.size()>0;){if(s=i._heap.pop(),s.rank!==s.qrank){i._enqueue(s,!0);continue}l=s.run(i._getPulse(s,e)),l.then?l=await l:l.async&&(r.push(l.async),l=bd),l!==bd&&(s._targets&&s._targets.forEach(c=>i._enqueue(c))),++o}}catch(c){i._heap.clear(),u=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${a}: ${o} operators`),u&&(i._postrun=[],i.error(u)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await Qf(i,c[f].callback)}return n&&await Qf(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function N6(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function I6(e,t,n){return this._pulse?z_(this):(this.evaluate(e,t,n),this)}function M6(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function z_(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function j6(e,t){var n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function L6(e,t){var n=e.source,i=this._clock;return n&&M(n)?new z0(this,i,n.map(r=>r.pulse),t):this._input[e.id]||P6(this._pulse,n&&n.pulse)}function P6(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==bd&&(e.source=t.source),e)}var B0={skip:!1,force:!1};function z6(e,t){var n=t||B0;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function B6(e,t,n){var i=n||B0;return(e.set(t)||i.force)&&this.touch(e,i),this}function U6(e,t,n){this.touch(e,n||B0);var i=new fa(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function q6(e){var t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),B_(t,0,t.length-1,e)),pop:()=>{var n=t.pop(),i;return t.length?(i=t[0],t[0]=n,W6(t,0,e)):i=n,i}}}function B_(e,t,n,i){var r,a,o;for(r=e[n];n>t;){if(o=n-1>>1,a=e[o],i(r,a)<0){e[n]=a,n=o;continue}break}return e[n]=r}function W6(e,t,n){for(var i=t,r=e.length,a=e[t],o=(t<<1)+1,s;o<r;)s=o+1,s<r&&n(e[o],e[s])>=0&&(o=s),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=a,B_(e,i,t,n)}function zs(){this.logger(Bm()),this.logLevel(Pm),this._clock=0,this._rank=0,this._locale=L0();try{this._loader=yd()}catch(e){}this._touched=Kf(tu),this._input={},this._pulse=null,this._heap=q6((e,t)=>e.qrank-t.qrank),this._postrun=[]}var Ae=zs.prototype;Ae.stamp=function(){return this._clock},Ae.loader=function(e){return arguments.length?(this._loader=e,this):this._loader},Ae.locale=function(e){return arguments.length?(this._locale=e,this):this._locale},Ae.cleanThreshold=1e4,Ae.add=c5,Ae.connect=f5,Ae.rank=$6,Ae.rerank=D6,Ae.pulse=U6,Ae.touch=z6,Ae.update=B6,Ae.changeset=fo,Ae.ingest=x6,Ae.parse=w6,Ae.preload=k6,Ae.request=E6,Ae.events=h5,Ae.on=S6,Ae.evaluate=F6,Ae.run=I6,Ae.runAsync=N6,Ae.runAfter=M6,Ae._enqueue=j6,Ae._getPulse=L6;function wu(e){return function(){return this._log[e].apply(this,arguments)}}Ae.logger=function(e){return arguments.length?(this._log=e,this):this._log},Ae.error=wu("error"),Ae.warn=wu("warn"),Ae.info=wu("info"),Ae.debug=wu("debug"),Ae.logLevel=wu("level");function $(e,t){Fe.call(this,e,null,t)}var U0=P($,Fe);U0.run=function(e){if(e.stamp<this.stamp)return e.StopPropagation;var t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},U0.evaluate=function(e){var t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},U0.transform=function(){};var Bs={};function U_(e){var t=q_(e);return t&&t.Definition||null}function q_(e){return e=e&&e.toLowerCase(),Q(Bs,e)?Bs[e]:null}function G6(e){return function(t){for(var n=e.length,i=1,r=String(e[0](t));i<n;++i)r+="|"+e[i](t);return r}}function q0(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:G6(e)}function W_(e,t,n){return n||e+(t?"_"+t:"")}const W0=()=>{},H6={init:W0,add:W0,rem:W0,idx:0},xu={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Eu=Object.keys(xu);function Y6(e,t){return n=>ce({name:e,out:n||e},H6,t)}Eu.forEach(e=>{xu[e]=Y6(e,xu[e])});function G_(e,t){return xu[e](t)}function H_(e,t){return e.idx-t.idx}function V6(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{if(!i.req)return;i.req.forEach(r=>{t[r]||n(t[r]=xu[r]())})};return e.forEach(n),Object.values(t).sort(H_)}function X6(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function J6(e,t){if(e==null||e===""){++this.missing;return}if(e!==e)return;++this.valid,this._ops.forEach(n=>n.add(this,e,t))}function K6(e,t){if(e==null||e===""){--this.missing;return}if(e!==e)return;--this.valid,this._ops.forEach(n=>n.rem(this,e,t))}function Q6(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function Y_(e,t){var n=t||It,i=V6(e),r=e.slice().sort(H_);function a(o){this._ops=i,this._out=r,this.cell=o,this.init()}return a.prototype.init=X6,a.prototype.add=J6,a.prototype.rem=K6,a.prototype.set=Q6,a.prototype.get=n,a.fields=e.map(o=>o.out),a}function*V_(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function G0(e,t,n){var i=Float64Array.from(V_(e,n));return i.sort($s),t.map(r=>J5(i,r))}function H0(e,t){return G0(e,[.25,.5,.75],t)}function Y0(e,t){var n=e.length,i=Y5(e,t),r=H0(e,t),a=(r[2]-r[0])/1.34;return i=Math.min(i,a)||i||Math.abs(r[0])||1,1.06*i*Math.pow(n,-.2)}function X_(e){var t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2],a=e.extent[0],o=e.extent[1],s=e.span||o-a||Math.abs(a)||1,l,u,c,f,d,h,p,g;if(e.step)l=e.step;else if(e.steps){for(d=s/t,h=0,p=e.steps.length;h<p&&e.steps[h]<d;++h);l=e.steps[Math.max(0,h-1)]}else{for(u=Math.ceil(Math.log(t)/i),c=e.minstep||0,l=Math.max(c,Math.pow(n,Math.round(Math.log(s)/i)-u));Math.ceil(s/l)>t;)l*=n;for(h=0,p=r.length;h<p;++h)d=l/r[h],d>=c&&s/d<=t&&(l=d)}return d=Math.log(l),f=d>=0?0:~~(-d/i)+1,g=Math.pow(n,-f-1),(e.nice||e.nice===void 0)&&(d=Math.floor(a/l+g)*l,a=a<d?d-l:d,o=Math.ceil(o/l)*l),{start:a,stop:o===a?a+l:o,step:l}}var Wn=Math.random;function Z6(e){Wn=e}function J_(e,t,n,i){if(!e.length)return[void 0,void 0];var r=Float64Array.from(V_(e,i)),a=r.length,o=t,s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=r[~~(Wn()*a)];c[u]=s/a}return c.sort($s),[sd(c,n/2),sd(c,1-n/2)]}function K_(e,t,n,i){i=i||(d=>d);let r=0,a=1,o=e.length,s=new Float64Array(o),l=i(e[0]),u=l,c=l+t,f;for(;a<o;++a){if(f=i(e[a]),f>=c){for(u=(l+u)/2;r<a;++r)s[r]=u;c=f+t,l=f}u=f}for(u=(l+u)/2;r<a;++r)s[r]=u;return n?e4(s,t+t/4):s}function e4(e,t){let n=e.length,i=0,r=1,a,o;for(;e[i]===e[r];)++r;for(;r<n;){for(a=r+1;e[r]===e[a];)++a;if(e[r]-e[r-1]<t){for(o=r+(i+a-r-r>>1);o<r;)e[o++]=e[r];for(;o>r;)e[o--]=e[i]}i=r,r=a}return e}function t4(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function n4(e,t){t==null&&(t=e,e=0);var n={},i,r,a;return n.min=function(o){return arguments.length?(i=o||0,a=r-i,n):i},n.max=function(o){return arguments.length?(r=o||0,a=r-i,n):r},n.sample=function(){return i+Math.floor(a*Wn())},n.pdf=function(o){return o===Math.floor(o)&&o>=i&&o<r?1/a:0},n.cdf=function(o){var s=Math.floor(o);return s<i?0:s>=r?1:(s-i+1)/a},n.icdf=function(o){return o>=0&&o<=1?i-1+Math.floor(o*a):NaN},n.min(e).max(t)}const Q_=Math.sqrt(2*Math.PI),i4=Math.SQRT2;let ku=NaN;function xd(e,t){e=e||0,t=t??1;let n=0,i=0,r,a;if(ku===ku)n=ku,ku=NaN;else{do n=Wn()*2-1,i=Wn()*2-1,r=n*n+i*i;while(r===0||r>1);a=Math.sqrt(-2*Math.log(r)/r),n*=a,ku=i*a}return e+n*t}function V0(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*Q_)}function Ed(e,t,n){t=t||0,n=n??1;let i,r=(e-t)/n,a=Math.abs(r);if(a>37)i=0;else{let o,s=Math.exp(-a*a/2);a<7.07106781186547?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,i=s*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,i=i/o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,i=s/o/2.506628274631)}return r>0?1-i:i}function kd(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*i4*r4(2*e-1)}function r4(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=Infinity,n*e}function X0(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>xd(n,i),pdf:a=>V0(a,n,i),cdf:a=>Ed(a,n,i),icdf:a=>kd(a,n,i)};return r.mean(e).stdev(t)}function J0(e,t){var n=X0(),i={},r=0;return i.data=function(a){return arguments.length?(e=a,r=a?a.length:0,i.bandwidth(t)):e},i.bandwidth=function(a){return arguments.length?(t=a,!t&&e&&(t=Y0(e)),i):t},i.sample=function(){return e[~~(Wn()*r)]+t*n.sample()},i.pdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.pdf((a-e[s])/t);return o/t/r},i.cdf=function(a){for(var o=0,s=0;s<r;++s)o+=n.cdf((a-e[s])/t);return o/r},i.icdf=function(){throw Error("KDE icdf not supported.")},i.data(e)}function K0(e,t){return e=e||0,t=t??1,Math.exp(e+xd()*t)}function Q0(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*Q_*e)}function Z0(e,t,n){return Ed(Math.log(e),t,n)}function ev(e,t,n){return Math.exp(kd(e,t,n))}function Z_(e,t){var n,i,r={mean:function(a){return arguments.length?(n=a||0,r):n},stdev:function(a){return arguments.length?(i=a??1,r):i},sample:()=>K0(n,i),pdf:a=>Q0(a,n,i),cdf:a=>Z0(a,n,i),icdf:a=>ev(a,n,i)};return r.mean(e).stdev(t)}function eA(e,t){var n={},i=0,r;function a(o){var s=[],l=0,u;for(u=0;u<i;++u)l+=s[u]=o[u]==null?1:+o[u];for(u=0;u<i;++u)s[u]/=l;return s}return n.weights=function(o){return arguments.length?(r=a(t=o||[]),n):t},n.distributions=function(o){return arguments.length?(o?(i=o.length,e=o):(i=0,e=[]),n.weights(t)):e},n.sample=function(){for(var o=Wn(),s=e[i-1],l=r[0],u=0;u<i-1;l+=r[++u])if(o<l){s=e[u];break}return s.sample()},n.pdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].pdf(o);return s},n.cdf=function(o){for(var s=0,l=0;l<i;++l)s+=r[l]*e[l].cdf(o);return s},n.icdf=function(){throw Error("Mixture icdf not supported.")},n.distributions(e).weights(t)}function tv(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Wn()}function nv(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function iv(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function rv(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function tA(e,t){var n,i,r={min:function(a){return arguments.length?(n=a||0,r):n},max:function(a){return arguments.length?(i=a??1,r):i},sample:()=>tv(n,i),pdf:a=>nv(a,n,i),cdf:a=>iv(a,n,i),icdf:a=>rv(a,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function _u(e,t,n,i){const r=i-e*e,a=Math.abs(r)<1e-24?0:(n-e*t)/r,o=t-a*e;return[o,a]}function _d(e,t,n,i){e=e.filter(h=>{let p=t(h),g=n(h);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&e.sort((h,p)=>t(h)-t(p));const r=e.length,a=new Float64Array(r),o=new Float64Array(r);let s=0,l=0,u=0,c,f,d;for(d of e)a[s]=c=+t(d),o[s]=f=+n(d),++s,l+=(c-l)/s,u+=(f-u)/s;for(s=0;s<r;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function Au(e,t,n,i){let r=-1,a,o;for(let s of e)a=t(s),o=n(s),a!=null&&(a=+a)>=a&&o!=null&&(o=+o)>=o&&i(a,o,++r)}function Us(e,t,n,i,r){let a=0,o=0;return Au(e,t,n,(s,l)=>{const u=l-r(s),c=l-i;a+=u*u,o+=c*c}),1-a/o}function av(e,t,n){let i=0,r=0,a=0,o=0,s=0;Au(e,t,n,(c,f)=>{++s,i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=_u(i,r,a,o),u=c=>l[0]+l[1]*c;return{coef:l,predict:u,rSquared:Us(e,t,n,r,u)}}function nA(e,t,n){let i=0,r=0,a=0,o=0,s=0;Au(e,t,n,(c,f)=>{++s,c=Math.log(c),i+=(c-i)/s,r+=(f-r)/s,a+=(c*f-a)/s,o+=(c*c-o)/s});const l=_u(i,r,a,o),u=c=>l[0]+l[1]*Math.log(c);return{coef:l,predict:u,rSquared:Us(e,t,n,r,u)}}function iA(e,t,n){const[i,r,a,o]=_d(e,t,n);let s=0,l=0,u=0,c=0,f=0,d,h,p;Au(e,t,n,(y,b)=>{d=i[f++],h=Math.log(b),p=d*b,s+=(b*h-s)/f,l+=(p-l)/f,u+=(p*h-u)/f,c+=(d*p-c)/f});const[g,m]=_u(l/o,s/o,u/o,c/o),v=y=>Math.exp(g+m*(y-a));return{coef:[Math.exp(g-m*a),m],predict:v,rSquared:Us(e,t,n,o,v)}}function rA(e,t,n){let i=0,r=0,a=0,o=0,s=0,l=0;Au(e,t,n,(f,d)=>{const h=Math.log(f),p=Math.log(d);++l,i+=(h-i)/l,r+=(p-r)/l,a+=(h*p-a)/l,o+=(h*h-o)/l,s+=(d-s)/l});const u=_u(i,r,a,o),c=f=>u[0]*Math.pow(f,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Us(e,t,n,s,c)}}function ov(e,t,n){const[i,r,a,o]=_d(e,t,n),s=i.length;let l=0,u=0,c=0,f=0,d=0,h,p,g,m;for(h=0;h<s;)p=i[h],g=r[h++],m=p*p,l+=(m-l)/h,u+=(m*p-u)/h,c+=(m*m-c)/h,f+=(p*g-f)/h,d+=(m*g-d)/h;const v=c-l*l,y=l*v-u*u,b=(d*l-f*u)/y,E=(f*v-d*u)/y,x=-b*l,k=w=>(w=w-a,b*w*w+E*w+x+o);return{coef:[x-E*a+b*a*a+o,E-2*b*a,b],predict:k,rSquared:Us(e,t,n,o,k)}}function aA(e,t,n,i){if(i===1)return av(e,t,n);if(i===2)return ov(e,t,n);const[r,a,o,s]=_d(e,t,n),l=r.length,u=[],c=[],f=i+1;let d,h,p,g,m;for(d=0;d<f;++d){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d)*a[p];for(u.push(g),m=new Float64Array(f),h=0;h<f;++h){for(p=0,g=0;p<l;++p)g+=Math.pow(r[p],d+h);m[h]=g}c.push(m)}c.push(u);const v=o4(c),y=b=>{b-=o;let E=s+v[0]+v[1]*b+v[2]*b*b;for(d=3;d<f;++d)E+=v[d]*Math.pow(b,d);return E};return{coef:a4(f,v,-o,s),predict:y,rSquared:Us(e,t,n,s,y)}}function a4(e,t,n,i){const r=Array(e);let a,o,s,l;for(a=0;a<e;++a)r[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,r[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,r[a-o]+=s*Math.pow(n,o)*l;return r[0]+=i,r}function o4(e){const t=e.length-1,n=[];let i,r,a,o,s;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(a=i;a<t+1;++a)s=e[a][i],e[a][i]=e[a][o],e[a][o]=s;for(r=i+1;r<t;++r)for(a=t;a>=i;a--)e[a][r]-=e[a][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(s=0,a=r+1;a<t;++a)s+=e[a][r]*n[a];n[r]=(e[t][r]-s)/e[r][r]}return n}const oA=2,sA=1e-12;function lA(e,t,n,i){const[r,a,o,s]=_d(e,t,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let h=-1;++h<=oA;){const p=[0,u-1];for(let m=0;m<l;++m){const v=r[m],y=p[0],b=p[1],E=v-r[y]>r[b]-v?y:b;let x=0,k=0,w=0,A=0,_=0,O=1/Math.abs(r[E]-v||1);for(let D=y;D<=b;++D){const I=r[D],C=a[D],N=s4(Math.abs(v-I)*O)*d[D],W=I*N;x+=N,k+=W,w+=C*N,A+=C*W,_+=I*W}const[S,T]=_u(k/x,w/x,A/x,_/x);c[m]=S+T*v,f[m]=Math.abs(a[m]-c[m]),l4(r,m+1,p)}if(h===oA)break;const g=Tk(f);if(Math.abs(g)<sA)break;for(let m=0,v,y;m<l;++m)v=f[m]/(6*g),d[m]=v>=1?sA:(y=1-v*v)*y}return u4(r,c,o,s)}function s4(e){return(e=1-e*e*e)*e*e}function l4(e,t,n){let i=e[t],r=n[0],a=n[1]+1;if(a>=e.length)return;for(;t>r&&e[a]-i<=i-e[r];)n[0]=++r,n[1]=a,++a}function u4(e,t,n,i){const r=e.length,a=[];let o=0,s=0,l=[],u;for(;o<r;++o)u=e[o]+n,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=i,l=[u,t[o]],a.push(l));return l[1]+=i,a}const c4=.1*Math.PI/180;function Ad(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=h=>[h,e(h)],a=t[0],o=t[1],s=o-a,l=s/i,u=[r(a)],c=[];if(n===i){for(let h=1;h<i;++h)u.push(r(a+h/n*s));return u.push(r(o)),u}else{c.push(r(o));for(let h=n;--h>0;)c.push(r(a+h/n*s))}let f=u[0],d=c[c.length-1];for(;d;){const h=r((f[0]+d[0])/2);h[0]-f[0]>=l&&f4(f,h,d)>c4?c.push(h):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function f4(e,t,n){const i=Math.atan2(n[1]-e[1],n[0]-e[0]),r=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(i-r)}function sv(e){this._key=e?ci(e):ee,this.reset()}var At=sv.prototype;At.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},At.add=function(e){this._add.push(e)},At.rem=function(e){this._rem.push(e)},At.values=function(){if(this._get=null,this._rem.length===0)return this._add;var e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,a=Array(i-r),o={},s,l,u;for(s=0;s<r;++s)o[n(t[s])]=1;for(s=0,l=0;s<i;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},At.distinct=function(e){for(var t=this.values(),n=t.length,i={},r=0,a;--n>=0;)a=e(t[n])+"",Q(i,a)||(i[a]=1,++r);return r},At.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=tk(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},At.argmin=function(e){return this.extent(e)[0]||{}},At.argmax=function(e){return this.extent(e)[1]||{}},At.min=function(e){var t=this.extent(e)[0];return t!=null?e(t):void 0},At.max=function(e){var t=this.extent(e)[1];return t!=null?e(t):void 0},At.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=H0(this.values(),e),this._get=e),this._q},At.q1=function(e){return this.quartile(e)[0]},At.q2=function(e){return this.quartile(e)[1]},At.q3=function(e){return this.quartile(e)[2]},At.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=J_(this.values(),1e3,.05,e),this._get=e),this._ci},At.ci0=function(e){return this.ci(e)[0]},At.ci1=function(e){return this.ci(e)[1]};function xo(e){$.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}xo.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Eu},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Gn=P(xo,$);Gn.transform=function(e,t){var n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,a=>n.add(a))):(n.value=n.value||n.init(e),t.visit(t.REM,a=>n.rem(a)),t.visit(t.ADD,a=>n.add(a))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},Gn.cross=function(){var e=this,t=e.value,n=e._dnames,i=n.map(function(){return{}}),r=n.length;function a(s){var l,u,c,f;for(l in s)for(c=s[l].tuple,u=0;u<r;++u)i[u][f=c[n[u]]]=f}a(e._prev),a(t);function o(s,l,u){var c=n[u],f=i[u++],d,h;for(d in f)l[c]=f[d],h=s?s+"|"+d:d,u<r?o(h,l,u):t[h]||e.cell(h,l)}o("",{},0)},Gn.init=function(e){var t=this._inputs=[],n=this._outputs=[],i={};function r(m){for(var v=G(Nt(m)),y=0,b=v.length,E;y<b;++y)i[E=v[y]]||(i[E]=1,t.push(E))}this._dims=G(e.groupby),this._dnames=this._dims.map(function(m){var v=Ye(m);return r(m),n.push(v),v}),this.cellkey=e.key?e.key:q0(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={},c,f,d,h,p,g;for(l!==o.length&&F("Unmatched number of fields and aggregate ops."),g=0;g<l;++g){if(c=a[g],f=o[g],c==null&&f!=="count"&&F("Null aggregate field specified."),h=Ye(c),p=W_(f,h,s[g]),n.push(p),f==="count"){this._counts.push(p);continue}d=u[h],d||(r(c),d=u[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(G_(f,p))}return this._measures=this._measures.map(function(m){return Y_(m,m.field)}),{}},Gn.cellkey=q0(),Gn.cell=function(e,t){var n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},Gn.newcell=function(e,t){var n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){var i=this._measures,r=i.length,a;for(n.agg=Array(r),a=0;a<r;++a)n.agg[a]=new i[a](n)}return n.store&&(n.data=new sv()),n},Gn.newtuple=function(e,t){var n=this._dnames,i=this._dims,r={},a,o;for(a=0,o=i.length;a<o;++a)r[n[a]]=i[a](e);return t?fk(t.tuple,r):ke(r)},Gn.clean=function(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},Gn.add=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num+=1,this._countOnly)return;for(n.store&&n.data.add(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].add(i[r].get(e),e)},Gn.rem=function(e){var t=this.cellkey(e),n=this.cell(t,e),i,r,a;if(n.num-=1,this._countOnly)return;for(n.store&&n.data.rem(e),i=n.agg,r=0,a=i.length;r<a;++r)i[r].rem(i[r].get(e),e)},Gn.celltuple=function(e){var t=e.tuple,n=this._counts,i,r,a;for(e.store&&e.data.values(),r=0,a=n.length;r<a;++r)t[n[r]]=e.num;if(!this._countOnly)for(i=e.agg,r=0,a=i.length;r<a;++r)i[r].set(t);return t},Gn.changes=function(e){var t=this._adds,n=this._mods,i=this._prev,r=this._drop,a=e.add,o=e.rem,s=e.mod,l,u,c,f;if(i)for(u in i)l=i[u],(!r||l.num)&&o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(l.num===0&&r?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e};const d4=1e-14;function lv(e){$.call(this,null,e)}lv.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var uA=P(lv,$);uA.transform=function(e,t){var n=e.interval!==!1,i=this._bins(e),r=i.start,a=i.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1],u;return e.modified()?(t=t.reflow(!0),u=t.SOURCE):u=t.modified(Nt(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?function(c){var f=i(c);c[s]=f,c[l]=f==null?null:r+a*(1+(f-r)/a)}:function(c){c[s]=i(c)}),t.modifies(n?o:s)},uA._bins=function(e){if(this.value&&!e.modified())return this.value;var t=e.field,n=X_(e),i=n.step,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i,o,s;(o=e.anchor)!=null&&(s=o-(r+i*Math.floor((o-r)/i)),r+=s,a+=s);var l=function(u){var c=Xt(t(u));return c==null?null:c<r?-Infinity:c>a?Infinity:(c=Math.max(r,Math.min(c,a-i)),r+i*Math.floor(d4+(c-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=dn(l,Nt(t),e.name||"bin_"+Ye(t))};function cA(e,t,n){var i=e,r=t||[],a=n||[],o={},s=0;return{add:function(l){a.push(l)},remove:function(l){o[i(l)]=++s},size:function(){return r.length},data:function(l,u){return s&&(r=r.filter(function(c){return!o[i(c)]}),o={},s=0),u&&l&&r.sort(l),a.length&&(r=l?ok(l,r,a.sort(l)):r.concat(a),a=[]),r}}}function uv(e){$.call(this,[],e)}uv.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};var h4=P(uv,$);h4.transform=function(e,t){var n=t.fork(t.ALL),i=cA(ee,this.value,n.materialize(n.ADD).add),r=e.sort,a=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(co(r),a),t.source&&t.source.root&&(this.value.root=t.source.root),n};function fA(e){Fe.call(this,null,p4,e)}P(fA,Fe);function p4(e){return this.value&&!e.modified()?this.value:Gm(e.fields,e.orders)}function cv(e){$.call(this,null,e)}cv.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function g4(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}var fv=P(cv,$);fv.transform=function(e,t){function n(f){return function(d){for(var h=g4(s(d),e.case,a)||[],p,g=0,m=h.length;g<m;++g)o.test(p=h[g])||f(p)}}var i=this._parameterCheck(e,t),r=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n(function(f){r[f]=1+(r[f]||0)}),c=n(function(f){r[f]-=1});return i?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},fv._parameterCheck=function(e,t){var n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},fv._finish=function(e,t){var n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS),s,l,u;for(s in n)l=i[s],u=n[s]||0,!l&&u?(i[s]=l=ke({}),l[r]=s,l[a]=u,o.add.push(l)):u===0?(l&&o.rem.push(l),n[s]=null,i[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)};function dv(e){$.call(this,null,e)}dv.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};var m4=P(dv,$);m4.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=this.value,r=e.as||["a","b"],a=r[0],o=r[1],s=!i||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");return s?(i&&(n.rem=i),i=t.materialize(t.SOURCE).source,n.add=this.value=v4(i,a,o,e.filter||fi)):n.mod=i,n.source=this.value,n.modifies(r)};function v4(e,t,n,i){for(var r=[],a={},o=e.length,s=0,l,u;s<o;++s)for(a[t]=u=e[s],l=0;l<o;++l)a[n]=e[l],i(a)&&(r.push(ke(a)),a={},a[t]=u);return r}var dA={kde:J0,mixture:eA,normal:X0,lognormal:Z_,uniform:tA},y4="distributions",hA="function",b4="field";function pA(e,t){var n=e[hA];Q(dA,n)||F("Unknown distribution function: "+n);var i=dA[n]();for(var r in e)r===b4?i.data((e.from||t()).map(e[r])):r===y4?i[r](e[r].map(function(a){return pA(a,t)})):typeof i[r]===hA&&i[r](e[r]);return i}function hv(e){$.call(this,null,e)}var gA=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],w4={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:gA},{name:"weights",type:"number",array:!0}]};hv.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:gA.concat(w4)},{name:"as",type:"string",array:!0,default:["value","density"]}]};var x4=P(hv,$);x4.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){var i=pA(e.distribution,E4(t)),r=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200,o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&F("Invalid density method: "+o),!e.extent&&!i.data&&F("Missing density extent parameter."),o=i[o];var s=e.as||["value","density"],l=e.extent||Mi(i.data()),u=Ad(o,l,r,a).map(c=>{var f={};return f[s[0]]=c[0],f[s[1]]=c[1],ke(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function E4(e){return function(){return e.materialize(e.SOURCE).source}}function mA(e,t){return e?e.map(function(n,i){return t[i]||Ye(n)}):null}function pv(e,t,n){var i=[],r=function(f){return f(l)},a,o,s,l,u,c;if(t==null)i.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(r),c=a[u],c||(a[u]=c=[],c.dims=u,i.push(c)),c.push(n(l));return i}const vA="bin";function gv(e){$.call(this,null,e)}gv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:vA}]};const k4=P(gv,$);k4.transform=function(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=pv(t.source,e.groupby,It),r=e.smooth||!1,a=e.field,o=e.step||_4(n,a),s=co((p,g)=>a(p)-a(g)),l=e.as||vA,u=i.length;let c=Infinity,f=-Infinity,d=0,h;for(;d<u;++d){const p=i[d].sort(s);h=-1;for(const g of K_(p,o,r,a))g<c&&(c=g),g>f&&(f=g),p[++h][l]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(l)};function _4(e,t){return ru(Mi(e,t))/30}function yA(e){Fe.call(this,null,A4,e),this.modified(!0)}P(yA,Fe);function A4(e){var t=e.expr;return this.value&&!e.modified("expr")?this.value:dn(n=>t(n,e),Nt(t),Ye(t))}function mv(e){$.call(this,[void 0,void 0],e)}mv.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};var S4=P(mv,$);S4.transform=function(e,t){var n=this.value,i=e.field,r=n[0],a=n[1],o;if(o=t.changed()||t.modified(i.fields)||e.modified("field"),(o||r==null)&&(r=Infinity,a=-Infinity),t.visit(o?t.SOURCE:t.ADD,function(s){var l=Xt(i(s));l!=null&&(l<r&&(r=l),l>a&&(a=l))}),!Number.isFinite(r)||!Number.isFinite(a)){let s=Ye(i);s&&(s=` for field "${s}"`),t.dataflow.warn(`Infinite extent${s}: [${r}, ${a}]`),r=a=void 0}this.value=[r,a]};function vv(e,t){Fe.call(this,e),this.parent=t,this.count=0}var qs=P(vv,Fe);qs.connect=function(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},qs.add=function(e){this.count+=1,this.value.add.push(e)},qs.rem=function(e){this.count-=1,this.value.rem.push(e)},qs.mod=function(e){this.value.mod.push(e)},qs.init=function(e){this.value.init(e,e.NO_SOURCE)},qs.evaluate=function(){return this.value};function Sd(e){$.call(this,{},e),this._keys=Ts();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}const Su=P(Sd,$);Su.activate=function(e){this._targets[this._targets.active++]=e},Su.subflow=function(e,t,n,i){let r=this.value,a=Q(r,e)&&r[e],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=i||(s=this._group[e])&&s.tuple,o=n.dataflow,a=new vv(n.fork(n.NO_SOURCE),this),o.add(a).connect(t(o,e,s)),r[e]=a,this.activate(a)),a},Su.clean=function(){const e=this.value;for(const t in e)if(e[t].count===0){const n=e[t].detachSubflow;n&&n(),delete e[t]}},Su.initTargets=function(){const e=this._targets,t=e.length;for(let n=0;n<t&&e[n]!=null;++n)e[n]=null;e.active=0},Su.transform=function(e,t){const n=t.dataflow,i=e.key,r=e.subflow,a=this._keys,o=e.modified("key"),s=l=>this.subflow(l,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,l=>{const u=ee(l),c=a.get(u);c!==void 0&&(a.delete(u),s(c).rem(l))}),t.visit(t.ADD,l=>{const u=i(l);a.set(ee(l),u),s(u).add(l)}),o||t.modified(i.fields)?t.visit(t.MOD,l=>{const u=ee(l),c=a.get(u),f=i(l);c===f?s(f).mod(l):(a.set(u,f),s(c).rem(l),s(f).add(l))}):t.changed(t.MOD)&&t.visit(t.MOD,l=>{s(a.get(ee(l))).mod(l)}),o&&t.visit(t.REFLOW,l=>{const u=ee(l),c=a.get(u),f=i(l);c!==f&&(a.set(u,f),s(c).rem(l),s(f).add(l))}),t.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t};function bA(e){Fe.call(this,null,O4,e)}P(bA,Fe);function O4(e){return this.value&&!e.modified()?this.value:M(e.name)?G(e.name).map(function(t){return ci(t)}):ci(e.name,e.as)}function yv(e){$.call(this,Ts(),e)}yv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};var T4=P(yv,$);T4.transform=function(e,t){var n=t.dataflow,i=this.value,r=t.fork(),a=r.add,o=r.rem,s=r.mod,l=e.expr,u=!0;t.visit(t.REM,function(f){var d=ee(f);i.has(d)?i.delete(d):o.push(f)}),t.visit(t.ADD,function(f){l(f,e)?a.push(f):i.set(ee(f),1)});function c(f){var d=ee(f),h=l(f,e),p=i.get(d);h&&p?(i.delete(d),a.push(f)):!h&&!p?(i.set(d,1),o.push(f)):u&&h&&!p&&s.push(f)}return t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r};function bv(e){$.call(this,[],e)}bv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};var C4=P(bv,$);C4.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=mA(i,e.as||[]),a=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,function(s){for(var l=i.map(p=>p(s)),u=l.reduce((p,g)=>Math.max(p,g.length),0),c=0,f,d,h;c<u;++c){for(d=Km(s),f=0;f<o;++f)d[r[f]]=(h=l[f][c])==null?null:h;a&&(d[a]=c),n.add.push(d)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)};function wv(e){$.call(this,[],e)}wv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};var $4=P(wv,$);$4.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(Ye),a=e.as||["key","value"],o=a[0],s=a[1],l=i.length;return n.rem=this.value,t.visit(t.SOURCE,function(u){for(var c=0,f;c<l;++c)f=Km(u),f[o]=r[c],f[s]=i[c](u),n.add.push(f)}),this.value=n.source=n.add,n.modifies(a)};function xv(e){$.call(this,null,e)}xv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};var D4=P(xv,$);D4.transform=function(e,t){var n=e.expr,i=e.as,r=e.modified(),a=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(a,o=>o[i]=n(o,e))};function wA(e){$.call(this,[],e)}var R4=P(wA,$);R4.transform=function(e,t){var n=this.value,i=t.fork(t.ALL),r=e.size-n.length,a=e.generator,o,s,l;if(r>0){for(o=[];--r>=0;)o.push(l=ke(a(e))),n.push(l);i.add=i.add.length?i.materialize(i.ADD).add.concat(o):o}else s=n.slice(0,-r),i.rem=i.rem.length?i.materialize(i.REM).rem.concat(s):s,n=n.slice(-r);return i.source=this.value=n,i};var Od={value:"value",median:Tk,mean:K5,min:f0,max:po},F4=[];function Ev(e){$.call(this,[],e)}Ev.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};var N4=P(Ev,$);function I4(e){var t=e.method||Od.value,n;if(Od[t]==null)F("Unrecognized imputation method: "+t);else return t===Od.value?(n=e.value!==void 0?e.value:0,function(){return n}):Od[t]}function M4(e){var t=e.field;return function(n){return n?t(n):NaN}}N4.transform=function(e,t){var n=t.fork(t.ALL),i=I4(e),r=M4(e),a=Ye(e.field),o=Ye(e.key),s=(e.groupby||[]).map(Ye),l=j4(t.source,e.groupby,e.key,e.keyvals),u=[],c=this.value,f=l.domain.length,d,h,p,g,m,v,y,b,E,x;for(m=0,b=l.length;m<b;++m)for(d=l[m],p=d.values,h=NaN,y=0;y<f;++y){if(d[y]!=null)continue;for(g=l.domain[y],x={_impute:!0},v=0,E=p.length;v<E;++v)x[s[v]]=p[v];x[o]=g,x[a]=Number.isNaN(h)?h=i(d,r):h,u.push(ke(x))}return u.length&&(n.add=n.materialize(n.ADD).add.concat(u)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=u,n};function j4(e,t,n,i){var r=function(v){return v(m)},a=[],o=i?i.slice():[],s={},l={},u,c,f,d,h,p,g,m;for(o.forEach(function(v,y){s[v]=y+1}),d=0,g=e.length;d<g;++d)m=e[d],p=n(m),h=s[p]||(s[p]=o.push(p)),c=(u=t?t.map(r):F4)+"",(f=l[c])||(f=l[c]=[],a.push(f),f.values=u),f[h-1]=m;return a.domain=o,a}function kv(e){xo.call(this,e)}kv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Eu},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var xA=P(kv,xo);xA.transform=function(e,t){var n=this,i=e.modified(),r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,function(a){n.add(a)})):(r=n.value=n.value||this.init(e),t.visit(t.REM,function(a){n.rem(a)}),t.visit(t.ADD,function(a){n.add(a)})),n.changes(),t.visit(t.SOURCE,function(a){ce(a,r[n.cellkey(a)].tuple)}),t.reflow(i).modifies(this._outputs)},xA.changes=function(){var e=this._adds,t=this._mods,n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0};function _v(e){$.call(this,null,e)}_v.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};var L4=P(_v,$);L4.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=pv(i,e.groupby,e.field),a=(e.groupby||[]).map(Ye),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;s!=="pdf"&&s!=="cdf"&&F("Invalid density method: "+s),e.resolve==="shared"&&(c||(c=Mi(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const p=J0(h,o)[s],g=e.counts?h.length:1,m=c||Mi(h);Ad(p,m,f,d).forEach(v=>{const y={};for(let b=0;b<a.length;++b)y[a[b]]=h.dims[b];y[l[0]]=v[0],y[l[1]]=v[1]*g,u.push(ke(y))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n};function EA(e){Fe.call(this,null,P4,e)}P(EA,Fe);function P4(e){return this.value&&!e.modified()?this.value:Ym(e.fields,e.flat)}function kA(e){$.call(this,[],e),this._pending=null}var z4=P(kA,$);z4.transform=function(e,t){const n=t.dataflow;if(this._pending)return Av(this,t,this._pending);if(B4(e))return t.StopPropagation;if(e.values)return Av(this,t,n.parse(e.values,e.format));if(e.async){const i=n.request(e.url,e.format).then(r=>(this._pending=G(r.data),a=>a.touch(this)));return{async:i}}else return n.request(e.url,e.format).then(i=>Av(this,t,G(i.data)))};function B4(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function Av(e,t,n){n.forEach(ke);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function Sv(e){$.call(this,{},e)}Sv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};var U4=P(Sv,$);U4.transform=function(e,t){var n=t,i=e.as,r=e.fields,a=e.index,o=e.values,s=e.default==null?null:e.default,l=e.modified(),u=l?t.SOURCE:t.ADD,c=r.length,f,d,h;return o?(d=o.length,c>1&&!i&&F('Multi-field lookup requires explicit "as" parameter.'),i&&i.length!==c*d&&F('The "as" parameter has too few output field names.'),i=i||o.map(Ye),f=function(p){for(var g=0,m=0,v,y;g<c;++g)if(y=a.get(r[g](p)),y==null)for(v=0;v<d;++v,++m)p[i[m]]=s;else for(v=0;v<d;++v,++m)p[i[m]]=o[v](y)}):(i||F("Missing output field names."),f=function(p){for(var g=0,m;g<c;++g)m=a.get(r[g](p)),p[i[g]]=m??s}),l?n=t.reflow(!0):(h=r.some(function(p){return t.modified(p.fields)}),u|=h?t.MOD:0),t.visit(u,f),n.modifies(i)};function _A(e){Fe.call(this,null,q4,e)}P(_A,Fe);function q4(e){if(this.value&&!e.modified())return this.value;var t=Infinity,n=-Infinity,i=e.extents,r,a,o;for(r=0,a=i.length;r<a;++r)o=i[r],o[0]<t&&(t=o[0]),o[1]>n&&(n=o[1]);return[t,n]}function AA(e){Fe.call(this,null,W4,e)}P(AA,Fe);function W4(e){return this.value&&!e.modified()?this.value:e.values.reduce(function(t,n){return t.concat(n)},[])}function Ov(e){$.call(this,null,e)}P(Ov,$),Ov.prototype.transform=function(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)};function Tv(e){xo.call(this,e)}Tv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Eu,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var Cv=P(Tv,xo);Cv._transform=Cv.transform,Cv.transform=function(e,t){return this._transform(G4(e,t),t)};function G4(e,t){var n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",a=Nt(n).concat(Nt(i)),o=Y4(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(function(){return r}),fields:o.map(function(s){return H4(s,n,i,a)}),as:o.map(function(s){return s+""}),modified:e.modified.bind(e)}}function H4(e,t,n,i){return dn(function(r){return t(r)===e?n(r):NaN},i,e+"")}function Y4(e,t,n){var i={},r=[];return n.visit(n.SOURCE,function(a){var o=e(a);i[o]||(i[o]=1,r.push(o))}),r.sort(function(a,o){return(a<o||a==null)&&o!=null?-1:(a>o||o==null)&&a!=null?1:(o=o instanceof Date?+o:o,a=a instanceof Date?+a:a)!==a&&o===o?-1:o!==o&&a===a?1:0}),t?r.slice(0,t):r}function SA(e){Sd.call(this,e)}const V4=P(SA,Sd);V4.transform=function(e,t){const n=e.subflow,i=e.field,r=a=>this.subflow(ee(a),n,t,a);return(e.modified("field")||i&&t.modified(Nt(i)))&&F("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,a=>{const o=r(a);i(a).forEach(s=>o.mod(s))}),t.visit(t.ADD,a=>{const o=r(a);i(a).forEach(s=>o.add(ke(s)))}),t.visit(t.REM,a=>{const o=r(a);i(a).forEach(s=>o.rem(s))})):(t.visit(t.MOD,a=>r(a).mod(a)),t.visit(t.ADD,a=>r(a).add(a)),t.visit(t.REM,a=>r(a).rem(a))),t.clean()&&t.runAfter(()=>this.clean()),t};function $v(e){$.call(this,null,e)}$v.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};var X4=P($v,$);X4.transform=function(e,t){var n=e.fields,i=mA(e.fields,e.as||[]),r=n?function(s,l){return J4(s,l,n,i)}:Qm,a,o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),a=t.fork(t.NO_SOURCE),t.visit(t.REM,function(s){var l=ee(s);a.rem.push(o[l]),o[l]=null}),t.visit(t.ADD,function(s){var l=r(s,ke({}));o[ee(s)]=l,a.add.push(l)}),t.visit(t.MOD,function(s){a.mod.push(r(s,o[ee(s)]))}),a};function J4(e,t,n,i){for(var r=0,a=n.length;r<a;++r)t[i[r]]=n[r](e);return t}function OA(e){$.call(this,null,e)}var K4=P(OA,$);K4.transform=function(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Dv(e){$.call(this,null,e)}Dv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};var Q4=P(Dv,$),Z4=1e-14;Q4.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,a=pv(r,e.groupby,e.field),o=(e.groupby||[]).map(Ye),s=[],l=e.step||.01,u=e.probs||ho(l/2,1-Z4,l),c=u.length;return a.forEach(f=>{const d=G0(f,u);for(let h=0;h<c;++h){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[i[0]]=u[h],p[i[1]]=d[h],s.push(ke(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s,n};function TA(e){$.call(this,null,e)}var e8=P(TA,$);e8.transform=function(e,t){var n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{var a=ee(r);n.rem.push(i[a]),i[a]=null}),t.visit(t.ADD,r=>{var a=Km(r);i[ee(r)]=a,n.add.push(a)}),t.visit(t.MOD,r=>{var a=i[ee(r)],o;for(o in r)a[o]=r[o],n.modifies(o);n.mod.push(a)})),n};function Rv(e){$.call(this,[],e),this.count=0}Rv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};var t8=P(Rv,$);t8.transform=function(e,t){var n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,a=this.value,o=this.count,s=0,l=a.reduce(function(d,h){return d[ee(h)]=1,d},{});function u(d){var h,p;a.length<r?a.push(d):(p=~~((o+1)*Wn()),p<a.length&&p>=s&&(h=a[p],l[ee(h)]&&n.rem.push(h),a[p]=d)),++o}if(t.rem.length&&(t.visit(t.REM,function(d){var h=ee(d);l[h]&&(l[h]=-1,n.rem.push(d)),--o}),a=a.filter(function(d){return l[ee(d)]!==-1})),(t.rem.length||i)&&a.length<r&&t.source&&(s=o=a.length,t.visit(t.SOURCE,function(d){l[ee(d)]||u(d)}),s=-1),i&&a.length>r){for(var c=0,f=a.length-r;c<f;++c)l[ee(a[c])]=-1,n.rem.push(a[c]);a=a.slice(f)}return t.mod.length&&t.visit(t.MOD,function(d){l[ee(d)]&&n.mod.push(d)}),t.add.length&&t.visit(t.ADD,u),(t.add.length||s<0)&&(n.add=a.filter(function(d){return!l[ee(d)]})),this.count=o,this.value=n.source=a,n};function Fv(e){$.call(this,null,e)}Fv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};var n8=P(Fv,$);n8.transform=function(e,t){if(this.value&&!e.modified())return;var n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=ho(e.start,e.stop,e.step||1).map(function(r){var a={};return a[i]=r,ke(a)}),n.add=t.add.concat(this.value),n};function CA(e){$.call(this,null,e),this.modified(!0)}var i8=P(CA,$);i8.transform=function(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation};function Nv(e){$.call(this,null,e)}const $A=["unit0","unit1"];Nv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:g0,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:$A}]};var DA=P(Nv,$);DA.transform=function(e,t){var n=e.field,i=e.interval!==!1,r=e.timezone==="utc",a=this._floor(e,t),o=(r?Ms:Is)(a.unit).offset,s=e.as||$A,l=s[0],u=s[1],c=a.start||Infinity,f=a.stop||-Infinity,d=a.step,h=t.ADD;return(e.modified()||t.modified(Nt(n)))&&(t=t.reflow(!0),h=t.SOURCE,c=Infinity,f=-Infinity),t.visit(h,function(p){var g=n(p),m,v;g==null?(p[l]=null,i&&(p[u]=null)):(p[l]=m=v=a(g),i&&(p[u]=v=o(m,d)),m<c&&(c=m),v>f&&(f=v))}),a.start=c,a.stop=f,t.modifies(i?s:l)},DA._floor=function(e,t){const n=e.timezone==="utc";let{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:g_({extent:e.extent||Mi(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins});i=v0(i);const a=this.value||{},o=(n?r_:i_)(i,r);return o.unit=ve(i),o.units=i,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o};function RA(e){$.call(this,Ts(),e)}var r8=P(RA,$);r8.transform=function(e,t){var n=t.dataflow,i=e.field,r=this.value,a=!0;function o(s){r.set(i(s),s)}return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,o)):t.changed()?(t.visit(t.REM,function(s){r.delete(i(s))}),t.visit(t.ADD,o)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()};function FA(e){$.call(this,null,e)}var a8=P(FA,$);a8.transform=function(e,t){var n=!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields);n&&(this.value=(e.sort?t.source.slice().sort(co(e.sort)):t.source).map(e.field))};function o8(e,t,n,i){let r=Ou[e](t,n);return{init:r.init||ea,update:function(a,o){o[i]=r.next(a)}}}const Ou={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{let n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){let e=Ou.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{let n=t.index,i=t.data,r=t.compare;if(e<n){for(;n+1<i.length&&!r(i[n],i[n+1]);)++n;e=n}return(1+e)/i.length}}},ntile:function(e,t){t=+t,t>0||F("ntile num must be greater than zero.");let n=Ou.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{let i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{let i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||F("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{let i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{let r=i.data;return i.index<=n?t:(n=s8(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function s8(e,t,n){for(let i=t.length;n<i;++n){let r=e(t[n]);if(r!=null)return n}return-1}var l8=Object.keys(Ou);function NA(e){let t=this,n=G(e.ops),i=G(e.fields),r=G(e.params),a=G(e.as),o=t.outputs=[],s=t.windows=[],l={},u={},c=!0,f=[],d=[];function h(p){G(Nt(p)).forEach(g=>l[g]=1)}h(e.sort),n.forEach(function(p,g){let m=i[g],v=Ye(m),y=W_(p,v,a[g]);if(h(m),o.push(y),Q(Ou,p))s.push(o8(p,i[g],r[g],y));else{if(m==null&&p!=="count"&&F("Null aggregate field specified."),p==="count"){f.push(y);return}c=!1;let b=u[v];b||(b=u[v]=[],b.field=m,d.push(b)),b.push(G_(p,y))}}),(f.length||d.length)&&(t.cell=u8(d,f,c)),t.inputs=Object.keys(l)}const IA=NA.prototype;IA.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()},IA.update=function(e,t){let n=this,i=n.cell,r=n.windows,a=e.data,o=r&&r.length,s;if(i){for(s=e.p0;s<e.i0;++s)i.rem(a[s]);for(s=e.p1;s<e.i1;++s)i.add(a[s]);i.set(t)}for(s=0;s<o;++s)r[s].update(e,t)};function u8(e,t,n){e=e.map(l=>Y_(l,l.field));let i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new e[o](i);if(i.store)var s=i.data=new sv();return i.add=function(l){if(i.num+=1,n)return;s&&s.add(l);for(let u=0;u<r;++u)a[u].add(a[u].get(l),l)},i.rem=function(l){if(i.num-=1,n)return;s&&s.rem(l);for(let u=0;u<r;++u)a[u].rem(a[u].get(l),l)},i.set=function(l){let u,c;for(s&&s.values(),u=0,c=t.length;u<c;++u)l[t[u]]=i.num;if(!n)for(u=0,c=a.length;u<c;++u)a[u].set(l)},i.init=function(){i.num=0,s&&s.reset();for(let l=0;l<r;++l)a[l].init()},i}function Iv(e){$.call(this,{},e),this._mlen=0,this._mods=[]}Iv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:l8.concat(Eu)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var MA=P(Iv,$);MA.transform=function(e,t){var n=this,i=n.state,r=e.modified(),a=co(e.sort),o,s;this.stamp=t.stamp,(!i||r)&&(i=n.state=new NA(e));var l=q0(e.groupby);function u(c){return n.group(l(c))}for(r||t.modified(i.inputs)?(n.value={},t.visit(t.SOURCE,function(c){u(c).add(c)})):(t.visit(t.REM,function(c){u(c).remove(c)}),t.visit(t.ADD,function(c){u(c).add(c)})),o=0,s=n._mlen;o<s;++o)c8(n._mods[o],i,a,e);return n._mlen=0,n._mods=[],t.reflow(r).modifies(i.outputs)},MA.group=function(e){var t=this,n=t.value[e];return n||(n=t.value[e]=cA(ee),n.stamp=-1),n.stamp<t.stamp&&(n.stamp=t.stamp,t._mods[t._mlen++]=n),n};function c8(e,t,n,i){var r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=e.data(n),l=s.length,u=0,c=a?ad(r):null,f={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Mt(-1)};for(t.init();u<l;++u)f8(f,o,u,l),a&&d8(f,c),t.update(f,s[u])}function f8(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function d8(e,t){var n=e.i0,i=e.i1-1,r=e.compare,a=e.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(e.i1=t.right(a,a[i]))}var h8=Object.freeze({__proto__:null,aggregate:xo,bin:lv,collect:uv,compare:fA,countpattern:cv,cross:dv,density:hv,dotbin:gv,expression:yA,extent:mv,facet:Sd,field:bA,filter:yv,flatten:bv,fold:wv,formula:xv,generate:wA,impute:Ev,joinaggregate:kv,kde:_v,key:EA,load:kA,lookup:Sv,multiextent:_A,multivalues:AA,params:Ov,pivot:Tv,prefacet:SA,project:$v,proxy:OA,quantile:Dv,relay:TA,sample:Rv,sequence:Fv,sieve:CA,subflow:vv,timeunit:Nv,tupleindex:RA,values:FA,window:Iv});const Ws="top",pi="left",gi="right",da="bottom",p8="top-left",g8="top-right",m8="bottom-left",v8="bottom-right",Mv="start",jv="middle",Jt="end",y8="x",b8="y",Td="group",Lv="axis",Pv="title",w8="frame",x8="scope",zv="legend",jA="row-header",LA="row-footer",PA="row-title",zA="column-header",BA="column-footer",UA="column-title",E8="padding",k8="symbol",qA="fit",_8="fit-x",A8="fit-y",S8="pad",Bv="none",Cd="all",Uv="each",qv="flush",ha="column",pa="row";var WA=0;function O8(){WA=0}const $d="p_";function Wv(e){return e&&e.gradient}function GA(e,t,n){let i=e.id,r=e.gradient,a=r==="radial"?$d:"";return i||(i=e.id="gradient_"+WA++,r==="radial"?(e.x1=Pi(e.x1,.5),e.y1=Pi(e.y1,.5),e.r1=Pi(e.r1,0),e.x2=Pi(e.x2,.5),e.y2=Pi(e.y2,.5),e.r2=Pi(e.r2,.5),a=$d):(e.x1=Pi(e.x1,0),e.y1=Pi(e.y1,0),e.x2=Pi(e.x2,1),e.y2=Pi(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function Pi(e,t){return e??t}function HA(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,a){return n.push({offset:r,color:a}),i}}}var Gv=Math.PI,Hv=2*Gv,Eo=1e-6,T8=Hv-Eo;function Yv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ko(){return new Yv()}Yv.prototype=ko.prototype={constructor:Yv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+a)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var a=this._x1,o=this._y1,s=n-e,l=i-t,u=a-e,c=o-t,f=u*u+c*c;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>Eo)if(!(Math.abs(c*s-l*u)>Eo)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-a,h=i-o,p=s*s+l*l,g=d*d+h*h,m=Math.sqrt(p),v=Math.sqrt(f),y=r*Math.tan((Gv-Math.acos((p+f-g)/(2*m*v)))/2),b=y/v,E=y/m;Math.abs(b-1)>Eo&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+E*s)+","+(this._y1=t+E*l)}},arc:function(e,t,n,i,r,a){e=+e,t=+t,n=+n,a=!!a;var o=n*Math.cos(i),s=n*Math.sin(i),l=e+o,u=t+s,c=1^a,f=a?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);if(this._x1===null?this._+="M"+l+","+u:(Math.abs(this._x1-l)>Eo||Math.abs(this._y1-u)>Eo)&&(this._+="L"+l+","+u),!n)return;f<0&&(f=f%Hv+Hv),f>T8?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>Eo&&(this._+="A"+n+","+n+",0,"+ +(f>=Gv)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r)))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function je(e){return function(){return e}}var YA=Math.abs,Pt=Math.atan2,_o=Math.cos,C8=Math.max,Vv=Math.min,zi=Math.sin,Gs=Math.sqrt,zt=1e-12,Hs=Math.PI,Dd=Hs/2,VA=2*Hs;function $8(e){return e>1?0:e<-1?Hs:Math.acos(e)}function XA(e){return e>=1?Dd:e<=-1?-Dd:Math.asin(e)}function D8(e){return e.innerRadius}function R8(e){return e.outerRadius}function F8(e){return e.startAngle}function N8(e){return e.endAngle}function I8(e){return e&&e.padAngle}function M8(e,t,n,i,r,a,o,s){var l=n-e,u=i-t,c=o-r,f=s-a,d=f*l-c*u;return d*d<zt?void 0:(d=(c*(t-a)-f*(e-r))/d,[e+d*l,t+d*u])}function Rd(e,t,n,i,r,a,o){var s=e-n,l=t-i,u=(o?a:-a)/Gs(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,g=i+f,m=(d+p)/2,v=(h+g)/2,y=p-d,b=g-h,E=y*y+b*b,x=r-a,k=d*g-p*h,w=(b<0?-1:1)*Gs(C8(0,x*x*E-k*k)),A=(k*b-y*w)/E,_=(-k*y-b*w)/E,O=(k*b+y*w)/E,S=(-k*y+b*w)/E,T=A-m,D=_-v,I=O-m,C=S-v;return T*T+D*D>I*I+C*C&&(A=O,_=S),{cx:A,cy:_,x01:-c,y01:-f,x11:A*(r/x-1),y11:_*(r/x-1)}}function j8(){var e=D8,t=R8,n=je(0),i=null,r=F8,a=N8,o=I8,s=null;function l(){var u,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-Dd,p=a.apply(this,arguments)-Dd,g=YA(p-h),m=p>h;if(s||(s=u=ko()),d<f&&(c=d,d=f,f=c),!(d>zt))s.moveTo(0,0);else if(g>VA-zt)s.moveTo(d*_o(h),d*zi(h)),s.arc(0,0,d,h,p,!m),f>zt&&(s.moveTo(f*_o(p),f*zi(p)),s.arc(0,0,f,p,h,m));else{var v=h,y=p,b=h,E=p,x=g,k=g,w=o.apply(this,arguments)/2,A=w>zt&&(i?+i.apply(this,arguments):Gs(f*f+d*d)),_=Vv(YA(d-f)/2,+n.apply(this,arguments)),O=_,S=_,T,D;if(A>zt){var I=XA(A/f*zi(w)),C=XA(A/d*zi(w));(x-=I*2)>zt?(I*=m?1:-1,b+=I,E-=I):(x=0,b=E=(h+p)/2),(k-=C*2)>zt?(C*=m?1:-1,v+=C,y-=C):(k=0,v=y=(h+p)/2)}var N=d*_o(v),W=d*zi(v),X=f*_o(E),J=f*zi(E);if(_>zt){var xe=d*_o(y),Pe=d*zi(y),dt=f*_o(b),ht=f*zi(b),Qe;if(g<Hs&&(Qe=M8(N,W,dt,ht,xe,Pe,X,J))){var Rt=N-Qe[0],ui=W-Qe[1],no=xe-Qe[0],Xr=Pe-Qe[1],H=1/zi($8((Rt*no+ui*Xr)/(Gs(Rt*Rt+ui*ui)*Gs(no*no+Xr*Xr)))/2),ue=Gs(Qe[0]*Qe[0]+Qe[1]*Qe[1]);O=Vv(_,(f-ue)/(H-1)),S=Vv(_,(d-ue)/(H+1))}}k>zt?S>zt?(T=Rd(dt,ht,N,W,d,S,m),D=Rd(xe,Pe,X,J,d,S,m),s.moveTo(T.cx+T.x01,T.cy+T.y01),S<_?s.arc(T.cx,T.cy,S,Pt(T.y01,T.x01),Pt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,S,Pt(T.y01,T.x01),Pt(T.y11,T.x11),!m),s.arc(0,0,d,Pt(T.cy+T.y11,T.cx+T.x11),Pt(D.cy+D.y11,D.cx+D.x11),!m),s.arc(D.cx,D.cy,S,Pt(D.y11,D.x11),Pt(D.y01,D.x01),!m))):(s.moveTo(N,W),s.arc(0,0,d,v,y,!m)):s.moveTo(N,W),!(f>zt)||!(x>zt)?s.lineTo(X,J):O>zt?(T=Rd(X,J,xe,Pe,f,-O,m),D=Rd(N,W,dt,ht,f,-O,m),s.lineTo(T.cx+T.x01,T.cy+T.y01),O<_?s.arc(T.cx,T.cy,O,Pt(T.y01,T.x01),Pt(D.y01,D.x01),!m):(s.arc(T.cx,T.cy,O,Pt(T.y01,T.x01),Pt(T.y11,T.x11),!m),s.arc(0,0,f,Pt(T.cy+T.y11,T.cx+T.x11),Pt(D.cy+D.y11,D.cx+D.x11),m),s.arc(D.cx,D.cy,O,Pt(D.y11,D.x11),Pt(D.y01,D.x01),!m))):s.arc(0,0,f,E,b,m)}if(s.closePath(),u)return s=null,u+""||null}return l.centroid=function(){var u=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-Hs/2;return[_o(c)*u,zi(c)*u]},l.innerRadius=function(u){return arguments.length?(e=typeof u=="function"?u:je(+u),l):e},l.outerRadius=function(u){return arguments.length?(t=typeof u=="function"?u:je(+u),l):t},l.cornerRadius=function(u){return arguments.length?(n=typeof u=="function"?u:je(+u),l):n},l.padRadius=function(u){return arguments.length?(i=u==null?null:typeof u=="function"?u:je(+u),l):i},l.startAngle=function(u){return arguments.length?(r=typeof u=="function"?u:je(+u),l):r},l.endAngle=function(u){return arguments.length?(a=typeof u=="function"?u:je(+u),l):a},l.padAngle=function(u){return arguments.length?(o=typeof u=="function"?u:je(+u),l):o},l.context=function(u){return arguments.length?(s=u??null,l):s},l}function JA(e){this._context=e}JA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Xv(e){return new JA(e)}function KA(e){return e[0]}function QA(e){return e[1]}function ZA(){var e=KA,t=QA,n=je(!0),i=null,r=Xv,a=null;function o(s){var l,u=s.length,c,f=!1,d;for(i==null&&(a=r(d=ko())),l=0;l<=u;++l)!(l<u&&n(c=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(c,l,s),+t(c,l,s));if(d)return a=null,d+""||null}return o.x=function(s){return arguments.length?(e=typeof s=="function"?s:je(+s),o):e},o.y=function(s){return arguments.length?(t=typeof s=="function"?s:je(+s),o):t},o.defined=function(s){return arguments.length?(n=typeof s=="function"?s:je(!!s),o):n},o.curve=function(s){return arguments.length?(r=s,i!=null&&(a=r(i)),o):r},o.context=function(s){return arguments.length?(s==null?i=a=null:a=r(i=s),o):i},o}function eS(){var e=KA,t=null,n=je(0),i=QA,r=je(!0),a=null,o=Xv,s=null;function l(c){var f,d,h,p=c.length,g,m=!1,v,y=new Array(p),b=new Array(p);for(a==null&&(s=o(v=ko())),f=0;f<=p;++f){if(!(f<p&&r(g=c[f],f,c))===m)if(m=!m)d=f,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=f-1;h>=d;--h)s.point(y[h],b[h]);s.lineEnd(),s.areaEnd()}m&&(y[f]=+e(g,f,c),b[f]=+n(g,f,c),s.point(t?+t(g,f,c):y[f],i?+i(g,f,c):b[f]))}if(v)return s=null,v+""||null}function u(){return ZA().defined(r).curve(o).context(a)}return l.x=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),t=null,l):e},l.x0=function(c){return arguments.length?(e=typeof c=="function"?c:je(+c),l):e},l.x1=function(c){return arguments.length?(t=c==null?null:typeof c=="function"?c:je(+c),l):t},l.y=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),i=null,l):n},l.y0=function(c){return arguments.length?(n=typeof c=="function"?c:je(+c),l):n},l.y1=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:je(+c),l):i},l.lineX0=l.lineY0=function(){return u().x(e).y(n)},l.lineY1=function(){return u().x(e).y(i)},l.lineX1=function(){return u().x(t).y(n)},l.defined=function(c){return arguments.length?(r=typeof c=="function"?c:je(!!c),l):r},l.curve=function(c){return arguments.length?(o=c,a!=null&&(s=o(a)),l):o},l.context=function(c){return arguments.length?(c==null?a=s=null:s=o(a=c),l):a},l}var L8={draw:function(e,t){var n=Math.sqrt(t/Hs);e.moveTo(n,0),e.arc(0,0,n,0,VA)}};function P8(){var e=je(L8),t=je(64),n=null;function i(){var r;if(n||(n=r=ko()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(e=typeof r=="function"?r:je(r),i):e},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:je(+r),i):t},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function ga(){}function Fd(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Nd(e){this._context=e}Nd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Fd(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Fd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function z8(e){return new Nd(e)}function tS(e){this._context=e}tS.prototype={areaStart:ga,areaEnd:ga,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Fd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function B8(e){return new tS(e)}function nS(e){this._context=e}nS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Fd(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function U8(e){return new nS(e)}function iS(e,t){this._basis=new Nd(e),this._beta=t}iS.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],a=e[n]-i,o=t[n]-r,s=-1,l;++s<=n;)l=s/n,this._basis.point(this._beta*e[s]+(1-this._beta)*(i+l*a),this._beta*t[s]+(1-this._beta)*(r+l*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var q8=function e(t){function n(i){return t===1?new Nd(i):new iS(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Id(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Jv(e,t){this._context=e,this._k=(1-t)/6}Jv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Id(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Id(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var W8=function e(t){function n(i){return new Jv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Kv(e,t){this._context=e,this._k=(1-t)/6}Kv.prototype={areaStart:ga,areaEnd:ga,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Id(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var G8=function e(t){function n(i){return new Kv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Qv(e,t){this._context=e,this._k=(1-t)/6}Qv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Id(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var H8=function e(t){function n(i){return new Qv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Zv(e,t,n){var i=e._x1,r=e._y1,a=e._x2,o=e._y2;if(e._l01_a>zt){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>zt){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,a,o,e._x2,e._y2)}function rS(e,t){this._context=e,this._alpha=t}rS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Y8=function e(t){function n(i){return t?new rS(i,t):new Jv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function aS(e,t){this._context=e,this._alpha=t}aS.prototype={areaStart:ga,areaEnd:ga,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var V8=function e(t){function n(i){return t?new aS(i,t):new Kv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function oS(e,t){this._context=e,this._alpha=t}oS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Zv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var X8=function e(t){function n(i){return t?new oS(i,t):new Qv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function sS(e){this._context=e}sS.prototype={areaStart:ga,areaEnd:ga,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function J8(e){return new sS(e)}function lS(e){return e<0?-1:1}function uS(e,t,n){var i=e._x1-e._x0,r=t-e._x1,a=(e._y1-e._y0)/(i||r<0&&-0),o=(n-e._y1)/(r||i<0&&-0),s=(a*r+o*i)/(i+r);return(lS(a)+lS(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function cS(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ey(e,t,n){var i=e._x0,r=e._y0,a=e._x1,o=e._y1,s=(a-i)/3;e._context.bezierCurveTo(i+s,r+s*t,a-s,o-s*n,a,o)}function Md(e){this._context=e}Md.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ey(this,this._t0,cS(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e===this._x1&&t===this._y1)return;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ey(this,cS(this,n=uS(this,e,t)),n);break;default:ey(this,this._t0,n=uS(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}};function fS(e){this._context=new dS(e)}(fS.prototype=Object.create(Md.prototype)).point=function(e,t){Md.prototype.point.call(this,t,e)};function dS(e){this._context=e}dS.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,a){this._context.bezierCurveTo(t,e,i,n,a,r)}};function K8(e){return new Md(e)}function Q8(e){return new fS(e)}function hS(e){this._context=e}hS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=pS(e),r=pS(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function pS(e){var t,n=e.length-1,i,r=new Array(n),a=new Array(n),o=new Array(n);for(r[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,a[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/a[t-1],a[t]-=i,o[t]-=i*o[t-1];for(r[n-1]=o[n-1]/a[n-1],t=n-2;t>=0;--t)r[t]=(o[t]-r[t+1])/a[t];for(a[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-r[t+1];return[r,a]}function Z8(e){return new hS(e)}function jd(e,t){this._context=e,this._t=t}jd.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){e=+e,t=+t;switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function e9(e){return new jd(e,.5)}function t9(e){return new jd(e,0)}function n9(e){return new jd(e,1)}var gS={basis:{curve:z8},"basis-closed":{curve:B8},"basis-open":{curve:U8},bundle:{curve:q8,tension:"beta",value:.85},cardinal:{curve:W8,tension:"tension",value:0},"cardinal-open":{curve:H8,tension:"tension",value:0},"cardinal-closed":{curve:G8,tension:"tension",value:0},"catmull-rom":{curve:Y8,tension:"alpha",value:.5},"catmull-rom-closed":{curve:V8,tension:"alpha",value:.5},"catmull-rom-open":{curve:X8,tension:"alpha",value:.5},linear:{curve:Xv},"linear-closed":{curve:J8},monotone:{horizontal:Q8,vertical:K8},natural:{curve:Z8},step:{curve:e9},"step-after":{curve:n9},"step-before":{curve:t9}};function ty(e,t,n){var i=Q(gS,e)&&gS[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}var i9={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Ld=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/];function Ys(e){var t=[],n,i,r,a,o,s,l,u,c,f,d;for(n=e.slice().replace(Ld[0],"###$1").split(Ld[1]).slice(1),u=0,f=n.length;u<f;++u){for(i=n[u],r=i.slice(1).trim().replace(Ld[2],"$1###$2").split(Ld[3]),s=i.charAt(0),a=[s],c=0,d=r.length;c<d;++c)(o=+r[c])===o&&a.push(o);if(l=i9[s.toLowerCase()],a.length-1>l)for(c=1,d=a.length;c<d;c+=l)t.push([s].concat(a.slice(c,c+l)));else t.push(a)}return t}const wr=Math.PI/180,r9=1e-14,Ao=Math.PI/2,Bi=Math.PI*2,Vs=Math.sqrt(3)/2;var ny={},iy={},mS=[].join;function a9(e,t,n,i,r,a,o,s,l){var u=mS.call(arguments);if(ny[u])return ny[u];var c=o*wr,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);var h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5,g=h*h/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,v=f/n,y=-f/i,b=d/i,E=m*s+v*l,x=y*s+b*l,k=m*e+v*t,w=y*e+b*t,A=(k-E)*(k-E)+(w-x)*(w-x),_=1/A-.25;_<0&&(_=0);var O=Math.sqrt(_);a==r&&(O=-O);var S=.5*(E+k)-O*(w-x),T=.5*(x+w)+O*(k-E),D=Math.atan2(x-T,E-S),I=Math.atan2(w-T,k-S),C=I-D;C<0&&a===1?C+=Bi:C>0&&a===0&&(C-=Bi);for(var N=Math.ceil(Math.abs(C/(Ao+.001))),W=[],X=0;X<N;++X){var J=D+X*C/N,xe=D+(X+1)*C/N;W[X]=[S,T,J,xe,n,i,f,d]}return ny[u]=W}function o9(e){var t=mS.call(e);if(iy[t])return iy[t];var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(r),g=Math.sin(r),m=Math.cos(a),v=Math.sin(a),y=.5*(a-r),b=Math.sin(y*.5),E=8/3*b*b/Math.sin(y),x=n+p-E*g,k=i+g+E*p,w=n+m,A=i+v,_=w+E*v,O=A-E*m;return iy[t]=[c*x+f*k,d*x+h*k,c*_+f*O,d*_+h*O,c*w+f*A,d*w+h*A]}var Hn=["l",0,0,0,0,0,0,0];function s9(e,t,n){var i=Hn[0]=e[0];if(i==="a"||i==="A")Hn[1]=t*e[1],Hn[2]=n*e[2],Hn[3]=e[3],Hn[4]=e[4],Hn[5]=e[5],Hn[6]=t*e[6],Hn[7]=n*e[7];else if(i==="h"||i==="H")Hn[1]=t*e[1];else if(i==="v"||i==="V")Hn[1]=n*e[1];else for(var r=1,a=e.length;r<a;++r)Hn[r]=(r%2==1?t:n)*e[r];return Hn}function Tu(e,t,n,i,r,a){var o,s=null,l=0,u=0,c=0,f=0,d,h,p,g;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),a==null&&(a=r),e.beginPath&&e.beginPath();for(var m=0,v=t.length;m<v;++m){o=t[m],(r!==1||a!==1)&&(o=s9(o,r,a));switch(o[0]){case"l":l+=o[1],u+=o[2],e.lineTo(l+n,u+i);break;case"L":l=o[1],u=o[2],e.lineTo(l+n,u+i);break;case"h":l+=o[1],e.lineTo(l+n,u+i);break;case"H":l=o[1],e.lineTo(l+n,u+i);break;case"v":u+=o[1],e.lineTo(l+n,u+i);break;case"V":u=o[1],e.lineTo(l+n,u+i);break;case"m":l+=o[1],u+=o[2],e.moveTo(l+n,u+i);break;case"M":l=o[1],u=o[2],e.moveTo(l+n,u+i);break;case"c":d=l+o[5],h=u+o[6],c=l+o[3],f=u+o[4],e.bezierCurveTo(l+o[1]+n,u+o[2]+i,c+n,f+i,d+n,h+i),l=d,u=h;break;case"C":l=o[5],u=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,c+n,f+i,l+n,u+i);break;case"s":d=l+o[3],h=u+o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,l+o[1]+n,u+o[2]+i,d+n,h+i),c=l+o[1],f=u+o[2],l=d,u=h;break;case"S":d=o[3],h=o[4],c=2*l-c,f=2*u-f,e.bezierCurveTo(c+n,f+i,o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"q":d=l+o[3],h=u+o[4],c=l+o[1],f=u+o[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),l=d,u=h,c=o[1],f=o[2];break;case"t":d=l+o[1],h=u+o[2],s[0].match(/[QqTt]/)===null?(c=l,f=u):s[0]==="t"?(c=2*l-p,f=2*u-g):s[0]==="q"&&(c=2*l-c,f=2*u-f),p=c,g=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h,c=l+o[1],f=u+o[2];break;case"T":d=o[1],h=o[2],c=2*l-c,f=2*u-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),l=d,u=h;break;case"a":vS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+l+n,o[7]+u+i]),l+=o[6],u+=o[7];break;case"A":vS(e,l+n,u+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),l=o[6],u=o[7];break;case"z":case"Z":e.closePath();break}s=o}}function vS(e,t,n,i){for(var r=a9(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n),a=0;a<r.length;++a){var o=o9(r[a]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var yS=.5773502691896257,bS={circle:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Bi)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,a=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-a),e.lineTo(r,-a),e.lineTo(0,-n),e.lineTo(-r,-a),e.lineTo(-i,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n,r=i-n*yS,a=n/4;e.moveTo(0,-i-r),e.lineTo(-a,i-r),e.lineTo(a,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n,r=i-n*yS;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Vs*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){var n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function wS(e){return Q(bS,e)?bS[e]:l9(e)}var ry={};function l9(e){if(!Q(ry,e)){var t=Ys(e);ry[e]={draw:function(n,i){Tu(n,t,0,0,Math.sqrt(i)/2)}}}return ry[e]}const ma=.448084975506;function u9(e){return e.x}function c9(e){return e.y}function f9(e){return e.width}function d9(e){return e.height}function xr(e){return typeof e=="function"?e:()=>+e}function Pd(e,t,n){return Math.max(t,Math.min(e,n))}function xS(){var e=u9,t=c9,n=f9,i=d9,r=xr(0),a=r,o=r,s=r,l=null;function u(c,f,d){var h,p=f??+e.call(this,c),g=d??+t.call(this,c),m=+n.call(this,c),v=+i.call(this,c),y=Math.min(m,v)/2,b=Pd(+r.call(this,c),0,y),E=Pd(+a.call(this,c),0,y),x=Pd(+o.call(this,c),0,y),k=Pd(+s.call(this,c),0,y);if(l||(l=h=ko()),b<=0&&E<=0&&x<=0&&k<=0)l.rect(p,g,m,v);else{var w=p+m,A=g+v;l.moveTo(p+b,g),l.lineTo(w-E,g),l.bezierCurveTo(w-ma*E,g,w,g+ma*E,w,g+E),l.lineTo(w,A-k),l.bezierCurveTo(w,A-ma*k,w-ma*k,A,w-k,A),l.lineTo(p+x,A),l.bezierCurveTo(p+ma*x,A,p,A-ma*x,p,A-x),l.lineTo(p,g+b),l.bezierCurveTo(p,g+ma*b,p+ma*b,g,p+b,g),l.closePath()}if(h)return l=null,h+""||null}return u.x=function(c){return arguments.length?(e=xr(c),u):e},u.y=function(c){return arguments.length?(t=xr(c),u):t},u.width=function(c){return arguments.length?(n=xr(c),u):n},u.height=function(c){return arguments.length?(i=xr(c),u):i},u.cornerRadius=function(c,f,d,h){return arguments.length?(r=xr(c),a=f!=null?xr(f):r,s=d!=null?xr(d):r,o=h!=null?xr(h):a,u):r},u.context=function(c){return arguments.length?(l=c??null,u):l},u}function ES(){var e,t,n,i,r=null,a,o,s,l;function u(f,d,h){var p=h/2;if(a){var g=s-d,m=f-o;if(g||m){var v=Math.sqrt(g*g+m*m),y=(g/=v)*l,b=(m/=v)*l,E=Math.atan2(m,g);r.moveTo(o-y,s-b),r.lineTo(f-g*p,d-m*p),r.arc(f,d,p,E-Math.PI,E),r.lineTo(o+y,s+b),r.arc(o,s,l,E,E+Math.PI)}else r.arc(f,d,p,0,Bi);r.closePath()}else a=1;o=f,s=d,l=p}function c(f){var d,h=f.length,p,g=!1,m;for(r==null&&(r=m=ko()),d=0;d<=h;++d)!(d<h&&i(p=f[d],d,f))===g&&((g=!g)&&(a=0)),g&&u(+e(p,d,f),+t(p,d,f),+n(p,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function Cu(e,t){return e??t}const $u=e=>e.x||0,Du=e=>e.y||0,h9=e=>e.width||0,p9=e=>e.height||0,g9=e=>(e.x||0)+(e.width||0),m9=e=>(e.y||0)+(e.height||0),v9=e=>e.startAngle||0,y9=e=>e.endAngle||0,b9=e=>e.padAngle||0,w9=e=>e.innerRadius||0,x9=e=>e.outerRadius||0,E9=e=>e.cornerRadius||0,k9=e=>Cu(e.cornerRadiusTopLeft,e.cornerRadius)||0,_9=e=>Cu(e.cornerRadiusTopRight,e.cornerRadius)||0,A9=e=>Cu(e.cornerRadiusBottomRight,e.cornerRadius)||0,S9=e=>Cu(e.cornerRadiusBottomLeft,e.cornerRadius)||0,O9=e=>Cu(e.size,64),T9=e=>e.size||1,zd=e=>!(e.defined===!1),C9=e=>wS(e.shape||"circle"),$9=j8().startAngle(v9).endAngle(y9).padAngle(b9).innerRadius(w9).outerRadius(x9).cornerRadius(E9),D9=eS().x($u).y1(Du).y0(m9).defined(zd),R9=eS().y(Du).x1($u).x0(g9).defined(zd),F9=ZA().x($u).y(Du).defined(zd),N9=xS().x($u).y(Du).width(h9).height(p9).cornerRadius(k9,_9,A9,S9),I9=P8().type(C9).size(O9),M9=ES().x($u).y(Du).defined(zd).size(T9);function ay(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function j9(e,t){return $9.context(e)(t)}function L9(e,t){var n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?R9:D9).curve(ty(i,n.orient,n.tension)).context(e)(t)}function P9(e,t){var n=t[0],i=n.interpolate||"linear";return F9.curve(ty(i,n.orient,n.tension)).context(e)(t)}function Xs(e,t,n,i){return N9.context(e)(t,n,i)}function z9(e,t){return(t.mark.shape||t.shape).context(e)(t)}function B9(e,t){return I9.context(e)(t)}function U9(e,t){return M9.context(e)(t)}var kS=1;function _S(){kS=1}function oy(e,t,n){var i=t.clip,r=e._defs,a=t.clip_id||(t.clip_id="clip"+kS++),o=r.clipping[a]||(r.clipping[a]={id:a});return de(i)?o.path=i(null):ay(n)?o.path=Xs(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function st(e){this.clear(),e&&this.union(e)}var it=st.prototype;it.clone=function(){return new st(this)},it.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},it.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},it.equals=function(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},it.set=function(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},it.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},it.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},it.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},it.scale=function(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},it.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},it.rotate=function(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},it.rotatedPoints=function(e,t,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*o+u,l*i+s*o+c,s*a-l*r+u,l*a+s*r+c,s*a-l*o+u,l*a+s*o+c]},it.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},it.intersect=function(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},it.encloses=function(e){return e&&(this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1)&&this.y2>=e.y2},it.alignsWith=function(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},it.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},it.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},it.width=function(){return this.x2-this.x1},it.height=function(){return this.y2-this.y1};function Bd(e){this.mark=e,this.bounds=this.bounds||new st()}function Ud(e){Bd.call(this,e),this.items=this.items||[]}P(Ud,Bd);function Ru(e,t){if(typeof document!="undefined"&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}function q9(){return typeof Image!="undefined"?Image:null}function sy(e){this._pending=0,this._loader=e||yd()}var qd=sy.prototype;qd.pending=function(){return this._pending};function AS(e){e._pending+=1}function Fu(e){e._pending-=1}qd.sanitizeURL=function(e){var t=this;return AS(t),t._loader.sanitize(e,{context:"href"}).then(function(n){return Fu(t),n}).catch(function(){return Fu(t),null})},qd.loadImage=function(e){const t=this,n=q9();return AS(t),t._loader.sanitize(e,{context:"image"}).then(function(i){const r=i.href;if(!r||!n)throw{url:r};const a=new n(),o=Q(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>Fu(t),a.onerror=()=>Fu(t),a.src=r,a}).catch(function(i){return Fu(t),{complete:!1,width:0,height:0,src:i&&i.url||""}})},qd.ready=function(){var e=this;return new Promise(function(t){function n(i){e.pending()?setTimeout(function(){n(!0)},10):t(i)}n(!1)})};function Er(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?W9(t,i):0))}return e}function W9(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}var Wd,Gd,Hd,G9=Bi-1e-8;function mn(e){return Wd=e,mn}function SS(){}function So(e,t){Wd.add(e,t)}function Nu(e,t){So(Gd=e,Hd=t)}function OS(e){So(e,Wd.y1)}function TS(e){So(Wd.x1,e)}mn.beginPath=SS,mn.closePath=SS,mn.moveTo=Nu,mn.lineTo=Nu,mn.rect=function(e,t,n,i){So(e+n,t+i),Nu(e,t)},mn.quadraticCurveTo=function(e,t,n,i){CS(Gd,e,n,OS),CS(Hd,t,i,TS),Nu(n,i)};function CS(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}mn.bezierCurveTo=function(e,t,n,i,r,a){$S(Gd,e,n,r,OS),$S(Hd,t,i,a,TS),Nu(r,a)};function $S(e,t,n,i,r){const a=i-e+3*t-3*n,o=e+n-2*t,s=e-t;let l=0,u=0,c;Math.abs(a)>r9?(c=o*o+s*a,c>=0&&(c=Math.sqrt(c),l=(-o+c)/a,u=(-o-c)/a)):l=.5*s/o,0<l&&l<1&&r(DS(l,e,t,n,i)),0<u&&u<1&&r(DS(u,e,t,n,i))}function DS(e,t,n,i,r){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*i+s*e*r}mn.arc=function(e,t,n,i,r,a){if(Gd=n*Math.cos(r)+e,Hd=n*Math.sin(r)+t,Math.abs(r-i)>G9)So(e-n,t-n),So(e+n,t+n);else{const o=u=>So(n*Math.cos(u)+e,n*Math.sin(u)+t);let s,l;if(o(i),o(r),r!==i)if(i=i%Bi,i<0&&(i+=Bi),r=r%Bi,r<0&&(r+=Bi),r<i&&(a=!a,s=i,i=r,r=s),a)for(r-=Bi,s=i-i%Ao,l=0;l<4&&s>r;++l,s-=Ao)o(s);else for(s=i-i%Ao+Ao,l=0;l<4&&s<r;++l,s=s+Ao)o(s)}};var va=(va=Ru(1,1))?va.getContext("2d"):null;const ly=new st();function uy(e){return function(t,n){if(!va)return!0;e(va,t),ly.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:a,y2:o}=ly;for(let s=r;s<=o;++s)for(let l=i;l<=a;++l)if(va.isPointInPath(l,s))return!0;return!1}}function cy(e,t){return t.contains(e.x||0,e.y||0)}function RS(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,a=e.height||0;return t.intersects(ly.set(n,i,n+r,i+a))}function FS(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,a=e.y2!=null?e.y2:i;return Js(t,n,i,r,a)}function Js(e,t,n,i,r){const{x1:a,y1:o,x2:s,y2:l}=e,u=i-t,c=r-n;let f=0,d=1,h,p,g,m;for(m=0;m<4;++m){if(m===0&&(h=-u,p=-(a-t)),m===1&&(h=u,p=s-t),m===2&&(h=-c,p=-(o-n)),m===3&&(h=c,p=l-n),Math.abs(h)<1e-10&&p<0)return!1;if(g=p/h,h<0){if(g>d)return!1;g>f&&(f=g)}else if(h>0){if(g<f)return!1;g<d&&(d=g)}}return!0}function Ks(e,t){e.globalCompositeOperation=t.blend||"source-over"}function mi(e,t){return e??t}function NS(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function H9(e,t,n){const i=n.width(),r=n.height();let a;if(t.gradient==="radial")a=e.createRadialGradient(n.x1+mi(t.x1,.5)*i,n.y1+mi(t.y1,.5)*r,Math.max(i,r)*mi(t.r1,0),n.x1+mi(t.x2,.5)*i,n.y1+mi(t.y2,.5)*r,Math.max(i,r)*mi(t.r2,.5));else{const o=mi(t.x1,0),s=mi(t.y1,0),l=mi(t.x2,1),u=mi(t.y2,0);if(o===l||s===u||i===r)a=e.createLinearGradient(n.x1+o*i,n.y1+s*r,n.x1+l*i,n.y1+u*r);else{const c=Ru(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=NS(f.createLinearGradient(o,s,l,u),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return NS(a,t.stops)}function IS(e,t,n){return Wv(n)?H9(e,n,t.bounds):n}function Yd(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=IS(e,t,t.fill),!0):!1}var Y9=[];function Qs(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=IS(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||Y9),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function V9(e,t){return e.zindex-t.zindex||e.index-t.index}function fy(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,a;for(r=0,a=t.length;r<a;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(V9)}function vi(e,t){var n=e.items,i,r;if(!n||!n.length)return;var a=fy(e);if(a&&a.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=a}for(i=0,r=n.length;i<r;++i)t(n[i])}function Vd(e,t){var n=e.items,i,r;if(!n||!n.length)return null;var a=fy(e);for(a&&a.length&&(n=a),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===a){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function dy(e){return function(t,n,i){vi(n,function(r){(!i||i.intersects(r.bounds))&&MS(e,t,r,r)})}}function X9(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&MS(e,t,n.items[0],n.items)}}function MS(e,t,n,i){var r=n.opacity==null?1:n.opacity;if(r===0)return;if(e(t,i))return;Ks(t,n),n.fill&&Yd(t,n,r)&&t.fill(),n.stroke&&Qs(t,n,r)&&t.stroke()}function Xd(e){return e=e||fi,function(t,n,i,r,a,o){return i*=t.pixelRatio,r*=t.pixelRatio,Vd(n,function(s){var l=s.bounds;if(l&&!l.contains(a,o)||!l)return;if(e(t,s,i,r,a,o))return s})}}function Jd(e,t){return function(n,i,r,a){var o=Array.isArray(i)?i[0]:i,s=t??o.fill,l=o.stroke&&n.isPointInStroke,u,c;return l&&(u=o.strokeWidth,c=o.strokeCap,n.lineWidth=u??1,n.lineCap=c??"butt"),e(n,i)?!1:s&&n.isPointInPath(r,a)||l&&n.isPointInStroke(r,a)}}function hy(e){return Xd(Jd(e))}function Zs(e,t){return"translate("+e+","+t+")"}function jS(e){return"rotate("+e+")"}function J9(e,t){return"scale("+e+","+t+")"}function LS(e){return Zs(e.x||0,e.y||0)}function PS(e){return Zs(e.x||0,e.y||0)+(e.angle?" "+jS(e.angle):"")+(e.scaleX||e.scaleY?" "+J9(e.scaleX||1,e.scaleY||1):"")}function py(e,t,n){function i(o,s){o("transform",PS(s)),o("d",t(null,s))}function r(o,s){var l=s.x||0,u=s.y||0;return t(mn(o),s),Er(o,s).translate(l,u),s.angle&&o.rotate(s.angle*wr,l,u),o}function a(o,s){var l=s.x||0,u=s.y||0,c=s.angle||0;o.translate(l,u),c&&o.rotate(c*=wr),o.beginPath(),t(o,s),c&&o.rotate(-c),o.translate(-l,-u)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:dy(a),pick:hy(a),isect:n||uy(a)}}var K9=py("arc",j9);function Q9(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,a=Infinity,o,s;--r>=0;){if(e[r].defined===!1)continue;s=Math.abs(e[r][i]-n),s<a&&(a=s,o=e[r])}return o}function Z9(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,a,o;--i>=0;){if(e[i].defined===!1)continue;if(r=e[i].x-t[0],a=e[i].y-t[1],o=r*r+a*a,o<n)return e[i]}return null}function e7(e,t){for(var n=e.length,i,r,a;--n>=0;){if(e[n].defined===!1)continue;if(i=e[n].x-t[0],r=e[n].y-t[1],a=i*i+r*r,i=e[n].size||1,a<i*i)return e[n]}return null}function gy(e,t,n){function i(l,u){var c=u.mark.items;c.length&&l("d",t(null,c))}function r(l,u){var c=u.items;return c.length===0?l:(t(mn(l),c),Er(l,c[0]))}function a(l,u){l.beginPath(),t(l,u)}var o=Jd(a);function s(l,u,c,f,d,h){var p=u.items,g=u.bounds;return!p||!p.length||g&&!g.contains(d,h)?null:(c*=l.pixelRatio,f*=l.pixelRatio,o(l,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:X9(a),pick:s,isect:cy,tip:n}}var t7=gy("area",L9,Q9);function n7(e,t){var n=t.clip;e.save(),de(n)?(e.beginPath(),n(e),e.clip()):zS(e,t.group)}function zS(e,t){e.beginPath(),ay(t)?Xs(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function BS(e){const t=mi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function i7(e,t){e("transform",LS(t))}function US(e,t){const n=BS(t);e("d",Xs(null,t,n,n))}function r7(e,t){e("class","background"),e("aria-hidden",!0),US(e,t)}function a7(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?US(e,t):e("d","")}function o7(e,t,n){const i=t.clip?oy(n,t,t):null;e("clip-path",i)}function s7(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Er(e,t),e.translate(t.x||0,t.y||0)}function Kd(e,t,n,i){const r=BS(t);e.beginPath(),Xs(e,t,(n||0)+r,(i||0)+r)}const qS=Jd(Kd),l7=Jd(Kd,!1);function u7(e,t,n){vi(t,i=>{const r=i.x||0,a=i.y||0,o=i.strokeForeground,s=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&s&&(Kd(e,i,r,a),Ks(e,i),i.fill&&Yd(e,i,s)&&e.fill(),i.stroke&&!o&&Qs(e,i,s)&&e.stroke()),e.save(),e.translate(r,a),i.clip&&zS(e,i),n&&n.translate(-r,-a),vi(i,l=>{this.draw(e,l,n)}),n&&n.translate(r,a),e.restore(),o&&i.stroke&&s&&(Kd(e,i,r,a),Ks(e,i),Qs(e,i,s)&&e.stroke())})}function c7(e,t,n,i,r,a){if(t.bounds&&!t.bounds.contains(r,a)||!t.items)return null;const o=n*e.pixelRatio,s=i*e.pixelRatio;return Vd(t,l=>{let u,c,f,d,h,p,g,m,v;return m=l.bounds,m&&!m.contains(r,a)?void 0:(d=l.x||0,h=l.y||0,p=d+(l.width||0),g=h+(l.height||0),v=l.clip,v&&(r<d||r>p||a<h||a>g)?void 0:(e.save(),e.translate(d,h),d=r-d,h=a-h,v&&ay(l)&&!qS(e,l,o,s)?(e.restore(),null):(c=l.strokeForeground,f=t.interactive!==!1,f&&c&&l.stroke&&l7(e,l,o,s)?(e.restore(),l):(u=Vd(l,y=>f7(y,d,h)?this.pick(y,n,i,d,h):null),!u&&f&&(l.fill||!c&&l.stroke)&&qS(e,l,o,s)&&(u=l),e.restore(),u||null))))})}function f7(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var d7={type:"group",tag:"g",nested:!1,attr:i7,bound:s7,draw:u7,pick:c7,isect:RS,content:o7,background:r7,foreground:a7},el={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function my(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function vy(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function yy(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function Qd(e,t){return e==="center"?t/2:e==="right"?t:0}function Zd(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function h7(e,t,n){const i=my(t,n),r=vy(t,i),a=yy(t,i),o=(t.x||0)-Qd(t.align,r),s=(t.y||0)-Zd(t.baseline,a),l=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",l,el["xmlns:xlink"],"xlink:href"),e("transform",Zs(o,s)),e("width",r),e("height",a),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function p7(e,t){const n=t.image,i=vy(t,n),r=yy(t,n),a=(t.x||0)-Qd(t.align,i),o=(t.y||0)-Zd(t.baseline,r);return e.set(a,o,a+i,o+r)}function g7(e,t,n){vi(t,i=>{if(n&&!n.intersects(i.bounds))return;let r=my(i,this),a=vy(i,r),o=yy(i,r),s=(i.x||0)-Qd(i.align,a),l=(i.y||0)-Zd(i.baseline,o),u,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=a/c,l+=(o-d)/2,o=d):(d=o*c,s+=(a-d)/2,a=d))),(r.complete||r.toDataURL)&&(Ks(e,i),e.globalAlpha=(u=i.opacity)!=null?u:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,s,l,a,o))})}var m7={type:"image",tag:"image",nested:!1,attr:h7,bound:p7,draw:g7,pick:Xd(),isect:fi,get:my,xOffset:Qd,yOffset:Zd},v7=gy("line",P9,Z9);function y7(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",PS(t)),e("d",t.path)}function eh(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*wr,l=t.pathCache;(!l||l.path!==n)&&((t.pathCache=l=Ys(n)).path=n),s&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(s),Tu(e,l,0,0,a,o),e.rotate(-s),e.translate(-i,-r)):Tu(e,l,i,r,a,o)}function b7(e,t){return eh(mn(e),t)?e.set(0,0,0,0):Er(e,t,!0),t.angle&&e.rotate(t.angle*wr,t.x||0,t.y||0),e}var w7={type:"path",tag:"path",nested:!1,attr:y7,bound:b7,draw:dy(eh),pick:hy(eh),isect:uy(eh)};function x7(e,t){e("d",Xs(null,t))}function E7(e,t){var n,i;return Er(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function WS(e,t){e.beginPath(),Xs(e,t)}var k7={type:"rect",tag:"path",nested:!1,attr:x7,bound:E7,draw:dy(WS),pick:hy(WS),isect:RS};function _7(e,t){e("transform",LS(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function A7(e,t){var n,i;return Er(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function GS(e,t,n){var i,r,a,o;return t.stroke&&Qs(e,t,n)?(i=t.x||0,r=t.y||0,a=t.x2!=null?t.x2:i,o=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(a,o),!0):!1}function S7(e,t,n){vi(t,function(i){if(n&&!n.intersects(i.bounds))return;var r=i.opacity==null?1:i.opacity;r&&GS(e,i,r)&&(Ks(e,i),e.stroke())})}function O7(e,t,n,i){return e.isPointInStroke?GS(e,t,1)&&e.isPointInStroke(n,i):!1}var T7={type:"rule",tag:"line",nested:!1,attr:_7,bound:A7,draw:S7,pick:Xd(O7),isect:FS},C7=py("shape",z9),$7=py("symbol",B9,cy);const HS=ak();var tl={height:Ui,measureWidth:wy,estimateWidth:by,width:by,canvas:YS};YS(!0);function YS(e){tl.width=e&&va?wy:by}function by(e,t){return VS(ba(e,t),Ui(e))}function VS(e,t){return~~(.8*e.length*t)}function wy(e,t){return Ui(e)<=0||!(t=ba(e,t))?0:XS(t,th(e))}function XS(e,t){const n=`(${t}) ${e}`;let i=HS.get(n);return i===void 0&&(va.font=t,i=va.measureText(e).width,HS.set(n,i)),i}function Ui(e){return e.fontSize!=null?+e.fontSize||0:11}function ya(e){return e.lineHeight!=null?e.lineHeight:Ui(e)+2}function D7(e){return M(e)?e.length>1?e:e[0]:e}function Iu(e){return D7(e.lineBreak&&e.text&&!M(e.text)?e.text.split(e.lineBreak):e.text)}function xy(e){const t=Iu(e);return(M(t)?t.length-1:0)*ya(e)}function ba(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?F7(e,n):n}function R7(e){if(tl.width===wy){const t=th(e);return n=>XS(n,t)}else{const t=Ui(e);return n=>VS(n,t)}}function F7(e,t){var n=+e.limit,i=R7(e);if(i(t)<n)return t;var r=e.ellipsis||"â€¦",a=e.dir==="rtl",o=0,s=t.length,l;if(n-=i(r),a){for(;o<s;)l=o+s>>>1,i(t.slice(l))>n?o=l+1:s=l;return r+t.slice(o)}else{for(;o<s;)l=1+(o+s>>>1),i(t.slice(0,l))<n?o=l:s=l-1;return t.slice(0,o)+r}}function Mu(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function th(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+Ui(e)+"px "+Mu(e,t)}function Ey(e){var t=e.baseline,n=Ui(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*ya(e):t==="line-bottom"?.29*n-.5*ya(e):0)}var N7={left:"start",center:"middle",right:"end"},ju=new st();function nh(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-Ao,t+=i*Math.cos(r),n+=i*Math.sin(r)),ju.x1=t,ju.y1=n,ju}function I7(e,t){var n=t.dx||0,i=(t.dy||0)+Ey(t),r=nh(t),a=r.x1,o=r.y1,s=t.angle||0,l;e("text-anchor",N7[t.align]||"start"),s?(l=Zs(a,o)+" "+jS(s),(n||i)&&(l+=" "+Zs(n,i))):l=Zs(a+n,o+i),e("transform",l)}function ky(e,t,n){var i=tl.height(t),r=t.align,a=nh(t),o=a.x1,s=a.y1,l=t.dx||0,u=(t.dy||0)+Ey(t)-Math.round(.8*i),c=Iu(t),f;if(M(c)?(i+=ya(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,tl.width(t,h)),0)):f=tl.width(t,c),r==="center"?l-=f/2:r==="right"&&(l-=f),e.set(l+=o,u+=s,l+f,u+i),t.angle&&!n)e.rotate(t.angle*wr,o,s);else if(n===2)return e.rotatedPoints(t.angle*wr,o,s);return e}function M7(e,t,n){vi(t,function(i){var r=i.opacity==null?1:i.opacity,a,o,s,l,u,c,f;if(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)return;if(e.font=th(i),e.textAlign=i.align||"left",a=nh(i),o=a.x1,s=a.y1,i.angle&&(e.save(),e.translate(o,s),e.rotate(i.angle*wr),o=s=0),o+=i.dx||0,s+=(i.dy||0)+Ey(i),c=Iu(i),Ks(e,i),M(c))for(u=ya(i),l=0;l<c.length;++l)f=ba(i,c[l]),i.fill&&Yd(e,i,r)&&e.fillText(f,o,s),i.stroke&&Qs(e,i,r)&&e.strokeText(f,o,s),s+=u;else f=ba(i,c),i.fill&&Yd(e,i,r)&&e.fillText(f,o,s),i.stroke&&Qs(e,i,r)&&e.strokeText(f,o,s);i.angle&&e.restore()})}function j7(e,t,n,i,r,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=nh(t),s=o.x1,l=o.y1,u=ky(ju,t,1),c=-t.angle*wr,f=Math.cos(c),d=Math.sin(c),h=f*r-d*a+(s-f*s+d*l),p=d*r+f*a+(l-d*s-f*l);return u.contains(h,p)}function L7(e,t){var n=ky(ju,e,2);return Js(t,n[0],n[1],n[2],n[3])||Js(t,n[0],n[1],n[4],n[5])||Js(t,n[4],n[5],n[6],n[7])||Js(t,n[2],n[3],n[6],n[7])}var P7={type:"text",tag:"text",nested:!1,attr:I7,bound:ky,draw:M7,pick:Xd(j7),isect:L7},z7=gy("trail",U9,e7),Yn={arc:K9,area:t7,group:d7,image:m7,line:v7,path:w7,rect:k7,rule:T7,shape:C7,symbol:$7,text:P7,trail:z7};function _y(e,t,n){var i=Yn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new st()),e,n)}var JS={mark:null};function KS(e,t,n){var i=Yn[e.marktype],r=i.bound,a=e.items,o=a&&a.length,s,l,u,c;if(i.nested)return o?u=a[0]:(JS.mark=e,u=JS),c=_y(u,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new st(),o)for(s=0,l=a.length;s<l;++s)t.union(_y(a[s],r,n));return e.bounds=t}var B7=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function QS(e,t){return JSON.stringify(e,B7,t)}function ZS(e){var t=typeof e=="string"?JSON.parse(e):e;return eO(t)}function eO(e){var t=e.marktype,n=e.items,i,r,a;if(n)for(r=0,a=n.length;r<a;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&eO(n[r]);return t&&KS(e),e}function Ay(e){arguments.length?this.root=ZS(e):(this.root=nO({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Ud(this.root)])}var tO=Ay.prototype;tO.toJSON=function(e){return QS(this.root,e||0)},tO.mark=function(e,t,n){t=t||this.root.items[0];var i=nO(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};function nO(e,t){const n={bounds:new st(),clip:!!e.clip,group:t,interactive:!(e.interactive===!1),items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function wa(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Sy(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function In(e,t,n,i){var r=e.childNodes[t],a;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(a=r||null,r=wa(e.ownerDocument,n,i),e.insertBefore(r,a)),r}function yi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function iO(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function ih(e,t){var n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function U7(e,t,n,i){var r=e&&e.mark,a,o;if(r&&(a=Yn[r.marktype]).tip){for(o=ih(t,n),o[0]-=i[0],o[1]-=i[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=a.tip(r.items,o)}return e}function xa(e,t){this._active=null,this._handlers={},this._loader=e||yd(),this._tooltip=t||q7}function q7(e,t,n,i){e.element().setAttribute("title",i||"")}const Mn=xa.prototype;Mn.initialize=function(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},Mn.element=function(){return this._el},Mn.canvas=function(){return this._el&&this._el.firstChild},Mn.origin=function(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},Mn.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},Mn.on=function(){},Mn.off=function(){},Mn._handlerIndex=function(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},Mn.handlers=function(e){const t=this._handlers,n=[];if(e)n.push.apply(n,t[this.eventName(e)]);else for(const i in t)n.push.apply(n,t[i]);return n},Mn.eventName=function(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},Mn.handleHref=function(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),a=wa(null,"a");for(const o in i)a.setAttribute(o,i[o]);a.dispatchEvent(r)}).catch(function(){})},Mn.handleTooltip=function(e,t,n){if(t&&t.tooltip!=null){t=U7(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},Mn.getItemBoundingClientRect=function(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,a=r.width(),o=r.height();let s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}};function bi(e){this._el=null,this._bgcolor=null,this._loader=new sy(e)}var Vn=bi.prototype;Vn.initialize=function(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},Vn.element=function(){return this._el},Vn.canvas=function(){return this._el&&this._el.firstChild},Vn.background=function(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},Vn.resize=function(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},Vn.dirty=function(){},Vn.render=function(e){var t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},Vn._render=function(){},Vn.renderAsync=function(e){var t=this.render(e);return this._ready?this._ready.then(function(){return t}):Promise.resolve(t)},Vn._load=function(e,t){var n=this,i=n._loader[e](t);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then(function(a){a&&r(),n._ready=null})}return i},Vn.sanitizeURL=function(e){return this._load("sanitizeURL",e)},Vn.loadImage=function(e){return this._load("loadImage",e)};const W7="keydown",G7="keypress",H7="keyup",rO="dragenter",rh="dragleave",aO="dragover",Oy="mousedown",Y7="mouseup",ah="mousemove",Lu="mouseout",oO="mouseover",oh="click",V7="dblclick",X7="wheel",sO="mousewheel",sh="touchstart",lh="touchmove",uh="touchend",J7=[W7,G7,H7,rO,rh,aO,Oy,Y7,ah,Lu,oO,oh,V7,X7,sO,sh,lh,uh],Ty=ah,Pu=Lu,Cy=oh;function zu(e,t){xa.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const lt=P(zu,xa);lt.initialize=function(e,t,n){return this._canvas=e&&Sy(e,"canvas"),[oh,Oy,ah,Lu,rh].forEach(i=>lO(this,i)),xa.prototype.initialize.call(this,e,t,n)};const K7=e=>e===sh||e===lh||e===uh?[sh,lh,uh]:[e];function lO(e,t){K7(t).forEach(n=>Q7(e,n))}function Q7(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}lt.canvas=function(){return this._canvas},lt.context=function(){return this._canvas.getContext("2d")},lt.events=J7;function uO(e,t,n){return function(i){const r=this._active,a=this.pickEvent(i);a===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=a,this.fire(t,i),this.fire(e,i))}}function cO(e){return function(t){this.fire(e,t),this._active=null}}lt.DOMMouseScroll=function(e){this.fire(sO,e)},lt.mousemove=uO(ah,oO,Lu),lt.dragover=uO(aO,rO,rh),lt.mouseout=cO(Lu),lt.dragleave=cO(rh),lt.mousedown=function(e){this._down=this._active,this.fire(Oy,e)},lt.click=function(e){this._down===this._active&&(this.fire(oh,e),this._down=null)},lt.touchstart=function(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(sh,e,!0)},lt.touchmove=function(e){this.fire(lh,e,!0)},lt.touchend=function(e){this.fire(uh,e,!0),this._touch=null},lt.fire=function(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===Cy&&i&&i.href?this.handleHref(t,i,i.href):(e===Ty||e===Pu)&&this.handleTooltip(t,i,e!==Pu),r)for(let a=0,o=r.length;a<o;++a)r[a].handler.call(this._obj,t,i)},lt.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);return r<0&&(lO(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},lt.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},lt.pickEvent=function(e){const t=ih(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},lt.pick=function(e,t,n,i,r){const a=this.context(),o=Yn[e.marktype];return o.pick.call(this,a,e,t,n,i,r)};function Z7(){return typeof window!="undefined"&&window.devicePixelRatio||1}var eB=Z7();function tB(e,t,n,i,r,a){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,s=e.getContext("2d"),l=o?eB:r;e.width=t*l,e.height=n*l;for(const u in a)s[u]=a[u];return o&&l!==1&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1]),e}function ch(e){bi.call(this,e),this._options={},this._redraw=!1,this._dirty=new st(),this._tempb=new st()}const Ea=P(ch,bi),fO=bi.prototype;Ea.initialize=function(e,t,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Ru(1,1,this._options.type),e&&this._canvas&&(yi(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),fO.initialize.call(this,e,t,n,i,r)},Ea.resize=function(e,t,n,i){if(fO.resize.call(this,e,t,n,i),this._canvas)tB(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||F("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},Ea.canvas=function(){return this._canvas},Ea.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},Ea.dirty=function(e){let t=this._tempb.clear().union(e.bounds),n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)};function nB(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}const iB=(e,t,n)=>new st().set(0,0,t,n).translate(-e[0],-e[1]);Ea._render=function(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,a=this._dirty,o=iB(n,i,r);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):nB(t,o.intersect(a),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,s),t.restore(),a.clear(),this},Ea.draw=function(e,t,n){const i=Yn[t.marktype];t.clip&&n7(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},Ea.clear=function(e,t,n,i){const r=this._options,a=this.context();r.type!=="pdf"&&!r.externalContext&&a.clearRect(e,t,n,i),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,i))};function $y(e,t){xa.call(this,e,t);const n=this;n._hrefHandler=Dy(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=Dy(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Pu)})}const fh=P($y,xa);fh.initialize=function(e,t,n){let i=this._svg;return i&&(i.removeEventListener(Cy,this._hrefHandler),i.removeEventListener(Ty,this._tooltipHandler),i.removeEventListener(Pu,this._tooltipHandler)),this._svg=i=e&&Sy(e,"svg"),i&&(i.addEventListener(Cy,this._hrefHandler),i.addEventListener(Ty,this._tooltipHandler),i.addEventListener(Pu,this._tooltipHandler)),xa.prototype.initialize.call(this,e,t,n)},fh.canvas=function(){return this._svg};const Dy=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};fh.on=function(e,t){const n=this.eventName(e),i=this._handlers,r=this._handlerIndex(i[n],e,t);if(r<0){const a={type:e,handler:t,listener:Dy(this,t)};(i[n]||(i[n]=[])).push(a),this._svg&&this._svg.addEventListener(n,a.listener)}return this},fh.off=function(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this};function Ry(e,t,n){var i=e-t+n*2;return e?i>0?i:1:0}const rB="identity",nl="linear",kr="log",Bu="pow",Uu="sqrt",dh="symlog",Oo="time",To="utc",qi="sequential",il="diverging",rl="quantile",hh="quantize",ph="threshold",Fy="ordinal",Ny="point",dO="band",Iy="bin-ordinal",ut="continuous",qu="discrete",Wu="discretizing",Xn="interpolating",My="temporal";function aB(e){return function(t){var n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function oB(e){return function(t){var n=e.range(),i=t[0],r=t[1],a=-1,o,s,l,u;for(r<i&&(s=i,i=r,r=s),l=0,u=n.length;l<u;++l)n[l]>=i&&n[l]<=r&&(a<0&&(a=l),o=l);return a<0?void 0:(i=e.invertExtent(n[a]),r=e.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]])}}function Wi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ka(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const jy=Symbol("implicit");function Ly(){var e=new Map(),t=[],n=[],i=jy;function r(a){var o=a+"",s=e.get(o);if(!s){if(i!==jy)return i;e.set(o,s=t.push(a))}return n[(s-1)%n.length]}return r.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new Map();for(const o of a){const s=o+"";if(e.has(s))continue;e.set(s,t.push(o))}return r},r.range=function(a){return arguments.length?(n=Array.from(a),r):n.slice()},r.unknown=function(a){return arguments.length?(i=a,r):i},r.copy=function(){return Ly(t,n).unknown(i)},Wi.apply(r,arguments),r}function al(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Gu(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function _a(){}var Co=.7,ol=1/Co,sl="\\s*([+-]?\\d+)\\s*",Hu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Gi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sB=/^#([0-9a-f]{3,8})$/,lB=new RegExp("^rgb\\("+[sl,sl,sl]+"\\)$"),uB=new RegExp("^rgb\\("+[Gi,Gi,Gi]+"\\)$"),cB=new RegExp("^rgba\\("+[sl,sl,sl,Hu]+"\\)$"),fB=new RegExp("^rgba\\("+[Gi,Gi,Gi,Hu]+"\\)$"),dB=new RegExp("^hsl\\("+[Hu,Gi,Gi]+"\\)$"),hB=new RegExp("^hsla\\("+[Hu,Gi,Gi,Hu]+"\\)$"),hO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};al(_a,Yu,{copy:function(e){return Object.assign(new this.constructor(),this,e)},displayable:function(){return this.rgb().displayable()},hex:pO,formatHex:pO,formatHsl:pB,formatRgb:gO,toString:gO});function pO(){return this.rgb().formatHex()}function pB(){return wO(this).formatHsl()}function gO(){return this.rgb().formatRgb()}function Yu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=sB.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?mO(t):n===3?new St(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?gh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?gh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=lB.exec(e))?new St(t[1],t[2],t[3],1):(t=uB.exec(e))?new St(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=cB.exec(e))?gh(t[1],t[2],t[3],t[4]):(t=fB.exec(e))?gh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=dB.exec(e))?bO(t[1],t[2]/100,t[3]/100,1):(t=hB.exec(e))?bO(t[1],t[2]/100,t[3]/100,t[4]):hO.hasOwnProperty(e)?mO(hO[e]):e==="transparent"?new St(NaN,NaN,NaN,0):null}function mO(e){return new St(e>>16&255,e>>8&255,e&255,1)}function gh(e,t,n,i){return i<=0&&(e=t=n=NaN),new St(e,t,n,i)}function Py(e){return e instanceof _a||(e=Yu(e)),e?(e=e.rgb(),new St(e.r,e.g,e.b,e.opacity)):new St()}function Aa(e,t,n,i){return arguments.length===1?Py(e):new St(e,t,n,i??1)}function St(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}al(St,Aa,Gu(_a,{brighter:function(e){return e=e==null?ol:Math.pow(ol,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Co:Math.pow(Co,e),new St(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:vO,formatHex:vO,formatRgb:yO,toString:yO}));function vO(){return"#"+zy(this.r)+zy(this.g)+zy(this.b)}function yO(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function zy(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function bO(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Hi(e,t,n,i)}function wO(e){if(e instanceof Hi)return new Hi(e.h,e.s,e.l,e.opacity);if(e instanceof _a||(e=Yu(e)),!e)return new Hi();if(e instanceof Hi)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),a=Math.max(t,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(t===a?o=(n-i)/s+(n<i)*6:n===a?o=(i-t)/s+2:o=(t-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new Hi(o,s,l,e.opacity)}function mh(e,t,n,i){return arguments.length===1?wO(e):new Hi(e,t,n,i??1)}function Hi(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}al(Hi,mh,Gu(_a,{brighter:function(e){return e=e==null?ol:Math.pow(ol,e),new Hi(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Co:Math.pow(Co,e),new Hi(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new St(By(e>=240?e-240:e+120,r,i),By(e,r,i),By(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function By(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}var xO=Math.PI/180,EO=180/Math.PI,vh=18,kO=.96422,_O=1,AO=.82521,SO=4/29,ll=6/29,OO=3*ll*ll,gB=ll*ll*ll;function TO(e){if(e instanceof Yi)return new Yi(e.l,e.a,e.b,e.opacity);if(e instanceof _r)return CO(e);e instanceof St||(e=Py(e));var t=Gy(e.r),n=Gy(e.g),i=Gy(e.b),r=Uy((.2225045*t+.7168786*n+.0606169*i)/_O),a,o;return t===n&&n===i?a=o=r:(a=Uy((.4360747*t+.3850649*n+.1430804*i)/kO),o=Uy((.0139322*t+.0971045*n+.7141733*i)/AO)),new Yi(116*r-16,500*(a-r),200*(r-o),e.opacity)}function yh(e,t,n,i){return arguments.length===1?TO(e):new Yi(e,t,n,i??1)}function Yi(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}al(Yi,yh,Gu(_a,{brighter:function(e){return new Yi(this.l+vh*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Yi(this.l-vh*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=kO*qy(t),e=_O*qy(e),n=AO*qy(n),new St(Wy(3.1338561*t-1.6168667*e-.4906146*n),Wy(-.9787684*t+1.9161415*e+.033454*n),Wy(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Uy(e){return e>gB?Math.pow(e,1/3):e/OO+SO}function qy(e){return e>ll?e*e*e:OO*(e-SO)}function Wy(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Gy(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function mB(e){if(e instanceof _r)return new _r(e.h,e.c,e.l,e.opacity);if(e instanceof Yi||(e=TO(e)),e.a===0&&e.b===0)return new _r(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*EO;return new _r(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function bh(e,t,n,i){return arguments.length===1?mB(e):new _r(e,t,n,i??1)}function _r(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function CO(e){if(isNaN(e.h))return new Yi(e.l,0,0,e.opacity);var t=e.h*xO;return new Yi(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}al(_r,bh,Gu(_a,{brighter:function(e){return new _r(this.h,this.c,this.l+vh*(e??1),this.opacity)},darker:function(e){return new _r(this.h,this.c,this.l-vh*(e??1),this.opacity)},rgb:function(){return CO(this).rgb()}}));var $O=-.14861,Hy=1.78277,Yy=-.29227,wh=-.90649,Vu=1.97294,DO=Vu*wh,RO=Vu*Hy,FO=Hy*Yy-wh*$O;function vB(e){if(e instanceof $o)return new $o(e.h,e.s,e.l,e.opacity);e instanceof St||(e=Py(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(FO*i+DO*t-RO*n)/(FO+DO-RO),a=i-r,o=(Vu*(n-r)-Yy*a)/wh,s=Math.sqrt(o*o+a*a)/(Vu*r*(1-r)),l=s?Math.atan2(o,a)*EO-120:NaN;return new $o(l<0?l+360:l,s,r,e.opacity)}function Vy(e,t,n,i){return arguments.length===1?vB(e):new $o(e,t,n,i??1)}function $o(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}al($o,Vy,Gu(_a,{brighter:function(e){return e=e==null?ol:Math.pow(ol,e),new $o(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Co:Math.pow(Co,e),new $o(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*xO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new St(255*(t+n*($O*i+Hy*r)),255*(t+n*(Yy*i+wh*r)),255*(t+n*(Vu*i)),this.opacity)}}));function NO(e,t,n,i,r){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*i+o*r)/6}function IO(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],a=e[i+1],o=i>0?e[i-1]:2*r-a,s=i<t-1?e[i+2]:2*a-r;return NO((n-i/t)*t,o,r,a,s)}}function MO(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],a=e[i%t],o=e[(i+1)%t],s=e[(i+2)%t];return NO((n-i/t)*t,r,a,o,s)}}function xh(e){return function(){return e}}function jO(e,t){return function(n){return e+n*t}}function yB(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Eh(e,t){var n=t-e;return n?jO(e,n>180||n<-180?n-360*Math.round(n/360):n):xh(isNaN(e)?t:e)}function bB(e){return(e=+e)===1?vt:function(t,n){return n-t?yB(t,n,e):xh(isNaN(t)?n:t)}}function vt(e,t){var n=t-e;return n?jO(e,n):xh(isNaN(e)?t:e)}var Xy=function e(t){var n=bB(t);function i(r,a){var o=n((r=Aa(r)).r,(a=Aa(a)).r),s=n(r.g,a.g),l=n(r.b,a.b),u=vt(r.opacity,a.opacity);return function(c){return r.r=o(c),r.g=s(c),r.b=l(c),r.opacity=u(c),r+""}}return i.gamma=e,i}(1);function LO(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),a=new Array(n),o,s;for(o=0;o<n;++o)s=Aa(t[o]),i[o]=s.r||0,r[o]=s.g||0,a[o]=s.b||0;return i=e(i),r=e(r),a=e(a),s.opacity=1,function(l){return s.r=i(l),s.g=r(l),s.b=a(l),s+""}}}var wB=LO(IO),xB=LO(MO);function Jy(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function PO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function EB(e,t){return(PO(t)?Jy:zO)(e,t)}function zO(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),a=new Array(n),o;for(o=0;o<i;++o)r[o]=Do(e[o],t[o]);for(;o<n;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=r[o](s);return a}}function BO(e,t){var n=new Date();return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function wi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function UO(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Do(e[r],t[r]):i[r]=t[r];return function(a){for(r in n)i[r]=n[r](a);return i}}var Ky=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qy=new RegExp(Ky.source,"g");function kB(e){return function(){return e}}function _B(e){return function(t){return e(t)+""}}function qO(e,t){var n=Ky.lastIndex=Qy.lastIndex=0,i,r,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(i=Ky.exec(e))&&(r=Qy.exec(t));)(a=r.index)>n&&(a=t.slice(n,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:wi(i,r)})),n=Qy.lastIndex;return n<t.length&&(a=t.slice(n),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?_B(l[0].x):kB(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function Do(e,t){var n=typeof t,i;return t==null||n==="boolean"?xh(t):(n==="number"?wi:n==="string"?(i=Yu(t))?(t=i,Xy):qO:t instanceof Yu?Xy:t instanceof Date?BO:PO(t)?Jy:Array.isArray(t)?zO:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?UO:wi)(e,t)}function AB(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function SB(e,t){var n=Eh(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Xu(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var WO=180/Math.PI,Zy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function GO(e,t,n,i,r,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(t,e)*WO,skewX:Math.atan(l)*WO,scaleX:o,scaleY:s}}var Ju,eb,HO,kh;function OB(e){return e==="none"?Zy:(Ju||(Ju=document.createElement("DIV"),eb=document.documentElement,HO=document.defaultView),Ju.style.transform=e,e=HO.getComputedStyle(eb.appendChild(Ju),null).getPropertyValue("transform"),eb.removeChild(Ju),e=e.slice(7,-1).split(","),GO(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function TB(e){return e==null?Zy:(kh||(kh=document.createElementNS("http://www.w3.org/2000/svg","g")),kh.setAttribute("transform",e),(e=kh.transform.baseVal.consolidate())?(e=e.matrix,GO(e.a,e.b,e.c,e.d,e.e,e.f)):Zy)}function YO(e,t,n,i){function r(u){return u.length?u.pop()+" ":""}function a(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push("translate(",null,t,null,n);p.push({i:g-4,x:wi(u,f)},{i:g-2,x:wi(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(u,c,f,d){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:wi(u,c)})):c&&f.push(r(f)+"rotate("+c+i)}function s(u,c,f,d){u!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:wi(u,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(u,c,f,d,h,p){if(u!==f||c!==d){var g=h.push(r(h)+"scale(",null,",",null,")");p.push({i:g-4,x:wi(u,f)},{i:g-2,x:wi(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(u,c){var f=[],d=[];return u=e(u),c=e(c),a(u.translateX,u.translateY,c.translateX,c.translateY,f,d),o(u.rotate,c.rotate,f,d),s(u.skewX,c.skewX,f,d),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,f,d),u=c=null,function(h){for(var p=-1,g=d.length,m;++p<g;)f[(m=d[p]).i]=m.x(h);return f.join("")}}}var CB=YO(OB,"px, ","px)","deg)"),$B=YO(TB,", ",")",")"),Ku=Math.SQRT2,tb=2,VO=4,DB=1e-12;function XO(e){return((e=Math.exp(e))+1/e)/2}function RB(e){return((e=Math.exp(e))-1/e)/2}function FB(e){return((e=Math.exp(2*e))-1)/(e+1)}function NB(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],o=t[1],s=t[2],l=a-n,u=o-i,c=l*l+u*u,f,d;if(c<DB)d=Math.log(s/r)/Ku,f=function(y){return[n+y*l,i+y*u,r*Math.exp(Ku*y*d)]};else{var h=Math.sqrt(c),p=(s*s-r*r+VO*c)/(2*r*tb*h),g=(s*s-r*r-VO*c)/(2*s*tb*h),m=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(g*g+1)-g);d=(v-m)/Ku,f=function(y){var b=y*d,E=XO(m),x=r/(tb*h)*(E*FB(Ku*b+m)-RB(m));return[n+x*l,i+x*u,r*E/XO(Ku*b+m)]}}return f.duration=d*1e3,f}function JO(e){return function(t,n){var i=e((t=mh(t)).h,(n=mh(n)).h),r=vt(t.s,n.s),a=vt(t.l,n.l),o=vt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.s=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var IB=JO(Eh),MB=JO(vt);function jB(e,t){var n=vt((e=yh(e)).l,(t=yh(t)).l),i=vt(e.a,t.a),r=vt(e.b,t.b),a=vt(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=r(o),e.opacity=a(o),e+""}}function KO(e){return function(t,n){var i=e((t=bh(t)).h,(n=bh(n)).h),r=vt(t.c,n.c),a=vt(t.l,n.l),o=vt(t.opacity,n.opacity);return function(s){return t.h=i(s),t.c=r(s),t.l=a(s),t.opacity=o(s),t+""}}}var LB=KO(Eh),PB=KO(vt);function QO(e){return function t(n){n=+n;function i(r,a){var o=e((r=Vy(r)).h,(a=Vy(a)).h),s=vt(r.s,a.s),l=vt(r.l,a.l),u=vt(r.opacity,a.opacity);return function(c){return r.h=o(c),r.s=s(c),r.l=l(Math.pow(c,n)),r.opacity=u(c),r+""}}return i.gamma=t,i}(1)}var zB=QO(Eh),BB=QO(vt);function nb(e,t){for(var n=0,i=t.length-1,r=t[0],a=new Array(i<0?0:i);n<i;)a[n]=e(r,r=t[++n]);return function(o){var s=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return a[s](o-s)}}function UB(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var qB=Object.freeze({__proto__:null,interpolate:Do,interpolateArray:EB,interpolateBasis:IO,interpolateBasisClosed:MO,interpolateDate:BO,interpolateDiscrete:AB,interpolateHue:SB,interpolateNumber:wi,interpolateNumberArray:Jy,interpolateObject:UO,interpolateRound:Xu,interpolateString:qO,interpolateTransformCss:CB,interpolateTransformSvg:$B,interpolateZoom:NB,interpolateRgb:Xy,interpolateRgbBasis:wB,interpolateRgbBasisClosed:xB,interpolateHsl:IB,interpolateHslLong:MB,interpolateLab:jB,interpolateHcl:LB,interpolateHclLong:PB,interpolateCubehelix:zB,interpolateCubehelixLong:BB,piecewise:nb,quantize:UB});function WB(e){return function(){return e}}function ib(e){return+e}var ZO=[0,1];function vn(e){return e}function rb(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:WB(isNaN(t)?NaN:.5)}function GB(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function HB(e,t,n){var i=e[0],r=e[1],a=t[0],o=t[1];return r<i?(i=rb(r,i),a=n(o,a)):(i=rb(i,r),a=n(a,o)),function(s){return a(i(s))}}function YB(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=rb(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(s){var l=oa(e,s,1,i)-1;return a[l](r[l](s))}}function Qu(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function _h(){var e=ZO,t=ZO,n=Do,i,r,a,o=vn,s,l,u;function c(){var d=Math.min(e.length,t.length);return o!==vn&&(o=GB(e[0],e[d-1])),s=d>2?YB:HB,l=u=null,f}function f(d){return isNaN(d=+d)?a:(l||(l=s(e.map(i),t,n)))(i(o(d)))}return f.invert=function(d){return o(r((u||(u=s(t,e.map(i),wi)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,ib),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Xu,c()},f.clamp=function(d){return arguments.length?(o=d?!0:vn,c()):o!==vn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,h){return i=d,r=h,c()}}function eT(){return _h()(vn,vn)}function tT(e,t,n,i){var r=sa(e,t,n),a;i=Rs(i??",f");switch(i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(a=Lk(r,o))&&(i.precision=a),h0(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=Pk(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=jk(r))&&(i.precision=a-(i.type==="%")*2);break}}return cd(i)}function Ro(e){var t=e.domain;return e.ticks=function(n){var i=t();return c0(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return tT(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,a=i.length-1,o=i[r],s=i[a],l;return s<o&&(l=o,o=s,s=l,l=r,r=a,a=l),l=od(o,s,n),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=od(o,s,n)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=od(o,s,n)),l>0?(i[r]=Math.floor(o/l)*l,i[a]=Math.ceil(s/l)*l,t(i)):l<0&&(i[r]=Math.ceil(o*l)/l,i[a]=Math.floor(s*l)/l,t(i)),e},e}function nT(){var e=eT();return e.copy=function(){return Qu(e,nT())},Wi.apply(e,arguments),Ro(e)}function iT(e){var t;function n(i){return isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,ib),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return iT(e).unknown(t)},e=arguments.length?Array.from(e,ib):[0,1],Ro(n)}function rT(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],a=e[i],o;return a<r&&(o=n,n=i,i=o,o=r,r=a,a=o),e[n]=t.floor(r),e[i]=t.ceil(a),e}function aT(e){return Math.log(e)}function oT(e){return Math.exp(e)}function VB(e){return-Math.log(-e)}function XB(e){return-Math.exp(-e)}function JB(e){return isFinite(e)?+("1e"+e):e<0?0:e}function KB(e){return e===10?JB:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function QB(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function sT(e){return function(t){return-e(-t)}}function ab(e){var t=e(aT,oT),n=t.domain,i=10,r,a;function o(){return r=QB(i),a=KB(i),n()[0]<0?(r=sT(r),a=sT(a),e(VB,XB)):e(aT,oT),t}return t.base=function(s){return arguments.length?(i=+s,o()):i},t.domain=function(s){return arguments.length?(n(s),o()):n()},t.ticks=function(s){var l=n(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=r(u),h=r(c),p,g,m,v=s==null?10:+s,y=[];if(!(i%1)&&h-d<v){if(d=Math.floor(d),h=Math.ceil(h),u>0)for(;d<=h;++d)for(g=1,p=a(d);g<i;++g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}else for(;d<=h;++d)for(g=i-1,p=a(d);g>=1;--g){if(m=p*g,m<u)continue;if(m>c)break;y.push(m)}y.length*2<v&&(y=c0(u,c,v))}else y=c0(d,h,Math.min(h-d,v)).map(a);return f?y.reverse():y},t.tickFormat=function(s,l){if(l==null&&(l=i===10?".0e":","),typeof l!="function"&&(l=cd(l)),s===Infinity)return l;s==null&&(s=10);var u=Math.max(1,i*s/t.ticks().length);return function(c){var f=c/a(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=u?l(c):""}},t.nice=function(){return n(rT(n(),{floor:function(s){return a(Math.floor(r(s)))},ceil:function(s){return a(Math.ceil(r(s)))}}))},t}function lT(){var e=ab(_h()).domain([1,10]);return e.copy=function(){return Qu(e,lT()).base(e.base())},Wi.apply(e,arguments),e}function uT(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function cT(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ob(e){var t=1,n=e(uT(t),cT(t));return n.constant=function(i){return arguments.length?e(uT(t=+i),cT(t)):t},Ro(n)}function fT(){var e=ob(_h());return e.copy=function(){return Qu(e,fT()).constant(e.constant())},Wi.apply(e,arguments)}function dT(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ZB(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function eU(e){return e<0?-e*e:e*e}function sb(e){var t=e(vn,vn),n=1;function i(){return n===1?e(vn,vn):n===.5?e(ZB,eU):e(dT(n),dT(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},Ro(t)}function lb(){var e=sb(_h());return e.copy=function(){return Qu(e,lb()).exponent(e.exponent())},Wi.apply(e,arguments),e}function tU(){return lb.apply(null,arguments).exponent(.5)}function hT(){var e=[],t=[],n=[],i;function r(){var o=0,s=Math.max(1,t.length);for(n=new Array(s-1);++o<s;)n[o-1]=sd(e,o/s);return a}function a(o){return isNaN(o=+o)?i:t[oa(n,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?n[s-1]:e[0],s<n.length?n[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort($s),r()},a.range=function(o){return arguments.length?(t=Array.from(o),r()):t.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.quantiles=function(){return n.slice()},a.copy=function(){return hT().domain(e).range(t).unknown(i)},Wi.apply(a,arguments)}function pT(){var e=0,t=1,n=1,i=[.5],r=[0,1],a;function o(l){return l<=l?r[oa(i,l,0,n)]:a}function s(){var l=-1;for(i=new Array(n);++l<n;)i[l]=((l+1)*t-(l-n)*e)/(n+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(n=(r=Array.from(l)).length-1,s()):r.slice()},o.invertExtent=function(l){var u=r.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,i[0]]:u>=n?[i[n-1],t]:[i[u-1],i[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return i.slice()},o.copy=function(){return pT().domain([e,t]).range(r).unknown(a)},Wi.apply(Ro(o),arguments)}function gT(){var e=[.5],t=[0,1],n,i=1;function r(a){return a<=a?t[oa(e,a,0,i)]:n}return r.domain=function(a){return arguments.length?(e=Array.from(a),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(a){return arguments.length?(t=Array.from(a),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},r.unknown=function(a){return arguments.length?(n=a,r):n},r.copy=function(){return gT().domain(e).range(t).unknown(n)},Wi.apply(r,arguments)}var Zu=1e3,ec=Zu*60,tc=ec*60,nc=tc*24,nU=nc*7,mT=nc*30,ub=nc*365;function iU(e){return new Date(e)}function rU(e){return e instanceof Date?+e:+new Date(+e)}function cb(e,t,n,i,r,a,o,s,l){var u=eT(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),g=l("%I %p"),m=l("%a %d"),v=l("%b %d"),y=l("%B"),b=l("%Y"),E=[[o,1,Zu],[o,5,5*Zu],[o,15,15*Zu],[o,30,30*Zu],[a,1,ec],[a,5,5*ec],[a,15,15*ec],[a,30,30*ec],[r,1,tc],[r,3,3*tc],[r,6,6*tc],[r,12,12*tc],[i,1,nc],[i,2,2*nc],[n,1,nU],[t,1,mT],[t,3,3*mT],[e,1,ub]];function x(w){return(o(w)<w?d:a(w)<w?h:r(w)<w?p:i(w)<w?g:t(w)<w?n(w)<w?m:v:e(w)<w?y:b)(w)}function k(w,A,_){if(w==null&&(w=10),typeof w=="number"){var O=Math.abs(_-A)/w,S=ad(function(D){return D[2]}).right(E,O),T;return S===E.length?(T=sa(A/ub,_/ub,w),w=e):S?(S=E[O/E[S-1][2]<E[S][2]/O?S-1:S],T=S[1],w=S[0]):(T=Math.max(sa(A,_,w),1),w=s),w.every(T)}return w}return u.invert=function(w){return new Date(c(w))},u.domain=function(w){return arguments.length?f(Array.from(w,rU)):f().map(iU)},u.ticks=function(w){var A=f(),_=A[0],O=A[A.length-1],S=O<_,T;return S&&(T=_,_=O,O=T),T=k(w,_,O),T=T?T.range(_,O+1):[],S?T.reverse():T},u.tickFormat=function(w,A){return A==null?x:l(A)},u.nice=function(w){var A=f();return(w=k(w,A[0],A[A.length-1]))?f(rT(A,w)):u},u.copy=function(){return Qu(u,cb(e,t,n,i,r,a,o,s,l))},u}function aU(){return Wi.apply(cb(la,E0,gd,mo,Yk,Hk,pd,Fs,N0).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function oU(){return Wi.apply(cb(ua,A0,md,yo,Xk,Vk,pd,Fs,I0).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Ah(){var e=0,t=1,n,i,r,a,o=vn,s=!1,l;function u(f){return isNaN(f=+f)?l:o(r===0?.5:(f=(a(f)-n)*r,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,n=a(e=+e),i=a(t=+t),r=n===i?0:1/(i-n),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function c(f){return function(d){var h,p;return arguments.length?([h,p]=d,o=f(h,p),u):[o(0),o(1)]}}return u.range=c(Do),u.rangeRound=c(Xu),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return a=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),u}}function Sa(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function fb(){var e=Ro(Ah()(vn));return e.copy=function(){return Sa(e,fb())},ka.apply(e,arguments)}function vT(){var e=ab(Ah()).domain([1,10]);return e.copy=function(){return Sa(e,vT()).base(e.base())},ka.apply(e,arguments)}function yT(){var e=ob(Ah());return e.copy=function(){return Sa(e,yT()).constant(e.constant())},ka.apply(e,arguments)}function db(){var e=sb(Ah());return e.copy=function(){return Sa(e,db()).exponent(e.exponent())},ka.apply(e,arguments)}function sU(){return db.apply(null,arguments).exponent(.5)}function Sh(){var e=0,t=.5,n=1,i=1,r,a,o,s,l,u=vn,c,f=!1,d;function h(g){return isNaN(g=+g)?d:(g=.5+((g=+c(g))-a)*(i*g<i*a?s:l),u(f?Math.max(0,Math.min(1,g)):g))}h.domain=function(g){return arguments.length?([e,t,n]=g,r=c(e=+e),a=c(t=+t),o=c(n=+n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h):[e,t,n]},h.clamp=function(g){return arguments.length?(f=!!g,h):f},h.interpolator=function(g){return arguments.length?(u=g,h):u};function p(g){return function(m){var v,y,b;return arguments.length?([v,y,b]=m,u=nb(g,[v,y,b]),h):[u(0),u(.5),u(1)]}}return h.range=p(Do),h.rangeRound=p(Xu),h.unknown=function(g){return arguments.length?(d=g,h):d},function(g){return c=g,r=g(e),a=g(t),o=g(n),s=r===a?0:.5/(a-r),l=a===o?0:.5/(o-a),i=a<r?-1:1,h}}function bT(){var e=Ro(Sh()(vn));return e.copy=function(){return Sa(e,bT())},ka.apply(e,arguments)}function wT(){var e=ab(Sh()).domain([.1,1,10]);return e.copy=function(){return Sa(e,wT()).base(e.base())},ka.apply(e,arguments)}function xT(){var e=ob(Sh());return e.copy=function(){return Sa(e,xT()).constant(e.constant())},ka.apply(e,arguments)}function hb(){var e=sb(Sh());return e.copy=function(){return Sa(e,hb()).exponent(e.exponent())},ka.apply(e,arguments)}function lU(){return hb.apply(null,arguments).exponent(.5)}function pb(){var e=Ly().unknown(void 0),t=e.domain,n=e.range,i=[0,1],r,a,o=!1,s=0,l=0,u=.5;delete e.unknown;function c(){var f=t().length,d=i[1]<i[0],h=i[d-0],p=i[1-d],g=Ry(f,s,l);r=(p-h)/(g||1),o&&(r=Math.floor(r)),h+=(p-h-r*(f-s))*u,a=r*(1-s),o&&(h=Math.round(h),a=Math.round(a));var m=ho(f).map(function(v){return h+r*v});return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return a},e.step=function(){return r},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),s=l,c()):s},e.paddingInner=function(f){return arguments.length?(s=Math.max(0,Math.min(1,f)),c()):s},e.paddingOuter=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.align=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;var d=+f[0],h=+f[1],p=i[1]<i[0],g=p?n().reverse():n(),m=g.length-1,v,y,b;return d!==d||h!==h?void 0:(h<d&&(b=d,d=h,h=b),h<g[0]||d>i[1-p]?void 0:(v=Math.max(0,oa(g,d)-1),y=d===h?v:oa(g,h)-1,d-g[v]>a+1e-10&&++v,p&&(b=v,v=m-y,y=m-b),v>y?void 0:t().slice(v,y+1)))},e.invert=function(f){var d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return pb().domain(t()).range(i).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function ET(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return ET(t())},e}function uU(){return ET(pb().paddingInner(1))}var cU=Array.prototype.map;function fU(e){return cU.call(e,function(t){return+t})}var dU=Array.prototype.slice;function kT(){var e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(oa(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=fU(i),n):e.slice()},n.range=function(i){return arguments.length?(t=dU.call(i),n):t.slice()},n.tickFormat=function(i,r){return tT(e[0],ve(e),i??10,r)},n.copy=function(){return kT().domain(n.domain()).range(n.range())},n}const Oh={};function hU(e,t,n){const i=function(){var a=t();return a.invertRange||(a.invertRange=a.invert?aB(a):a.invertExtent?oB(a):void 0),a.type=e,a};return i.metadata=pt(G(n)),i}function Ee(e,t,n){return arguments.length>1?(Oh[e]=hU(e,t,n),this):_T(e)?Oh[e]:void 0}Ee(rB,iT),Ee(nl,nT,ut),Ee(kr,lT,[ut,kr]),Ee(Bu,lb,ut),Ee(Uu,tU,ut),Ee(dh,fT,ut),Ee(Oo,aU,[ut,My]),Ee(To,oU,[ut,My]),Ee(qi,fb,[ut,Xn]),Ee(`${qi}-${nl}`,fb,[ut,Xn]),Ee(`${qi}-${kr}`,vT,[ut,Xn,kr]),Ee(`${qi}-${Bu}`,db,[ut,Xn]),Ee(`${qi}-${Uu}`,sU,[ut,Xn]),Ee(`${qi}-${dh}`,yT,[ut,Xn]),Ee(`${il}-${nl}`,bT,[ut,Xn]),Ee(`${il}-${kr}`,wT,[ut,Xn,kr]),Ee(`${il}-${Bu}`,hb,[ut,Xn]),Ee(`${il}-${Uu}`,lU,[ut,Xn]),Ee(`${il}-${dh}`,xT,[ut,Xn]),Ee(rl,hT,[Wu,rl]),Ee(hh,pT,Wu),Ee(ph,gT,Wu),Ee(Iy,kT,[qu,Wu]),Ee(Fy,Ly,qu),Ee(dO,pb,qu),Ee(Ny,uU,qu);function _T(e){return Q(Oh,e)}function Fo(e,t){const n=Oh[e];return n&&n.metadata[t]}function gb(e){return Fo(e,ut)}function ul(e){return Fo(e,qu)}function mb(e){return Fo(e,Wu)}function AT(e){return Fo(e,kr)}function pU(e){return Fo(e,My)}function ST(e){return Fo(e,Xn)}function OT(e){return Fo(e,rl)}const gU=["clamp","base","constant","exponent"];function TT(e,t){var n=t[0],i=ve(t)-n;return function(r){return e(n+r*i)}}function Th(e,t,n){return nb(vb(t||"rgb",n),e)}function CT(e,t){for(var n=new Array(t),i=t+1,r=0;r<t;)n[r]=e(++r/i);return n}function $T(e,t,n){var i=n-t,r,a,o;return!i||!Number.isFinite(i)?Mt(.5):(r=(a=e.type).indexOf("-"),a=r<0?a:a.slice(r+1),o=Ee(a)().domain([t,n]).range([0,1]),gU.forEach(s=>e[s]?o[s](e[s]()):0),o)}function vb(e,t){var n=qB[mU(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function mU(e){return"interpolate"+e.toLowerCase().split("-").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("")}const vU={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},yU={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function DT(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function RT(e,t){for(let n in e)yb(n,t(e[n]))}const FT={};RT(yU,DT),RT(vU,e=>Th(DT(e)));function yb(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(FT[e]=t,this):FT[e]}var Ch="symbol",bU="discrete",wU="gradient";const xU=e=>M(e)?e.map(t=>String(t)):String(e),EU=(e,t)=>e[1]-t[1],kU=(e,t)=>t[1]-e[1];function bb(e,t,n){var i;return Ce(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(ru(e.domain())/n||1)))),K(t)&&(i=t.step,t=t.interval),Y(t)&&(t=e.type===Oo?Is(t):e.type==To?Ms(t):F("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function NT(e,t,n){let i=e.range(),r=i[0],a=ve(i),o=EU;if(r>a&&(i=a,a=r,r=i,o=kU),r=Math.floor(r),a=Math.ceil(a),t=t.map(s=>[s,e(s)]).filter(s=>r<=s[1]&&s[1]<=a).sort(o).map(s=>s[0]),n>0&&t.length>1){const s=[t[0],ve(t)];for(;t.length>n&&t.length>=3;)t=t.filter((l,u)=>!(u%2));t.length<3&&(t=s)}return t}function wb(e,t){return e.bins?NT(e,e.bins):e.ticks?e.ticks(t):e.domain()}function IT(e,t,n,i,r,a){var o=t.type;let s=xU;if(o===Oo||r===Oo)s=e.timeFormat(i);else if(o===To||r===To)s=e.utcFormat(i);else if(AT(o)){const l=e.formatFloat(i);if(a||t.bins)s=l;else{const u=MT(t,n,!1);s=c=>u(c)?l(c):""}}else if(t.tickFormat){const l=t.domain();s=e.formatSpan(l[0],l[l.length-1],n,i)}else i&&(s=e.format(i));return s}function MT(e,t,n){const i=wb(e,t),r=e.base(),a=Math.log(r),o=Math.max(1,r*t/i.length),s=l=>{let u=l/Math.pow(r,Math.round(Math.log(l)/a));return u*r<r-.5&&(u*=r),u<=o};return n?i.filter(s):s}const xb={[rl]:"quantiles",[hh]:"thresholds",[ph]:"domain"},jT={[rl]:"quantiles",[hh]:"domain"};function LT(e,t){return e.bins?SU(e.bins):e.type===kr?MT(e,t,!0):xb[e.type]?AU(e[xb[e.type]]()):wb(e,t)}function _U(e,t,n){var i=t[jT[t.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return e.formatSpan(0,a,3*10,n)}function AU(e){const t=[-Infinity].concat(e);return t.max=Infinity,t}function SU(e){const t=e.slice(0,-1);return t.max=ve(e),t}function OU(e){return xb[e.type]||e.bins}function PT(e,t,n,i,r,a,o){const s=jT[t.type]&&a!==Oo&&a!==To?_U(e,t,r):IT(e,t,n,r,a,o);return i===Ch&&OU(t)?TU(s):i===bU?CU(s):$U(s)}function TU(e){return(t,n,i)=>{var r=zT(i[n+1],zT(i.max,Infinity)),a=BT(t,e),o=BT(r,e);return a&&o?a+" â€“ "+o:o?"< "+o:"â‰¥ "+a}}function zT(e,t){return e??t}function CU(e){return(t,n)=>n?e(t):null}function $U(e){return t=>e(t)}function BT(e,t){return Number.isFinite(e)?t(e):null}function DU(e){var t=e.domain(),n=t.length-1,i=+t[0],r=+ve(t),a=r-i;if(e.type===ph){const o=n?a/n:.1;i-=o,r+=o,a=r-i}return o=>(o-i)/a}function RU(e,t,n,i){const r=i||t.type;return Y(n)&&pU(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===Oo?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===To?e.utcFormat("%A, %d %B %Y, %X UTC"):PT(e,t,5,null,n,i,!0)}function UT(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=RU(e,t,n.format,n.formatType);if(mb(t.type)){const a=LT(t).slice(1).map(r),o=a.length;return`${o} boundar${o===1?"y":"ies"}: ${a.join(", ")}`}else if(ul(t.type)){const a=t.domain(),o=a.length,s=o>i?a.slice(0,i-2).map(r).join(", ")+", ending with "+a.slice(-1).map(r):a.map(r).join(", ");return`${o} value${o===1?"":"s"}: ${s}`}else{const a=t.domain();return`values from ${r(a[0])} to ${r(ve(a))}`}}const qT="aria-hidden",Eb="aria-label",kb="role",_b="aria-roledescription",WT="graphics-object",Ab="graphics-symbol",GT=(e,t,n)=>({[kb]:e,[_b]:t,[Eb]:n||void 0}),FU=pt(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),HT={axis:{desc:"axis",caption:MU},legend:{desc:"legend",caption:jU},"title-text":{desc:"title",caption:e=>`Title text '${JT(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${JT(e)}'`}},YT={ariaRole:kb,ariaRoleDescription:_b,description:Eb};function VT(e,t){const n=t.aria===!1;if(e(qT,n||void 0),n||t.description==null)for(const i in YT)e(YT[i],void 0);else{const i=t.mark.marktype;e(Eb,t.description),e(kb,t.ariaRole||(i==="group"?WT:Ab)),e(_b,t.ariaRoleDescription||`${i} mark`)}}function XT(e){return e.aria===!1?{[qT]:!0}:FU[e.role]?null:HT[e.role]?IU(e,HT[e.role]):NU(e)}function NU(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return GT(n?WT:Ab,`${t} mark container`,e.description)}function IU(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return GT(t.role||Ab,t.desc,n.description||i(n))}catch(n){return null}}function JT(e){return G(e.text).join(" ")}function MU(e){const t=e.datum,n=e.orient,i=t.title?KT(e):null,r=e.context,a=r.scales[t.scale].value,o=r.dataflow.locale(),s=a.type,l=n==="left"||n==="right"?"Y":"X";return`${l}-axis`+(i?` titled '${i}'`:"")+` for a ${ul(s)?"discrete":s} scale with ${UT(o,a,e)}`}function jU(e){const t=e.datum,n=t.title?KT(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,a=Object.keys(r),o=e.context,s=o.scales[r[a[0]]].value,l=o.dataflow.locale();return PU(i)+(n?` titled '${n}'`:"")+` for ${LU(a)} with ${UT(l,s,e)}`}function KT(e){try{return G(ve(e.items).items[0].text).join(" ")}catch(t){return null}}function LU(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ve(e)}function PU(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const zU=e=>(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function We(e,t,n){var i="<"+e,r,a;if(t)for(r in t)a=t[r],a!=null&&(i+=" "+r+'="'+zU(a)+'"');return n&&(i+=" "+n),i+">"}function Ve(e){return"</"+e+">"}const $h={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Sb={fill:"none","stroke-miterlimit":10},Dh=0,Ot=el.xmlns;function Ob(e){bi.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var yn=P(Ob,bi),Tb=bi.prototype;yn.initialize=function(e,t,n,i){if(this._defs={gradient:{},clipping:{}},e){this._svg=In(e,0,"svg",Ot),this._svg.setAttribute("class","marks"),yi(e,1),this._root=In(this._svg,Dh,"g",Ot);for(const r in Sb)this._root.setAttribute(r,Sb[r]);yi(this._svg,Dh+1)}return this.background(this._bgcolor),Tb.initialize.call(this,e,t,n,i)},yn.background=function(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Tb.background.apply(this,arguments)},yn.resize=function(e,t,n,i){return Tb.resize.call(this,e,t,n,i),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},yn.canvas=function(){return this._svg},yn.svg=function(){if(!this._svg)return null;var e={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var t in el)e[t]=el[t];var n=this._bgcolor?We("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Ve("rect"):"";return We("svg",e)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+Ve("svg")},yn._render=function(e){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,e),yi(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},yn.updateDefs=function(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=In(e,Dh,"defs",Ot)),i=BU(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=In(e,Dh,"defs",Ot)),i=UU(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):yi(n,i))};function BU(e,t,n){var i,r,a;if(t.gradient==="radial"){var o=In(e,n++,"pattern",Ot);o.setAttribute("id",$d+t.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),o=In(o,0,"rect",Ot),o.setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+eC()+"#"+t.id+")"),e=In(e,n++,"radialGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("fx",t.x1),e.setAttribute("fy",t.y1),e.setAttribute("fr",t.r1),e.setAttribute("cx",t.x2),e.setAttribute("cy",t.y2),e.setAttribute("r",t.r2)}else e=In(e,n++,"linearGradient",Ot),e.setAttribute("id",t.id),e.setAttribute("x1",t.x1),e.setAttribute("x2",t.x2),e.setAttribute("y1",t.y1),e.setAttribute("y2",t.y2);for(i=0,r=t.stops.length;i<r;++i)a=In(e,i,"stop",Ot),a.setAttribute("offset",t.stops[i].offset),a.setAttribute("stop-color",t.stops[i].color);return yi(e,i),n}function UU(e,t,n){var i;return e=In(e,n,"clipPath",Ot),e.setAttribute("id",t.id),t.path?(i=In(e,0,"path",Ot),i.setAttribute("d",t.path)):(i=In(e,0,"rect",Ot),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",t.width),i.setAttribute("height",t.height)),yi(e,1),n+1}yn._resetDefs=function(){var e=this._defs;e.gradient={},e.clipping={}},yn.dirty=function(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},yn.isDirty=function(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},yn._dirtyCheck=function(){this._dirtyAll=!0;var e=this._dirty;if(!e.length||!this._dirtyID)return!0;var t=++this._dirtyID,n,i,r,a,o,s,l;for(o=0,s=e.length;o<s;++o){if(n=e[o],i=n.mark,i.marktype!==r&&(r=i.marktype,a=Yn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,QT(n,t),i.items.forEach(function(u){u.dirty=t})),i.zdirty)continue;if(n.exit){a.nested&&i.items.length?(l=i.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null;continue}if(n=a.nested?i.items[0]:n,n._update===t)continue;!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,QT(n,t)):this._update(a,n._svg,n),n._update=t}return!this._dirtyAll};function QT(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}yn.draw=function(e,t,n){if(!this.isDirty(t))return t._svg;var i=this._svg,r=Yn[t.marktype],a=t.interactive===!1?"none":null,o=r.tag==="g",s=null,l=0,u;u=ZT(t,e,n,"g",i),u.setAttribute("class",iO(t));const c=XT(t);for(const d in c)bn(u,d,c[d]);o||bn(u,"pointer-events",a),bn(u,"clip-path",t.clip?oy(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),p=ZT(d,u,s,r.tag,i);h&&(this._update(r,p,d),o&&qU(this,p,d)),s=p,++l};return r.nested?t.items.length&&f(t.items[0]):vi(t,f),yi(u,l),u};function qU(e,t,n){t=t.lastChild.previousSibling;let i,r=0;vi(n,a=>{i=e.draw(t,a,i),++r}),yi(t,1+r)}function ZT(e,t,n,i,r){let a=e._svg,o;if(!a&&(o=t.ownerDocument,a=wa(o,i,Ot),e._svg=a,e.mark&&(a.__data__=e,a.__values__={fill:"default"},i==="g"))){const s=wa(o,"path",Ot);a.appendChild(s),s.__data__=e;const l=wa(o,"g",Ot);a.appendChild(l),l.__data__=e;const u=wa(o,"path",Ot);a.appendChild(u),u.__data__=e,u.__values__={fill:"default"}}return(a.ownerSVGElement!==r||WU(a,n))&&t.insertBefore(a,n?n.nextSibling:t.firstChild),a}function WU(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}var Ar=null,Bt=null,GU={group:function(e,t,n){const i=Ar=t.childNodes[2];Bt=i.__values__,e.foreground(ic,n,this),Bt=t.__values__,Ar=t.childNodes[1],e.content(ic,n,this);const r=Ar=t.childNodes[0];e.background(ic,n,this);const a=n.mark.interactive===!1?"none":null;if(a!==Bt.events&&(bn(i,"pointer-events",a),bn(r,"pointer-events",a),Bt.events=a),n.strokeForeground&&n.stroke){const o=n.fill;bn(i,"display",null),this.style(r,n),bn(r,"stroke",null),o&&(n.fill=null),Bt=i.__values__,this.style(i,n),o&&(n.fill=o),Ar=null}else bn(i,"display","none")},image:function(e,t,n){n.smooth===!1?(Cb(t,"image-rendering","optimizeSpeed"),Cb(t,"image-rendering","pixelated")):Cb(t,"image-rendering",null)},text:function(e,t,n){let i=Iu(n),r,a,o,s;M(i)?(a=i.map(l=>ba(n,l)),r=a.join(`
`),r!==Bt.text&&(yi(t,0),o=t.ownerDocument,s=ya(n),a.forEach((l,u)=>{const c=wa(o,"tspan",Ot);c.__data__=n,c.textContent=l,u&&(c.setAttribute("x",0),c.setAttribute("dy",s)),t.appendChild(c)}),Bt.text=r)):(a=ba(n,i),a!==Bt.text&&(t.textContent=a,Bt.text=a)),bn(t,"font-family",Mu(n)),bn(t,"font-size",Ui(n)+"px"),bn(t,"font-style",n.fontStyle),bn(t,"font-variant",n.fontVariant),bn(t,"font-weight",n.fontWeight)}};function Cb(e,t,n){n!==Bt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Bt[t]=n)}yn._update=function(e,t,n){Ar=t,Bt=t.__values__,VT(ic,n),e.attr(ic,n,this);const i=GU[e.type];i&&i.call(this,e,t,n),Ar&&this.style(Ar,n)};function ic(e,t,n){if(t===Bt[e])return;n?HU(Ar,e,t,n):bn(Ar,e,t),Bt[e]=t}function bn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function HU(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}yn.style=function(e,t){if(t==null)return;for(const n in $h){let i=n==="font"?Mu(t):t[n];if(i===Bt[n])continue;const r=$h[n];i==null?e.removeAttribute(r):(Wv(i)&&(i=GA(i,this._defs.gradient,eC())),e.setAttribute(r,i+"")),Bt[n]=i}};function eC(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function $b(e){bi.call(this,e),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}var Sr=P($b,bi),tC=bi.prototype;Sr.resize=function(e,t,n,i){tC.resize.call(this,e,t,n,i);var r=this._origin,a=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var s in el)o[s]=el[s];a.head=We("svg",o);var l=this._bgcolor;return(l==="transparent"||l==="none")&&(l=null),l?a.bg=We("rect",{width:this._width,height:this._height,fill:l})+Ve("rect"):a.bg="",a.root=We("g",ce({},Sb,{transform:"translate("+r+")"})),a.foot=Ve("g")+Ve("svg"),this},Sr.background=function(){var e=tC.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),e},Sr.svg=function(){var e=this._text;return e.head+e.defs+e.bg+e.root+e.body+e.foot},Sr._render=function(e){return this._text.body=this.mark(e),this._text.defs=this.buildDefs(),this},Sr.buildDefs=function(){let e="",t;for(const n in this._defs.gradient){const i=this._defs.gradient[n],r=i.stops;i.gradient==="radial"?(e+=We(t="pattern",{id:$d+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=We("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+Ve("rect"),e+=Ve(t),e+=We(t="radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):e+=We(t="linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let a=0;a<r.length;++a)e+=We("stop",{offset:r[a].offset,"stop-color":r[a].color})+Ve("stop");e+=Ve(t)}for(const n in this._defs.clipping){const i=this._defs.clipping[n];e+=We("clipPath",{id:n}),i.path?e+=We("path",{d:i.path})+Ve("path"):e+=We("rect",{x:0,y:0,width:i.width,height:i.height})+Ve("rect"),e+=Ve("clipPath")}return e?We("defs")+e+Ve("defs"):""},Sr.attr=function(e,t,n,i){const r={},a=(o,s,l,u)=>{r[u||o]=s};return Array.isArray(n)?n.forEach(o=>o(a,t,this)):n(a,t,this),i&&YU(r,t,e,i,this._defs),r},Sr.href=function(e){var t=this,n=e.href,i;if(n){if(i=t._hrefs&&t._hrefs[n])return i;t.sanitizeURL(n).then(r=>{r["xlink:href"]=r.href,r.href=null,(t._hrefs||(t._hrefs={}))[n]=r})}return null},Sr.mark=function(e){const t=Yn[e.marktype],n=t.tag,i=[VT,t.attr];let r="";r+=We("g",ce({class:iO(e),"clip-path":e.clip?oy(this,e,e.group):null},XT(e),{"pointer-events":n!=="g"&&e.interactive===!1?"none":null}));const a=o=>{const s=this.href(o);if(s&&(r+=We("a",s)),r+=We(n,this.attr(e,o,i,n!=="g"?n:null)),n==="text"){const l=Iu(o);if(M(l)){const u={x:0,dy:ya(o)};for(let c=0;c<l.length;++c)r+=We("tspan",c?u:null)+nC(ba(o,l[c]))+Ve("tspan")}else r+=nC(ba(o,l))}else if(n==="g"){const l=o.strokeForeground,u=o.fill,c=o.stroke;l&&c&&(o.stroke=null),r+=We("path",this.attr(e,o,t.background,"bgrect"))+Ve("path"),r+=We("g",this.attr(e,o,t.content))+this.markGroup(o)+Ve("g"),l&&c?(u&&(o.fill=null),o.stroke=c,r+=We("path",this.attr(e,o,t.foreground,"bgrect"))+Ve("path"),u&&(o.fill=u)):r+=We("path",this.attr(e,o,t.foreground,"bgfore"))+Ve("path")}r+=Ve(n),s&&(r+=Ve("a"))};return t.nested?e.items&&e.items.length&&a(e.items[0]):vi(e,a),r+Ve("g")},Sr.markGroup=function(e){let t="";return vi(e,n=>{t+=this.mark(n)}),t};function YU(e,t,n,i,r){if(t==null)return e;if(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null))return e;i==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),i==="text"&&(e["font-family"]=Mu(t),e["font-size"]=Ui(t)+"px",t.fontStyle&&(e["font-style"]=t.fontStyle),t.fontVariant&&(e["font-variant"]=t.fontVariant),t.fontWeight&&(e["font-weight"]=t.fontWeight));for(const a in $h){let o=t[a];const s=$h[a];o==="transparent"&&(s==="fill"||s==="stroke")||o!=null&&(Wv(o)&&(o=GA(o,r.gradient,"")),e[s]=o)}return e}function nC(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var iC="canvas",rC="png",aC="svg",oC="none",Oa={Canvas:iC,PNG:rC,SVG:aC,None:oC},cl={};cl[iC]=cl[rC]={renderer:ch,headless:ch,handler:zu},cl[aC]={renderer:Ob,headless:$b,handler:$y},cl[oC]={};function Rh(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(cl[e]=t,this):cl[e]}function sC(e,t,n){const i=[],r=new st().union(t),a=e.marktype;return a?lC(e,r,n,i):a==="group"?uC(e,r,n,i):F("Intersect scene must be mark node or group item.")}function lC(e,t,n,i){if(VU(e,t,n)){const r=e.items,a=e.marktype,o=r.length;let s=0;if(a==="group")for(;s<o;++s)uC(r[s],t,n,i);else for(const l=Yn[a].isect;s<o;++s){let u=r[s];cC(u,t,l)&&i.push(u)}}return i}function VU(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function uC(e,t,n,i){n&&n(e.mark)&&cC(e,t,Yn.group.isect)&&i.push(e);const r=e.items,a=r&&r.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let l=0;l<a;++l)lC(r[l],t,n,i);t.translate(o,s)}return i}function cC(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}var Db=new st();function fC(e){var t=e.clip;if(de(t))t(mn(Db.clear()));else if(t)Db.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(Db)}var XU=1e-9;function Rb(e,t,n){return e===t?!0:n==="path"?dC(e,t):e instanceof Date&&t instanceof Date?+e===+t:Ce(e)&&Ce(t)?Math.abs(e-t)<=XU:!e||!t||!K(e)&&!K(t)?e==t:e==null||t==null?!1:JU(e,t)}function dC(e,t){return Rb(Ys(e),Ys(t))}function JU(e,t){var n=Object.keys(e),i=Object.keys(t),r,a;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),a=n.length-1;a>=0;a--)if(n[a]!=i[a])return!1;for(a=n.length-1;a>=0;a--)if(r=n[a],!Rb(e[r],t[r],r))return!1;return typeof e===typeof t}function KU(){_S(),O8()}function hC(e){$.call(this,null,e)}var QU=P(hC,$);QU.transform=function(e,t){var n=t.dataflow,i=e.mark,r=i.marktype,a=Yn[r],o=a.bound,s=i.bounds,l;if(a.nested)i.items.length&&n.dirty(i.items[0]),s=Fh(i,o),i.items.forEach(function(u){u.bounds.clear().union(s)});else if(r===Td||e.modified()){t.visit(t.MOD,u=>n.dirty(u)),s.clear(),i.items.forEach(u=>s.union(Fh(u,o)));switch(i.role){case Lv:case zv:case Pv:t.reflow()}}else l=t.changed(t.REM),t.visit(t.ADD,u=>{s.union(Fh(u,o))}),t.visit(t.MOD,u=>{l=l||s.alignsWith(u.bounds),n.dirty(u),s.union(Fh(u,o))}),l&&(s.clear(),i.items.forEach(u=>s.union(u.bounds)));return fC(i),t.modifies("bounds")};function Fh(e,t,n){return t(e.bounds.clear(),e,n)}var pC=":vega_identifier:";function Fb(e){$.call(this,0,e)}Fb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};var ZU=P(Fb,$);ZU.transform=function(e,t){var n=eq(t.dataflow),i=n.value,r=e.as;return t.visit(t.ADD,a=>{a[r]||(a[r]=++i)}),n.set(this.value=i),t};function eq(e){var t=e._signals[pC];return t||(e._signals[pC]=t=e.add(0)),t}function gC(e){$.call(this,null,e)}var tq=P(gC,$);tq.transform=function(e,t){var n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,nq(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);var i=n.marktype===Td?Ud:Bd;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t};function nq(e){var t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function mC(e){$.call(this,null,e)}var iq=P(mC,$),vC={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{var n;return e.filter((i,r)=>!r||!yC(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}};function yC(e,t,n){return n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2)}function bC(e,t){for(var n=1,i=e.length,r=e[0].bounds,a;n<i;r=a,++n)if(yC(r,a=e[n].bounds,t))return!0}function rq(e){var t=e.bounds;return t.width()>1&&t.height()>1}function aq(e,t,n){var i=e.range(),r=new st();return t===Ws||t===da?r.set(i[0],-Infinity,i[1],Infinity):r.set(-Infinity,i[0],Infinity,i[1]),r.expand(n||1),a=>r.encloses(a.bounds)}function wC(e){return e.forEach(t=>t.opacity=1),e}function xC(e,t){return e.reflow(t.modified()).modifies("opacity")}iq.transform=function(e,t){var n=vC[e.method]||vC.parity,i=t.materialize(t.SOURCE).source,r=e.separation||0,a,o,s;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(wC(i),t=xC(t,e)),t;if(i=i.filter(rq),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),a=wC(i),t=xC(t,e),a.length>=3&&bC(a,r)){do a=n(a,r);while(a.length>=3&&bC(a,r));a.length<3&&!ve(i).opacity&&(a.length>1&&(ve(a).opacity=0),ve(i).opacity=1)}return e.boundScale&&e.boundTolerance>=0&&(o=aq(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(l=>{o(l)||(l.opacity=0)})),s=a[0].mark.bounds.clear(),i.forEach(l=>{l.opacity&&s.union(l.bounds)}),t};function EC(e){$.call(this,null,e)}var oq=P(EC,$);oq.transform=function(e,t){var n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){var i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}};const Ut=new st();function fl(e,t,n){return e[t]===n?0:(e[t]=n,1)}function sq(e){var t=e.items[0].orient;return t===pi||t===gi}function lq(e){var t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function uq(e,t,n,i){var r=t.items[0],a=r.datum,o=r.translate!=null?r.translate:.5,s=r.orient,l=lq(a),u=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,p=a.title&&r.items[l[2]].items[0],g=r.titlePadding,m=r.bounds,v=p&&xy(p),y=0,b=0,E,x;Ut.clear().union(m),m.clear(),(E=l[0])>-1&&m.union(r.items[E].bounds),(E=l[1])>-1&&m.union(r.items[E].bounds);switch(s){case Ws:y=f||0,b=-c,x=Math.max(d,Math.min(h,-m.y1)),m.add(0,-x).add(u,0),p&&Nh(e,p,x,g,v,0,-1,m);break;case pi:y=-c,b=f||0,x=Math.max(d,Math.min(h,-m.x1)),m.add(-x,0).add(0,u),p&&Nh(e,p,x,g,v,1,-1,m);break;case gi:y=n+c,b=f||0,x=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(x,u),p&&Nh(e,p,x,g,v,1,1,m);break;case da:y=f||0,b=i+c,x=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(u,x),p&&Nh(e,p,x,g,0,0,1,m);break;default:y=r.x,b=r.y}return Er(m.translate(y,b),r),fl(r,"x",y+o)|fl(r,"y",b+o)&&(r.bounds=Ut,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Nh(e,t,n,i,r,a,o,s){const l=t.bounds;if(t.auto){const u=o*(n+r+i);let c=0,f=0;e.dirty(t),a?c=(t.x||0)-(t.x=u):f=(t.y||0)-(t.y=u),t.mark.bounds.clear().union(l.translate(-c,-f)),e.dirty(t)}s.union(l)}const kC=(e,t)=>Math.floor(Math.min(e,t)),_C=(e,t)=>Math.ceil(Math.max(e,t));function cq(e){for(var t=e.items,n=t.length,i=0,r,a,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};i<n;++i)if(r=t[i],a=r.items,r.marktype===Td)switch(r.role){case Lv:case zv:case Pv:break;case jA:o.rowheaders.push(...a);break;case LA:o.rowfooters.push(...a);break;case zA:o.colheaders.push(...a);break;case BA:o.colfooters.push(...a);break;case PA:o.rowtitle=a[0];break;case UA:o.coltitle=a[0];break;default:o.marks.push(...a)}return o}function fq(e){return new st().set(0,0,e.width||0,e.height||0)}function dq(e){var t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Be(e,t,n){var i=K(e)?e[t]:e;return i??(n!==void 0?n:0)}function AC(e){return e<0?Math.ceil(-e):0}function SC(e,t,n){var i=!n.nodirty,r=n.bounds===qv?fq:dq,a=Ut.set(0,0,0,0),o=Be(n.align,ha),s=Be(n.align,pa),l=Be(n.padding,ha),u=Be(n.padding,pa),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),p=Array(c),g=0,m=Array(d),v=Array(f),y=0,b=Array(d),E=Array(d),x=Array(d),k,w,A,_,O,S,T,D,I,C,N;for(w=0;w<c;++w)p[w]=0;for(w=0;w<f;++w)v[w]=0;for(w=0;w<d;++w)S=t[w],O=x[w]=r(S),S.x=S.x||0,b[w]=0,S.y=S.y||0,E[w]=0,A=w%c,_=~~(w/c),g=Math.max(g,T=Math.ceil(O.x2)),y=Math.max(y,D=Math.ceil(O.y2)),p[A]=Math.max(p[A],T),v[_]=Math.max(v[_],D),h[w]=l+AC(O.x1),m[w]=u+AC(O.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c===0&&(h[w]=0),w<c&&(m[w]=0);if(o===Uv)for(A=1;A<c;++A){for(N=0,w=A;w<d;w+=c)N<h[w]&&(N=h[w]);for(w=A;w<d;w+=c)h[w]=N+p[A-1]}else if(o===Cd){for(N=0,w=0;w<d;++w)w%c&&N<h[w]&&(N=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=N+g)}else for(o=!1,A=1;A<c;++A)for(w=A;w<d;w+=c)h[w]+=p[A-1];if(s===Uv)for(_=1;_<f;++_){for(N=0,w=_*c,k=w+c;w<k;++w)N<m[w]&&(N=m[w]);for(w=_*c;w<k;++w)m[w]=N+v[_-1]}else if(s===Cd){for(N=0,w=c;w<d;++w)N<m[w]&&(N=m[w]);for(w=c;w<d;++w)m[w]=N+y}else for(s=!1,_=1;_<f;++_)for(w=_*c,k=w+c;w<k;++w)m[w]+=v[_-1];for(I=0,w=0;w<d;++w)I=h[w]+(w%c?I:0),b[w]+=I-t[w].x;for(A=0;A<c;++A)for(C=0,w=A;w<d;w+=c)C+=m[w],E[w]+=C-t[w].y;if(o&&Be(n.center,ha)&&f>1)for(w=0;w<d;++w)O=o===Cd?g:p[w%c],I=O-x[w].x2-t[w].x-b[w],I>0&&(b[w]+=I/2);if(s&&Be(n.center,pa)&&c!==1)for(w=0;w<d;++w)O=s===Cd?y:v[~~(w/c)],C=O-x[w].y2-t[w].y-E[w],C>0&&(E[w]+=C/2);for(w=0;w<d;++w)a.union(x[w].translate(b[w],E[w]));I=Be(n.anchor,y8),C=Be(n.anchor,b8);switch(Be(n.anchor,ha)){case Jt:I-=a.width();break;case jv:I-=a.width()/2}switch(Be(n.anchor,pa)){case Jt:C-=a.height();break;case jv:C-=a.height()/2}for(I=Math.round(I),C=Math.round(C),a.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)S=t[w],S.x+=b[w]+=I,S.y+=E[w]+=C,a.union(S.mark.bounds.union(S.bounds.translate(b[w],E[w]))),i&&e.dirty(S);return a}function hq(e,t,n){var i=cq(t),r=i.marks,a=n.bounds===qv?pq:gq,o=n.offset,s=n.columns||r.length,l=s<=0?1:Math.ceil(r.length/s),u=l*s,c,f,d,h,p,g,m;const v=SC(e,r,n);v.empty()&&v.set(0,0,0,0),i.rowheaders&&(g=Be(n.headerBand,pa,null),c=Ih(e,i.rowheaders,r,s,l,-Be(o,"rowHeader"),kC,0,a,"x1",0,s,1,g)),i.colheaders&&(g=Be(n.headerBand,ha,null),f=Ih(e,i.colheaders,r,s,s,-Be(o,"columnHeader"),kC,1,a,"y1",0,1,s,g)),i.rowfooters&&(g=Be(n.footerBand,pa,null),d=Ih(e,i.rowfooters,r,s,l,Be(o,"rowFooter"),_C,0,a,"x2",s-1,s,1,g)),i.colfooters&&(g=Be(n.footerBand,ha,null),h=Ih(e,i.colfooters,r,s,s,Be(o,"columnFooter"),_C,1,a,"y2",u-s,1,s,g)),i.rowtitle&&(p=Be(n.titleAnchor,pa),m=Be(o,"rowTitle"),m=p===Jt?d+m:c-m,g=Be(n.titleBand,pa,.5),OC(e,i.rowtitle,m,0,v,g)),i.coltitle&&(p=Be(n.titleAnchor,ha),m=Be(o,"columnTitle"),m=p===Jt?h+m:f-m,g=Be(n.titleBand,ha,.5),OC(e,i.coltitle,m,1,v,g))}function pq(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function gq(e,t){return e.bounds[t]}function Ih(e,t,n,i,r,a,o,s,l,u,c,f,d,h){var p=n.length,g=0,m=0,v,y,b,E,x,k,w,A,_;if(!p)return g;for(v=c;v<p;v+=f)n[v]&&(g=o(g,l(n[v],u)));if(!t.length)return g;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),g+=a,y=0,E=t.length;y<E;++y)e.dirty(t[y]),t[y].mark.bounds.clear();for(v=c,y=0,E=t.length;y<E;++y,v+=f){for(k=t[y],x=k.mark.bounds,b=v;b>=0&&(w=n[b])==null;b-=d);s?(A=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),_=g):(A=g,_=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),x.union(k.bounds.translate(A-(k.x||0),_-(k.y||0))),k.x=A,k.y=_,e.dirty(k),m=o(m,x[u])}return m}function OC(e,t,n,i,r,a){if(!t)return;e.dirty(t);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}function mq(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function vq(e,t){var n=-Infinity;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-Infinity?n:t}function yq(e,t,n,i,r,a,o){const s=mq(n,t),l=vq(e,s("offset",0)),u=s("anchor",Mv),c=u===Jt?1:u===jv?.5:0,f={align:Uv,bounds:s("bounds",qv),columns:s("direction")==="vertical"?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case pi:f.anchor={x:Math.floor(i.x1)-l,column:Jt,y:c*(o||i.height()+2*i.y1),row:u};break;case gi:f.anchor={x:Math.ceil(i.x2)+l,y:c*(o||i.height()+2*i.y1),row:u};break;case Ws:f.anchor={y:Math.floor(r.y1)-l,row:Jt,x:c*(a||r.width()+2*r.x1),column:u};break;case da:f.anchor={y:Math.ceil(r.y2)+l,x:c*(a||r.width()+2*r.x1),column:u};break;case p8:f.anchor={x:l,y:l};break;case g8:f.anchor={x:a-l,y:l,column:Jt};break;case m8:f.anchor={x:l,y:o-l,row:Jt};break;case v8:f.anchor={x:a-l,y:o-l,column:Jt,row:Jt};break}return f}function bq(e,t){var n=t.items[0],i=n.datum,r=n.orient,a=n.bounds,o=n.x,s=n.y,l,u;return n._bounds?n._bounds.clear().union(a):n._bounds=a.clone(),a.clear(),xq(e,n,n.items[0].items[0]),a=wq(n,a),l=2*n.padding,u=2*n.padding,a.empty()||(l=Math.ceil(a.width()+l),u=Math.ceil(a.height()+u)),i.type===k8&&Eq(n.items[0].items[0].items[0].items),r!==Bv&&(n.x=o=0,n.y=s=0),n.width=l,n.height=u,Er(a.set(o,s,o+l,s+u),n),n.mark.bounds.clear().union(a),n}function wq(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function xq(e,t,n){var i=t.padding,r=i-n.x,a=i-n.y;if(!t.datum.title)(r||a)&&rc(e,n,r,a);else{var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=i-o.x,c=i-o.y;switch(o.orient){case pi:r+=Math.ceil(o.bounds.width())+l;break;case gi:case da:break;default:a+=o.bounds.height()+l}(r||a)&&rc(e,n,r,a);switch(o.orient){case pi:c+=dl(t,n,o,s,1,1);break;case gi:u+=dl(t,n,o,Jt,0,0)+l,c+=dl(t,n,o,s,1,1);break;case da:u+=dl(t,n,o,s,0,0),c+=dl(t,n,o,Jt,-1,0,1)+l;break;default:u+=dl(t,n,o,s,0,0)}(u||c)&&rc(e,o,u,c),(u=Math.round(o.bounds.x1-i))<0&&(rc(e,n,-u,0),rc(e,o,-u,0))}}function dl(e,t,n,i,r,a,o){const s=e.datum.type!=="symbol",l=n.datum.vgrad,u=s&&(a||!l)&&!o?t.items[0]:t,c=u.bounds[r?"y2":"x2"]-e.padding,f=l&&a?c:0,d=l&&a?0:c,h=r<=0?0:xy(n);return Math.round(i===Mv?f:i===Jt?d-h:.5*(c-h))}function rc(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function Eq(e){var t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function kq(e,t,n,i,r){var a=t.items[0],o=a.frame,s=a.orient,l=a.anchor,u=a.offset,c=a.padding,f=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],h=s===pi||s===gi?i:n,p=0,g=0,m=0,v=0,y=0,b;if(o!==Td?s===pi?(p=r.y2,h=r.y1):s===gi?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2):s===pi&&(p=i,h=0),b=l===Mv?p:l===Jt?h:(p+h)/2,d&&d.text){switch(s){case Ws:case da:y=f.bounds.height()+c;break;case pi:v=f.bounds.width()+c;break;case gi:v=-f.bounds.width()-c;break}Ut.clear().union(d.bounds),Ut.translate(v-(d.x||0),y-(d.y||0)),fl(d,"x",v)|fl(d,"y",y)&&(e.dirty(d),d.bounds.clear().union(Ut),d.mark.bounds.clear().union(Ut),e.dirty(d)),Ut.clear().union(d.bounds)}else Ut.clear();Ut.union(f.bounds);switch(s){case Ws:g=b,m=r.y1-Ut.height()-u;break;case pi:g=r.x1-Ut.width()-u,m=b;break;case gi:g=r.x2+Ut.width()+u,m=b;break;case da:g=b,m=r.y2+u;break;default:g=a.x,m=a.y}return fl(a,"x",g)|fl(a,"y",m)&&(Ut.translate(g,m),e.dirty(a),a.bounds.clear().union(Ut),t.bounds.clear().union(Ut),e.dirty(a)),a.bounds}function TC(e){$.call(this,null,e)}var _q=P(TC,$);_q.transform=function(e,t){var n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&hq(n,i,e.layout),Sq(n,i,e)}),Aq(e.mark.group)?t.reflow():t};function Aq(e){return e&&e.mark.role!=="legend-entry"}function Sq(e,t,n){var i=t.items,r=Math.max(0,t.width||0),a=Math.max(0,t.height||0),o=new st().set(0,0,r,a),s=o.clone(),l=o.clone(),u=[],c,f,d,h,p,g;for(p=0,g=i.length;p<g;++p){f=i[p];switch(f.role){case Lv:h=sq(f)?s:l,h.union(uq(e,f,r,a));break;case Pv:c=f;break;case zv:u.push(bq(e,f));break;case w8:case x8:case jA:case LA:case PA:case zA:case BA:case UA:s.union(f.bounds),l.union(f.bounds);break;default:o.union(f.bounds)}}if(u.length){const m={};u.forEach(v=>{d=v.orient||gi,d!==Bv&&(m[d]||(m[d]=[])).push(v)});for(let v in m){const y=m[v];SC(e,y,yq(y,v,n.legends,s,l,r,a))}u.forEach(v=>{const y=v.bounds;if(y.equals(v._bounds)||(v.bounds=v._bounds,e.dirty(v),v.bounds=y,e.dirty(v)),n.autosize&&n.autosize.type===qA)switch(v.orient){case pi:case gi:o.add(y.x1,0).add(y.x2,0);break;case Ws:case da:o.add(0,y.y1).add(0,y.y2)}else o.union(y)})}o.union(s).union(l),c&&o.union(kq(e,c,r,a,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),Oq(e,t,o,n)}function Oq(e,t,n,i){const r=i.autosize||{},a=r.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),f=Math.max(0,t.height||0),d=Math.max(0,Math.ceil(-n.y1)),h=Math.max(0,Math.ceil(n.y2-f));if(r.contains===E8){const p=e.padding();o-=p.left+p.right,s-=p.top+p.bottom}a===Bv?(u=0,d=0,l=o,f=s):a===qA?(l=Math.max(0,o-u-c),f=Math.max(0,s-d-h)):a===_8?(l=Math.max(0,o-u-c),s=f+d+h):a===A8?(o=l+u+c,f=Math.max(0,s-d-h)):a===S8&&(o=l+u+c,s=f+d+h),e._resizeView(o,s,l,f,[u,d],r.resize)}var Tq=Object.freeze({__proto__:null,bound:hC,identifier:Fb,mark:gC,overlap:mC,render:EC,viewlayout:TC});function CC(e){$.call(this,null,e)}var Cq=P(CC,$);Cq.transform=function(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,s=bb(a,o,e.minstep),l=e.format||IT(n,a,s,e.formatSpecifier,e.formatType,!!e.values),u=e.values?NT(a,e.values,s):wb(a,s);return r&&(i.rem=r),r=u.map(function(c,f){return ke({index:f/(u.length-1||1),value:c,label:l(c)})}),e.extra&&r.length&&r.push(ke({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i};function $C(e){$.call(this,null,e)}var $q=P($C,$);function Dq(){return ke({})}function Rq(e){const t=Ts().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}$q.transform=function(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||Dq,a=e.key||ee,o=this.value;return M(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(a))&&F("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=Rq(a)),t.visit(t.ADD,s=>{const l=a(s);let u=o.get(l);u?u.exit?(o.empty--,i.add.push(u)):i.mod.push(u):(u=r(s),o.set(l,u),i.add.push(u)),u.datum=s,u.exit=!1}),t.visit(t.MOD,s=>{const l=a(s),u=o.get(l);u&&(u.datum=s,i.mod.push(u))}),t.visit(t.REM,s=>{const l=a(s),u=o.get(l);s===u.datum&&!u.exit&&(i.rem.push(u),u.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i};function DC(e){$.call(this,null,e)}var Fq=P(DC,$);Fq.transform=function(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,a=t.encode;if(M(a))if(n.changed()||a.every(function(d){return r[d]}))a=a[0],n.encode=null;else return t.StopPropagation;var o=a==="enter",s=r.update||ta,l=r.enter||ta,u=r.exit||ta,c=(a&&!o?r[a]:s)||ta;if(t.changed(t.ADD)&&(t.visit(t.ADD,function(d){l(d,e),s(d,e)}),n.modifies(l.output),n.modifies(s.output),c!==ta&&c!==s&&(t.visit(t.ADD,function(d){c(d,e)}),n.modifies(c.output))),t.changed(t.REM)&&u!==ta&&(t.visit(t.REM,function(d){u(d,e)}),n.modifies(u.output)),o||c!==ta){var f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,function(d){var h=l(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(l.output)):t.visit(f,function(d){(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation};function RC(e){$.call(this,[],e)}var Nq=P(RC,$);Nq.transform=function(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,a=e.type||Ch,o=e.scale,s=+e.limit,l=bb(o,e.count==null?5:e.count,e.minstep),u=!!e.values||a===Ch,c=e.format||PT(n,o,l,a,e.formatSpecifier,e.formatType,u),f=e.values||LT(o,l),d,h,p,g,m;return r&&(i.rem=r),a===Ch?(s&&f.length>s?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,s-1),m=!0):r=f,de(p=e.size)?(!e.values&&o(r[0])===0&&(r=r.slice(1)),g=r.reduce(function(v,y){return Math.max(v,p(y,e))},0)):p=Mt(g=p||8),r=r.map(function(v,y){return ke({index:y,label:c(v,y,r),value:v,offset:g,size:p(v,e)})}),m&&(m=f[r.length],r.push(ke({index:r.length,label:`â€¦${f.length-r.length} entries`,value:m,offset:g,size:p(m,e)})))):a===wU?(d=o.domain(),h=$T(o,d[0],ve(d)),f.length<3&&!e.values&&d[0]!==ve(d)&&(f=[d[0],ve(d)]),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:h(v)})})):(p=f.length-1,h=DU(o),r=f.map(function(v,y){return ke({index:y,label:c(v,y,f),value:v,perc:y?h(v):0,perc2:y===p?1:h(f[y+1])})})),i.source=r,i.add=r,this.value=r,i};var FC=Ts({line:NC,"line-radial":zq,arc:IC,"arc-radial":Bq,curve:MC,"curve-radial":Uq,"orthogonal-horizontal":qq,"orthogonal-vertical":Wq,"orthogonal-radial":Gq,"diagonal-horizontal":Hq,"diagonal-vertical":Yq,"diagonal-radial":Vq});function Iq(e){return e.source.x}function Mq(e){return e.source.y}function jq(e){return e.target.x}function Lq(e){return e.target.y}function Nb(e){$.call(this,{},e)}Nb.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};var Pq=P(Nb,$);Pq.transform=function(e,t){var n=e.sourceX||Iq,i=e.sourceY||Mq,r=e.targetX||jq,a=e.targetY||Lq,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=FC.get(l+"-"+s)||FC.get(l);return u||F("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,function(c){c[o]=u(n(c),i(c),r(c),a(c))}),t.reflow(e.modified()).modifies(o)};function NC(e,t,n,i){return"M"+e+","+t+"L"+n+","+i}function zq(e,t,n,i){return NC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function IC(e,t,n,i){var r=n-e,a=i-t,o=Math.sqrt(r*r+a*a)/2,s=180*Math.atan2(a,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+s+" 0 1 "+n+","+i}function Bq(e,t,n,i){return IC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function MC(e,t,n,i){var r=n-e,a=i-t,o=.2*(r+a),s=.2*(a-r);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(i-o)+" "+n+","+i}function Uq(e,t,n,i){return MC(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n))}function qq(e,t,n,i){return"M"+e+","+t+"V"+i+"H"+n}function Wq(e,t,n,i){return"M"+e+","+t+"H"+n+"V"+i}function Gq(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*a+"A"+t+","+t+" 0 0,"+(l?1:0)+" "+t*o+","+t*s+"L"+i*o+","+i*s}function Hq(e,t,n,i){var r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i}function Yq(e,t,n,i){var r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i}function Vq(e,t,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+i)/2;return"M"+t*r+","+t*a+"C"+l*r+","+l*a+" "+l*o+","+l*s+" "+i*o+","+i*s}function Ib(e){$.call(this,null,e)}Ib.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};var Xq=P(Ib,$);Xq.transform=function(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],a=e.field||Ss,o=e.startAngle||0,s=e.endAngle!=null?e.endAngle:2*Math.PI,l=t.source,u=l.map(a),c=u.length,f=o,d=(s-o)/Ck(u),h=ho(c),p,g,m;for(e.sort&&h.sort(function(v,y){return u[v]-u[y]}),p=0;p<c;++p)m=u[h[p]],g=l[h[p]],g[i]=f,g[r]=f+=m*d;return this.value=u,t.reflow(e.modified()).modifies(n)};var Jq=5;function Kq(e){const t=e.type;return!e.bins&&(t===nl||t===Bu||t===Uu)}function jC(e){return gb(e)&&e!==qi}var Qq=pt(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function LC(e){$.call(this,null,e),this.modified(!0)}var Zq=P(LC,$);Zq.transform=function(e,t){var n=t.dataflow,i=this.value,r=eW(e);(!i||r!==i.type)&&(this.value=i=Ee(r)());for(r in e)if(!Qq[r]){if(r==="padding"&&jC(i.type))continue;de(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return oW(i,e,aW(i,e,nW(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function eW(e){var t=e.type,n="",i;return t===qi?qi+"-"+nl:(tW(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?qi+"-":i===3?il+"-":""),(n+t||nl).toLowerCase())}function tW(e){const t=e.type;return gb(t)&&t!==Oo&&t!==To&&(e.scheme||e.range&&e.range.length&&e.range.every(Y))}function nW(e,t,n){var i=iW(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,a=e.type,o=t.zero||t.zero===void 0&&Kq(e),s,l;if(!r)return 0;if(jC(a)&&t.padding&&r[0]!==ve(r)&&(r=rW(a,r,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(s=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[s]<0&&(r[s]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[s]=t.domainMax),t.domainMid!=null)){l=t.domainMid;const u=l>r[s]?s+1:l<r[0]?0:s;u!==s&&n.warn("Scale domainMid exceeds domain min or max.",l),r.splice(u,0,l)}return e.domain(PC(a,r,n)),a===Fy&&e.unknown(t.domainImplicit?jy:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&bb(e,t.nice)||null),r.length}function iW(e,t,n){return t?(e.domain(PC(e.type,t,n)),t.length):-1}function rW(e,t,n,i,r,a){var o=Math.abs(ve(n)-n[0]),s=o/(o-2*i),l=e===kr?qm(t,null,s):e===Uu?Xf(t,null,s,.5):e===Bu?Xf(t,null,s,r||1):e===dh?Wm(t,null,s,a||1):Um(t,null,s);return t=t.slice(),t[0]=l[0],t[t.length-1]=l[1],t}function PC(e,t,n){if(AT(e)){var i=Math.abs(t.reduce(function(r,a){return r+(a<0?-1:a>0?1:0)},0));i!==t.length&&n.warn("Log scale domain includes zero: "+B(t))}return t}function aW(e,t,n){let i=t.bins;if(i&&!M(i)){let r=e.domain(),a=r[0],o=ve(r),s=i.start==null?a:i.start,l=i.stop==null?o:i.stop,u=i.step;u||F("Scale bins parameter missing step property."),s<a&&(s=u*Math.ceil(a/u)),l>o&&(l=u*Math.floor(o/u)),i=ho(s,l+u/2,u)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Iy&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function oW(e,t,n){var i=e.type,r=t.round||!1,a=t.range;if(t.rangeStep!=null)a=sW(i,t,n);else if(t.scheme&&(a=lW(i,t,n),de(a))){if(e.interpolator)return e.interpolator(a);F(`Scale type ${i} does not support interpolating color schemes.`)}if(a&&ST(i))return e.interpolator(Th(Mb(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(vb(t.interpolate,t.interpolateGamma)):de(e.round)?e.round(r):de(e.rangeRound)&&e.interpolate(r?Xu:Do),a&&e.range(Mb(a,t.reverse))}function sW(e,t,n){e!==dO&&e!==Ny&&F("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===Ny?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Ry(n,r,i)]}function lW(e,t,n){var i=t.schemeExtent,r,a;return M(t.scheme)?a=Th(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),a=yb(r),a||F(`Unrecognized scheme name: ${t.scheme}`)),n=e===ph?n+1:e===Iy?n-1:e===rl||e===hh?+t.schemeCount||Jq:n,ST(e)?zC(a,i,t.reverse):de(a)?CT(zC(a,i),n):e===Fy?a:a.slice(0,n)}function zC(e,t,n){return de(e)&&(t||n)?TT(e,Mb(t||[0,1],n)):e}function Mb(e,t){return t?e.slice().reverse():e}function BC(e){$.call(this,null,e)}var uW=P(BC,$);uW.transform=function(e,t){var n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(co(e.sort)),this.modified(n),t};var UC="zero",qC="center",WC="normalize",GC=["y0","y1"];function jb(e){$.call(this,null,e)}jb.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:UC,values:[UC,qC,WC]},{name:"as",type:"string",array:!0,length:2,default:GC}]};var cW=P(jb,$);cW.transform=function(e,t){var n=e.as||GC,i=n[0],r=n[1],a=co(e.sort),o=e.field||Ss,s=e.offset===qC?fW:e.offset===WC?dW:hW,l,u,c,f;for(l=pW(t.source,e.groupby,a,o),u=0,c=l.length,f=l.max;u<c;++u)s(l[u],f,o,i,r);return t.reflow(e.modified()).modifies(n)};function fW(e,t,n,i,r){for(var a=(t-e.sum)/2,o=e.length,s=0,l;s<o;++s)l=e[s],l[i]=a,l[r]=a+=Math.abs(n(l))}function dW(e,t,n,i,r){for(var a=1/e.sum,o=0,s=e.length,l=0,u=0,c;l<s;++l)c=e[l],c[i]=o,c[r]=o=a*(u+=Math.abs(n(c)))}function hW(e,t,n,i,r){for(var a=0,o=0,s=e.length,l=0,u,c;l<s;++l)c=e[l],u=+n(c),u<0?(c[i]=o,c[r]=o+=u):(c[i]=a,c[r]=a+=u)}function pW(e,t,n,i){var r=[],a=function(g){return g(c)},o,s,l,u,c,f,d,h,p;if(t==null)r.push(e.slice());else for(o={},s=0,l=e.length;s<l;++s)c=e[s],f=t.map(a),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(c);for(f=0,p=0,u=r.length;f<u;++f){for(d=r[f],s=0,h=0,l=d.length;s<l;++s)h+=Math.abs(i(d[s]));d.sum=h,h>p&&(p=h),n&&d.sort(n)}return r.max=p,r}var gW=Object.freeze({__proto__:null,axisticks:CC,datajoin:$C,encode:DC,legendentries:RC,linkpath:Nb,pie:Ib,scale:LC,sortitems:BC,stack:jb});function mW(){}const Or=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function HC(){var e=1,t=1,n=s;function i(l,u){return u.map(c=>r(l,c))}function r(l,u){var c=[],f=[];return a(l,u,function(d){n(d,l,u),vW(d)>0?c.push([d]):f.push(d)}),f.forEach(function(d){for(var h=0,p=c.length,g;h<p;++h)if(yW((g=c[h])[0],d)!==-1){g.push(d);return}}),{type:"MultiPolygon",value:u,coordinates:c}}function a(l,u,c){var f=new Array(),d=new Array(),h,p,g,m,v,y;for(h=p=-1,m=l[0]>=u,Or[m<<1].forEach(b);++h<e-1;)g=m,m=l[h+1]>=u,Or[g|m<<1].forEach(b);for(Or[m<<0].forEach(b);++p<t-1;){for(h=-1,m=l[p*e+e]>=u,v=l[p*e]>=u,Or[m<<1|v<<2].forEach(b);++h<e-1;)g=m,m=l[p*e+e+h+1]>=u,y=v,v=l[p*e+h+1]>=u,Or[g|m<<1|v<<2|y<<3].forEach(b);Or[m|v<<3].forEach(b)}for(h=-1,v=l[p*e]>=u,Or[v<<2].forEach(b);++h<e-1;)y=v,v=l[p*e+h+1]>=u,Or[v<<2|y<<3].forEach(b);Or[v<<3].forEach(b);function b(E){var x=[E[0][0]+h,E[0][1]+p],k=[E[1][0]+h,E[1][1]+p],w=o(x),A=o(k),_,O;(_=d[w])?(O=f[A])?(delete d[_.end],delete f[O.start],_===O?(_.ring.push(k),c(_.ring)):f[_.start]=d[O.end]={start:_.start,end:O.end,ring:_.ring.concat(O.ring)}):(delete d[_.end],_.ring.push(k),d[_.end=A]=_):(_=f[A])?(O=d[w])?(delete f[_.start],delete d[O.end],_===O?(_.ring.push(k),c(_.ring)):f[O.start]=d[_.end]={start:O.start,end:_.end,ring:O.ring.concat(_.ring)}):(delete f[_.start],_.ring.unshift(x),f[_.start=w]=_):f[w]=d[A]={start:w,end:A,ring:[x,k]}}}function o(l){return l[0]*2+l[1]*(e+1)*4}function s(l,u,c){l.forEach(function(f){var d=f[0],h=f[1],p=d|0,g=h|0,m,v=u[g*e+p];d>0&&d<e&&p===d&&(m=u[g*e+p-1],f[0]=d+(c-m)/(v-m)-.5),h>0&&h<t&&g===h&&(m=u[(g-1)*e+p],f[1]=h+(c-m)/(v-m)-.5)})}return i.contour=r,i.size=function(l){if(!arguments.length)return[e,t];var u=Math.floor(l[0]),c=Math.floor(l[1]);return u>=0&&c>=0||F("invalid size"),e=u,t=c,i},i.smooth=function(l){return arguments.length?(n=l?s:mW,i):n===s},i}function vW(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function yW(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=bW(e,t[n]))return r;return 0}function bW(e,t){for(var n=t[0],i=t[1],r=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(wW(l,f,t))return 0;c>i!==h>i&&n<(d-u)*(i-c)/(h-c)+u&&(r=-r)}return r}function wW(e,t,n){var i;return xW(e,t,n)&&EW(e[i=+(e[0]===t[0])],n[i],t[i])}function xW(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function EW(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function YC(e,t,n){return function(i){var r=Mi(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,l=t?sa(a,o,e):s/(e+1);return ho(l,o,l)}}function Lb(e){$.call(this,null,e)}Lb.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};var kW=P(Lb,$);kW.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||It,a=HC().smooth(e.smooth!==!1),o=e.thresholds||_W(i,r,e),s=e.as===null?null:e.as||"contour",l=[];return i.forEach(u=>{const c=r(u),f=a.size([c.width,c.height])(c.values,M(o)?o:o(c.values));AW(f,c,u,e),f.forEach(d=>{l.push(Qm(u,ke(s!=null?{[s]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function _W(e,t,n){const i=YC(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>po(t(r).values)))}function AW(e,t,n,i){let r=i.scale||t.scale,a=i.translate||t.translate;if(de(r)&&(r=r(n,i)),de(a)&&(a=a(n,i)),(r===1||r==null)&&!a)return;const o=(Ce(r)?r:r[0])||1,s=(Ce(r)?r:r[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(VC(t,o,s,l,u))}function VC(e,t,n,i,r){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(f){f.forEach(u)}function u(f){s&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-a)*t+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(l),f}}function XC(e,t,n){const i=e>=0?e:Y0(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Pb(e){return de(e)?e:Mt(+e)}function JC(){var e=l=>l[0],t=l=>l[1],n=Ss,i=[-1,-1],r=960,a=500,o=2;function s(l,u){const c=XC(i[0],l,e)>>o,f=XC(i[1],l,t)>>o,d=c?c+2:0,h=f?f+2:0,p=2*d+(r>>o),g=2*h+(a>>o),m=new Float32Array(p*g),v=new Float32Array(p*g);let y=m;l.forEach(E=>{const x=d+(+e(E)>>o),k=h+(+t(E)>>o);x>=0&&x<p&&k>=0&&k<g&&(m[x+k*p]+=+n(E))}),c>0&&f>0?(hl(p,g,m,v,c),pl(p,g,v,m,f),hl(p,g,m,v,c),pl(p,g,v,m,f),hl(p,g,m,v,c),pl(p,g,v,m,f)):c>0?(hl(p,g,m,v,c),hl(p,g,v,m,c),hl(p,g,m,v,c),y=v):f>0&&(pl(p,g,m,v,f),pl(p,g,v,m,f),pl(p,g,m,v,f),y=v);let b=u?Math.pow(2,-2*o):1/Ck(y);for(let E=0,x=p*g;E<x;++E)y[E]*=b;return{values:y,scale:1<<o,width:p,height:g,x1:d,y1:h,x2:d+(r>>o),y2:h+(a>>o)}}return s.x=function(l){return arguments.length?(e=Pb(l),s):e},s.y=function(l){return arguments.length?(t=Pb(l),s):t},s.weight=function(l){return arguments.length?(n=Pb(l),s):n},s.size=function(l){if(!arguments.length)return[r,a];var u=+l[0],c=+l[1];return u>=0&&c>=0||F("invalid size"),r=u,a=c,s},s.cellSize=function(l){return arguments.length?((l=+l)>=1||F("invalid cell size"),o=Math.floor(Math.log(l)/Math.LN2),s):1<<o},s.bandwidth=function(l){return arguments.length?(l=G(l),l.length===1&&(l=[+l[0],+l[0]]),l.length!==2&&F("invalid bandwidth"),i=l,s):i},s}function hl(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[s+o*e]),s>=r&&(s>=a&&(l-=n[s-a+o*e]),i[s-r+o*e]=l/Math.min(s+1,e-1+a-s,a))}function pl(e,t,n,i,r){const a=(r<<1)+1;for(let o=0;o<e;++o)for(let s=0,l=0;s<t+r;++s)s<t&&(l+=n[o+s*e]),s>=r&&(s>=a&&(l-=n[o+(s-a)*e]),i[o+(s-r)*e]=l/Math.min(s+1,t-1+a-s,a))}function zb(e){$.call(this,null,e)}zb.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var SW=P(zb,$);const OW=["x","y","weight","size","cellSize","bandwidth"];function KC(e,t){return OW.forEach(n=>t[n]!=null?e[n](t[n]):0),e}SW.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=TW(i,e.groupby),a=(e.groupby||[]).map(Ye),o=KC(JC(),e),s=e.as||"grid",l=[];function u(c,f){for(let d=0;d<a.length;++d)c[a[d]]=f[d];return c}return l=r.map(c=>ke(u({[s]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};function TW(e,t){var n=[],i=c=>c(s),r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function Bb(e){$.call(this,null,e)}Bb.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};var CW=P(Bb,$);CW.transform=function(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=HC().smooth(e.smooth!==!1),r=e.values,a=e.thresholds||YC(e.count||10,e.nice,!!r),o=e.size,s,l;return r||(r=t.materialize(t.SOURCE).source,s=KC(JC(),e)(r,!0),l=VC(s,s.scale||1,s.scale||1,0,0),o=[s.width,s.height],r=s.values),a=M(a)?a:a(r),r=i.size(o)(r,a),l&&r.forEach(l),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(ke),n};var Ub="Feature",qb="FeatureCollection",$W="MultiPoint";function Wb(e){$.call(this,null,e)}Wb.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};var DW=P(Wb,$);DW.transform=function(e,t){var n=this._features,i=this._points,r=e.fields,a=r&&r[0],o=r&&r[1],s=e.geojson||!r&&It,l=t.ADD,u;u=e.modified()||t.changed(t.REM)||t.modified(Nt(s))||a&&t.modified(Nt(a))||o&&t.modified(Nt(o)),(!this.value||u)&&(l=t.SOURCE,this._features=n=[],this._points=i=[]),s&&t.visit(l,function(c){n.push(s(c))}),a&&o&&(t.visit(l,function(c){var f=a(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:Ub,geometry:{type:$W,coordinates:i}})),this.value={type:qb,features:n}};function No(){return new Mh()}function Mh(){this.reset()}Mh.prototype={constructor:Mh,reset:function(){this.s=this.t=0},add:function(e){QC(jh,e,this.t),QC(this,jh.s,this.s),this.s?this.t+=jh.t:this.s=jh.t},valueOf:function(){return this.s}};var jh=new Mh();function QC(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var ie=1e-6,Gb=1e-12,he=Math.PI,Xe=he/2,Lh=he/4,Kt=he*2,tt=180/he,pe=he/180,ye=Math.abs,gl=Math.atan,Jn=Math.atan2,re=Math.cos,Ph=Math.ceil,ZC=Math.exp,zh=Math.log,Hb=Math.pow,te=Math.sin,Kn=Math.sign||function(e){return e>0?1:e<0?-1:0},Tt=Math.sqrt,Yb=Math.tan;function e$(e){return e>1?0:e<-1?he:Math.acos(e)}function wn(e){return e>1?Xe:e<-1?-Xe:Math.asin(e)}function Ct(){}function Bh(e,t){e&&n$.hasOwnProperty(e.type)&&n$[e.type](e,t)}var t$={Feature:function(e,t){Bh(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Bh(n[i].geometry,t)}},n$={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Vb(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Vb(n[i],t,0)},Polygon:function(e,t){i$(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)i$(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Bh(n[i],t)}};function Vb(e,t,n){var i=-1,r=e.length-n,a;for(t.lineStart();++i<r;)a=e[i],t.point(a[0],a[1],a[2]);t.lineEnd()}function i$(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Vb(e[n],t,1);t.polygonEnd()}function Tr(e,t){e&&t$.hasOwnProperty(e.type)?t$[e.type](e,t):Bh(e,t)}var Uh=No(),qh=No(),r$,a$,Xb,Jb,Kb,Vi={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){Uh.reset(),Vi.lineStart=RW,Vi.lineEnd=FW},polygonEnd:function(){var e=+Uh;qh.add(e<0?Kt+e:e),this.lineStart=this.lineEnd=this.point=Ct},sphere:function(){qh.add(Kt)}};function RW(){Vi.point=NW}function FW(){o$(r$,a$)}function NW(e,t){Vi.point=o$,r$=e,a$=t,e*=pe,t*=pe,Xb=e,Jb=re(t=t/2+Lh),Kb=te(t)}function o$(e,t){e*=pe,t*=pe,t=t/2+Lh;var n=e-Xb,i=n>=0?1:-1,r=i*n,a=re(t),o=te(t),s=Kb*o,l=Jb*a+s*re(r),u=s*i*te(r);Uh.add(Jn(u,l)),Xb=e,Jb=a,Kb=o}function IW(e){return qh.reset(),Tr(e,Vi),qh*2}function Wh(e){return[Jn(e[1],e[0]),wn(e[2])]}function Io(e){var t=e[0],n=e[1],i=re(n);return[i*re(t),i*te(t),te(n)]}function Gh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ml(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Qb(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Hh(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Yh(e){var t=Tt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ge,xn,Je,jn,Mo,s$,l$,vl,ac=No(),Ta,Cr,$r={point:Zb,lineStart:c$,lineEnd:f$,polygonStart:function(){$r.point=d$,$r.lineStart=MW,$r.lineEnd=jW,ac.reset(),Vi.polygonStart()},polygonEnd:function(){Vi.polygonEnd(),$r.point=Zb,$r.lineStart=c$,$r.lineEnd=f$,Uh<0?(Ge=-(Je=180),xn=-(jn=90)):ac>ie?jn=90:ac<-ie&&(xn=-90),Cr[0]=Ge,Cr[1]=Je},sphere:function(){Ge=-(Je=180),xn=-(jn=90)}};function Zb(e,t){Ta.push(Cr=[Ge=e,Je=e]),t<xn&&(xn=t),t>jn&&(jn=t)}function u$(e,t){var n=Io([e*pe,t*pe]);if(vl){var i=ml(vl,n),r=[i[1],-i[0],0],a=ml(r,i);Yh(a),a=Wh(a);var o=e-Mo,s=o>0?1:-1,l=a[0]*tt*s,u,c=ye(o)>180;c^(s*Mo<l&&l<s*e)?(u=a[1]*tt,u>jn&&(jn=u)):(l=(l+360)%360-180,c^(s*Mo<l&&l<s*e))?(u=-a[1]*tt,u<xn&&(xn=u)):(t<xn&&(xn=t),t>jn&&(jn=t)),c?e<Mo?Ln(Ge,e)>Ln(Ge,Je)&&(Je=e):Ln(e,Je)>Ln(Ge,Je)&&(Ge=e):Je>=Ge?(e<Ge&&(Ge=e),e>Je&&(Je=e)):e>Mo?Ln(Ge,e)>Ln(Ge,Je)&&(Je=e):Ln(e,Je)>Ln(Ge,Je)&&(Ge=e)}else Ta.push(Cr=[Ge=e,Je=e]);t<xn&&(xn=t),t>jn&&(jn=t),vl=n,Mo=e}function c$(){$r.point=u$}function f$(){Cr[0]=Ge,Cr[1]=Je,$r.point=Zb,vl=null}function d$(e,t){if(vl){var n=e-Mo;ac.add(ye(n)>180?n+(n>0?360:-360):n)}else s$=e,l$=t;Vi.point(e,t),u$(e,t)}function MW(){Vi.lineStart()}function jW(){d$(s$,l$),Vi.lineEnd(),ye(ac)>ie&&(Ge=-(Je=180)),Cr[0]=Ge,Cr[1]=Je,vl=null}function Ln(e,t){return(t-=e)<0?t+360:t}function LW(e,t){return e[0]-t[0]}function h$(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function PW(e){var t,n,i,r,a,o,s;if(jn=Je=-(Ge=xn=Infinity),Ta=[],Tr(e,$r),n=Ta.length){for(Ta.sort(LW),t=1,i=Ta[0],a=[i];t<n;++t)r=Ta[t],h$(i,r[0])||h$(i,r[1])?(Ln(i[0],r[1])>Ln(i[0],i[1])&&(i[1]=r[1]),Ln(r[0],i[1])>Ln(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(o=-Infinity,n=a.length-1,t=0,i=a[n];t<=n;i=r,++t)r=a[t],(s=Ln(i[1],r[0]))>o&&(o=s,Ge=r[0],Je=i[1])}return Ta=Cr=null,Ge===Infinity||xn===Infinity?[[NaN,NaN],[NaN,NaN]]:[[Ge,xn],[Je,jn]]}var oc,Vh,Xh,Jh,Kh,Qh,Zh,ep,e1,t1,n1,p$,g$,Qt,Zt,en,xi={sphere:Ct,point:i1,lineStart:m$,lineEnd:v$,polygonStart:function(){xi.lineStart=UW,xi.lineEnd=qW},polygonEnd:function(){xi.lineStart=m$,xi.lineEnd=v$}};function i1(e,t){e*=pe,t*=pe;var n=re(t);sc(n*re(e),n*te(e),te(t))}function sc(e,t,n){++oc,Xh+=(e-Xh)/oc,Jh+=(t-Jh)/oc,Kh+=(n-Kh)/oc}function m$(){xi.point=zW}function zW(e,t){e*=pe,t*=pe;var n=re(t);Qt=n*re(e),Zt=n*te(e),en=te(t),xi.point=BW,sc(Qt,Zt,en)}function BW(e,t){e*=pe,t*=pe;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Jn(Tt((o=Zt*a-en*r)*o+(o=en*i-Qt*a)*o+(o=Qt*r-Zt*i)*o),Qt*i+Zt*r+en*a);Vh+=o,Qh+=o*(Qt+(Qt=i)),Zh+=o*(Zt+(Zt=r)),ep+=o*(en+(en=a)),sc(Qt,Zt,en)}function v$(){xi.point=i1}function UW(){xi.point=WW}function qW(){y$(p$,g$),xi.point=i1}function WW(e,t){p$=e,g$=t,e*=pe,t*=pe,xi.point=y$;var n=re(t);Qt=n*re(e),Zt=n*te(e),en=te(t),sc(Qt,Zt,en)}function y$(e,t){e*=pe,t*=pe;var n=re(t),i=n*re(e),r=n*te(e),a=te(t),o=Zt*a-en*r,s=en*i-Qt*a,l=Qt*r-Zt*i,u=Tt(o*o+s*s+l*l),c=wn(u),f=u&&-c/u;e1+=f*o,t1+=f*s,n1+=f*l,Vh+=c,Qh+=c*(Qt+(Qt=i)),Zh+=c*(Zt+(Zt=r)),ep+=c*(en+(en=a)),sc(Qt,Zt,en)}function GW(e){oc=Vh=Xh=Jh=Kh=Qh=Zh=ep=e1=t1=n1=0,Tr(e,xi);var t=e1,n=t1,i=n1,r=t*t+n*n+i*i;return r<Gb&&(t=Qh,n=Zh,i=ep,Vh<ie&&(t=Xh,n=Jh,i=Kh),r=t*t+n*n+i*i,r<Gb)?[NaN,NaN]:[Jn(n,t)*tt,wn(i/Tt(r))*tt]}function r1(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function a1(e,t){return[ye(e)>he?e+Math.round(-e/Kt)*Kt:e,t]}a1.invert=a1;function b$(e,t,n){return(e%=Kt)?t||n?r1(x$(e),E$(t,n)):x$(e):t||n?E$(t,n):a1}function w$(e){return function(t,n){return t+=e,[t>he?t-Kt:t<-he?t+Kt:t,n]}}function x$(e){var t=w$(e);return t.invert=w$(-e),t}function E$(e,t){var n=re(e),i=te(e),r=re(t),a=te(t);function o(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*n+c*i;return[Jn(f*r-h*a,c*n-d*i),wn(h*r+f*a)]}return o.invert=function(s,l){var u=re(l),c=re(s)*u,f=te(s)*u,d=te(l),h=d*r-f*a;return[Jn(f*r+d*a,c*n+h*i),wn(h*n-c*i)]},o}function HW(e){e=b$(e[0]*pe,e[1]*pe,e.length>2?e[2]*pe:0);function t(n){return n=e(n[0]*pe,n[1]*pe),n[0]*=tt,n[1]*=tt,n}return t.invert=function(n){return n=e.invert(n[0]*pe,n[1]*pe),n[0]*=tt,n[1]*=tt,n},t}function YW(e,t,n,i,r,a){if(!n)return;var o=re(t),s=te(t),l=i*n;r==null?(r=t+i*Kt,a=t-l/2):(r=k$(o,r),a=k$(o,a),(i>0?r<a:r>a)&&(r+=i*Kt));for(var u,c=r;i>0?c>a:c<a;c-=l)u=Wh([o,-s*re(c),-s*te(c)]),e.point(u[0],u[1])}function k$(e,t){t=Io(t),t[0]-=e,Yh(t);var n=e$(-t[1]);return((-t[2]<0?-n:n)+Kt-ie)%Kt}function _$(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Ct,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function tp(e,t){return ye(e[0]-t[0])<ie&&ye(e[1]-t[1])<ie}function np(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function A$(e,t,n,i,r){var a=[],o=[],s,l;if(e.forEach(function(p){if((g=p.length-1)<=0)return;var g,m=p[0],v=p[g],y;if(tp(m,v)){if(!m[2]&&!v[2]){for(r.lineStart(),s=0;s<g;++s)r.point((m=p[s])[0],m[1]);r.lineEnd();return}v[0]+=2*ie}a.push(y=new np(m,p,null,!0)),o.push(y.o=new np(m,null,y,!1)),a.push(y=new np(v,p,null,!1)),o.push(y.o=new np(v,null,y,!0))}),!a.length)return;for(o.sort(t),S$(a),S$(o),s=0,l=o.length;s<l;++s)o[s].e=n=!n;for(var u=a[0],c,f;;){for(var d=u,h=!0;d.v;)if((d=d.n)===u)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(s=0,l=c.length;s<l;++s)r.point((f=c[s])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,s=c.length-1;s>=0;--s)r.point((f=c[s])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}function S$(e){if(!(t=e.length))return;for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}var o1=No();function s1(e){return ye(e[0])<=he?e[0]:Kn(e[0])*((ye(e[0])+he)%Kt-he)}function VW(e,t){var n=s1(t),i=t[1],r=te(i),a=[te(n),-re(n),0],o=0,s=0;o1.reset(),r===1?i=Xe+ie:r===-1&&(i=-Xe-ie);for(var l=0,u=e.length;l<u;++l){if(!(f=(c=e[l]).length))continue;for(var c,f,d=c[f-1],h=s1(d),p=d[1]/2+Lh,g=te(p),m=re(p),v=0;v<f;++v,h=b,g=x,m=k,d=y){var y=c[v],b=s1(y),E=y[1]/2+Lh,x=te(E),k=re(E),w=b-h,A=w>=0?1:-1,_=A*w,O=_>he,S=g*x;if(o1.add(Jn(S*A*te(_),m*k+S*re(_))),o+=O?w+A*Kt:w,O^h>=n^b>=n){var T=ml(Io(d),Io(y));Yh(T);var D=ml(a,T);Yh(D);var I=(O^w>=0?-1:1)*wn(D[2]);(i>I||i===I&&(T[0]||T[1]))&&(s+=O^w>=0?1:-1)}}}return(o<-ie||o<ie&&o1<-ie)^s&1}function O$(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function XW(e){return e.length===1&&(e=JW(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function JW(e){return function(t,n){return O$(e(t),n)}}var Lfe=XW(O$);function yl(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,a=new Array(r);++i<r;)a[i]=e+i*n;return a}function T$(e){for(var t=e.length,n,i=-1,r=0,a,o;++i<t;)r+=e[i].length;for(a=new Array(r);--t>=0;)for(o=e[t],n=o.length;--n>=0;)a[--r]=o[n];return a}function C$(e,t,n,i){return function(r){var a=t(r),o=_$(),s=t(o),l=!1,u,c,f,d={point:h,lineStart:g,lineEnd:m,polygonStart:function(){d.point=v,d.lineStart=y,d.lineEnd=b,c=[],u=[]},polygonEnd:function(){d.point=h,d.lineStart=g,d.lineEnd=m,c=T$(c);var E=VW(u,i);c.length?(l||(r.polygonStart(),l=!0),A$(c,QW,E,n,r)):E&&(l||(r.polygonStart(),l=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),c=u=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(E,x){e(E,x)&&r.point(E,x)}function p(E,x){a.point(E,x)}function g(){d.point=p,a.lineStart()}function m(){d.point=h,a.lineEnd()}function v(E,x){f.push([E,x]),s.point(E,x)}function y(){s.lineStart(),f=[]}function b(){v(f[0][0],f[0][1]),s.lineEnd();var E=s.clean(),x=o.result(),k,w=x.length,A,_,O;if(f.pop(),u.push(f),f=null,!w)return;if(E&1){if(_=x[0],(A=_.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),k=0;k<A;++k)r.point((O=_[k])[0],O[1]);r.lineEnd()}return}w>1&&E&2&&x.push(x.pop().concat(x.shift())),c.push(x.filter(KW))}return d}}function KW(e){return e.length>1}function QW(e,t){return((e=e.x)[0]<0?e[1]-Xe-ie:Xe-e[1])-((t=t.x)[0]<0?t[1]-Xe-ie:Xe-t[1])}var $$=C$(function(){return!0},ZW,tG,[-he,-Xe]);function ZW(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(a,o){var s=a>0?he:-he,l=ye(a-t);ye(l-he)<ie?(e.point(t,n=(n+o)/2>0?Xe:-Xe),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),e.point(a,n),r=0):i!==s&&l>=he&&(ye(t-i)<ie&&(t-=i*ie),ye(a-s)<ie&&(a-=s*ie),n=eG(t,n,a,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(s,n),r=0),e.point(t=a,n=o),i=s},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function eG(e,t,n,i){var r,a,o=te(e-n);return ye(o)>ie?gl((te(t)*(a=re(i))*te(n)-te(i)*(r=re(t))*te(e))/(r*a*o)):(t+i)/2}function tG(e,t,n,i){var r;if(e==null)r=n*Xe,i.point(-he,r),i.point(0,r),i.point(he,r),i.point(he,0),i.point(he,-r),i.point(0,-r),i.point(-he,-r),i.point(-he,0),i.point(-he,r);else if(ye(e[0]-t[0])>ie){var a=e[0]<t[0]?he:-he;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function nG(e){var t=re(e),n=6*pe,i=t>0,r=ye(t)>ie;function a(c,f,d,h){YW(h,e,n,d,c,f)}function o(c,f){return re(c)*re(f)>t}function s(c){var f,d,h,p,g;return{lineStart:function(){p=h=!1,g=1},point:function(m,v){var y=[m,v],b,E=o(m,v),x=i?E?0:u(m,v):E?u(m+(m<0?he:-he),v):0;if(!f&&(p=h=E)&&c.lineStart(),E!==h&&(b=l(f,y),(!b||tp(f,b)||tp(y,b))&&(y[2]=1)),E!==h)g=0,E?(c.lineStart(),b=l(y,f),c.point(b[0],b[1])):(b=l(f,y),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^E){var k;!(x&d)&&(k=l(y,f,!0))&&(g=0,i?(c.lineStart(),c.point(k[0][0],k[0][1]),c.point(k[1][0],k[1][1]),c.lineEnd()):(c.point(k[1][0],k[1][1]),c.lineEnd(),c.lineStart(),c.point(k[0][0],k[0][1],3)))}E&&(!f||!tp(f,y))&&c.point(y[0],y[1]),f=y,h=E,d=x},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return g|(p&&h)<<1}}}function l(c,f,d){var h=Io(c),p=Io(f),g=[1,0,0],m=ml(h,p),v=Gh(m,m),y=m[0],b=v-y*y;if(!b)return!d&&c;var E=t*v/b,x=-t*y/b,k=ml(g,m),w=Hh(g,E),A=Hh(m,x);Qb(w,A);var _=k,O=Gh(w,_),S=Gh(_,_),T=O*O-S*(Gh(w,w)-1);if(T<0)return;var D=Tt(T),I=Hh(_,(-O-D)/S);if(Qb(I,w),I=Wh(I),!d)return I;var C=c[0],N=f[0],W=c[1],X=f[1],J;N<C&&(J=C,C=N,N=J);var xe=N-C,Pe=ye(xe-he)<ie,dt=Pe||xe<ie;if(!Pe&&X<W&&(J=W,W=X,X=J),dt?Pe?W+X>0^I[1]<(ye(I[0]-C)<ie?W:X):W<=I[1]&&I[1]<=X:xe>he^(C<=I[0]&&I[0]<=N)){var ht=Hh(_,(-O+D)/S);return Qb(ht,w),[I,Wh(ht)]}}function u(c,f){var d=i?e:he-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return C$(o,s,a,i?[0,-e]:[-he,e-he])}function iG(e,t,n,i,r,a){var o=e[0],s=e[1],l=t[0],u=t[1],c=0,f=1,d=l-o,h=u-s,p;if(p=n-o,!d&&p>0)return;if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=r-o,!d&&p<0)return;if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}if(p=i-s,!h&&p>0)return;if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=a-s,!h&&p<0)return;if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*d,e[1]=s+c*h),f<1&&(t[0]=o+f*d,t[1]=s+f*h),!0}var lc=1e9,ip=-lc;function D$(e,t,n,i){function r(u,c){return e<=u&&u<=n&&t<=c&&c<=i}function a(u,c,f,d){var h=0,p=0;if(u==null||(h=o(u,f))!==(p=o(c,f))||l(u,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==p);else d.point(c[0],c[1])}function o(u,c){return ye(u[0]-e)<ie?c>0?0:3:ye(u[0]-n)<ie?c>0?2:1:ye(u[1]-t)<ie?c>0?1:0:c>0?3:2}function s(u,c){return l(u.x,c.x)}function l(u,c){var f=o(u,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-u[1]:f===1?u[0]-c[0]:f===2?u[1]-c[1]:c[0]-u[0]}return function(u){var c=u,f=_$(),d,h,p,g,m,v,y,b,E,x,k,w={point:A,lineStart:T,lineEnd:D,polygonStart:O,polygonEnd:S};function A(C,N){r(C,N)&&c.point(C,N)}function _(){for(var C=0,N=0,W=h.length;N<W;++N)for(var X=h[N],J=1,xe=X.length,Pe=X[0],dt,ht,Qe=Pe[0],Rt=Pe[1];J<xe;++J)dt=Qe,ht=Rt,Pe=X[J],Qe=Pe[0],Rt=Pe[1],ht<=i?Rt>i&&(Qe-dt)*(i-ht)>(Rt-ht)*(e-dt)&&++C:Rt<=i&&(Qe-dt)*(i-ht)<(Rt-ht)*(e-dt)&&--C;return C}function O(){c=f,d=[],h=[],k=!0}function S(){var C=_(),N=k&&C,W=(d=T$(d)).length;(N||W)&&(u.polygonStart(),N&&(u.lineStart(),a(null,null,1,u),u.lineEnd()),W&&A$(d,s,C,a,u),u.polygonEnd()),c=u,d=h=p=null}function T(){w.point=I,h&&h.push(p=[]),x=!0,E=!1,y=b=NaN}function D(){d&&(I(g,m),v&&E&&f.rejoin(),d.push(f.result())),w.point=A,E&&c.lineEnd()}function I(C,N){var W=r(C,N);if(h&&p.push([C,N]),x)g=C,m=N,v=W,x=!1,W&&(c.lineStart(),c.point(C,N));else if(W&&E)c.point(C,N);else{var X=[y=Math.max(ip,Math.min(lc,y)),b=Math.max(ip,Math.min(lc,b))],J=[C=Math.max(ip,Math.min(lc,C)),N=Math.max(ip,Math.min(lc,N))];iG(X,J,e,t,n,i)?(E||(c.lineStart(),c.point(X[0],X[1])),c.point(J[0],J[1]),W||c.lineEnd(),k=!1):W&&(c.lineStart(),c.point(C,N),k=!1)}y=C,b=N,E=W}return w}}function R$(e,t,n){var i=yl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[r,a]})}}function F$(e,t,n){var i=yl(e,t-ie,n).concat(t);return function(r){return i.map(function(a){return[a,r]})}}function rG(){var e,t,n,i,r,a,o,s,l=10,u=l,c=90,f=360,d,h,p,g,m=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return yl(Ph(i/c)*c,n,c).map(p).concat(yl(Ph(s/f)*f,o,f).map(g)).concat(yl(Ph(t/l)*l,e,l).filter(function(b){return ye(b%c)>ie}).map(d)).concat(yl(Ph(a/u)*u,r,u).filter(function(b){return ye(b%f)>ie}).map(h))}return v.lines=function(){return y().map(function(b){return{type:"LineString",coordinates:b}})},v.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(o).slice(1),p(n).reverse().slice(1),g(s).reverse().slice(1))]}},v.extent=function(b){return arguments.length?v.extentMajor(b).extentMinor(b):v.extentMinor()},v.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],s=+b[0][1],o=+b[1][1],i>n&&(b=i,i=n,n=b),s>o&&(b=s,s=o,o=b),v.precision(m)):[[i,s],[n,o]]},v.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],a=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),a>r&&(b=a,a=r,r=b),v.precision(m)):[[t,a],[e,r]]},v.step=function(b){return arguments.length?v.stepMajor(b).stepMinor(b):v.stepMinor()},v.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],v):[c,f]},v.stepMinor=function(b){return arguments.length?(l=+b[0],u=+b[1],v):[l,u]},v.precision=function(b){return arguments.length?(m=+b,d=R$(a,r,90),h=F$(t,e,m),p=R$(s,o,90),g=F$(i,n,m),v):m},v.extentMajor([[-180,-90+ie],[180,90-ie]]).extentMinor([[-180,-80-ie],[180,80+ie]])}function uc(e){return e}var l1=No(),u1=No(),N$,I$,c1,f1,Dr={point:Ct,lineStart:Ct,lineEnd:Ct,polygonStart:function(){Dr.lineStart=aG,Dr.lineEnd=sG},polygonEnd:function(){Dr.lineStart=Dr.lineEnd=Dr.point=Ct,l1.add(ye(u1)),u1.reset()},result:function(){var e=l1/2;return l1.reset(),e}};function aG(){Dr.point=oG}function oG(e,t){Dr.point=M$,N$=c1=e,I$=f1=t}function M$(e,t){u1.add(f1*e-c1*t),c1=e,f1=t}function sG(){M$(N$,I$)}var bl=Infinity,rp=bl,cc=-bl,ap=cc,op={point:lG,lineStart:Ct,lineEnd:Ct,polygonStart:Ct,polygonEnd:Ct,result:function(){var e=[[bl,rp],[cc,ap]];return cc=ap=-(rp=bl=Infinity),e}};function lG(e,t){e<bl&&(bl=e),e>cc&&(cc=e),t<rp&&(rp=t),t>ap&&(ap=t)}var d1=0,h1=0,fc=0,sp=0,lp=0,wl=0,p1=0,g1=0,dc=0,j$,L$,Xi,Ji,Qn={point:jo,lineStart:P$,lineEnd:z$,polygonStart:function(){Qn.lineStart=fG,Qn.lineEnd=dG},polygonEnd:function(){Qn.point=jo,Qn.lineStart=P$,Qn.lineEnd=z$},result:function(){var e=dc?[p1/dc,g1/dc]:wl?[sp/wl,lp/wl]:fc?[d1/fc,h1/fc]:[NaN,NaN];return d1=h1=fc=sp=lp=wl=p1=g1=dc=0,e}};function jo(e,t){d1+=e,h1+=t,++fc}function P$(){Qn.point=uG}function uG(e,t){Qn.point=cG,jo(Xi=e,Ji=t)}function cG(e,t){var n=e-Xi,i=t-Ji,r=Tt(n*n+i*i);sp+=r*(Xi+e)/2,lp+=r*(Ji+t)/2,wl+=r,jo(Xi=e,Ji=t)}function z$(){Qn.point=jo}function fG(){Qn.point=hG}function dG(){B$(j$,L$)}function hG(e,t){Qn.point=B$,jo(j$=Xi=e,L$=Ji=t)}function B$(e,t){var n=e-Xi,i=t-Ji,r=Tt(n*n+i*i);sp+=r*(Xi+e)/2,lp+=r*(Ji+t)/2,wl+=r,r=Ji*e-Xi*t,p1+=r*(Xi+e),g1+=r*(Ji+t),dc+=r*3,jo(Xi=e,Ji=t)}function U$(e){this._context=e}U$.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Kt);break}}},result:Ct};var m1=No(),v1,q$,W$,hc,pc,gc={point:Ct,lineStart:function(){gc.point=pG},lineEnd:function(){v1&&G$(q$,W$),gc.point=Ct},polygonStart:function(){v1=!0},polygonEnd:function(){v1=null},result:function(){var e=+m1;return m1.reset(),e}};function pG(e,t){gc.point=G$,q$=hc=e,W$=pc=t}function G$(e,t){hc-=e,pc-=t,m1.add(Tt(hc*hc+pc*pc)),hc=e,pc=t}function H$(){this._string=[]}H$.prototype={_radius:4.5,_circle:Y$(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=Y$(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function Y$(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function V$(e,t){var n=4.5,i,r;function a(o){return o&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Tr(o,i(r))),r.result()}return a.area=function(o){return Tr(o,i(Dr)),Dr.result()},a.measure=function(o){return Tr(o,i(gc)),gc.result()},a.bounds=function(o){return Tr(o,i(op)),op.result()},a.centroid=function(o){return Tr(o,i(Qn)),Qn.result()},a.projection=function(o){return arguments.length?(i=o==null?(e=null,uc):(e=o).stream,a):e},a.context=function(o){return arguments.length?(r=o==null?(t=null,new H$()):new U$(t=o),typeof n!="function"&&r.pointRadius(n),a):t},a.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(r.pointRadius(+o),+o),a):n},a.projection(e).context(t)}function up(e){return function(t){var n=new y1();for(var i in e)n[i]=e[i];return n.stream=t,n}}function y1(){}y1.prototype={constructor:y1,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function b1(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Tr(n,e.stream(op)),t(op.result()),i!=null&&e.clipExtent(i),e}function cp(e,t,n){return b1(e,function(i){var r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),a/(i[1][1]-i[0][1])),s=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(a-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([s,l])},n)}function w1(e,t,n){return cp(e,[[0,0],t],n)}function x1(e,t,n){return b1(e,function(i){var r=+t,a=r/(i[1][0]-i[0][0]),o=(r-a*(i[1][0]+i[0][0]))/2,s=-a*i[0][1];e.scale(150*a).translate([o,s])},n)}function E1(e,t,n){return b1(e,function(i){var r=+t,a=r/(i[1][1]-i[0][1]),o=-a*i[0][0],s=(r-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([o,s])},n)}var X$=16,gG=re(30*pe);function J$(e,t){return+t?vG(e,t):mG(e)}function mG(e){return up({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function vG(e,t){function n(i,r,a,o,s,l,u,c,f,d,h,p,g,m){var v=u-i,y=c-r,b=v*v+y*y;if(b>4*t&&g--){var E=o+d,x=s+h,k=l+p,w=Tt(E*E+x*x+k*k),A=wn(k/=w),_=ye(ye(k)-1)<ie||ye(a-f)<ie?(a+f)/2:Jn(x,E),O=e(_,A),S=O[0],T=O[1],D=S-i,I=T-r,C=y*D-v*I;(C*C/b>t||ye((v*D+y*I)/b-.5)>.3||o*d+s*h+l*p<gG)&&(n(i,r,a,o,s,l,S,T,_,E/=w,x/=w,k,g,m),m.point(S,T),n(S,T,_,E,x,k,u,c,f,d,h,p,g,m))}}return function(i){var r,a,o,s,l,u,c,f,d,h,p,g,m={point:v,lineStart:y,lineEnd:E,polygonStart:function(){i.polygonStart(),m.lineStart=x},polygonEnd:function(){i.polygonEnd(),m.lineStart=y}};function v(A,_){A=e(A,_),i.point(A[0],A[1])}function y(){f=NaN,m.point=b,i.lineStart()}function b(A,_){var O=Io([A,_]),S=e(A,_);n(f,d,c,h,p,g,f=S[0],d=S[1],c=A,h=O[0],p=O[1],g=O[2],X$,i),i.point(f,d)}function E(){m.point=v,i.lineEnd()}function x(){y(),m.point=k,m.lineEnd=w}function k(A,_){b(r=A,_),a=f,o=d,s=h,l=p,u=g,m.point=b}function w(){n(f,d,c,h,p,g,a,o,r,s,l,u,X$,i),m.lineEnd=E,E()}return m}}var yG=up({point:function(e,t){this.stream.point(e*pe,t*pe)}});function bG(e){return up({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function wG(e,t,n,i,r){function a(o,s){return o*=i,s*=r,[t+e*o,n-e*s]}return a.invert=function(o,s){return[(o-t)/e*i,(n-s)/e*r]},a}function K$(e,t,n,i,r,a){var o=re(a),s=te(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(g,m){return g*=i,m*=r,[l*g-u*m+t,n-u*g-l*m]}return p.invert=function(g,m){return[i*(c*g-f*m+d),r*(h-f*g-c*m)]},p}function Ki(e){return Q$(function(){return e})()}function Q$(e){var t,n=150,i=480,r=250,a=0,o=0,s=0,l=0,u=0,c,f=0,d=1,h=1,p=null,g=$$,m=null,v,y,b,E=uc,x=.5,k,w,A,_,O;function S(C){return A(C[0]*pe,C[1]*pe)}function T(C){return C=A.invert(C[0],C[1]),C&&[C[0]*tt,C[1]*tt]}S.stream=function(C){return _&&O===C?_:_=yG(bG(c)(g(k(E(O=C)))))},S.preclip=function(C){return arguments.length?(g=C,p=void 0,I()):g},S.postclip=function(C){return arguments.length?(E=C,m=v=y=b=null,I()):E},S.clipAngle=function(C){return arguments.length?(g=+C?nG(p=C*pe):(p=null,$$),I()):p*tt},S.clipExtent=function(C){return arguments.length?(E=C==null?(m=v=y=b=null,uc):D$(m=+C[0][0],v=+C[0][1],y=+C[1][0],b=+C[1][1]),I()):m==null?null:[[m,v],[y,b]]},S.scale=function(C){return arguments.length?(n=+C,D()):n},S.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],D()):[i,r]},S.center=function(C){return arguments.length?(a=C[0]%360*pe,o=C[1]%360*pe,D()):[a*tt,o*tt]},S.rotate=function(C){return arguments.length?(s=C[0]%360*pe,l=C[1]%360*pe,u=C.length>2?C[2]%360*pe:0,D()):[s*tt,l*tt,u*tt]},S.angle=function(C){return arguments.length?(f=C%360*pe,D()):f*tt},S.reflectX=function(C){return arguments.length?(d=C?-1:1,D()):d<0},S.reflectY=function(C){return arguments.length?(h=C?-1:1,D()):h<0},S.precision=function(C){return arguments.length?(k=J$(w,x=C*C),I()):Tt(x)},S.fitExtent=function(C,N){return cp(S,C,N)},S.fitSize=function(C,N){return w1(S,C,N)},S.fitWidth=function(C,N){return x1(S,C,N)},S.fitHeight=function(C,N){return E1(S,C,N)};function D(){var C=K$(n,0,0,d,h,f).apply(null,t(a,o)),N=(f?K$:wG)(n,i-C[0],r-C[1],d,h,f);return c=b$(s,l,u),w=r1(t,N),A=r1(c,w),k=J$(w,x),I()}function I(){return _=O=null,S}return function(){return t=e.apply(this,arguments),S.invert=t.invert&&T,D()}}function k1(e){var t=0,n=he/3,i=Q$(e),r=i(t,n);return r.parallels=function(a){return arguments.length?i(t=a[0]*pe,n=a[1]*pe):[t*tt,n*tt]},r}function xG(e){var t=re(e);function n(i,r){return[i*t,te(r)/t]}return n.invert=function(i,r){return[i/t,wn(r*t)]},n}function EG(e,t){var n=te(e),i=(n+te(t))/2;if(ye(i)<ie)return xG(e);var r=1+n*(2*i-n),a=Tt(r)/i;function o(s,l){var u=Tt(r-2*i*te(l))/i;return[u*te(s*=i),a-u*re(s)]}return o.invert=function(s,l){var u=a-l,c=Jn(s,ye(u))*Kn(u);return u*i<0&&(c-=he*Kn(s)*Kn(u)),[c/i,wn((r-(s*s+u*u)*i*i)/(2*i))]},o}function fp(){return k1(EG).scale(155.424).center([0,33.6442])}function Z$(){return fp().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function kG(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function _G(){var e,t,n=Z$(),i,r=fp().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a,o=fp().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,l,u={point:function(d,h){l=[d,h]}};function c(d){var h=d[0],p=d[1];return l=null,(i.point(h,p),l)||(a.point(h,p),l)||(s.point(h,p),l)}c.invert=function(d){var h=n.scale(),p=n.translate(),g=(d[0]-p[0])/h,m=(d[1]-p[1])/h;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=kG([n.stream(t=d),r.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),p=+d[0],g=+d[1];return i=n.translate(d).clipExtent([[p-.455*h,g-.238*h],[p+.455*h,g+.238*h]]).stream(u),a=r.translate([p-.307*h,g+.201*h]).clipExtent([[p-.425*h+ie,g+.12*h+ie],[p-.214*h-ie,g+.234*h-ie]]).stream(u),s=o.translate([p-.205*h,g+.212*h]).clipExtent([[p-.214*h+ie,g+.166*h+ie],[p-.115*h-ie,g+.234*h-ie]]).stream(u),f()},c.fitExtent=function(d,h){return cp(c,d,h)},c.fitSize=function(d,h){return w1(c,d,h)},c.fitWidth=function(d,h){return x1(c,d,h)},c.fitHeight=function(d,h){return E1(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function eD(e){return function(t,n){var i=re(t),r=re(n),a=e(i*r);return[a*r*te(t),a*te(n)]}}function mc(e){return function(t,n){var i=Tt(t*t+n*n),r=e(i),a=te(r),o=re(r);return[Jn(t*a,i*o),wn(i&&n*a/i)]}}var tD=eD(function(e){return Tt(2/(1+e))});tD.invert=mc(function(e){return 2*wn(e/2)});function AG(){return Ki(tD).scale(124.75).clipAngle(180-.001)}var nD=eD(function(e){return(e=e$(e))&&e/te(e)});nD.invert=mc(function(e){return e});function SG(){return Ki(nD).scale(79.4188).clipAngle(180-.001)}function dp(e,t){return[e,zh(Yb((Xe+t)/2))]}dp.invert=function(e,t){return[e,2*gl(ZC(t))-Xe]};function OG(){return iD(dp).scale(961/Kt)}function iD(e){var t=Ki(e),n=t.center,i=t.scale,r=t.translate,a=t.clipExtent,o=null,s,l,u;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=s=l=u=null:(o=+f[0][0],s=+f[0][1],l=+f[1][0],u=+f[1][1]),c()):o==null?null:[[o,s],[l,u]]};function c(){var f=he*i(),d=t(HW(t.rotate()).invert([0,0]));return a(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===dp?[[Math.max(d[0]-f,o),s],[Math.min(d[0]+f,l),u]]:[[o,Math.max(d[1]-f,s)],[l,Math.min(d[1]+f,u)]])}return c()}function hp(e){return Yb((Xe+e)/2)}function TG(e,t){var n=re(e),i=e===t?te(e):zh(n/re(t))/zh(hp(t)/hp(e)),r=n*Hb(hp(e),i)/i;if(!i)return dp;function a(o,s){r>0?s<-Xe+ie&&(s=-Xe+ie):s>Xe-ie&&(s=Xe-ie);var l=r/Hb(hp(s),i);return[l*te(i*o),r-l*re(i*o)]}return a.invert=function(o,s){var l=r-s,u=Kn(i)*Tt(o*o+l*l),c=Jn(o,ye(l))*Kn(l);return l*i<0&&(c-=he*Kn(o)*Kn(l)),[c/i,2*gl(Hb(r/u,1/i))-Xe]},a}function CG(){return k1(TG).scale(109.5).parallels([30,30])}function pp(e,t){return[e,t]}pp.invert=pp;function $G(){return Ki(pp).scale(152.63)}function DG(e,t){var n=re(e),i=e===t?te(e):(n-re(t))/(t-e),r=n/i+e;if(ye(i)<ie)return pp;function a(o,s){var l=r-s,u=i*o;return[l*te(u),r-l*re(u)]}return a.invert=function(o,s){var l=r-s,u=Jn(o,ye(l))*Kn(l);return l*i<0&&(u-=he*Kn(o)*Kn(l)),[u/i,r-Kn(i)*Tt(o*o+l*l)]},a}function RG(){return k1(DG).scale(131.154).center([0,13.9389])}var vc=1.340264,yc=-.081106,bc=893e-6,wc=.003796,gp=Tt(3)/2,FG=12;function rD(e,t){var n=wn(gp*te(t)),i=n*n,r=i*i*i;return[e*re(n)/(gp*(vc+3*yc*i+r*(7*bc+9*wc*i))),n*(vc+yc*i+r*(bc+wc*i))]}rD.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,a=0,o,s,l;a<FG&&!(s=n*(vc+yc*i+r*(bc+wc*i))-t,l=vc+3*yc*i+r*(7*bc+9*wc*i),n-=o=s/l,i=n*n,r=i*i*i,ye(o)<Gb);++a);return[gp*e*(vc+3*yc*i+r*(7*bc+9*wc*i))/re(n),wn(te(n)/gp)]};function NG(){return Ki(rD).scale(177.158)}function aD(e,t){var n=re(t),i=re(e)*n;return[n*te(e)/i,te(t)/i]}aD.invert=mc(gl);function IG(){return Ki(aD).scale(144.049).clipAngle(60)}function MG(){var e=1,t=0,n=0,i=1,r=1,a=0,o,s,l=null,u,c,f,d=1,h=1,p=up({point:function(E,x){var k=b([E,x]);this.stream.point(k[0],k[1])}}),g=uc,m,v;function y(){return d=e*i,h=e*r,m=v=null,b}function b(E){var x=E[0]*d,k=E[1]*h;if(a){var w=k*o-x*s;x=x*o+k*s,k=w}return[x+t,k+n]}return b.invert=function(E){var x=E[0]-t,k=E[1]-n;if(a){var w=k*o+x*s;x=x*o-k*s,k=w}return[x/d,k/h]},b.stream=function(E){return m&&v===E?m:m=p(g(v=E))},b.postclip=function(E){return arguments.length?(g=E,l=u=c=f=null,y()):g},b.clipExtent=function(E){return arguments.length?(g=E==null?(l=u=c=f=null,uc):D$(l=+E[0][0],u=+E[0][1],c=+E[1][0],f=+E[1][1]),y()):l==null?null:[[l,u],[c,f]]},b.scale=function(E){return arguments.length?(e=+E,y()):e},b.translate=function(E){return arguments.length?(t=+E[0],n=+E[1],y()):[t,n]},b.angle=function(E){return arguments.length?(a=E%360*pe,s=te(a),o=re(a),y()):a*tt},b.reflectX=function(E){return arguments.length?(i=E?-1:1,y()):i<0},b.reflectY=function(E){return arguments.length?(r=E?-1:1,y()):r<0},b.fitExtent=function(E,x){return cp(b,E,x)},b.fitSize=function(E,x){return w1(b,E,x)},b.fitWidth=function(E,x){return x1(b,E,x)},b.fitHeight=function(E,x){return E1(b,E,x)},b}function oD(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}oD.invert=function(e,t){var n=t,i=25,r;do{var a=n*n,o=a*a;n-=r=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-t)/(1.007226+a*(.015085*3+o*(-.044475*7+.028874*9*a-.005916*11*o)))}while(ye(r)>ie&&--i>0);return[e/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]};function jG(){return Ki(oD).scale(175.295)}function sD(e,t){return[re(t)*te(e),te(t)]}sD.invert=mc(wn);function LG(){return Ki(sD).scale(249.5).clipAngle(90+ie)}function lD(e,t){var n=re(t),i=1+re(e)*n;return[n*te(e)/i,te(t)/i]}lD.invert=mc(function(e){return 2*gl(e)});function PG(){return Ki(lD).scale(250).clipAngle(142)}function uD(e,t){return[zh(Yb((Xe+t)/2)),-e]}uD.invert=function(e,t){return[-t,2*gl(ZC(e))-Xe]};function zG(){var e=iD(uD),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var BG=Math.abs,_1=Math.cos,mp=Math.sin,UG=1e-6,cD=Math.PI,A1=cD/2,fD=qG(2);function dD(e){return e>1?A1:e<-1?-A1:Math.asin(e)}function qG(e){return e>0?Math.sqrt(e):0}function WG(e,t){var n=e*mp(t),i=30,r;do t-=r=(t+mp(t)-n)/(1+_1(t));while(BG(r)>UG&&--i>0);return t/2}function GG(e,t,n){function i(r,a){return[e*r*_1(a=WG(n,a)),t*mp(a)]}return i.invert=function(r,a){return a=dD(a/t),[r/(e*_1(a)),dD((2*a+mp(2*a))/n)]},i}var HG=GG(fD/A1,fD,cD);function YG(){return Ki(HG).scale(169.529)}var VG=V$(),S1=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function XG(e,t){return function n(){var i=t();return i.type=e,i.path=V$().projection(i),i.copy=i.copy||function(){var r=n();return S1.forEach(function(a){i[a]&&r[a](i[a]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function O1(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(vp[e]=XG(e,t),this):vp[e]||null}function hD(e){return e&&e.path||VG}var vp={albers:Z$,albersusa:_G,azimuthalequalarea:AG,azimuthalequidistant:SG,conicconformal:CG,conicequalarea:fp,conicequidistant:RG,equalEarth:NG,equirectangular:$G,gnomonic:IG,identity:MG,mercator:OG,mollweide:YG,naturalEarth1:jG,orthographic:LG,stereographic:PG,transversemercator:zG};for(var pD in vp)O1(pD,vp[pD]);function T1(e){$.call(this,null,e)}T1.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};var JG=P(T1,$);JG.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||It,a=e.as||"path",o=n.SOURCE;function s(u){u[a]=i(r(u))}!i||e.modified()?(this.value=i=hD(e.projection),n.materialize().reflow()):o=r===It||t.modified(r.fields)?n.ADD_MOD:n.ADD;var l=KG(i,e.pointRadius);return n.visit(o,s),i.pointRadius(l),n.modifies(a)};function KG(e,t){var n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function C1(e){$.call(this,null,e)}C1.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};var QG=P(C1,$);QG.transform=function(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],a=e.as||["x","y"],o=a[0],s=a[1],l;function u(c){var f=n([i(c),r(c)]);f?(c[o]=f[0],c[s]=f[1]):(c[o]=void 0,c[s]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(l=t.modified(i.fields)||t.modified(r.fields),t.visit(l?t.ADD_MOD:t.ADD,u)),t.modifies(a)};function $1(e){$.call(this,null,e)}$1.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};var ZG=P($1,$);ZG.transform=function(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",a=n.ADD;return(!i||e.modified())&&(this.value=i=eH(hD(e.projection),e.field||ci("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,function(o){o[r]=i}),n.modifies(r)};function eH(e,t,n){var i=n==null?function(r){return e(t(r))}:function(r){var a=e.pointRadius(),o=e.pointRadius(n)(t(r));return e.pointRadius(a),o};return i.context=function(r){return e.context(r),i},i}function D1(e){$.call(this,[],e),this.generator=rG()}D1.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};var tH=P(D1,$);tH.transform=function(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(var a in e)de(i[a])&&i[a](e[a]);return r=i(),n.length?t.mod.push(fk(n[0],r)):t.add.push(ke(r)),n[0]=r,t};function R1(e){$.call(this,null,e)}R1.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};var nH=P(R1,$);nH.transform=function(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||It,a=rH(e.opacity,e),o=iH(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:i?po(n.map(u=>po(r(u).values))):0};return n.forEach(u=>{const c=r(u),f=ce({},u,l);i||(f.$max=po(c.values||[])),u[s]=aH(c,f,o.dep?o:Mt(o(f)),a.dep?a:Mt(a(f)))}),t.reflow(!0).modifies(s)};function iH(e,t){let n;return de(e)?(n=i=>Aa(e(i,t)),n.dep=gD(e)):n=Mt(Aa(e||"#888")),n}function rH(e,t){let n;return de(e)?(n=i=>e(i,t),n.dep=gD(e)):e?n=Mt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function gD(e){if(!de(e))return!1;const t=pt(Nt(e));return t.$x||t.$y||t.$value||t.$max}function aH(e,t,n,i){const r=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||r,u=e.y2||a,c=e.values,f=c?m=>c[m]:ea,d=Ru(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),g=p.data;for(let m=s,v=0;m<u;++m){t.$y=m-s;for(let y=o,b=m*r;y<l;++y,v+=4){t.$x=y-o,t.$value=f(y+b);const E=n(t);g[v+0]=E.r,g[v+1]=E.g,g[v+2]=E.b,g[v+3]=~~(255*i(t))}}return h.putImageData(p,0,0),d}function mD(e){$.call(this,null,e),this.modified(!0)}var oH=P(mD,$);oH.transform=function(e,t){var n=this.value;return!n||e.modified("type")?(this.value=n=lH(e.type),S1.forEach(function(i){e[i]!=null&&vD(n,i,e[i])})):S1.forEach(function(i){e.modified(i)&&vD(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&sH(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)};function sH(e,t){var n=uH(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function lH(e){var t=O1((e||"mercator").toLowerCase());return t||F("Unrecognized projection type: "+e),t()}function vD(e,t,n){de(e[t])&&e[t](n)}function uH(e){return e=G(e),e.length===1?e[0]:{type:qb,features:e.reduce((t,n)=>t.concat(cH(n)),[])}}function cH(e){return e.type===qb?e.features:G(e).filter(t=>t!=null).map(t=>t.type===Ub?t:{type:Ub,geometry:t})}var fH=Object.freeze({__proto__:null,contour:Bb,geojson:Wb,geopath:T1,geopoint:C1,geoshape:$1,graticule:D1,heatmap:R1,isocontour:Lb,kde2d:zb,projection:mD});function dH(e,t){var n;e==null&&(e=0),t==null&&(t=0);function i(){var r,a=n.length,o,s=0,l=0;for(r=0;r<a;++r)o=n[r],s+=o.x,l+=o.y;for(s=s/a-e,l=l/a-t,r=0;r<a;++r)o=n[r],o.x-=s,o.y-=l}return i.initialize=function(r){n=r},i.x=function(r){return arguments.length?(e=+r,i):e},i.y=function(r){return arguments.length?(t=+r,i):t},i}function hH(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return yD(this.cover(t,n),t,n,e)}function yD(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,a=e._root,o={data:i},s=e._x0,l=e._y0,u=e._x1,c=e._y1,f,d,h,p,g,m,v,y;if(!a)return e._root=o,e;for(;a.length;)if((g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d,r=a,!(a=a[v=m<<1|g]))return r[v]=o,e;if(h=+e._x.call(null,a.data),p=+e._y.call(null,a.data),t===h&&n===p)return o.next=a,r?r[v]=o:e._root=o,e;do r=r?r[v]=new Array(4):e._root=new Array(4),(g=t>=(f=(s+u)/2))?s=f:u=f,(m=n>=(d=(l+c)/2))?l=d:c=d;while((v=m<<1|g)===(y=(p>=d)<<1|h>=f));return r[y]=a,r[v]=o,e}function pH(e){var t,n,i=e.length,r,a,o=new Array(i),s=new Array(i),l=Infinity,u=Infinity,c=-Infinity,f=-Infinity;for(n=0;n<i;++n){if(isNaN(r=+this._x.call(null,t=e[n]))||isNaN(a=+this._y.call(null,t)))continue;o[n]=r,s[n]=a,r<l&&(l=r),r>c&&(c=r),a<u&&(u=a),a>f&&(f=a)}if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<i;++n)yD(this,o[n],s[n],e[n]);return this}function gH(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1;else{for(var o=r-n,s=this._root,l,u;n>e||e>=r||i>t||t>=a;){u=(t<i)<<1|e<n,l=new Array(4),l[u]=s,s=l,o*=2;switch(u){case 0:r=n+o,a=i+o;break;case 1:n=r-o,a=i+o;break;case 2:r=n+o,i=a-o;break;case 3:n=r-o,i=a-o;break}}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this}function mH(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function vH(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function tn(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function yH(e,t,n){var i,r=this._x0,a=this._y0,o,s,l,u,c=this._x1,f=this._y1,d=[],h=this._root,p,g;for(h&&d.push(new tn(h,r,a,c,f)),n==null?n=Infinity:(r=e-n,a=t-n,c=e+n,f=t+n,n*=n);p=d.pop();){if(!(h=p.node)||(o=p.x0)>c||(s=p.y0)>f||(l=p.x1)<r||(u=p.y1)<a)continue;if(h.length){var m=(o+l)/2,v=(s+u)/2;d.push(new tn(h[3],m,v,l,u),new tn(h[2],o,v,m,u),new tn(h[1],m,s,l,v),new tn(h[0],o,s,m,v)),(g=(t>=v)<<1|e>=m)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-g],d[d.length-1-g]=p)}else{var y=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),E=y*y+b*b;if(E<n){var x=Math.sqrt(n=E);r=e-x,a=t-x,c=e+x,f=t+x,i=h.data}}}return i}function bH(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,a,o=this._x0,s=this._y0,l=this._x1,u=this._y1,c,f,d,h,p,g,m,v;if(!n)return this;if(n.length)for(;;){if((p=c>=(d=(o+l)/2))?o=d:l=d,(g=f>=(h=(s+u)/2))?s=h:u=h,!(t=n,n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,v=m)}for(;n.data!==e;)if(!(r=n,n=n.next))return this;return(a=n.next)&&delete n.next,r?(a?r.next=a:delete r.next,this):t?(a?t[m]=a:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[v]=n:this._root=n),this):(this._root=a,this)}function wH(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function xH(){return this._root}function EH(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function kH(e){var t=[],n,i=this._root,r,a,o,s,l;for(i&&t.push(new tn(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,a=n.x0,o=n.y0,s=n.x1,l=n.y1)&&i.length){var u=(a+s)/2,c=(o+l)/2;(r=i[3])&&t.push(new tn(r,u,c,s,l)),(r=i[2])&&t.push(new tn(r,a,c,u,l)),(r=i[1])&&t.push(new tn(r,u,o,s,c)),(r=i[0])&&t.push(new tn(r,a,o,u,c))}return this}function _H(e){var t=[],n=[],i;for(this._root&&t.push(new tn(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var a,o=i.x0,s=i.y0,l=i.x1,u=i.y1,c=(o+l)/2,f=(s+u)/2;(a=r[0])&&t.push(new tn(a,o,s,c,f)),(a=r[1])&&t.push(new tn(a,c,s,l,f)),(a=r[2])&&t.push(new tn(a,o,f,c,u)),(a=r[3])&&t.push(new tn(a,c,f,l,u))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function AH(e){return e[0]}function SH(e){return arguments.length?(this._x=e,this):this._x}function OH(e){return e[1]}function TH(e){return arguments.length?(this._y=e,this):this._y}function F1(e,t,n){var i=new N1(t??AH,n??OH,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function N1(e,t,n,i,r,a){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function bD(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var nn=F1.prototype=N1.prototype;nn.copy=function(){var e=new N1(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=bD(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=bD(i));return e},nn.add=hH,nn.addAll=pH,nn.cover=gH,nn.data=mH,nn.extent=vH,nn.find=yH,nn.remove=bH,nn.removeAll=wH,nn.root=xH,nn.size=EH,nn.visit=kH,nn.visitAfter=_H,nn.x=SH,nn.y=TH;function rn(e){return function(){return e}}function Ca(){return(Math.random()-.5)*1e-6}function CH(e){return e.x+e.vx}function $H(e){return e.y+e.vy}function DH(e){var t,n,i=1,r=1;typeof e!="function"&&(e=rn(e==null?1:+e));function a(){for(var l,u=t.length,c,f,d,h,p,g,m=0;m<r;++m)for(c=F1(t,CH,$H).visitAfter(o),l=0;l<u;++l)f=t[l],p=n[f.index],g=p*p,d=f.x+f.vx,h=f.y+f.vy,c.visit(v);function v(y,b,E,x,k){var w=y.data,A=y.r,_=p+A;if(w){if(w.index>f.index){var O=d-w.x-w.vx,S=h-w.y-w.vy,T=O*O+S*S;T<_*_&&(O===0&&(O=Ca(),T+=O*O),S===0&&(S=Ca(),T+=S*S),T=(_-(T=Math.sqrt(T)))/T*i,f.vx+=(O*=T)*(_=(A*=A)/(g+A)),f.vy+=(S*=T)*_,w.vx-=O*(_=1-_),w.vy-=S*_)}return}return b>d+_||x<d-_||E>h+_||k<h-_}}function o(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function s(){if(!t)return;var l,u=t.length,c;for(n=new Array(u),l=0;l<u;++l)c=t[l],n[c.index]=+e(c,l,t)}return a.initialize=function(l){t=l,s()},a.iterations=function(l){return arguments.length?(r=+l,a):r},a.strength=function(l){return arguments.length?(i=+l,a):i},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:rn(+l),s(),a):e},a}function RH(e){return e.index}function wD(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function FH(e){var t=RH,n=c,i,r=rn(30),a,o,s,l,u=1;e==null&&(e=[]);function c(g){return 1/Math.min(s[g.source.index],s[g.target.index])}function f(g){for(var m=0,v=e.length;m<u;++m)for(var y=0,b,E,x,k,w,A,_;y<v;++y)b=e[y],E=b.source,x=b.target,k=x.x+x.vx-E.x-E.vx||Ca(),w=x.y+x.vy-E.y-E.vy||Ca(),A=Math.sqrt(k*k+w*w),A=(A-a[y])/A*g*i[y],k*=A,w*=A,x.vx-=k*(_=l[y]),x.vy-=w*_,E.vx+=k*(_=1-_),E.vy+=w*_}function d(){if(!o)return;var g,m=o.length,v=e.length,y=new Map(o.map((E,x)=>[t(E,x,o),E])),b;for(g=0,s=new Array(m);g<v;++g)b=e[g],b.index=g,typeof b.source!="object"&&(b.source=wD(y,b.source)),typeof b.target!="object"&&(b.target=wD(y,b.target)),s[b.source.index]=(s[b.source.index]||0)+1,s[b.target.index]=(s[b.target.index]||0)+1;for(g=0,l=new Array(v);g<v;++g)b=e[g],l[g]=s[b.source.index]/(s[b.source.index]+s[b.target.index]);i=new Array(v),h(),a=new Array(v),p()}function h(){if(!o)return;for(var g=0,m=e.length;g<m;++g)i[g]=+n(e[g],g,e)}function p(){if(!o)return;for(var g=0,m=e.length;g<m;++g)a[g]=+r(e[g],g,e)}return f.initialize=function(g){o=g,d()},f.links=function(g){return arguments.length?(e=g,d(),f):e},f.id=function(g){return arguments.length?(t=g,f):t},f.iterations=function(g){return arguments.length?(u=+g,f):u},f.strength=function(g){return arguments.length?(n=typeof g=="function"?g:rn(+g),h(),f):n},f.distance=function(g){return arguments.length?(r=typeof g=="function"?g:rn(+g),p(),f):r},f}var NH={value:function(){}};function xD(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new yp(n)}function yp(e){this._=e}function IH(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}yp.prototype=xD.prototype={constructor:yp,on:function(e,t){var n=this._,i=IH(e+"",n),r,a=-1,o=i.length;if(arguments.length<2){for(;++a<o;)if((r=(e=i[a]).type)&&(r=MH(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++a<o;)if(r=(e=i[a]).type)n[r]=ED(n[r],e.name,t);else if(t==null)for(r in n)n[r]=ED(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new yp(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=this._[e],i=0,r=a.length;i<r;++i)a[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,a=i.length;r<a;++r)i[r].value.apply(t,n)}};function MH(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function ED(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=NH,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var xl=0,xc=0,Ec=0,kD=1e3,bp,kc,wp=0,Lo=0,xp=0,_c=typeof performance=="object"&&performance.now?performance:Date,_D=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function I1(){return Lo||(_D(jH),Lo=_c.now()+xp)}function jH(){Lo=0}function Ep(){this._call=this._time=this._next=null}Ep.prototype=AD.prototype={constructor:Ep,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?I1():+n)+(t==null?0:+t),!this._next&&kc!==this&&(kc?kc._next=this:bp=this,kc=this),this._call=e,this._time=n,M1()},stop:function(){this._call&&(this._call=null,this._time=Infinity,M1())}};function AD(e,t,n){var i=new Ep();return i.restart(e,t,n),i}function LH(){I1(),++xl;for(var e=bp,t;e;)(t=Lo-e._time)>=0&&e._call.call(null,t),e=e._next;--xl}function SD(){Lo=(wp=_c.now())+xp,xl=xc=0;try{LH()}finally{xl=0,zH(),Lo=0}}function PH(){var e=_c.now(),t=e-wp;t>kD&&(xp-=t,wp=e)}function zH(){for(var e,t=bp,n,i=Infinity;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:bp=n);kc=e,M1(i)}function M1(e){if(xl)return;xc&&(xc=clearTimeout(xc));var t=e-Lo;t>24?(e<Infinity&&(xc=setTimeout(SD,e-_c.now()-xp)),Ec&&(Ec=clearInterval(Ec))):(Ec||(wp=_c.now(),Ec=setInterval(PH,kD)),xl=1,_D(SD))}function BH(e,t,n){var i=new Ep(),r=t;return t==null?(i.restart(e,t,n),i):(t=+t,n=n==null?I1():+n,i.restart(function a(o){o+=r,i.restart(a,r+=t,n),e(o)},t,n),i)}function UH(e){return e.x}function qH(e){return e.y}var WH=10,GH=Math.PI*(3-Math.sqrt(5));function HH(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),a=0,o=.6,s=new Map(),l=AD(c),u=xD("tick","end");e==null&&(e=[]);function c(){f(),u.call("tick",t),n<i&&(l.stop(),u.call("end",t))}function f(p){var g,m=e.length,v;p===void 0&&(p=1);for(var y=0;y<p;++y)for(n+=(a-n)*r,s.forEach(function(b){b(n)}),g=0;g<m;++g)v=e[g],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function d(){for(var p=0,g=e.length,m;p<g;++p){if(m=e[p],m.index=p,m.fx!=null&&(m.x=m.fx),m.fy!=null&&(m.y=m.fy),isNaN(m.x)||isNaN(m.y)){var v=WH*Math.sqrt(p),y=p*GH;m.x=v*Math.cos(y),m.y=v*Math.sin(y)}(isNaN(m.vx)||isNaN(m.vy))&&(m.vx=m.vy=0)}}function h(p){return p.initialize&&p.initialize(e),p}return d(),t={tick:f,restart:function(){return l.restart(c),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,d(),s.forEach(h),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(a=+p,t):a},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},force:function(p,g){return arguments.length>1?(g==null?s.delete(p):s.set(p,h(g)),t):s.get(p)},find:function(p,g,m){var v=0,y=e.length,b,E,x,k,w;for(m==null?m=Infinity:m*=m,v=0;v<y;++v)k=e[v],b=p-k.x,E=g-k.y,x=b*b+E*E,x<m&&(w=k,m=x);return w},on:function(p,g){return arguments.length>1?(u.on(p,g),t):u.on(p)}}}function YH(){var e,t,n,i=rn(-30),r,a=1,o=Infinity,s=.81;function l(d){var h,p=e.length,g=F1(e,UH,qH).visitAfter(c);for(n=d,h=0;h<p;++h)t=e[h],g.visit(f)}function u(){if(!e)return;var d,h=e.length,p;for(r=new Array(h),d=0;d<h;++d)p=e[d],r[p.index]=+i(p,d,e)}function c(d){var h=0,p,g,m=0,v,y,b;if(d.length){for(v=y=b=0;b<4;++b)(p=d[b])&&(g=Math.abs(p.value))&&(h+=p.value,m+=g,v+=g*p.x,y+=g*p.y);d.x=v/m,d.y=y/m}else{p=d,p.x=p.data.x,p.y=p.data.y;do h+=r[p.data.index];while(p=p.next)}d.value=h}function f(d,h,p,g){if(!d.value)return!0;var m=d.x-t.x,v=d.y-t.y,y=g-h,b=m*m+v*v;if(y*y/s<b)return b<o&&(m===0&&(m=Ca(),b+=m*m),v===0&&(v=Ca(),b+=v*v),b<a&&(b=Math.sqrt(a*b)),t.vx+=m*d.value*n/b,t.vy+=v*d.value*n/b),!0;if(d.length||b>=o)return;(d.data!==t||d.next)&&(m===0&&(m=Ca(),b+=m*m),v===0&&(v=Ca(),b+=v*v),b<a&&(b=Math.sqrt(a*b)));do d.data!==t&&(y=r[d.data.index]*n/b,t.vx+=m*y,t.vy+=v*y);while(d=d.next)}return l.initialize=function(d){e=d,u()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:rn(+d),u(),l):i},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.theta=function(d){return arguments.length?(s=d*d,l):Math.sqrt(s)},l}function VH(e){var t=rn(.1),n,i,r;typeof e!="function"&&(e=rn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vx+=(r[l]-c.x)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:rn(+s),o(),a):t},a.x=function(s){return arguments.length?(e=typeof s=="function"?s:rn(+s),o(),a):e},a}function XH(e){var t=rn(.1),n,i,r;typeof e!="function"&&(e=rn(e==null?0:+e));function a(s){for(var l=0,u=n.length,c;l<u;++l)c=n[l],c.vy+=(r[l]-c.y)*i[l]*s}function o(){if(!n)return;var s,l=n.length;for(i=new Array(l),r=new Array(l),s=0;s<l;++s)i[s]=isNaN(r[s]=+e(n[s],s,n))?0:+t(n[s],s,n)}return a.initialize=function(s){n=s,o()},a.strength=function(s){return arguments.length?(t=typeof s=="function"?s:rn(+s),o(),a):t},a.y=function(s){return arguments.length?(e=typeof s=="function"?s:rn(+s),o(),a):e},a}var OD={center:dH,collide:DH,nbody:YH,link:FH,x:VH,y:XH},Ac="forces",j1=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],JH=["static","iterations"],TD=["x","y","vx","vy"];function L1(e){$.call(this,null,e)}L1.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:TD}]};var CD=P(L1,$);CD.transform=function(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(j1),a=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&$D(n,e,0,t)):(this.value=n=QH(t.source,e),n.on("tick",KH(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(JH)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/a)),e.static)for(n.stop();--a>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},CD.finish=function(e,t){for(var n=t.dataflow,i=this._argops,r=0,a=i.length,o;r<a;++r){if(o=i[r],o.name!==Ac||o.op._argval.force!=="link")continue;for(var s=o.op._argops,l=0,u=s.length,c;l<u;++l)if(s[l].name==="links"&&(c=s[l].op.source)){n.pulse(c,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(TD)};function KH(e,t){return function(){e.touch(t).run()}}function QH(e,t){var n=HH(e),i=!1,r=n.stop,a=n.restart;return n.stopped=function(){return i},n.restart=function(){return i=!1,a()},n.stop=function(){return i=!0,r()},$D(n,t,!0).on("end",function(){i=!0})}function $D(e,t,n,i){var r=G(t.forces),a,o,s,l;for(a=0,o=j1.length;a<o;++a)s=j1[a],s!==Ac&&t.modified(s)&&e[s](t[s]);for(a=0,o=r.length;a<o;++a)l=Ac+a,s=n||t.modified(Ac,a)?eY(r[a]):i&&ZH(r[a],i)?e.force(l):null,s&&e.force(l,s);for(o=e.numForces||0;a<o;++a)e.force(Ac+a,null);return e.numForces=r.length,e}function ZH(e,t){var n,i;for(n in e)if(de(i=e[n])&&t.modified(Nt(i)))return 1;return 0}function eY(e){var t,n;Q(OD,e.force)||F("Unrecognized force: "+e.force),t=OD[e.force]();for(n in e)de(t[n])&&tY(t[n],e[n],e);return t}function tY(e,t,n){e(de(t)?function(i){return t(i,n)}:t)}var nY=Object.freeze({__proto__:null,force:L1});function P1(e,t,n){var i={};return e.each(function(r){var a=r.data;n(a)&&(i[t(a)]=r)}),e.lookup=i,e}function iY(e,t){return e.parent===t.parent?1:2}function rY(e){return e.reduce(aY,0)/e.length}function aY(e,t){return e+t.x}function oY(e){return 1+e.reduce(sY,0)}function sY(e,t){return Math.max(e,t.y)}function lY(e){for(var t;t=e.children;)e=t[0];return e}function uY(e){for(var t;t=e.children;)e=t[t.length-1];return e}function cY(){var e=iY,t=1,n=1,i=!1;function r(a){var o,s=0;a.eachAfter(function(d){var h=d.children;h?(d.x=rY(h),d.y=oY(h)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=lY(a),u=uY(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(i?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*n})}return r.separation=function(a){return arguments.length?(e=a,r):e},r.size=function(a){return arguments.length?(i=!1,t=+a[0],n=+a[1],r):i?null:[t,n]},r.nodeSize=function(a){return arguments.length?(i=!0,t=+a[0],n=+a[1],r):i?[t,n]:null},r}function fY(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function dY(){return this.eachAfter(fY)}function hY(e){var t=this,n,i=[t],r,a,o;do for(n=i.reverse(),i=[];t=n.pop();)if(e(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)i.push(r[a]);while(i.length);return this}function pY(e){for(var t=this,n=[t],i,r;t=n.pop();)if(e(t),i=t.children,i)for(r=i.length-1;r>=0;--r)n.push(i[r]);return this}function gY(e){for(var t=this,n=[t],i=[],r,a,o;t=n.pop();)if(i.push(t),r=t.children,r)for(a=0,o=r.length;a<o;++a)n.push(r[a]);for(;t=i.pop();)e(t);return this}function mY(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function vY(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function yY(e){for(var t=this,n=bY(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function bY(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function wY(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function xY(){var e=[];return this.each(function(t){e.push(t)}),e}function EY(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function kY(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function z1(e,t){var n=new El(e),i=+e.value&&(n.value=e.value),r,a=[n],o,s,l,u;for(t==null&&(t=AY);r=a.pop();)if(i&&(r.value=+r.data.value),(s=t(r.data))&&(u=s.length))for(r.children=new Array(u),l=u-1;l>=0;--l)a.push(o=r.children[l]=new El(s[l])),o.parent=r,o.depth=r.depth+1;return n.eachBefore(DD)}function _Y(){return z1(this).eachBefore(SY)}function AY(e){return e.children}function SY(e){e.data=e.data.data}function DD(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function El(e){this.data=e,this.depth=this.height=0,this.parent=null}El.prototype=z1.prototype={constructor:El,count:dY,each:hY,eachAfter:gY,eachBefore:pY,sum:mY,sort:vY,path:yY,ancestors:wY,descendants:xY,leaves:EY,links:kY,copy:_Y};var OY=Array.prototype.slice;function TY(e){for(var t=e.length,n,i;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}function CY(e){for(var t=0,n=(e=TY(OY.call(e))).length,i=[],r,a;t<n;)r=e[t],a&&RD(a,r)?++t:(a=DY(i=$Y(i,r)),t=0);return a}function $Y(e,t){var n,i;if(B1(t,e))return[t];for(n=0;n<e.length;++n)if(kp(t,e[n])&&B1(Sc(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(kp(Sc(e[n],e[i]),t)&&kp(Sc(e[n],t),e[i])&&kp(Sc(e[i],t),e[n])&&B1(FD(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error()}function kp(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function RD(e,t){var n=e.r-t.r+1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function B1(e,t){for(var n=0;n<t.length;++n)if(!RD(e,t[n]))return!1;return!0}function DY(e){switch(e.length){case 1:return RY(e[0]);case 2:return Sc(e[0],e[1]);case 3:return FD(e[0],e[1],e[2])}}function RY(e){return{x:e.x,y:e.y,r:e.r}}function Sc(e,t){var n=e.x,i=e.y,r=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-i,c=s-r,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(i+o+u/f*c)/2,r:(f+r+s)/2}}function FD(e,t,n){var i=e.x,r=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=i-o,h=i-u,p=r-s,g=r-c,m=l-a,v=f-a,y=i*i+r*r-a*a,b=y-o*o-s*s+l*l,E=y-u*u-c*c+f*f,x=h*p-d*g,k=(p*E-g*b)/(x*2)-i,w=(g*m-p*v)/x,A=(h*b-d*E)/(x*2)-r,_=(d*v-h*m)/x,O=w*w+_*_-1,S=2*(a+k*w+A*_),T=k*k+A*A-a*a,D=-(O?(S+Math.sqrt(S*S-4*O*T))/(2*O):T/S);return{x:i+k+w*D,y:r+A+_*D,r:D}}function ND(e,t,n){var i=e.x-t.x,r,a,o=e.y-t.y,s,l,u=i*i+o*o;u?(a=t.r+n.r,a*=a,l=e.r+n.r,l*=l,a>l?(r=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-r*r)),n.x=e.x-r*i-s*o,n.y=e.y-r*o+s*i):(r=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-r*r)),n.x=t.x+r*i-s*o,n.y=t.y+r*o+s*i)):(n.x=t.x+n.r,n.y=t.y)}function ID(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function MD(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,a=(t.y*n.r+n.y*t.r)/i;return r*r+a*a}function _p(e){this._=e,this.next=null,this.previous=null}function FY(e){if(!(r=e.length))return 0;var t,n,i,r,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;ND(n,t,i=e[2]),t=new _p(t),n=new _p(n),i=new _p(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(s=3;s<r;++s){ND(t._,n._,i=e[s]),i=new _p(i),l=n.next,u=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(ID(l._,i._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(ID(u._,i._)){t=u,t.next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}while(l!==u.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,a=MD(t);(i=i.next)!==n;)(o=MD(i))<a&&(t=i,a=o);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=CY(t),s=0;s<r;++s)t=e[s],t.x-=i.x,t.y-=i.y;return i.r}function NY(e){return e==null?null:Ap(e)}function Ap(e){if(typeof e!="function")throw new Error();return e}function Po(){return 0}function kl(e){return function(){return e}}function IY(e){return Math.sqrt(e.value)}function MY(){var e=null,t=1,n=1,i=Po;function r(a){return a.x=t/2,a.y=n/2,e?a.eachBefore(jD(e)).eachAfter(U1(i,.5)).eachBefore(LD(1)):a.eachBefore(jD(IY)).eachAfter(U1(Po,1)).eachAfter(U1(i,a.r/Math.min(t,n))).eachBefore(LD(Math.min(t,n)/(2*a.r))),a}return r.radius=function(a){return arguments.length?(e=NY(a),r):e},r.size=function(a){return arguments.length?(t=+a[0],n=+a[1],r):[t,n]},r.padding=function(a){return arguments.length?(i=typeof a=="function"?a:kl(+a),r):i},r}function jD(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function U1(e,t){return function(n){if(i=n.children){var i,r,a=i.length,o=e(n)*t||0,s;if(o)for(r=0;r<a;++r)i[r].r+=o;if(s=FY(i),o)for(r=0;r<a;++r)i[r].r-=o;n.r=s+o}}}function LD(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function PD(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Oc(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-t)/e.value;++s<l;)o=a[s],o.y0=n,o.y1=r,o.x0=t,o.x1=t+=o.value*u}function jY(){var e=1,t=1,n=0,i=!1;function r(o){var s=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),i&&o.eachBefore(PD),o}function a(o,s){return function(l){l.children&&Oc(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-n,d=l.y1-n;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(e=+o[0],t=+o[1],r):[e,t]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var zD="$",LY={depth:-1},BD={};function PY(e){return e.id}function zY(e){return e.parentId}function UD(){var e=PY,t=zY;function n(i){var r,a,o=i.length,s,l,u,c=new Array(o),f,d,h={};for(a=0;a<o;++a)r=i[a],u=c[a]=new El(r),(f=e(r,a,i))!=null&&(f+="")&&(d=zD+(u.id=f),h[d]=d in h?BD:u);for(a=0;a<o;++a)if(u=c[a],f=t(i[a],a,i),f==null||!(f+="")){if(s)throw new Error("multiple roots");s=u}else{if(l=h[zD+f],!l)throw new Error("missing: "+f);if(l===BD)throw new Error("ambiguous: "+f);l.children?l.children.push(u):l.children=[u],u.parent=l}if(!s)throw new Error("no root");if(s.parent=LY,s.eachBefore(function(p){p.depth=p.parent.depth+1,--o}).eachBefore(DD),s.parent=null,o>0)throw new Error("cycle");return s}return n.id=function(i){return arguments.length?(e=Ap(i),n):e},n.parentId=function(i){return arguments.length?(t=Ap(i),n):t},n}function BY(e,t){return e.parent===t.parent?1:2}function q1(e){var t=e.children;return t?t[0]:e.t}function W1(e){var t=e.children;return t?t[t.length-1]:e.t}function UY(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function qY(e){for(var t=0,n=0,i=e.children,r=i.length,a;--r>=0;)a=i[r],a.z+=t,a.m+=t,t+=a.s+(n+=a.c)}function WY(e,t,n){return e.a.parent===t.parent?e.a:n}function Sp(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}Sp.prototype=Object.create(El.prototype);function GY(e){for(var t=new Sp(e,0),n,i=[t],r,a,o,s;n=i.pop();)if(a=n._.children)for(n.children=new Array(s=a.length),o=s-1;o>=0;--o)i.push(r=n.children[o]=new Sp(a[o],o)),r.parent=n;return(t.parent=new Sp(null,0)).children=[t],t}function HY(){var e=BY,t=1,n=1,i=null;function r(u){var c=GY(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),i)u.eachBefore(l);else{var f=u,d=u,h=u;u.eachBefore(function(y){y.x<f.x&&(f=y),y.x>d.x&&(d=y),y.depth>h.depth&&(h=y)});var p=f===d?1:e(f,d)/2,g=p-f.x,m=t/(d.x+p+g),v=n/(h.depth||1);u.eachBefore(function(y){y.x=(y.x+g)*m,y.y=y.depth*v})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){qY(u);var h=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-h):u.z=h}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,h=u,p=c,g=d.parent.children[0],m=d.m,v=h.m,y=p.m,b=g.m,E;p=W1(p),d=q1(d),p&&d;)g=q1(g),h=W1(h),h.a=u,E=p.z+y-d.z-m+e(p._,d._),E>0&&(UY(WY(p,u,f),u,E),m+=E,v+=E),y+=p.m,m+=d.m,b+=g.m,v+=h.m;p&&!W1(h)&&(h.t=p,h.m+=y-v),d&&!q1(g)&&(g.t=d,g.m+=m-b,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*n}return r.separation=function(u){return arguments.length?(e=u,r):e},r.size=function(u){return arguments.length?(i=!1,t=+u[0],n=+u[1],r):i?null:[t,n]},r.nodeSize=function(u){return arguments.length?(i=!0,t=+u[0],n=+u[1],r):i?[t,n]:null},r}function Op(e,t,n,i,r){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(r-n)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=i,o.y0=n,o.y1=n+=o.value*u}var qD=(1+Math.sqrt(5))/2;function WD(e,t,n,i,r,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,h,p,g=t.value,m,v,y,b,E,x,k;c<d;){h=r-n,p=a-i;do m=s[f++].value;while(!m&&f<d);for(v=y=m,x=Math.max(p/h,h/p)/(g*e),k=m*m*x,E=Math.max(y/k,k/v);f<d;++f){if(m+=u=s[f].value,u<v&&(v=u),u>y&&(y=u),k=m*m*x,b=Math.max(y/k,k/v),b>E){m-=u;break}E=b}o.push(l={value:m,dice:h<p,children:s.slice(c,f)}),l.dice?Oc(l,n,i,r,g?i+=p*m/g:a):Op(l,n,i,g?n+=h*m/g:r,a),g-=m,c=f}return o}var GD=function e(t){function n(i,r,a,o,s){WD(t,i,r,a,o,s)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(qD);function YY(){var e=GD,t=!1,n=1,i=1,r=[0],a=Po,o=Po,s=Po,l=Po,u=Po;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(PD),d}function f(d){var h=r[d.depth],p=d.x0+h,g=d.y0+h,m=d.x1-h,v=d.y1-h;m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),d.x0=p,d.y0=g,d.x1=m,d.y1=v,d.children&&(h=r[d.depth+1]=a(d)/2,p+=u(d)-h,g+=o(d)-h,m-=s(d)-h,v-=l(d)-h,m<p&&(p=m=(p+m)/2),v<g&&(g=v=(g+v)/2),e(d,p,g,m,v))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=Ap(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:kl(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:kl(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:kl(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:kl(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:kl(+d),c):u},c}function VY(e,t,n,i,r){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,n,i,r);function c(f,d,h,p,g,m,v){if(f>=d-1){var y=a[f];y.x0=p,y.y0=g,y.x1=m,y.y1=v;return}for(var b=u[f],E=h/2+b,x=f+1,k=d-1;x<k;){var w=x+k>>>1;u[w]<E?x=w+1:k=w}E-u[x-1]<u[x]-E&&f+1<x&&--x;var A=u[x]-b,_=h-A;if(m-p>v-g){var O=(p*_+m*A)/h;c(f,x,A,p,g,O,v),c(x,d,_,O,g,m,v)}else{var S=(g*_+v*A)/h;c(f,x,A,p,g,m,S),c(x,d,_,p,S,m,v)}}}function XY(e,t,n,i,r){(e.depth&1?Op:Oc)(e,t,n,i,r)}var JY=function e(t){function n(i,r,a,o,s){if((l=i._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,h,p=l.length,g=i.value;++d<p;){for(u=l[d],c=u.children,f=u.value=0,h=c.length;f<h;++f)u.value+=c[f].value;u.dice?Oc(u,r,a,o,a+=(s-a)*u.value/g):Op(u,r,a,r+=(o-r)*u.value/g,s),g-=u.value}else i._squarify=l=WD(t,i,r,a,o,s),l.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(qD);function G1(e){$.call(this,null,e)}G1.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};var KY=P(G1,$);function QY(e){return e.values}KY.transform=function(e,t){t.source||F("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),a=this.value;return(!a||i||t.changed())&&(a&&a.each(o=>{o.children&&Zf(o.data)&&r.rem.push(o.data)}),this.value=a=z1({values:G(e.keys).reduce((o,s)=>(o.key(s),o),ZY()).entries(r.source)},QY),n&&a.each(o=>{o.children&&(o=ke(o.data),r.add.push(o),r.source.push(o))}),P1(a,ee,ee)),r.source.root=a,r};function ZY(){var e=[],t;function n(r,a){if(a>=e.length)return r;for(var o=-1,s=r.length,l=e[a++],u,c,f={},d,h={};++o<s;)u=l(c=r[o])+"",(d=f[u])?d.push(c):f[u]=[c];for(u in f)h[u]=n(f[u],a);return h}function i(r,a){if(++a>e.length)return r;var o=[],s;for(s in r)o.push({key:s,values:i(r[s],a)});return o}return t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)}}function Rr(e){$.call(this,null,e)}var eV=P(Rr,$);eV.transform=function(e,t){(!t.source||!t.source.root)&&F(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(e.method),i=this.fields,r=t.source.root,a=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(co(e.sort,o=>o.data)),tV(n,this.params,e),n.separation&&n.separation(e.separation!==!1?iV:Ss);try{this.value=n(r)}catch(o){F(o)}return r.each(function(o){nV(o,i,a)}),t.reflow(e.modified()).modifies(a).modifies("leaf")};function tV(e,t,n){for(var i,r=0,a=t.length;r<a;++r)i=t[r],i in n&&e[i](n[i])}function nV(e,t,n){for(var i=e.data,r=0,a=t.length-1;r<a;++r)i[n[r]]=e[t[r]];i[n[a]]=e.children?e.children.length:0}function iV(e,t){return e.parent===t.parent?1:2}var H1=["x","y","r","depth","children"];function Y1(e){Rr.call(this,e)}Y1.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:H1.length,default:H1}]};var V1=P(Y1,Rr);V1.layout=MY,V1.params=["radius","size","padding"],V1.fields=H1;var X1=["x0","y0","x1","y1","depth","children"];function J1(e){Rr.call(this,e)}J1.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:X1.length,default:X1}]};var K1=P(J1,Rr);K1.layout=jY,K1.params=["size","round","padding"],K1.fields=X1;function Q1(e){$.call(this,null,e)}Q1.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};var rV=P(Q1,$);rV.transform=function(e,t){t.source||F("Stratify transform requires an upstream data source.");var n=this.value,i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),a=!this.value||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),a&&(r.source.length?n=P1(UD().id(e.key).parentId(e.parentKey)(r.source),e.key,fi):n=P1(UD()([{}]),e.key,e.key)),r.source.root=this.value=n,r};var HD={tidy:HY,cluster:cY},Z1=["x","y","depth","children"];function ew(e){Rr.call(this,e)}ew.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:Z1.length,default:Z1}]};var tw=P(ew,Rr);tw.layout=function(e){var t=e||"tidy";if(Q(HD,t))return HD[t]();F("Unrecognized Tree layout method: "+t)},tw.params=["size","nodeSize"],tw.fields=Z1;function nw(e){$.call(this,[],e)}nw.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};var aV=P(nw,$);aV.transform=function(e,t){var n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),a={};return i||F("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,function(o){a[ee(o)]=1}),i.each(function(o){var s=o.data,l=o.parent&&o.parent.data;l&&a[ee(s)]&&a[ee(l)]&&r.add.push(ke({source:l,target:s}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,function(o){a[ee(o)]=1}),n.forEach(function(o){(a[ee(o.source)]||a[ee(o.target)])&&r.mod.push(o)})),r};var YD={binary:VY,dice:Oc,slice:Op,slicedice:XY,squarify:GD,resquarify:JY},iw=["x0","y0","x1","y1","depth","children"];function rw(e){Rr.call(this,e)}rw.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iw.length,default:iw}]};var aw=P(rw,Rr);aw.layout=function(){var e=YY();return e.ratio=function(t){var n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=function(t){Q(YD,t)?e.tile(YD[t]):F("Unrecognized Treemap layout method: "+t)},e},aw.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],aw.fields=iw;var oV=Object.freeze({__proto__:null,nest:G1,pack:Y1,partition:J1,stratify:Q1,tree:ew,treelinks:nw,treemap:rw});function VD(e,t){var n=[],i=function(c){return c(s)},r,a,o,s,l,u;if(t==null)n.push(e);else for(r={},a=0,o=e.length;a<o;++a)s=e[a],l=t.map(i),u=r[l],u||(r[l]=u=[],u.dims=l,n.push(u)),u.push(s);return n}function ow(e){$.call(this,null,e)}ow.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};var sV=P(ow,$);sV.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=VD(i,e.groupby),a=(e.groupby||[]).map(Ye),o=a.length,s=e.as||[Ye(e.x),Ye(e.y)],l=[];r.forEach(u=>{lA(u,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[a[d]]=u.dims[d];f[s[0]]=c[0],f[s[1]]=c[1],l.push(ke(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};const sw={linear:av,log:nA,exp:iA,pow:rA,quad:ov,poly:aA};function lV(e,t){return e==="poly"?t:e==="quad"?2:1}function lw(e){$.call(this,null,e)}lw.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(sw)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};var uV=P(lw,$);uV.transform=function(e,t){var n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=VD(i,e.groupby),a=(e.groupby||[]).map(Ye),o=e.method||"linear",s=e.order||3,l=lV(o,s),u=e.as||[Ye(e.x),Ye(e.y)],c=sw[o],f=[];let d=e.extent;Q(sw,o)||F("Invalid regression method: "+o),d!=null&&(o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null)),r.forEach(h=>{const p=h.length;if(p<=l){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(h,e.x,e.y,s);if(e.params){f.push(ke({keys:h.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=d||Mi(h,e.x),v=y=>{const b={};for(let E=0;E<a.length;++E)b[a[E]]=h.dims[E];b[u[0]]=y[0],b[u[1]]=y[1],f.push(ke(b))};o==="linear"?m.forEach(y=>v([y,g.predict(y)])):Ad(g.predict,m,25,200).forEach(v)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n};var cV=Object.freeze({__proto__:null,loess:ow,regression:lw});const XD=Math.pow(2,-52),Tp=new Uint32Array(512);class uw{static from(e,t=gV,n=mV){const i=e.length,r=new Float64Array(i*2);for(let a=0;a<i;a++){const o=e[a];r[2*a]=t(o),r[2*a+1]=n(o)}return new uw(r)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:i,_hullHash:r}=this,a=e.length>>1;let o=Infinity,s=Infinity,l=-Infinity,u=-Infinity;for(let _=0;_<a;_++){const O=e[2*_],S=e[2*_+1];O<o&&(o=O),S<s&&(s=S),O>l&&(l=O),S>u&&(u=S),this._ids[_]=_}const c=(o+l)/2,f=(s+u)/2;let d=Infinity,h,p,g;for(let _=0;_<a;_++){const O=cw(c,f,e[2*_],e[2*_+1]);O<d&&(h=_,d=O)}const m=e[2*h],v=e[2*h+1];d=Infinity;for(let _=0;_<a;_++){if(_===h)continue;const O=cw(m,v,e[2*_],e[2*_+1]);O<d&&O>0&&(p=_,d=O)}let y=e[2*p],b=e[2*p+1],E=Infinity;for(let _=0;_<a;_++){if(_===h||_===p)continue;const O=hV(m,v,y,b,e[2*_],e[2*_+1]);O<E&&(g=_,E=O)}let x=e[2*g],k=e[2*g+1];if(E===Infinity){for(let S=0;S<a;S++)this._dists[S]=e[2*S]-e[0]||e[2*S+1]-e[1];_l(this._ids,this._dists,0,a-1);const _=new Uint32Array(a);let O=0;for(let S=0,T=-Infinity;S<a;S++){const D=this._ids[S];this._dists[D]>T&&(_[O++]=D,T=this._dists[D])}this.hull=_.subarray(0,O),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Cp(m,v,y,b,x,k)){const _=p,O=y,S=b;p=g,y=x,b=k,g=_,x=O,k=S}const w=pV(m,v,y,b,x,k);this._cx=w.x,this._cy=w.y;for(let _=0;_<a;_++)this._dists[_]=cw(e[2*_],e[2*_+1],w.x,w.y);_l(this._ids,this._dists,0,a-1),this._hullStart=h;let A=3;n[h]=t[g]=p,n[p]=t[h]=g,n[g]=t[p]=h,i[h]=0,i[p]=1,i[g]=2,r.fill(-1),r[this._hashKey(m,v)]=h,r[this._hashKey(y,b)]=p,r[this._hashKey(x,k)]=g,this.trianglesLen=0,this._addTriangle(h,p,g,-1,-1,-1);for(let _=0,O,S;_<this._ids.length;_++){const T=this._ids[_],D=e[2*T],I=e[2*T+1];if(_>0&&Math.abs(D-O)<=XD&&Math.abs(I-S)<=XD)continue;if(O=D,S=I,T===h||T===p||T===g)continue;let C=0;for(let xe=0,Pe=this._hashKey(D,I);xe<this._hashSize&&!(C=r[(Pe+xe)%this._hashSize],C!==-1&&C!==n[C]);xe++);C=t[C];let N=C,W;for(;W=n[N],!Cp(D,I,e[2*N],e[2*N+1],e[2*W],e[2*W+1]);)if(N=W,N===C){N=-1;break}if(N===-1)continue;let X=this._addTriangle(N,T,n[N],-1,-1,i[N]);i[T]=this._legalize(X+2),i[N]=X,A++;let J=n[N];for(;W=n[J],Cp(D,I,e[2*J],e[2*J+1],e[2*W],e[2*W+1]);)X=this._addTriangle(J,T,W,i[T],-1,i[J]),i[T]=this._legalize(X+2),n[J]=J,A--,J=W;if(N===C)for(;W=t[N],Cp(D,I,e[2*W],e[2*W+1],e[2*N],e[2*N+1]);)X=this._addTriangle(W,T,N,-1,i[N],i[W]),this._legalize(X+2),i[W]=X,n[N]=N,A--,N=W;this._hullStart=t[T]=N,n[N]=t[J]=T,n[T]=J,r[this._hashKey(D,I)]=T,r[this._hashKey(e[2*N],e[2*N+1])]=N}this.hull=new Uint32Array(A);for(let _=0,O=this._hullStart;_<A;_++)this.hull[_]=O,O=n[O];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(fV(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:i}=this;let r=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,o===-1){if(r===0)break;e=Tp[--r];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c],g=dV(i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(g){t[e]=p,t[o]=f;const m=n[c];if(m===-1){let y=this._hullStart;do{if(this._hullTri[y]===c){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,m),this._link(o,n[a]),this._link(a,c);const v=l+(o+1)%3;r<Tp.length&&(Tp[r++]=v)}else{if(r===0)break;e=Tp[--r]}}return a}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}}function fV(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function cw(e,t,n,i){const r=e-n,a=t-i;return r*r+a*a}function fw(e,t,n,i,r,a){const o=(i-t)*(r-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function Cp(e,t,n,i,r,a){const o=fw(r,a,e,t,n,i)||fw(e,t,n,i,r,a)||fw(n,i,r,a,e,t);return o<0}function dV(e,t,n,i,r,a,o,s){const l=e-o,u=t-s,c=n-o,f=i-s,d=r-o,h=a-s,p=l*l+u*u,g=c*c+f*f,m=d*d+h*h;return l*(f*m-g*h)-u*(c*m-g*d)+p*(c*h-f*d)<0}function hV(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function pV(e,t,n,i,r,a){const o=n-e,s=i-t,l=r-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=e+(u*c-s*f)*d,p=t+(o*f-l*c)*d;return{x:h,y:p}}function _l(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const a=e[r],o=t[a];let s=r-1;for(;s>=n&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=a}else{const r=n+i>>1;let a=n+1,o=i;Tc(e,r,a),t[e[n]]>t[e[i]]&&Tc(e,n,i),t[e[a]]>t[e[i]]&&Tc(e,a,i),t[e[n]]>t[e[a]]&&Tc(e,n,a);const s=e[a],l=t[s];for(;;){do a++;while(t[e[a]]<l);do o--;while(t[e[o]]>l);if(o<a)break;Tc(e,a,o)}e[n+1]=e[o],e[o]=s,i-a+1>=o-n?(_l(e,t,a,i),_l(e,t,n,o-1)):(_l(e,t,n,o-1),_l(e,t,a,i))}}function Tc(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function gV(e){return e[0]}function mV(e){return e[1]}const JD=1e-6;class zo{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t,n=+n;const i=e+n,r=t;if(n<0)throw new Error("negative radius");if(this._x1===null?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>JD||Math.abs(this._y1-r)>JD)&&(this._+="L"+i+","+r),!n)return;this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class dw{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class vV{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,g,m;d<p;d+=3,h+=2){const v=n[d]*2,y=n[d+1]*2,b=n[d+2]*2,E=e[v],x=e[v+1],k=e[y],w=e[y+1],A=e[b],_=e[b+1],O=k-E,S=w-x,T=A-E,D=_-x,I=O*O+S*S,C=T*T+D*D,N=(O*D-S*T)*2;if(!N)g=(E+A)/2-1e8*D,m=(x+_)/2+1e8*T;else if(Math.abs(N)<1e-8)g=(E+A)/2,m=(x+_)/2;else{const W=1/N;g=E+(D*I-S*C)*W,m=x+(O*C-T*I)*W}r[h]=g,r[h+1]=m}let a=t[t.length-1],o,s=a*4,l,u=e[2*a],c,f=e[2*a+1];i.fill(0);for(let d=0;d<t.length;++d)a=t[d],o=s,l=u,c=f,s=a*4,u=e[2*a],f=e[2*a+1],i[o+2]=i[s]=c-f,i[o+3]=i[s+1]=u-l}render(e){const t=e==null?e=new zo():void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const f=n[u];if(f<u)continue;const d=Math.floor(u/3)*2,h=Math.floor(f/3)*2,p=a[d],g=a[d+1],m=a[h],v=a[h+1];this._renderSegment(p,g,m,v,e)}let s,l=r[r.length-1];for(let u=0;u<r.length;++u){s=l,l=r[u];const c=Math.floor(i[l]/3)*2,f=a[c],d=a[c+1],h=s*4,p=this._project(f,d,o[h+2],o[h+3]);p&&this._renderSegment(f,d,p[0],p[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new zo():void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=t==null?t=new zo():void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let a=2;a<r;a+=2)(i[a]!==i[a-2]||i[a+1]!==i[a-1])&&t.lineTo(i[a],i[a+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new dw();return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let a;const o=this._regioncode(e,t),s=this._regioncode(n,i);o===0&&s===0?(r.moveTo(e,t),r.lineTo(n,i)):(a=this._clipSegment(e,t,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t,t!==t)||(n=+n,n!==n)?!1:this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const i=this._clip(n);if(i)e:for(let r=0,a=t.length;r<a;r+=2)for(let o=0,s=i.length;o<s;o+=2)if(t[r]==i[o]&&t[r+1]==i[o+1]&&t[(r+2)%a]==i[(o+s-2)%s]&&t[(r+3)%a]==i[(o+s-1)%s]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[e];if(a===-1)return null;const o=[];let s=a;do{const l=Math.floor(s/3);if(o.push(t[l*2],t[l*2+1]),s=s%3===2?s-2:s+1,r[s]!==e)break;s=i[s]}while(s!==a&&s!==-1);return o}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:n}=this,i=e*4;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let i=null,r,a,o=t[n-2],s=t[n-1],l,u=this._regioncode(o,s),c,f;for(let d=0;d<n;d+=2)if(r=o,a=s,o=t[d],s=t[d+1],l=u,u=this._regioncode(o,s),l===0&&u===0)c=f,f=0,i?i.push(o,s):i=[o,s];else{let h,p,g,m,v;if(l===0){if((h=this._clipSegment(r,a,o,s,l,u))===null)continue;[p,g,m,v]=h}else{if((h=this._clipSegment(o,s,r,a,u,l))===null)continue;[m,v,p,g]=h,c=f,f=this._edgecode(p,g),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(p,g):i=[p,g]}c=f,f=this._edgecode(m,v),c&&f&&this._edge(e,c,f,i,i.length),i?i.push(m,v):i=[m,v]}if(i)c=f,f=this._edgecode(i[0],i[1]),c&&f&&this._edge(e,c,f,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,n,i,r,a){for(;;){if(r===0&&a===0)return[e,t,n,i];if(r&a)return null;let o,s,l=r||a;l&8?(o=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):l&4?(o=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):l&2?(s=t+(i-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),o=this.xmin),r?(e=o,t=s,r=this._regioncode(e,t)):(n=o,i=s,a=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,a){let o=Array.from(t),s;if((s=this._project(o[0],o[1],n,i))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],r,a))&&o.push(s[0],s[1]),o=this._clipFinite(e,o))for(let l=0,u=o.length,c,f=this._edgecode(o[u-2],o[u-1]);l<u;l+=2)c=f,f=this._edgecode(o[l],o[l+1]),c&&f&&(l=this._edge(e,c,f,o,l),u=o.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(e,t,n,i,r){for(;t!==n;){let a,o;switch(t){case 5:t=4;continue;case 4:t=6,a=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,a=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,a=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,a=this.xmin,o=this.ymin;break}(i[r]!==a||i[r+1]!==o)&&this.contains(e,a,o)&&(i.splice(r,0,a,o),r+=2)}if(i.length>4)for(let a=0;a<i.length;a+=2){const o=(a+2)%i.length,s=(a+4)%i.length;(i[a]===i[o]&&i[o]===i[s]||i[a+1]===i[o+1]&&i[o+1]===i[s+1])&&(i.splice(o,2),a-=2)}return r}_project(e,t,n,i){let r=Infinity,a,o,s;if(i<0){if(t<=this.ymin)return null;(a=(this.ymin-t)/i)<r&&(s=this.ymin,o=e+(r=a)*n)}else if(i>0){if(t>=this.ymax)return null;(a=(this.ymax-t)/i)<r&&(s=this.ymax,o=e+(r=a)*n)}if(n>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/n)<r&&(o=this.xmax,s=t+(r=a)*i)}else if(n<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/n)<r&&(o=this.xmin,s=t+(r=a)*i)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const yV=2*Math.PI,Al=Math.pow;function bV(e){return e[0]}function wV(e){return e[1]}function xV(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],a=2*t[i+1],o=2*t[i+2],s=(n[o]-n[r])*(n[a+1]-n[r+1])-(n[a]-n[r])*(n[o+1]-n[r+1]);if(s>1e-10)return!1}return!0}function EV(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class KD{static from(e,t=bV,n=wV,i){return new KD("length"in e?kV(e,t,n,i):Float64Array.from(_V(e,t,n,i)))}constructor(e){this._delaunator=new uw(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&xV(e)){this.collinear=Int32Array.from({length:t.length/2},(f,d)=>d).sort((f,d)=>t[2*f]-t[2*d]||t[2*f+1]-t[2*d+1]);const s=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*s],t[2*s+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let f=0,d=t.length/2;f<d;++f){const h=EV(t[2*f],t[2*f+1],c);t[2*f]=h[0],t[2*f+1]=h[1]}this._delaunator=new uw(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let s=0,l=n.length;s<l;++s){const u=r[s%3===2?s-2:s+1];(n[s]===-1||a[u]===-1)&&(a[u]=s)}for(let s=0,l=i.length;s<l;++s)o[i[s]]=s;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],a[i[0]]=1,i.length===2&&(a[i[1]]=0))}voronoi(e){return new vV(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){const c=o.indexOf(e);c>0&&(yield o[c-1]),c<o.length-1&&(yield o[c+1]);return}const s=t[e];if(s===-1)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3===2?l-2:l+1,a[l]!==e)return;if(l=r[l],l===-1){const c=n[(i[e]+1)%n.length];c!==u&&(yield c);return}}while(l!==s)}find(e,t,n=0){if((e=+e,e!==e)||(t=+t,t!==t))return-1;const i=n;let r;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){const{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=Al(t-l[e*2],2)+Al(n-l[e*2+1],2);const f=i[e];let d=f;do{let h=s[d];const p=Al(t-l[h*2],2)+Al(n-l[h*2+1],2);if(p<c&&(c=p,u=h),d=d%3===2?d-2:d+1,s[d]!==e)break;if(d=o[d],d===-1){if(d=r[(a[e]+1)%r.length],d!==h&&Al(t-l[d*2],2)+Al(n-l[d*2+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=e==null?e=new zo():void 0,{points:n,halfedges:i,triangles:r}=this;for(let a=0,o=i.length;a<o;++a){const s=i[a];if(s<a)continue;const l=r[a]*2,u=r[s]*2;e.moveTo(n[l],n[l+1]),e.lineTo(n[u],n[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=e==null?e=new zo():void 0,{points:i}=this;for(let r=0,a=i.length;r<a;r+=2){const o=i[r],s=i[r+1];e.moveTo(o+t,s),e.arc(o,s,t,0,yV)}return n&&n.value()}renderHull(e){const t=e==null?e=new zo():void 0,{hull:n,points:i}=this,r=n[0]*2,a=n.length;e.moveTo(i[r],i[r+1]);for(let o=1;o<a;++o){const s=2*n[o];e.lineTo(i[s],i[s+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new dw();return this.renderHull(e),e.value()}renderTriangle(e,t){const n=t==null?t=new zo():void 0,{points:i,triangles:r}=this,a=r[e*=3]*2,o=r[e+1]*2,s=r[e+2]*2;return t.moveTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new dw();return this.renderTriangle(e,t),t.value()}}function kV(e,t,n,i){const r=e.length,a=new Float64Array(r*2);for(let o=0;o<r;++o){const s=e[o];a[o*2]=t.call(i,s,o,e),a[o*2+1]=n.call(i,s,o,e)}return a}function*_V(e,t,n,i){let r=0;for(const a of e)yield t.call(i,a,r,e),yield n.call(i,a,r,e),++r}function hw(e){$.call(this,null,e)}hw.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const AV=P(hw,$),SV=[-1e5,-1e5,1e5,1e5];AV.transform=function(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:SV;const a=this.value=KD.from(i,e.x,e.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const l=a.cellPolygon(o);i[o][n]=l?OV(l):null}return t.reflow(e.modified()).modifies(n)};function OV(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var TV=Object.freeze({__proto__:null,voronoi:hw}),pw=Math.PI/180,Cc=1<<11>>5,$p=1<<11;function CV(){var e=[256,256],t,n,i,r,a,o,s,l=QD,u=[],c=Math.random,f={};f.layout=function(){for(var p=d(Ru()),g=IV((e[0]>>5)*e[1]),m=null,v=u.length,y=-1,b=[],E=u.map(function(k){return{text:t(k),font:n(k),style:r(k),weight:a(k),rotate:o(k),size:~~(i(k)+1e-14),padding:s(k),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:k}}).sort(function(k,w){return w.size-k.size});++y<v;){var x=E[y];x.x=e[0]*(c()+.5)>>1,x.y=e[1]*(c()+.5)>>1,$V(p,x,E,y),x.hasText&&h(g,x,m)&&(b.push(x),m?RV(m,x):m=[{x:x.x+x.x0,y:x.y+x.y0},{x:x.x+x.x1,y:x.y+x.y1}],x.x-=e[0]>>1,x.y-=e[1]>>1)}return b};function d(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(Cc<<5)/g,p.height=$p/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function h(p,g,m){for(var v=g.x,y=g.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),E=l(e),x=c()<.5?1:-1,k=-x,w,A,_;(w=E(k+=x))&&!(A=~~w[0],_=~~w[1],Math.min(Math.abs(A),Math.abs(_))>=b);){if(g.x=v+A,g.y=y+_,g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])continue;if((!m||!DV(g,p,e[0]))&&(!m||FV(g,m))){for(var O=g.sprite,S=g.width>>5,T=e[0]>>5,D=g.x-(S<<4),I=D&127,C=32-I,N=g.y1-g.y0,W=(g.y+g.y0)*T+(D>>5),X,J=0;J<N;J++){X=0;for(var xe=0;xe<=S;xe++)p[W+xe]|=X<<C|(xe<S?(X=O[J*S+xe])>>>I:0);W+=T}return g.sprite=null,!0}}return!1}return f.words=function(p){return arguments.length?(u=p,f):u},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=Bo(p),f):n},f.fontStyle=function(p){return arguments.length?(r=Bo(p),f):r},f.fontWeight=function(p){return arguments.length?(a=Bo(p),f):a},f.rotate=function(p){return arguments.length?(o=Bo(p),f):o},f.text=function(p){return arguments.length?(t=Bo(p),f):t},f.spiral=function(p){return arguments.length?(l=MV[p]||p,f):l},f.fontSize=function(p){return arguments.length?(i=Bo(p),f):i},f.padding=function(p){return arguments.length?(s=Bo(p),f):s},f.random=function(p){return arguments.length?(c=p,f):c},f}function $V(e,t,n,i){if(t.sprite)return;var r=e.context,a=e.ratio;r.clearRect(0,0,(Cc<<5)/a,$p/a);var o=0,s=0,l=0,u=n.length,c,f,d,h,p;for(--i;++i<u;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,c=r.measureText(t.text+"m").width*a,d=t.size<<1,t.rotate){var g=Math.sin(t.rotate*pw),m=Math.cos(t.rotate*pw),v=c*m,y=c*g,b=d*m,E=d*g;c=Math.max(Math.abs(v+E),Math.abs(v-E))+31>>5<<5,d=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else c=c+31>>5<<5;if(d>l&&(l=d),o+c>=Cc<<5&&(o=0,s+=l,l=0),s+d>=$p)break;r.translate((o+(c>>1))/a,(s+(d>>1))/a),t.rotate&&r.rotate(t.rotate*pw),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var x=r.getImageData(0,0,(Cc<<5)/a,$p/a).data,k=[];--i>=0;){if(t=n[i],!t.hasText)continue;for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)k[h]=0;if(o=t.xoff,o==null)return;s=t.yoff;var w=0,A=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var _=f*p+(h>>5),O=x[(s+p)*(Cc<<5)+(o+h)<<2]?1<<31-h%32:0;k[_]|=O,w|=O}w?A=p:(t.y0++,d--,p--,s++)}t.y1=t.y0+A,t.sprite=k.slice(0,(t.y1-t.y0)*f)}}function DV(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,a=e.x-(r<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*n+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=r;d++)if((c<<s|(d<r?(c=i[f*r+d])>>>o:0))&t[u+d])return!0;u+=n}return!1}function RV(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function FV(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function QD(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function NV(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function IV(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function Bo(e){return typeof e=="function"?e:function(){return e}}var MV={archimedean:QD,rectangular:NV},ZD=["x","y","font","fontSize","fontStyle","fontWeight","angle"],jV=["text","font","rotate","fontSize","fontStyle","fontWeight"];function gw(e){$.call(this,CV(),e)}gw.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:ZD}]};var LV=P(gw,$);LV.transform=function(e,t){e.size&&!(e.size[0]&&e.size[1])&&F("Wordcloud size dimensions must be non-zero.");function n(b){var E=e[b];return de(E)&&t.modified(E.fields)}var i=e.modified();if(!(i||t.changed(t.ADD_REM)||jV.some(n)))return;var r=t.materialize(t.SOURCE).source,a=this.value,o=e.as||ZD,s=e.fontSize||14,l;if(de(s)?l=e.fontSizeRange:s=Mt(s),l){var u=s,c=Ee("sqrt")().domain(Mi(r,u)).range(l);s=function(b){return c(u(b))}}r.forEach(function(b){b[o[0]]=NaN,b[o[1]]=NaN,b[o[3]]=0});for(var f=a.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Wn).layout(),d=a.size(),h=d[0]>>1,p=d[1]>>1,g=0,m=f.length,v,y;g<m;++g)v=f[g],y=v.datum,y[o[0]]=v.x+h,y[o[1]]=v.y+p,y[o[2]]=v.font,y[o[3]]=v.size,y[o[4]]=v.style,y[o[5]]=v.weight,y[o[6]]=v.rotate;return t.reflow(i).modifies(o)};var PV=Object.freeze({__proto__:null,wordcloud:gw});function zV(e){return new Uint8Array(e)}function BV(e){return new Uint16Array(e)}function $c(e){return new Uint32Array(e)}function UV(){var e=8,t=[],n=$c(0),i=Dp(0,e),r=Dp(0,e);return{data:function(){return t},seen:function(){return n=qV(n,t.length)},add:function(a){for(var o=0,s=t.length,l=a.length,u;o<l;++o)u=a[o],u._index=s++,t.push(u)},remove:function(a,o){var s=t.length,l=Array(s-a),u=t,c,f,d;for(f=0;!o[f]&&f<s;++f)l[f]=t[f],u[f]=f;for(d=f;f<s;++f)c=t[f],o[f]?u[f]=-1:(u[f]=d,i[d]=i[f],r[d]=r[f],l[d]=c,c._index=d++),i[f]=0;return t=l,u},size:function(){return t.length},curr:function(){return i},prev:function(){return r},reset:function(a){r[a]=i[a]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(a,o){i[a]|=o},clear:function(a,o){i[a]&=~o},resize:function(a,o){var s=i.length;(a>s||o>e)&&(e=Math.max(o,e),i=Dp(a,e,i),r=Dp(a,e))}}}function qV(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Dp(e,t,n){var i=(t<257?zV:t<65537?BV:$c)(e);return n&&i.set(n),i}function eR(e,t,n){var i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd:function(r,a){var o=this,s=o.bisect(o.range,r.value),l=r.index,u=s[0],c=s[1],f=l.length,d;for(d=0;d<u;++d)a[l[d]]|=i;for(d=c;d<f;++d)a[l[d]]|=i;return o}}}function tR(){var e=$c(0),t=[],n=0;function i(s,l,u){if(!l.length)return[];var c=n,f=l.length,d=Array(f),h=$c(f),p,g,m;for(m=0;m<f;++m)d[m]=s(l[m]),h[m]=m;if(d=WV(d,h),c)p=t,g=e,t=Array(c+f),e=$c(c+f),GV(u,p,g,c,d,h,f,t,e);else{if(u>0)for(m=0;m<f;++m)h[m]+=u;t=d,e=h}return n=c+f,{index:h,value:d}}function r(s,l){var u=n,c,f,d;for(f=0;!l[e[f]]&&f<u;++f);for(d=f;f<u;++f)l[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=u-s}function a(s){for(var l=0,u=n;l<u;++l)e[l]=s[e[l]]}function o(s,l){var u;return l?u=l.length:(l=t,u=n),[G5(l,s[0],0,u),oa(l,s[1],0,u)]}return{insert:i,remove:r,bisect:o,reindex:a,index:function(){return e},size:function(){return n}}}function WV(e,t){return e.sort.call(t,function(n,i){var r=e[n],a=e[i];return r<a?-1:r>a?1:0}),Q5(e,t)}function GV(e,t,n,i,r,a,o,s,l){var u=0,c=0,f;for(f=0;u<i&&c<o;++f)t[u]<r[c]?(s[f]=t[u],l[f]=n[u++]):(s[f]=r[c],l[f]=a[c++]+e);for(;u<i;++u,++f)s[f]=t[u],l[f]=n[u];for(;c<o;++c,++f)s[f]=r[c],l[f]=a[c]+e}function mw(e){$.call(this,UV(),e),this._indices=null,this._dims=null}mw.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var Ei=P(mw,$);Ei.transform=function(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(function(i){return t.modified(i.fields)});return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},Ei.init=function(e,t){for(var n=e.fields,i=e.query,r=this._indices={},a=this._dims=[],o=i.length,s=0,l,u;s<o;++s)l=n[s].fname,u=r[l]||(r[l]=tR()),a.push(eR(u,s,i[s]));return this.eval(e,t)},Ei.reinit=function(e,t){var n=t.materialize().fork(),i=e.fields,r=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=r.length,p={},g,m,v,y,b,E,x,k,w;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(E={},y=t.mod,x=0,k=y.length;x<k;++x)E[y[x]._index]=1;for(x=0;x<h;++x)w=i[x],(!o[x]||e.modified("fields",x)||t.modified(w.fields))&&(v=w.fname,(g=p[v])||(a[v]=m=tR(),p[v]=g=m.insert(w,t.source,0)),o[x]=eR(m,x,r[x]).onAdd(g,l));for(x=0,k=s.data().length;x<k;++x){if(b[x])continue;u[x]!==l[x]?f.push(x):E[x]&&l[x]!==c&&d.push(x)}return s.mask=(1<<h)-1,n},Ei.eval=function(e,t){var n=t.materialize().fork(),i=this._dims.length,r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},Ei.insert=function(e,t,n){var i=t.add,r=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=r.size(),f=c+i.length,d=a.length,h,p,g;r.resize(f,d),r.add(i);var m=r.curr(),v=r.prev(),y=r.all();for(h=0;h<d;++h)p=s[h].fname,g=l[p]||(l[p]=o[p].insert(s[h],i,c)),a[h].onAdd(g,m);for(;c<f;++c)v[c]=y,m[c]!==y&&u.push(c)},Ei.modify=function(e,t){var n=t.mod,i=this.value,r=i.curr(),a=i.all(),o=e.mod,s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,r[u]!==a&&n.push(u)},Ei.remove=function(e,t,n){var i=this._indices,r=this.value,a=r.curr(),o=r.prev(),s=r.all(),l={},u=n.rem,c=t.rem,f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in i)i[h].remove(d,l);return this.reindex(t,d,l),l},Ei.reindex=function(e,t,n){var i=this._indices,r=this.value;e.runAfter(function(){var a=r.remove(t,n);for(var o in i)i[o].reindex(a)})},Ei.update=function(e,t,n){var i=this._dims,r=e.query,a=t.stamp,o=i.length,s=0,l,u;for(n.filters=0,u=0;u<o;++u)e.modified("query",u)&&(l=u,++s);if(s===1)s=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,s=0;u<o;++u){if(!e.modified("query",u))continue;s|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add}return s},Ei.incrementAll=function(e,t,n,i){var r=this.value,a=r.seen(),o=r.curr(),s=r.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],g=e.one,m,v,y;if(f<h)for(m=f,v=Math.min(h,d);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(f>h)for(m=h,v=Math.min(f,p);m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;if(d>p)for(m=Math.max(f,p),v=d;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;else if(d<p)for(m=Math.max(h,d),v=p;m<v;++m)y=l[m],a[y]!==n&&(s[y]=o[y],a[y]=n,i.push(y)),o[y]^=g;e.range=t.slice()},Ei.incrementOne=function(e,t,n,i){var r=this.value,a=r.curr(),o=e.index(),s=e.bisect(e.range),l=e.bisect(t),u=l[0],c=l[1],f=s[0],d=s[1],h=e.one,p,g,m;if(u<f)for(p=u,g=Math.min(f,c);p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(u>f)for(p=f,g=Math.min(u,d);p<g;++p)m=o[p],a[m]^=h,i.push(m);if(c>d)for(p=Math.max(u,d),g=c;p<g;++p)m=o[p],a[m]^=h,n.push(m);else if(c<d)for(p=Math.max(f,c),g=d;p<g;++p)m=o[p],a[m]^=h,i.push(m);e.range=t.slice()};function vw(e){$.call(this,null,e)}vw.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};var HV=P(vw,$);HV.transform=function(e,t){var n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)===0)return t.StopPropagation;var a=t.fork(t.ALL),o=i.data(),s=i.curr(),l=i.prev(),u=function(c){return s[c]&n?null:o[c]};return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,function(c){var f=s[c]&n,d=!f&&f^l[c]&n;return d?o[c]:null}),a.filter(a.REM,function(c){var f=s[c]&n,d=f&&!(f^(f^l[c]&n));return d?o[c]:null})):(a.filter(a.ADD,u),a.filter(a.REM,function(c){return(s[c]&n)===r?o[c]:null})),a.filter(a.SOURCE,function(c){return u(c._index)})};var YV=Object.freeze({__proto__:null,crossfilter:mw,resolvefilter:vw});const VV="5.13.0";function XV(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),nR(t,e.description()))}function nR(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function JV(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const yw="default";function KV(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:yw,item:null}));e.on(e.events("view","mousemove"),t,function(n,i){const r=t.value,a=r?Y(r)?r:r.user:yw,o=i.item&&i.item.cursor||null;return r&&a===r.user&&o==r.item?r:{user:a,item:o}}),e.add(null,function(n){let i=n.cursor,r=this.value;return Y(i)||(r=i.item,i=i.user),bw(e,i&&i!==yw?i:r||i),r},{cursor:t})}function bw(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function Rp(e,t){var n=e._runtime.data;return Q(n,t)||F("Unrecognized data set: "+t),n[t]}function QV(e,t){return arguments.length<2?Rp(this,e).values.value:Fp.call(this,e,fo().remove(fi).insert(t))}function Fp(e,t){dk(t)||F("Second argument to changes must be a changeset.");var n=Rp(this,e);return n.modified=!0,this.pulse(n.input,t)}function ZV(e,t){return Fp.call(this,e,fo().insert(t))}function eX(e,t){return Fp.call(this,e,fo().remove(t))}function iR(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function rR(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function Np(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function tX(e){var t=Np(e),n=iR(e),i=rR(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(function(r){try{r(n,i)}catch(a){e.error(a)}})}function nX(e,t,n){var i=e._renderer,r=i&&i.canvas(),a,o,s;return r&&(s=Np(e),o=t.changedTouches?t.changedTouches[0]:t,a=ih(o,r),a[0]-=s[0],a[1]-=s[1]),t.dataflow=e,t.item=n,t.vega=iX(e,n,a),t}function iX(e,t,n){var i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(o){var s=i,l;if(o){for(l=t;l;l=l.mark.group)if(l.mark.name===o){s=l;break}}return s&&s.mark&&s.mark.interactive?s:{}}function a(o){if(!o)return n;Y(o)&&(o=r(o));for(var s=n.slice();o;)s[0]-=o.x||0,s[1]-=o.y||0,o=o.mark&&o.mark.group;return s}return{view:Mt(e),item:Mt(t||{}),group:r,xy:a,x:function(o){return a(o)[0]},y:function(o){return a(o)[1]}}}const aR="view",rX="timer",aX="window",oX={trap:!1};function sX(e){const t=ce({defaults:{}},e),n=(i,r)=>{r.forEach(a=>{M(i[a])&&(i[a]=pt(i[a]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function lX(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function Ip(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function uX(e,t,n){var i=this,r=new nd(n),a=function(u,c){i.runAsync(null,()=>{e===aR&&lX(i,t)&&u.preventDefault(),r.receive(nX(i,u,c))})},o;if(e===rX)Ip(i,"timer",t)&&i.timer(a,t);else if(e===aR)Ip(i,"view",t)&&i.addEventListener(t,a,oX);else if(e===aX?Ip(i,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&(Ip(i,"selector",t)&&(o=document.querySelectorAll(e))),!o)i.warn("Can not resolve event source: "+e);else{for(var s=0,l=o.length;s<l;++s)o[s].addEventListener(t,a);i._eventListeners.push({type:t,sources:o,handler:a})}return r}function oR(e){return e.item}function sR(e){return e.item.mark.source}function lR(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function cX(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",oR),sR,lR(e)),this.on(this.events("view","mouseout",oR),sR,lR(t)),this}function fX(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,a;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(a=n[i],r=a.sources.length;--r>=0;)a.sources[r].removeEventListener(a.type,a.handler);return e&&e.call(this,this._handler,null,null,null),this}function Pn(e,t,n){var i=document.createElement(e);for(var r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const dX="vega-bind",hX="vega-bind-name",pX="vega-bind-radio";function gX(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!==e.signal(i.signal)&&e.runAsync(null,function(){r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=Hm(i.debounce,r.update))),mX(r,t,i,e.signal(i.signal)),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function mX(e,t,n,i){const r=Pn("div",{class:dX}),a=n.input==="radio"?r:r.appendChild(Pn("label"));a.appendChild(Pn("span",{class:hX},n.name||n.signal)),t.appendChild(r);let o=vX;switch(n.input){case"checkbox":o=yX;break;case"select":o=bX;break;case"radio":o=wX;break;case"range":o=xX;break}o(e,a,n,i)}function vX(e,t,n,i){const r=Pn("input");for(const a in n)a!=="signal"&&a!=="element"&&r.setAttribute(a==="input"?"type":a,n[a]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=a=>r.value=a}function yX(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const a=Pn("input",r);t.appendChild(a),a.addEventListener("change",()=>e.update(a.checked)),e.elements=[a],e.set=o=>a.checked=!!o||null}function bX(e,t,n,i){const r=Pn("select",{name:n.signal}),a=n.labels||[];n.options.forEach((o,s)=>{const l={value:o};Mp(o,i)&&(l.selected=!0),r.appendChild(Pn("option",l,(a[s]||o)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=o=>{for(let s=0,l=n.options.length;s<l;++s)if(Mp(n.options[s],o)){r.selectedIndex=s;return}}}function wX(e,t,n,i){const r=Pn("span",{class:pX}),a=n.labels||[];t.appendChild(r),e.elements=n.options.map((o,s)=>{const l={type:"radio",name:n.signal,value:o};Mp(o,i)&&(l.checked=!0);const u=Pn("input",l);u.addEventListener("change",()=>e.update(o));const c=Pn("label",{},(a[s]||o)+"");return c.prepend(u),r.appendChild(c),u}),e.set=o=>{const s=e.elements,l=s.length;for(let u=0;u<l;++u)Mp(s[u].value,o)&&(s[u].checked=!0)}}function xX(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||sa(a,r,100),s=Pn("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;const l=Pn("span",{},+i);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=c=>{s.value=c,l.textContent=c}}function Mp(e,t){return e===t||e+""===t+""}function uR(e,t,n,i,r,a){return t=t||new i(e.loader()),t.initialize(n,iR(e),rR(e),Np(e),r,a).background(e.background())}function ww(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function EX(e,t,n,i){var r=new i(e.loader(),ww(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,Np(e),e);return t&&t.handlers().forEach(function(a){r.on(a.type,a.handler)}),r}function kX(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,a=Rh(i);e=n._el=e?xw(n,e):null,XV(n),a||n.error("Unrecognized renderer type: "+i);const o=a.handler||zu,s=e?a.renderer:a.headless;return n._renderer=s?uR(n,n._renderer,e,s):null,n._handler=EX(n,n._handler,e,o),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=xw(n,t):e.appendChild(Pn("form",{class:"vega-bindings"})),n._bind.forEach(function(l){l.param.element&&r!=="container"&&(l.element=xw(n,l.param.element))}),n._bind.forEach(function(l){gX(n,l.element||t,l)})),n}function xw(e,t){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const Dc=e=>+e||0,_X=e=>({top:e,bottom:e,left:e,right:e});function cR(e){return K(e)?{top:Dc(e.top),bottom:Dc(e.bottom),left:Dc(e.left),right:Dc(e.right)}:_X(Dc(e))}async function Ew(e,t,n,i){const r=Rh(t),a=r&&r.headless;return a||F("Unrecognized renderer type: "+t),await e.runAsync(),uR(e,null,null,a,n,i).renderAsync(e._scenegraph.root)}async function AX(e,t){e!==Oa.Canvas&&e!==Oa.SVG&&e!==Oa.PNG&&F("Unrecognized image type: "+e);const n=await Ew(this,e,t);return e===Oa.SVG?SX(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function SX(e,t){var n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function OX(e,t){const n=await Ew(this,Oa.Canvas,e,t);return n.canvas()}async function TX(e){const t=await Ew(this,Oa.SVG,e);return t.svg()}function fR(e){const t=this.context.data[e];return t?t.values.value:[]}function CX(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function $X(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(fi).insert(t)),1}function DX(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Rc=e=>function(t,n){const i=this.context.dataflow.locale();return i[e](n)(t)},RX=Rc("format"),dR=Rc("timeFormat"),FX=Rc("utcFormat"),NX=Rc("timeParse"),IX=Rc("utcParse");var jp=new Date(2e3,0,1);function Lp(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(jp.setYear(2e3),jp.setMonth(e),jp.setDate(t),dR.call(this,jp,n))}function MX(e){return Lp.call(this,e,1,"%B")}function jX(e){return Lp.call(this,e,1,"%b")}function LX(e){return Lp.call(this,0,2+e,"%A")}function PX(e){return Lp.call(this,0,2+e,"%a")}const zX=":",BX="@",kw="%",hR="$";var UX="RawCode",Uo="Literal",qX="Property",WX="Identifier",GX="ArrayExpression",HX="BinaryExpression",pR="CallExpression",YX="ConditionalExpression",VX="LogicalExpression",XX="MemberExpression",JX="ObjectExpression",KX="UnaryExpression";function ki(e){this.type=e}ki.prototype.visit=function(e){var t=this,n,i,r;if(e(t))return 1;for(n=QX(t),i=0,r=n.length;i<r;++i)if(n[i].visit(e))return 1};function QX(e){switch(e.type){case GX:return e.elements;case HX:case VX:return[e.left,e.right];case pR:var t=e.arguments.slice();return t.unshift(e.callee),t;case YX:return[e.test,e.consequent,e.alternate];case XX:return[e.object,e.property];case JX:return e.properties;case qX:return[e.key,e.value];case KX:return[e.argument];case WX:case Uo:case UX:default:return[]}}var Qi,V,R,qt,Te,Pp=1,Fc=2,qo=3,$a=4,zp=5,Wo=6,En=7,Nc=8,ZX=9;Qi={},Qi[Pp]="Boolean",Qi[Fc]="<end>",Qi[qo]="Identifier",Qi[$a]="Keyword",Qi[zp]="Null",Qi[Wo]="Numeric",Qi[En]="Punctuator",Qi[Nc]="String",Qi[ZX]="RegularExpression";var eJ="ArrayExpression",tJ="BinaryExpression",nJ="CallExpression",iJ="ConditionalExpression",gR="Identifier",rJ="Literal",aJ="LogicalExpression",oJ="MemberExpression",sJ="ObjectExpression",lJ="Property",uJ="UnaryExpression",$t="Unexpected token %0",cJ="Unexpected number",fJ="Unexpected string",dJ="Unexpected identifier",hJ="Unexpected reserved word",pJ="Unexpected end of input",_w="Invalid regular expression",Aw="Invalid regular expression: missing /",mR="Octal literals are not allowed in strict mode.",gJ="Duplicate data property in object literal not allowed in strict mode",Wt="ILLEGAL",Ic="Disabled.",mJ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),vJ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Bp(e,t){if(!e)throw new Error("ASSERT: "+t)}function Fr(e){return e>=48&&e<=57}function Sw(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Mc(e){return"01234567".indexOf(e)>=0}function yJ(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function jc(e){return e===10||e===13||e===8232||e===8233}function Lc(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&mJ.test(String.fromCharCode(e))}function Up(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&vJ.test(String.fromCharCode(e))}var bJ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function vR(){for(var e;R<qt&&(e=V.charCodeAt(R),yJ(e)||jc(e));)++R}function Ow(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)R<qt&&Sw(V[R])?(i=V[R++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):_e({},$t,Wt);return String.fromCharCode(r)}function wJ(){var e,t,n,i;for(e=V[R],t=0,e==="}"&&_e({},$t,Wt);R<qt&&!(e=V[R++],!Sw(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&_e({},$t,Wt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function yR(){var e,t;for(e=V.charCodeAt(R++),t=String.fromCharCode(e),e===92&&(V.charCodeAt(R)!==117&&_e({},$t,Wt),++R,e=Ow("u"),(!e||e==="\\"||!Lc(e.charCodeAt(0)))&&_e({},$t,Wt),t=e);R<qt&&!(e=V.charCodeAt(R),!Up(e));)++R,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),V.charCodeAt(R)!==117&&_e({},$t,Wt),++R,e=Ow("u"),(!e||e==="\\"||!Up(e.charCodeAt(0)))&&_e({},$t,Wt),t+=e);return t}function xJ(){var e,t;for(e=R++;R<qt;){if(t=V.charCodeAt(R),t===92)return R=e,yR();if(Up(t))++R;else break}return V.slice(e,R)}function EJ(){var e,t,n;return e=R,t=V.charCodeAt(R)===92?yR():xJ(),t.length===1?n=qo:bJ.hasOwnProperty(t)?n=$a:t==="null"?n=zp:t==="true"||t==="false"?n=Pp:n=qo,{type:n,value:t,start:e,end:R}}function Tw(){var e=R,t=V.charCodeAt(R),n,i=V[R],r,a,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++R,{type:En,value:String.fromCharCode(t),start:e,end:R};default:if(n=V.charCodeAt(R+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return R+=2,{type:En,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:R};case 33:case 61:return R+=2,V.charCodeAt(R)===61&&++R,{type:En,value:V.slice(e,R),start:e,end:R}}}if(o=V.substr(R,4),o===">>>=")return R+=4,{type:En,value:o,start:e,end:R};if(a=o.substr(0,3),a===">>>"||a==="<<="||a===">>=")return R+=3,{type:En,value:a,start:e,end:R};if(r=a.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return R+=2,{type:En,value:r,start:e,end:R};if("<>=!+-*%&|^/".indexOf(i)>=0)return++R,{type:En,value:i,start:e,end:R};_e({},$t,Wt)}function kJ(e){for(var t="";R<qt&&Sw(V[R]);)t+=V[R++];return t.length===0&&_e({},$t,Wt),Lc(V.charCodeAt(R))&&_e({},$t,Wt),{type:Wo,value:parseInt("0x"+t,16),start:e,end:R}}function _J(e){for(var t="0"+V[R++];R<qt&&Mc(V[R]);)t+=V[R++];return(Lc(V.charCodeAt(R))||Fr(V.charCodeAt(R)))&&_e({},$t,Wt),{type:Wo,value:parseInt(t,8),octal:!0,start:e,end:R}}function bR(){var e,t,n;if(n=V[R],Bp(Fr(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=R,e="",n!=="."){if(e=V[R++],n=V[R],e==="0"){if(n==="x"||n==="X")return++R,kJ(t);if(Mc(n))return _J(t);n&&Fr(n.charCodeAt(0))&&_e({},$t,Wt)}for(;Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="."){for(e+=V[R++];Fr(V.charCodeAt(R));)e+=V[R++];n=V[R]}if(n==="e"||n==="E")if(e+=V[R++],n=V[R],(n==="+"||n==="-")&&(e+=V[R++]),Fr(V.charCodeAt(R)))for(;Fr(V.charCodeAt(R));)e+=V[R++];else _e({},$t,Wt);return Lc(V.charCodeAt(R))&&_e({},$t,Wt),{type:Wo,value:parseFloat(e),start:t,end:R}}function AJ(){var e="",t,n,i,r,a=!1;for(t=V[R],Bp(t==="'"||t==='"',"String literal must starts with a quote"),n=R,++R;R<qt;)if(i=V[R++],i===t){t="";break}else if(i==="\\")if(i=V[R++],!i||!jc(i.charCodeAt(0)))switch(i){case"u":case"x":V[R]==="{"?(++R,e+=wJ()):e+=Ow(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Mc(i)?(r="01234567".indexOf(i),r!==0&&(a=!0),R<qt&&Mc(V[R])&&(a=!0,r=r*8+"01234567".indexOf(V[R++]),"0123".indexOf(i)>=0&&R<qt&&Mc(V[R])&&(r=r*8+"01234567".indexOf(V[R++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&V[R]===`
`&&++R;else{if(jc(i.charCodeAt(0)))break;e+=i}return t!==""&&_e({},$t,Wt),{type:Nc,value:e,octal:a,start:n,end:R}}function SJ(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(i,r){if(parseInt(r,16)<=1114111)return"x";_e({},_w)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(i){_e({},_w)}try{return new RegExp(e,t)}catch(i){return null}}function OJ(){var e,t,n,i,r;for(e=V[R],Bp(e==="/","Regular expression literal must start with a slash"),t=V[R++],n=!1,i=!1;R<qt;)if(e=V[R++],t+=e,e==="\\")e=V[R++],jc(e.charCodeAt(0))&&_e({},Aw),t+=e;else if(jc(e.charCodeAt(0)))_e({},Aw);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||_e({},Aw),r=t.substr(1,t.length-2),{value:r,literal:t}}function TJ(){var e,t,n;for(t="",n="";R<qt&&!(e=V[R],!Up(e.charCodeAt(0)));)++R,e==="\\"&&R<qt?_e({},$t,Wt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_e({},_w,n),{value:n,literal:t}}function CJ(){var e,t,n,i;return Te=null,vR(),e=R,t=OJ(),n=TJ(),i=SJ(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:R}}function $J(e){return e.type===qo||e.type===$a||e.type===Pp||e.type===zp}function wR(){var e;return vR(),R>=qt?{type:Fc,start:R,end:R}:(e=V.charCodeAt(R),Lc(e)?EJ():e===40||e===41||e===59?Tw():e===39||e===34?AJ():e===46?Fr(V.charCodeAt(R+1))?bR():Tw():Fr(e)?bR():Tw())}function kn(){var e;return e=Te,R=e.end,Te=wR(),R=e.end,e}function xR(){var e;e=R,Te=wR(),R=e}function DJ(e){var t=new ki(eJ);return t.elements=e,t}function ER(e,t,n){var i=new ki(e==="||"||e==="&&"?aJ:tJ);return i.operator=e,i.left=t,i.right=n,i}function RJ(e,t){var n=new ki(nJ);return n.callee=e,n.arguments=t,n}function FJ(e,t,n){var i=new ki(iJ);return i.test=e,i.consequent=t,i.alternate=n,i}function Cw(e){var t=new ki(gR);return t.name=e,t}function Pc(e){var t=new ki(rJ);return t.value=e.value,t.raw=V.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function kR(e,t,n){var i=new ki(oJ);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function NJ(e){var t=new ki(sJ);return t.properties=e,t}function _R(e,t,n){var i=new ki(lJ);return i.key=t,i.value=n,i.kind=e,i}function IJ(e,t){var n=new ki(uJ);return n.operator=e,n.argument=t,n.prefix=!0,n}function _e(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,function(a,o){return Bp(o<i.length,"Message reference must be in range"),i[o]});throw n=new Error(r),n.index=R,n.description=r,n}function qp(e){e.type===Fc&&_e(e,pJ),e.type===Wo&&_e(e,cJ),e.type===Nc&&_e(e,fJ),e.type===qo&&_e(e,dJ),e.type===$a&&_e(e,hJ),_e(e,$t,e.value)}function Gt(e){var t=kn();(t.type!==En||t.value!==e)&&qp(t)}function Le(e){return Te.type===En&&Te.value===e}function $w(e){return Te.type===$a&&Te.value===e}function MJ(){var e=[];for(R=Te.start,Gt("[");!Le("]");)Le(",")?(kn(),e.push(null)):(e.push(Go()),Le("]")||Gt(","));return kn(),DJ(e)}function AR(){var e;return R=Te.start,e=kn(),e.type===Nc||e.type===Wo?(e.octal&&_e(e,mR),Pc(e)):Cw(e.value)}function jJ(){var e,t,n,i;if(R=Te.start,e=Te,e.type===qo)return n=AR(),Gt(":"),i=Go(),_R("init",n,i);if(e.type===Fc||e.type===En)qp(e);else return t=AR(),Gt(":"),i=Go(),_R("init",t,i)}function LJ(){var e=[],t,n,i,r={},a=String;for(R=Te.start,Gt("{");!Le("}");)t=jJ(),t.key.type===gR?n=t.key.name:n=a(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?_e({},gJ):r[i]=!0,e.push(t),Le("}")||Gt(",");return Gt("}"),NJ(e)}function PJ(){var e;return Gt("("),e=Dw(),Gt(")"),e}var zJ={if:1};function BJ(){var e,t,n;if(Le("("))return PJ();if(Le("["))return MJ();if(Le("{"))return LJ();if(e=Te.type,R=Te.start,e===qo||zJ[Te.value])n=Cw(kn().value);else if(e===Nc||e===Wo)Te.octal&&_e(Te,mR),n=Pc(kn());else{if(e===$a)throw new Error(Ic);e===Pp?(t=kn(),t.value=t.value==="true",n=Pc(t)):e===zp?(t=kn(),t.value=null,n=Pc(t)):Le("/")||Le("/=")?(n=Pc(CJ()),xR()):qp(kn())}return n}function UJ(){var e=[];if(Gt("("),!Le(")"))for(;R<qt&&!(e.push(Go()),Le(")"));)Gt(",");return Gt(")"),e}function qJ(){var e;return R=Te.start,e=kn(),$J(e)||qp(e),Cw(e.value)}function WJ(){return Gt("."),qJ()}function GJ(){var e;return Gt("["),e=Dw(),Gt("]"),e}function HJ(){var e,t,n;for(e=BJ();;)if(Le("."))n=WJ(),e=kR(".",e,n);else if(Le("("))t=UJ(),e=RJ(e,t);else if(Le("["))n=GJ(),e=kR("[",e,n);else break;return e}function SR(){var e=HJ();if(Te.type===En&&(Le("++")||Le("--")))throw new Error(Ic);return e}function Wp(){var e,t;if(Te.type!==En&&Te.type!==$a)t=SR();else{if(Le("++")||Le("--"))throw new Error(Ic);if(Le("+")||Le("-")||Le("~")||Le("!"))e=kn(),t=Wp(),t=IJ(e.value,t);else{if($w("delete")||$w("void")||$w("typeof"))throw new Error(Ic);t=SR()}}return t}function OR(e){var t=0;if(e.type!==En&&e.type!==$a)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function YJ(){var e,t,n,i,r,a,o,s,l,u;if(e=Te,l=Wp(),i=Te,r=OR(i),r===0)return l;for(i.prec=r,kn(),t=[e,Te],o=Wp(),a=[l,i,o];(r=OR(Te))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=ER(s,l,o),a.push(n);i=kn(),i.prec=r,a.push(i),t.push(Te),n=Wp(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)t.pop(),n=ER(a[u-1].value,a[u-2],n),u-=2;return n}function Go(){var e,t,n;return e=YJ(),Le("?")&&(kn(),t=Go(),Gt(":"),n=Go(),e=FJ(e,t,n)),e}function Dw(){var e=Go();if(Le(","))throw new Error(Ic);return e}function TR(e){V=e,R=0,qt=V.length,Te=null,xR();var t=Dw();if(Te.type!==Fc)throw new Error("Unexpect token after expression.");return t}var CR={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function $R(e){function t(o,s,l,u){var c=e(s[0]);return l&&(c=l+"("+c+")",l.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(u<0?"":u===0?"()":"("+s.slice(1).map(e).join(",")+")")}function n(o,s,l){return function(u){return t(o,u,s,l)}}var i="new Date",r="String",a="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&F("Missing arguments to clamp function."),o.length>3&&F("Too many arguments to clamp function.");var s=o.map(e);return"Math.max("+s[1]+", Math.min("+s[2]+","+s[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),join:n("join",null),indexof:n("indexOf",null),lastindexof:n("lastIndexOf",null),slice:n("slice",null),reverse:function(o){return"("+e(o[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),replace:n("replace",r),trim:n("trim",r,0),regexp:a,test:n("test",a),if:function(o){o.length<3&&F("Missing arguments to if function."),o.length>3&&F("Too many arguments to if function.");var s=o.map(e);return"("+s[0]+"?"+s[1]+":"+s[2]+")"}}}function VJ(e){var t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function XJ(e){e=e||{};var t=e.whitelist?pt(e.whitelist):{},n=e.blacklist?pt(e.blacklist):{},i=e.constants||CR,r=(e.functions||$R)(f),a=e.globalvar,o=e.fieldvar,s={},l={},u=0,c=de(a)?a:function(p){return a+'["'+p+'"]'};function f(p){if(Y(p))return p;var g=d[p.type];return g==null&&F("Unsupported type: "+p.type),g(p)}var d={Literal:function(p){return p.raw},Identifier:function(p){var g=p.name;return u>0?g:Q(n,g)?F("Illegal identifier: "+g):Q(i,g)?i[g]:Q(t,g)?g:(s[g]=1,c(g))},MemberExpression:function(p){var g=!p.computed,m=f(p.object);g&&(u+=1);var v=f(p.property);return m===o&&(l[VJ(v)]=1),g&&(u-=1),m+(g?"."+v:"["+v+"]")},CallExpression:function(p){p.callee.type!=="Identifier"&&F("Illegal callee type: "+p.callee.type);var g=p.callee.name,m=p.arguments,v=Q(r,g)&&r[g];return v||F("Unrecognized function: "+g),de(v)?v(m):v+"("+m.map(f).join(",")+")"},ArrayExpression:function(p){return"["+p.elements.map(f).join(",")+"]"},BinaryExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},UnaryExpression:function(p){return"("+p.operator+f(p.argument)+")"},ConditionalExpression:function(p){return"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")"},LogicalExpression:function(p){return"("+f(p.left)+p.operator+f(p.right)+")"},ObjectExpression:function(p){return"{"+p.properties.map(f).join(",")+"}"},Property:function(p){u+=1;var g=f(p.key);return u-=1,g+":"+f(p.value)}};function h(p){var g={code:f(p),globals:Object.keys(s),fields:Object.keys(l)};return s={},l={},g}return h.functions=r,h.constants=i,h}function Rw(e,t,n,i){t[0].type!==Uo&&F("First argument to data functions must be a string literal.");const r=t[0].value,a=zX+r;if(!Q(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(o){}}function JJ(e,t,n,i){t[0].type!==Uo&&F("First argument to indata must be a string literal."),t[1].type!==Uo&&F("Second argument to indata must be a string literal.");const r=t[0].value,a=t[1].value,o=BX+a;Q(o,i)||(i[o]=n.getData(r).indataRef(n,a))}function _n(e,t,n,i){if(t[0].type===Uo)DR(n,i,t[0].value);else for(e in n.scales)DR(n,i,e)}function DR(e,t,n){const i=kw+n;if(!Q(t,i))try{t[i]=e.scaleRef(n)}catch(r){}}function Nr(e,t){let n;return de(e)?e:Y(e)?(n=t.scales[e])&&n.value:void 0}function KJ(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=_n,n._range=_n,n._scale=_n;const i=r=>"_["+(r.type===Uo?B(kw+r.value):B(kw)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function Fw(e,t){return function(n,i,r){if(n){const a=Nr(n,(r||this).context);return a&&a.path[e](i)}else return t(i)}}const QJ=Fw("area",IW),ZJ=Fw("bounds",PW),eK=Fw("centroid",GW);function tK(e){let t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function Nw(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function nK(){return Nw(this.context.dataflow,"warn",arguments)}function iK(){return Nw(this.context.dataflow,"info",arguments)}function rK(){return Nw(this.context.dataflow,"debug",arguments)}function Iw(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Mw(e){const t=Aa(e),n=Iw(t.r),i=Iw(t.g),r=Iw(t.b);return .2126*n+.7152*i+.0722*r}function aK(e,t){const n=Mw(e),i=Mw(t),r=Math.max(n,i),a=Math.min(n,i);return(r+.05)/(a+.05)}function oK(){var e=[].slice.call(arguments);return e.unshift({}),ce.apply(null,e)}function RR(e,t){return e===t||e!==e&&t!==t?!0:M(e)?M(t)&&e.length===t.length?sK(e,t):!1:K(e)&&K(t)?FR(e,t):!1}function sK(e,t){for(let n=0,i=e.length;n<i;++n)if(!RR(e[n],t[n]))return!1;return!0}function FR(e,t){for(let n in e)if(!RR(e[n],t[n]))return!1;return!0}function NR(e){return t=>FR(e,t)}function lK(e,t,n,i,r,a){let o=this.context.dataflow,s=this.context.data[e],l=s.input,u=s.changes,c=o.stamp(),f,d;if(o._trigger===!1||!(l.value.length||t||i))return 0;if((!u||u.stamp<c)&&(s.changes=u=o.changeset(),u.stamp=c,o.runAfter(function(){s.modified=!0,o.pulse(l,u).run()},!0,1)),n&&(f=n===!0?fi:M(n)||Zf(n)?n:NR(n),u.remove(f)),t&&u.insert(t),i&&(f=NR(i),l.value.some(f)?u.remove(f):u.insert(i)),r)for(d in a)u.modify(r,d,a[d]);return 1}function uK(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function cK(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}function fK(e,t,n){return Ry(e||0,t||0,n||0)}function dK(e,t){const n=Nr(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function hK(e,t){const n=Nr(e,(t||this).context);return n?n.copy():void 0}function pK(e,t){const n=Nr(e,(t||this).context);return n?n.domain():[]}function gK(e,t,n){const i=Nr(e,(n||this).context);return i?M(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function mK(e,t){const n=Nr(e,(t||this).context);return n&&n.range?n.range():[]}function vK(e,t,n){const i=Nr(e,(n||this).context);return i?i(t):void 0}function yK(e,t,n,i,r){e=Nr(e,(r||this).context);const a=HA(t,n);let o=e.domain(),s=o[0],l=ve(o),u=It;return l-s?u=$T(e,s,l):e=(e.interpolator?Ee("sequential")().interpolator(e.interpolator()):Ee("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+i||15),s!==o[0]&&o.unshift(s),l!==ve(o)&&o.push(l)),o.forEach(c=>a.stop(u(c),e(c))),a}function bK(e,t,n){const i=Nr(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function wK(e){let t=null;return function(n){return n?Tu(n,t=t||Ys(e)):e}}const IR=e=>e.data;function MR(e,t){const n=fR.call(t,e);return n.root&&n.root.lookup||{}}function xK(e,t,n){const i=MR(e,this),r=i[t],a=i[n];return r&&a?r.path(a).map(IR):void 0}function EK(e,t){const n=MR(e,this)[t];return n?n.ancestors().map(IR):void 0}const jR=()=>typeof window!="undefined"&&window||null;function kK(){const e=jR();return e?e.screen:{}}function _K(){const e=jR();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function AK(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}const LR="intersect",PR="union",SK="vlMulti",zR="or",OK="and";var TK="E",CK="R",$K="R-E",DK="R-LE",RK="R-RE",BR="index:unit";function UR(e,t){for(var n=t.fields,i=t.values,r=n.length,a=0,o,s;a<r;++a)if(s=n[a],s.getter=ci.getter||ci(s.field),o=s.getter(e),ia(o)&&(o=Xt(o)),ia(i[a])&&(i[a]=Xt(i[a])),ia(i[a][0])&&(i[a]=i[a].map(Xt)),s.type===TK){if(M(i[a])?i[a].indexOf(o)<0:o!==i[a])return!1}else if(s.type===CK){if(!Cs(o,i[a]))return!1}else if(s.type===RK){if(!Cs(o,i[a],!0,!1))return!1}else if(s.type===$K){if(!Cs(o,i[a],!1,!1))return!1}else if(s.type===DK&&!Cs(o,i[a],!1,!0))return!1;return!0}function FK(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a=i?i[BR]&&i[BR].value:void 0,o=n===LR,s=r.length,l=0,u,c,f,d,h;l<s;++l)if(u=r[l],a&&o){if(c=c||{},f=c[d=u.unit]||0,f===-1)continue;if(h=UR(t,u),c[d]=h?-1:++f,h&&a.size===1)return!0;if(!h&&f===a.get(d).count)return!1}else if(h=UR(t,u),o^h)return h;return s&&o}function NK(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],a={},o={},s={},l,u,c,f,d,h,p,g,m,v=r.length,y=0,b,E;y<v;++y){for(l=r[y],f=l.unit,u=l.fields,c=l.values,b=0,E=u.length;b<E;++b)d=u[b],h=a[d.field]||(a[d.field]={}),p=h[f]||(h[f]=[]),s[d.field]=g=d.type.charAt(0),m=qR[g+"_union"],h[f]=m(p,G(c[b]));n&&(p=o[f]||(o[f]=[]),p.push(G(c).reduce((x,k,w)=>(x[u[w].field]=k,x),{})))}return t=t||PR,Object.keys(a).forEach(function(x){a[x]=Object.keys(a[x]).map(k=>a[x][k]).reduce((k,w)=>k===void 0?w:qR[s[x]+"_"+t](k,w))}),r=Object.keys(o),n&&r.length&&(a[SK]=t===PR?{[zR]:r.reduce((x,k)=>(x.push.apply(x,o[k]),x),[])}:{[OK]:r.map(x=>({[zR]:o[x]}))}),a}var qR={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(function(n){return t.indexOf(n)>=0}):t},R_union:function(e,t){var n=Xt(t[0]),i=Xt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Xt(t[0]),i=Xt(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const IK=":",MK="@";function WR(e,t,n,i){t[0].type!==Uo&&F("First argument to selection functions must be a string literal.");const r=t[0].value,a=t.length>=2&&ve(t).value,o="unit",s=MK+o,l=IK+r;a===LR&&!Q(i,s)&&(i[s]=n.getData(r).indataRef(n,o)),Q(i,l)||(i[l]=n.getData(r).tuplesRef())}function jK(e,t,n){if(!e)return[];const[i,r]=e,a=new st().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return sC(o,a,LK(t))}function LK(e){let t=null;if(e){const n=G(e.marktype),i=G(e.markname);t=r=>(!n.length||n.some(a=>r.marktype===a))&&(!i.length||i.some(a=>r.name===a))}return t}const zc={random:function(){return Wn()},cumulativeNormal:Ed,cumulativeLogNormal:Z0,cumulativeUniform:iv,densityNormal:V0,densityLogNormal:Q0,densityUniform:nv,quantileNormal:kd,quantileLogNormal:ev,quantileUniform:rv,sampleNormal:xd,sampleLogNormal:K0,sampleUniform:tv,isArray:M,isBoolean:na,isDate:ia,isDefined:function(e){return e!==void 0},isNumber:Ce,isObject:K,isRegExp:ik,isString:Y,isTuple:Zf,isValid:function(e){return e!=null&&e===e},toBoolean:Vm,toDate:Xm,toNumber:Xt,toString:Jm,flush:nk,lerp:rk,merge:oK,pad:sk,peek:ve,span:ru,inrange:Cs,truncate:lk,rgb:Aa,lab:yh,hcl:bh,hsl:mh,luminance:Mw,contrast:aK,sequence:ho,format:RX,utcFormat:FX,utcParse:IX,utcOffset:s_,utcSequence:c_,timeFormat:dR,timeParse:NX,timeOffset:o_,timeSequence:u_,timeUnitSpecifier:qk,monthFormat:MX,monthAbbrevFormat:jX,dayFormat:LX,dayAbbrevFormat:PX,quarter:KE,utcquarter:QE,week:Kk,utcweek:e_,dayofyear:Jk,utcdayofyear:Zk,warn:nK,info:iK,debug:rK,extent:Mi,inScope:tK,intersect:jK,clampRange:ZE,pinchDistance:uK,pinchAngle:cK,screen:kK,containerSize:AK,windowSize:_K,bandspace:fK,setdata:$X,pathShape:wK,panLinear:YE,panLog:VE,panPow:XE,panSymlog:JE,zoomLinear:Um,zoomLog:qm,zoomPow:Xf,zoomSymlog:Wm,encode:DX,modify:lK},PK=["view","item","group","xy","x","y"],zK="event.vega.",GR="this.",jw={};function BK(e){const t=$R(e);PK.forEach(n=>t[n]=zK+n);for(let n in zc)t[n]=GR+n;return ce(t,KJ(e,zc,jw)),t}function yt(e,t,n){return arguments.length===1?zc[e]:(zc[e]=t,n&&(jw[e]=n),Lw&&(Lw.functions[e]=GR+e),this)}yt("bandwidth",dK,_n),yt("copy",hK,_n),yt("domain",pK,_n),yt("range",mK,_n),yt("invert",gK,_n),yt("scale",vK,_n),yt("gradient",yK,_n),yt("geoArea",QJ,_n),yt("geoBounds",ZJ,_n),yt("geoCentroid",eK,_n),yt("geoShape",bK,_n),yt("indata",CX,JJ),yt("data",fR,Rw),yt("treePath",xK,Rw),yt("treeAncestors",EK,Rw),yt("vlSelectionTest",FK,WR),yt("vlSelectionResolve",NK,WR);const HR={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_["+B(hR+e)+"]",functions:BK,constants:CR,visitors:jw};var Lw=XJ(HR);function Zi(e,t){var n={},i,r;try{e=Y(e)?e:B(e)+"",i=TR(e)}catch(a){F("Expression parse error: "+e)}return i.visit(a=>{if(a.type!==pR)return;var o=a.callee.name,s=HR.visitors[o];s&&s(o,a.arguments,t,n)}),r=Lw(i),r.globals.forEach(a=>{var o=hR+a;!Q(n,o)&&t.getSignal(a)&&(n[o]=t.signalRef(a))}),{$expr:ce({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function UK(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const qK=pt(["rule"]),YR=pt(["group","image","rect"]);function WK(e,t){let n="";return qK[t]||(e.x2&&(e.x?(YR[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(YR[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function Pw(e){return(e+"").toLowerCase()}function GK(e){return Pw(e)==="operator"}function HK(e){return Pw(e)==="collect"}function Bc(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");var i=Function.apply(null,t.concat(n));return e&&e.functions?i.bind(e.functions):i}function YK(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var VK={operator:(e,t)=>Bc(e,["_"],t.code),parameter:(e,t)=>Bc(e,["datum","_"],t.code),event:(e,t)=>Bc(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return Bc(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const a in i){const o="o["+B(a)+"]";r+=`$=${i[a].code};if(${o}!==$)${o}=$,m=1;`}return r+=WK(i,n),r+="return m;",Bc(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(B).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(a,o)=>{const s=t[o];let l,u;return a.path?(l=`a${a.path}`,u=`b${a.path}`):((n=n||{})["f"+o]=a,l=`this.f${o}(a)`,u=`this.f${o}(b)`),YK(l,u,-s,s)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function XK(e){const t=this;GK(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function JK(e){const t=this;if(e.params){const n=t.get(e.id);n||F("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function KK(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=M(r)?r.map(a=>VR(a,n,t)):VR(r,n,t)}return t}function VR(e,t,n){if(!e||!K(e))return e;for(let i=0,r=XR.length,a;i<r;++i)if(a=XR[i],Q(e,a.key))return a.parse(e,t,n);return e}var XR=[{key:"$ref",parse:QK},{key:"$key",parse:eQ},{key:"$expr",parse:ZK},{key:"$field",parse:tQ},{key:"$encode",parse:iQ},{key:"$compare",parse:nQ},{key:"$context",parse:rQ},{key:"$subflow",parse:aQ},{key:"$tupleid",parse:oQ}];function QK(e,t){return t.get(e.$ref)||F("Operator not defined: "+e.$ref)}function ZK(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=dn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function eQ(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Ym(e.$key,e.$flat,t.expr.codegen))}function tQ(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=ci(e.$field,e.$name,t.expr.codegen))}function nQ(e,t){const n="c:"+e.$compare+"_"+e.$order,i=G(e.$compare).map(r=>r&&r.$tupleid?ee:r);return t.fn[n]||(t.fn[n]=Gm(i,e.$order,t.expr.codegen))}function iQ(e,t){const n=e.$encode,i={};for(const r in n){const a=n[r];i[r]=dn(t.encodeExpression(a.$expr),a.$fields),i[r].output=a.$output}return i}function rQ(e,t){return t}function aQ(e,t){const n=e.$subflow;return function(i,r,a){const o=t.fork().parse(n),s=o.get(n.operators[0].id),l=o.signals.parent;return l&&l.set(a),s.detachSubflow=()=>t.detach(o),s}}function oQ(){return ee}function sQ(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(a=>t.get(a)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(a=>t.get(a)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&F("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function lQ(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,a=e.update,o=void 0;i||F("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),a&&a.$expr&&(a.$params&&(o=t.parseParameters(a.$params)),a=t.handlerExpression(a.$expr)),t.update(e,i,r,a,o)}var uQ={skip:!0};function cQ(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(a=>{var o=t.signals[a];e.signals(a,o)&&(i[a]=o.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(a=>{var o=t.data[a];e.data(a,o)&&(r[a]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(a=>a.getState(e))),n}function fQ(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(a=>{n.update(t.signals[a],r[a],uQ)}),Object.keys(i||{}).forEach(a=>{n.pulse(t.data[a].input,n.changeset().remove(fi).insert(i[a]))}),(e.subcontext||[]).forEach((a,o)=>{var s=t.subcontext[o];s&&s.setState(a)})}function JR(e,t,n,i){return new KR(e,t,n,i)}function KR(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||VK,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function QR(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}KR.prototype=QR.prototype={fork(){const e=new QR(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),HK(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){var a=n.get(e.parent.$ref);a?(i.connect(a,[t]),t.targets().add(a)):(n.unresolved=n.unresolved||[]).push(()=>{a=n.get(e.parent.$ref),i.connect(a,[t]),t.targets().add(a)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const o in e.data){const s=n.data[o]||(n.data[o]={});e.data[o].forEach(l=>s[l]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[Pw(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:UK,parseOperator:XK,parseOperatorParameters:JK,parseParameters:KK,parseStream:sQ,parseUpdate:lQ,getState:cQ,setState:fQ};function dQ(e,t,n){return JR(e,Bs,zc,n).parse(t)}function hQ(e){var t=this._runtime.scales;return Q(t,e)||F("Unrecognized scale or projection: "+e),t[e].value}var ZR="width",eF="height",zw="padding",tF={skip:!0};function nF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===zw?i.left+i.right:0)}function iF(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===zw?i.top+i.bottom:0)}function pQ(e){var t=e._signals,n=t[ZR],i=t[eF],r=t[zw];function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,function(s){e._width=s.size,e._viewWidth=nF(e,s.size),a()},{size:n}),e._resizeHeight=e.add(null,function(s){e._height=s.size,e._viewHeight=iF(e,s.size),a()},{size:i});var o=e.add(null,a,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function gQ(e,t,n,i,r,a){this.runAfter(function(o){var s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(ZR,n,tF),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(eF,i,tF),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(l=>l.resize())},!1,1)}function mQ(e){return this._runtime.getState(e||{data:vQ,signals:yQ,recurse:!0})}function vQ(e,t){return t.modified&&M(t.input.value)&&e.indexOf("_:vega:_")}function yQ(e,t){return!(e==="parent"||t instanceof Bs.proxy)}function bQ(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function wQ(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(BH(n,t))}function xQ(e,t,n,i){var r=e.element();r&&r.setAttribute("title",EQ(i))}function EQ(e){return e==null?"":M(e)?rF(e):K(e)&&!ia(e)?kQ(e):e+""}function kQ(e){return Object.keys(e).map(function(t){var n=e[t];return t+": "+(M(n)?rF(n):aF(n))}).join(`
`)}function rF(e){return"["+e.map(aF).join(", ")+"]"}function aF(e){return M(e)?"[â€¦]":K(e)&&!ia(e)?"{â€¦}":e}function oF(e,t){const n=this;if(t=t||{},zs.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const a=ce({},e.locale,t.locale);n.locale(F_(a.number,a.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Oa.Canvas,n._scenegraph=new Ay();const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||xQ,n._redraw=!0,n._handler=new zu().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=sX(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=dQ(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(a=>({state:null,param:ce({},a)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=nF(n,n._width),n._viewHeight=iF(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,pQ(n),JV(n),KV(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}var le=P(oF,zs);le.evaluate=async function(e,t,n){if(await zs.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,tX(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&Qf(this,n),this},le.dirty=function(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},le.description=function(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&nR(this._el,this._desc=t),this}return this._desc},le.container=function(){return this._el},le.scenegraph=function(){return this._scenegraph},le.origin=function(){return this._origin.slice()};function Gp(e,t){return Q(e._signals,t)?e._signals[t]:F("Unrecognized signal name: "+B(t))}le.signal=function(e,t,n){var i=Gp(this,e);return arguments.length===1?i.value:this.update(i,t,n)},le.width=function(e){return arguments.length?this.signal("width",e):this.signal("width")},le.height=function(e){return arguments.length?this.signal("height",e):this.signal("height")},le.padding=function(e){return arguments.length?this.signal("padding",cR(e)):cR(this.signal("padding"))},le.autosize=function(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},le.background=function(e){return arguments.length?this.signal("background",e):this.signal("background")},le.renderer=function(e){return arguments.length?(Rh(e)||F("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},le.tooltip=function(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},le.loader=function(e){return arguments.length?(e!==this._loader&&(zs.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},le.resize=function(){return this._autosize=1,this.touch(Gp(this,"autosize"))},le._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},le._resizeView=gQ,le.addEventListener=function(e,t,n){var i=t;return n&&n.trap===!1||(i=ww(this,t),i.raw=t),this._handler.on(e,i),this},le.removeEventListener=function(e,t){for(var n=this._handler.handlers(e),i=n.length,r,a;--i>=0;)if(a=n[i].type,r=n[i].handler,e===a&&(t===r||t===r.raw)){this._handler.off(a,r);break}return this},le.addResizeListener=function(e){var t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},le.removeResizeListener=function(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this};function sF(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function lF(e,t,n,i){var r=sF(n,i);return r||(r=ww(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function uF(e,t,n){var i=sF(t,n);return i&&t._targets.remove(i),e}le.addSignalListener=function(e,t){return lF(this,e,Gp(this,e),t)},le.removeSignalListener=function(e,t){return uF(this,Gp(this,e),t)},le.addDataListener=function(e,t){return lF(this,e,Rp(this,e).values,t)},le.removeDataListener=function(e,t){return uF(this,Rp(this,e).values,t)},le.globalCursor=function(e){if(arguments.length){if(this._globalCursor!==!!e){const t=bw(this,null);this._globalCursor=!!e,t&&bw(this,t)}return this}else return this._globalCursor},le.preventDefault=function(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},le.timer=wQ,le.events=uX,le.finalize=fX,le.hover=cX,le.data=QV,le.change=Fp,le.insert=ZV,le.remove=eX,le.scale=hQ,le.initialize=kX,le.toImageURL=AX,le.toCanvas=OX,le.toSVG=TX,le.getState=mQ,le.setState=bQ;function _Q(e){return K(e)?e:{type:e||"pad"}}const Uc=e=>+e||0,AQ=e=>({top:e,bottom:e,left:e,right:e});function SQ(e){return K(e)?e.signal?e:{top:Uc(e.top),bottom:Uc(e.bottom),left:Uc(e.left),right:Uc(e.right)}:AQ(Uc(e))}const bt=e=>K(e)&&!M(e)?ce({},e):{value:e};function cF(e,t,n,i){return n!=null?(K(n)&&!M(n)?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function Dt(e,t,n){for(const i in t)cF(e,i,t[i]);for(const i in n)cF(e,i,n[i],"update")}function Sl(e,t,n){for(const i in t){if(n&&Q(n,i))continue;e[i]=ce(e[i]||{},t[i])}return e}function Ol(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}var Bw="mark",Uw="frame",qw="scope",OQ="axis",TQ="axis-domain",CQ="axis-grid",$Q="axis-label",DQ="axis-tick",RQ="axis-title",FQ="legend",NQ="legend-band",IQ="legend-entry",MQ="legend-gradient",fF="legend-label",jQ="legend-symbol",LQ="legend-title",PQ="title",zQ="title-text",BQ="title-subtitle";function UQ(e,t,n,i,r){const a={},o={};let s,l,u,c;l="lineBreak",t==="text"&&r[l]!=null&&!Ol(l,e)&&Ww(a,l,r[l]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Uw?r.group:n===Bw?ce({},r.mark,r[t]):null;for(l in c)u=Ol(l,e)||(l==="fill"||l==="stroke")&&(Ol("fill",e)||Ol("stroke",e)),u||Ww(a,l,c[l]);G(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)Ol(h,e)||Ww(a,h,d[h])}),e=ce({},e);for(l in a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=ce(o,e.enter),s&&(e.update=ce(s,e.update)),e}function Ww(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const dF=e=>Y(e)?B(e):e.signal?`(${e.signal})`:hF(e);function Hp(e){if(e.gradient!=null)return WQ(e);let t=e.signal?`(${e.signal})`:e.color?qQ(e.color):e.field!=null?hF(e.field):e.value!==void 0?B(e.value):void 0;return e.scale!=null&&(t=GQ(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${Vp(e.exponent)})`),e.mult!=null&&(t+=`*${Vp(e.mult)}`),e.offset!=null&&(t+=`+${Vp(e.offset)}`),e.round&&(t=`round(${t})`),t}const Yp=(e,t,n,i)=>`(${e}(${[t,n,i].map(Hp).join(",")})+'')`;function qQ(e){return e.c?Yp("hcl",e.h,e.c,e.l):e.h||e.s?Yp("hsl",e.h,e.s,e.l):e.l||e.a?Yp("lab",e.l,e.a,e.b):e.r||e.g||e.b?Yp("rgb",e.r,e.g,e.b):null}function WQ(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:B(n));for(;t.length&&ve(t)==null;)t.pop();return t.unshift(dF(e.gradient)),`gradient(${t.join(",")})`}function Vp(e){return K(e)?"("+Hp(e)+")":e}function hF(e){return pF(K(e)?e:{datum:e})}function pF(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):F("Invalid field reference: "+B(e));return e.signal||(i=Y(i)?Ii(i).map(B).join("]["):pF(i)),t+"["+i+"]"}function GQ(e,t){const n=dF(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band===1?"":"*"+Vp(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function HQ(e){let t="";return e.forEach(n=>{const i=Hp(n);t+=n.test?`(${n.test})?${i}:`:i}),ve(t)===":"&&(t+="null"),t}function gF(e,t,n,i,r,a){const o={};a=a||{},a.encoders={$encode:o},e=UQ(e,t,n,i,r.config);for(const s in e)o[s]=YQ(e[s],t,a,r);return a}function YQ(e,t,n,i){const r={},a={};for(const o in e)e[o]!=null&&(r[o]=XQ(VQ(e[o]),i,n,a));return{$expr:{marktype:t,channels:r},$fields:Object.keys(a),$output:Object.keys(e)}}function VQ(e){return M(e)?HQ(e):Hp(e)}function XQ(e,t,n,i){const r=Zi(e,t);return r.$fields.forEach(a=>i[a]=1),ce(n,r.$params),r.$expr}var JQ="outer",KQ=["value","update","init","react","bind"];function mF(e,t){F(e+' for "outer" push: '+B(t))}function vF(e,t){var n=e.name;if(e.push===JQ)t.signals[n]||mF("No prior signal definition",n),KQ.forEach(function(r){e[r]!==void 0&&mF("Invalid property ",r)});else{var i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Gw(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function Xp(e,t,n,i){return new Gw(e,t,n,i)}function Jp(e,t){return Xp("operator",e,t)}function ne(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function qc(e,t){return t?{$field:e,$name:t}:{$field:e}}var Hw=qc("key");function yF(e,t){return{$compare:e,$order:t}}function QQ(e,t){var n={$key:e};return t&&(n.$flat=!0),n}var ZQ="ascending",eZ="descending";function tZ(e){return K(e)?(e.order===eZ?"-":"+")+Kp(e.op,e.field):""}function Kp(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}var Yw="scope",Vw="view";function wt(e){return e&&e.signal}function nZ(e){return e&&e.expr}function Wc(e){if(wt(e))return!0;if(K(e)){for(var t in e)if(Wc(e[t]))return!0}return!1}function _i(e,t){return e??t}function Ho(e){return e&&e.signal||e}var bF="timer";function Gc(e,t){var n=e.merge?rZ:e.stream?aZ:e.type?oZ:F("Invalid stream specification: "+B(e));return n(e,t)}function iZ(e){return e===Yw?Vw:e||Vw}function rZ(e,t){var n=e.merge.map(r=>Gc(r,t)),i=Xw({merge:n},e,t);return t.addStream(i).id}function aZ(e,t){var n=Gc(e.stream,t),i=Xw({stream:n},e,t);return t.addStream(i).id}function oZ(e,t){var n,i;return e.type===bF?(n=t.event(bF,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(iZ(e.source),e.type),i=Xw({stream:n},e,t),Object.keys(i).length===1?n:t.addStream(i).id}function Xw(e,t,n){var i=t.between;return i&&(i.length!==2&&F('Stream "between" parameter must have 2 entries: '+B(t)),e.between=[Gc(i[0],n),Gc(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(sZ(t.marktype,t.markname,t.markrole)),t.source===Yw&&i.push("inScope(event.item)"),i.length&&(e.filter=Zi("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function sZ(e,t,n){var i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}function Yo(e,t,n){return kF=t||lZ,_F=n||hZ,AF(e.trim()).map(Jw)}var lZ="view",Qp="[",Zp="]",wF="{",xF="}",uZ=":",EF=",",cZ="@",fZ=">",dZ=/[[\]{}]/,kF,_F,hZ={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function pZ(e){return _F[e]}function Hc(e,t,n,i,r){for(var a=0,o=e.length,s;t<o;++t){if(s=e[t],!a&&s===n)return t;r&&r.indexOf(s)>=0?--a:i&&i.indexOf(s)>=0&&++a}return t}function AF(e){for(var t=[],n=0,i=e.length,r=0;r<i;)r=Hc(e,r,EF,Qp+wF,Zp+xF),t.push(e.substring(n,r).trim()),n=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Jw(e){return e[0]==="["?gZ(e):mZ(e)}function gZ(e){var t=e.length,n=1,i,r;if(n=Hc(e,n,Zp,Qp,Zp),n===t)throw"Empty between selector: "+e;if(i=AF(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==fZ)throw"Expected '>' after between selector: "+e;return i=i.map(Jw),r=Jw(e.slice(1).trim()),r.between?{between:i,stream:r}:(r.between=i,r)}function mZ(e){var t={source:kF},n=[],i=[0,0],r=0,a=0,o=e.length,s=0,l,u;if(e[o-1]===xF){if(s=e.lastIndexOf(wF),s>=0){try{i=vZ(e.substring(s+1,o-1))}catch(c){throw"Invalid throttle specification: "+e}e=e.slice(0,s).trim(),o=e.length}else throw"Unmatched right brace: "+e;s=0}if(!o)throw e;if(e[0]===cZ&&(r=++s),l=Hc(e,s,uZ),l<o&&(n.push(e.substring(a,l).trim()),a=s=++l),s=Hc(e,s,Qp),s===o)n.push(e.substring(a,o).trim());else if(n.push(e.substring(a,s).trim()),u=[],a=++s,a===o)throw"Unmatched left bracket: "+e;for(;s<o;){if(s=Hc(e,s,Zp),s===o)throw"Unmatched left bracket: "+e;if(u.push(e.substring(a,s).trim()),s<o-1&&e[++s]!==Qp)throw"Expected left bracket: "+e;a=++s}if(!(o=n.length)||dZ.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):pZ(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),u!=null&&(t.filter=u),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function vZ(e){var t=e.split(EF);if(!e.length||t.length>2)throw e;return t.map(function(n){var i=+n;if(i!==i)throw e;return i})}const yZ={code:"_.$value",ast:{type:"Identifier",value:"value"}};function bZ(e,t,n){var i=e.events,r=e.update,a=e.encode,o=[],s={target:n};i||F("Signal update missing events specification."),Y(i)&&(i=Yo(i,t.isSubscope()?Yw:Vw)),i=G(i).filter(l=>l.signal||l.scale?(o.push(l),0):1),o.length>1&&(o=[xZ(o)]),i.length&&o.push(i.length>1?{merge:i}:i[0]),a!=null&&(r&&F("Signal encode and update are mutually exclusive."),r="encode(item(),"+B(a)+")"),s.update=Y(r)?Zi(r,t):r.expr!=null?Zi(r.expr,t):r.value!=null?r.value:r.signal!=null?{$expr:yZ,$params:{$value:t.signalRef(r.signal)}}:F("Invalid signal update specification."),e.force&&(s.options={force:!0}),o.forEach(function(l){t.addUpdate(ce(wZ(l,t),s))})}function wZ(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Gc(e,t)}}function xZ(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function EZ(e,t){var n=t.getSignal(e.name),i=e.update;e.init&&(i?F("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Zi(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(function(r){bZ(r,t,n.id)})}const De=e=>(t,n,i)=>Xp(e,n,t||void 0,i);var SF=De("aggregate"),kZ=De("axisticks"),OF=De("bound"),Ai=De("collect"),TF=De("compare"),_Z=De("datajoin"),CF=De("encode"),AZ=De("expression"),SZ=De("facet"),OZ=De("field"),TZ=De("key"),CZ=De("legendentries"),$Z=De("load"),DZ=De("mark"),RZ=De("multiextent"),FZ=De("multivalues"),NZ=De("overlap"),IZ=De("params"),$F=De("prefacet"),MZ=De("projection"),jZ=De("proxy"),LZ=De("relay"),DF=De("render"),PZ=De("scale"),Vo=De("sieve"),zZ=De("sortitems"),RF=De("viewlayout"),BZ=De("values"),UZ=0,FF={min:"min",max:"max",count:"sum"};function qZ(e,t){var n=e.type||"linear";_T(n)||F("Unrecognized scale type: "+B(n)),t.addScale(e.name,{type:n,domain:void 0})}function WZ(e,t){var n=t.getScale(e.name).params,i;n.domain=NF(e.domain,e,t),e.range!=null&&(n.range=MF(e,t,n)),e.interpolate!=null&&eee(e.interpolate,n),e.nice!=null&&(n.nice=ZZ(e.nice)),e.bins!=null&&(n.bins=QZ(e.bins,t));for(i in e){if(Q(n,i)||i==="name")continue;n[i]=Zn(e[i],t)}}function Zn(e,t){return K(e)?e.signal?t.signalRef(e.signal):F("Unsupported object: "+B(e)):e}function eg(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Zn(n,t))}function tg(e){F("Can not find data set: "+B(e))}function NF(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&F("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(M(e)?GZ:e.fields?YZ:HZ)(e,t,n)}function GZ(e,t,n){return e.map(function(i){return Zn(i,n)})}function HZ(e,t,n){var i=n.getData(e.data);return i||tg(e.data),ul(t.type)?i.valuesRef(n,e.field,IF(e.sort,!1)):OT(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function YZ(e,t,n){var i=e.data,r=e.fields.reduce(function(a,o){return o=Y(o)?{data:i,field:o}:M(o)||o.signal?VZ(o,n):o,a.push(o),a},[]);return(ul(t.type)?XZ:OT(t.type)?JZ:KZ)(e,n,r)}function VZ(e,t){var n="_:vega:_"+UZ++,i=Ai({});if(M(e))i.value={$ingest:e};else if(e.signal){var r="setdata("+B(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Vo({})]),{data:n,field:"data"}}function XZ(e,t,n){var i=IF(e.sort,!0),r,a,o,s,l;return r=n.map(function(u){var c=t.getData(u.data);return c||tg(u.data),c.countsRef(t,u.field,i)}),a={groupby:Hw,pulse:r},i&&(o=i.op||"count",l=i.field?Kp(o,i.field):"count",a.ops=[FF[o]],a.fields=[t.fieldRef(l)],a.as=[l]),o=t.add(SF(a)),s=t.add(Ai({pulse:ne(o)})),l=t.add(BZ({field:Hw,sort:t.sortRef(i),pulse:ne(s)})),ne(l)}function IF(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?F("No field provided for sort aggregate op: "+e.op):t&&e.field&&(e.op&&!FF[e.op]&&F("Multiple domain scales can not be sorted using "+e.op))),e}function JZ(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||tg(r.data),a.domainRef(t,r.field)});return ne(t.add(FZ({values:i})))}function KZ(e,t,n){var i=n.map(function(r){var a=t.getData(r.data);return a||tg(r.data),a.extentRef(t,r.field)});return ne(t.add(RZ({extents:i})))}function QZ(e,t){return e.signal||M(e)?eg(e,t):t.objectProperty(e)}function ZZ(e){return K(e)?{interval:Zn(e.interval),step:Zn(e.step)}:Zn(e)}function eee(e,t){t.interpolate=Zn(e.type||e),e.gamma!=null&&(t.interpolateGamma=Zn(e.gamma))}function MF(e,t,n){var i=e.range,r=t.config.range;if(i.signal)return t.signalRef(i.signal);if(Y(i)){if(r&&Q(r,i))return e=ce({},e,{range:r[i]}),MF(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=ul(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:F("Unrecognized scale range value: "+B(i))}else if(i.scheme){n.scheme=M(i.scheme)?eg(i.scheme,t):Zn(i.scheme,t),i.extent&&(n.schemeExtent=eg(i.extent,t)),i.count&&(n.schemeCount=Zn(i.count,t));return}else if(i.step){n.rangeStep=Zn(i.step,t);return}else{if(ul(e.type)&&!M(i))return NF(i,e,t);M(i)||F("Unsupported range type: "+B(i))}return i.map(a=>(M(a)?eg:Zn)(a,t))}function tee(e,t){var n=t.config.projection||{},i={};for(var r in e){if(r==="name")continue;i[r]=Kw(e[r],r,t)}for(r in n)i[r]==null&&(i[r]=Kw(n[r],r,t));t.addProjection(e.name,i)}function Kw(e,t,n){return M(e)?e.map(function(i){return Kw(i,t,n)}):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:F("Unsupported parameter object: "+B(e)):e}const Si="top",Tl="left",Cl="right",Da="bottom",jF="center",nee="vertical",iee="start",ree="middle",aee="end",Qw="index",Zw="label",oee="offset",$l="perc",see="perc2",ei="value",Yc="guide-label",ex="guide-title",lee="group-title",uee="group-subtitle",LF="symbol",ng="gradient",tx="discrete",nx="size",cee="shape",fee="fill",dee="stroke",hee="strokeWidth",pee="strokeDash",gee="opacity",ix=[nx,cee,fee,dee,hee,pee,gee],Vc={name:1,style:1,interactive:1},be={value:0},ti={value:1};var ig="group",PF="rect",rx="rule",mee="symbol",Xo="text";function Xc(e){return e.type=ig,e.interactive=e.interactive||!1,e}function An(e,t){const n=(i,r)=>_i(e[i],_i(t[i],r));return n.isVertical=i=>nee===_i(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>_i(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>_i(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>_i(e.columns,_i(t.columns,+n.isVertical(!0))),n}function zF(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function vee(e,t,n){var i=t.config.style[n];return i&&i[e]}function rg(e,t,n){return`item.anchor === '${iee}' ? ${e} : item.anchor === '${aee}' ? ${t} : ${n}`}const ax=rg(B(Tl),B(Cl),B(jF));function yee(e){let t=e("tickBand"),n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function BF(e,t){return t?e?K(e)?Object.assign({},e,{offset:BF(e.offset,t)}):{value:e,offset:t}:t:e}function zn(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Sl(e.encode,t,Vc)):e.interactive=!1,e}function bee(e,t,n,i){var r=An(e,n),a=r.isVertical(),o=r.gradientThickness(),s=r.gradientLength(),l,u,c,f,d,h;return a?(c=[0,1],f=[0,0],d=o,h=s):(c=[0,0],f=[1,0],d=s,h=o),l={enter:u={opacity:be,x:be,y:be,width:bt(d),height:bt(h)},update:ce({},u,{opacity:ti,fill:{gradient:t,start:c,stop:f}}),exit:{opacity:be}},Dt(l,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),zn({type:PF,role:MQ,encode:l},i)}function wee(e,t,n,i,r){var a=An(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength(),u,c,f,d,h,p,g="";return o?(f="y",h="y2",d="x",p="width",g="1-"):(f="x",h="x2",d="y",p="height"),c={opacity:be,fill:{scale:t,field:ei}},c[f]={signal:g+"datum."+$l,mult:l},c[d]=be,c[h]={signal:g+"datum."+see,mult:l},c[p]=bt(s),u={enter:c,update:ce({},c,{opacity:ti}),exit:{opacity:be}},Dt(u,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),zn({type:PF,role:NQ,key:ei,from:r,encode:u},i)}const xee=`datum.${$l}<=0?"${Tl}":datum.${$l}>=1?"${Cl}":"${jF}"`,Eee=`datum.${$l}<=0?"${Da}":datum.${$l}>=1?"${Si}":"${ree}"`;function UF(e,t,n,i){var r=An(e,t),a=r.isVertical(),o=bt(r.gradientThickness()),s=r.gradientLength(),l=r("labelOverlap"),u,c,f,d,h,p="";return u={enter:c={opacity:be},update:f={opacity:ti,text:{field:Zw}},exit:{opacity:be}},Dt(u,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:_i(e.labelLimit,t.gradientLabelLimit)}),a?(c.align={value:"left"},c.baseline=f.baseline={signal:Eee},d="y",h="x",p="1-"):(c.align=f.align={signal:xee},c.baseline={value:"top"},d="x",h="y"),c[d]=f[d]={signal:p+"datum."+$l,mult:s},c[h]=f[h]=o,o.offset=_i(e.labelOffset,t.gradientLabelOffset)||0,l=l?{separation:r("labelSeparation"),method:l,order:"datum."+Qw}:void 0,zn({type:Xo,role:fF,style:Yc,key:ei,from:i,encode:u,overlap:l},n)}function kee(e,t,n,i,r){var a=An(e,t),o=n.entries,s=!!(o&&o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d={},h=`(${r}) ? datum.${oee} : datum.${nx}`,p=u?bt(u):{field:nx},g=`datum.${Qw}`,m=`max(1, ${r})`,v,y,b,E,x,k,w;p.mult=.5,d={enter:v={opacity:be,x:{signal:h,mult:.5,offset:c},y:p},update:y={opacity:ti,x:v.x,y:v.y},exit:{opacity:be}};var A=null,_=null;return e.fill||(A=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Dt(d,{fill:a("symbolFillColor",A),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),ix.forEach(function(O){e[O]&&(y[O]=v[O]={scale:e[O],field:ei})}),E=zn({type:mee,role:jQ,key:ei,from:f,clip:u?!0:void 0,encode:d},n.symbols),b=bt(c),b.offset=a("labelOffset"),d={enter:v={opacity:be,x:{signal:h,offset:b},y:p},update:y={opacity:ti,text:{field:Zw},x:v.x,y:v.y},exit:{opacity:be}},Dt(d,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")}),x=zn({type:Xo,role:fF,style:Yc,key:ei,from:f,encode:d},n.labels),d={enter:{noBound:{value:!u},width:be,height:u?bt(u):be,opacity:be},exit:{opacity:be},update:y={opacity:ti,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(k=`ceil(item.mark.items.length / ${m})`,y.row.signal=`${g}%${k}`,y.column.signal=`floor(${g} / ${k})`,w={field:["row",g]}):(y.row.signal=`floor(${g} / ${m})`,y.column.signal=`${g} % ${m}`,w={field:g}),y.column.signal=`(${r})?${y.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Qw}},Xc({role:qw,from:i,encode:Sl(d,o,Vc),marks:[E,x],name:l,interactive:s,sort:w})}function _ee(e,t){const n=An(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const ox='item.orient === "left"',sx='item.orient === "right"',ag=`(${ox} || ${sx})`,Aee=`datum.vgrad && ${ag}`,See=rg('"top"','"bottom"','"middle"'),Oee=rg('"right"','"left"','"center"'),Tee=`datum.vgrad && ${sx} ? (${Oee}) : (${ag} && !(datum.vgrad && ${ox})) ? "left" : ${ax}`,Cee=`item._anchor || (${ag} ? "middle" : "start")`,$ee=`${Aee} ? (${ox} ? -90 : 90) : 0`,Dee=`${ag} ? (datum.vgrad ? (${sx} ? "bottom" : "top") : ${See}) : "top"`;function Ree(e,t,n,i){var r=An(e,t),a;return a={enter:{opacity:be},update:{opacity:ti,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:be}},Dt(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Cee},angle:{signal:$ee},align:{signal:Tee},baseline:{signal:Dee},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),zn({type:Xo,role:LQ,style:ex,from:i,encode:a},n)}function Fee(e,t){var n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+qF(e.path)+")":e.sphere&&(n="geoShape("+qF(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function qF(e){return K(e)&&e.signal?e.signal:B(e)}function WF(e){var t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===ig?qw:t||Bw}function Nee(e){return{marktype:e.type,name:e.name||void 0,role:e.role||WF(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Iee(e,t){return e&&e.signal?t.signalRef(e.signal):!(e===!1)}function lx(e,t){var n=U_(e.type);n||F("Unrecognized transform type: "+B(e.type));var i=Xp(n.type.toLowerCase(),null,GF(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function GF(e,t,n){var i={},r,a,o;for(a=0,o=e.params.length;a<o;++a)r=e.params[a],i[r.name]=Mee(r,t,n);return i}function Mee(e,t,n){var i=e.type,r=t[e.name];if(i==="index")return jee(e,t,n);if(r===void 0){e.required&&F("Missing required "+B(t.type)+" parameter: "+B(e.name));return}else{if(i==="param")return Lee(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!wt(r)?r.map(function(a){return HF(e,a,n)}):HF(e,r,n)}function HF(e,t,n){var i=e.type;if(wt(t))return VF(i)?F("Expression references can not be signals."):ux(i)?n.fieldRef(t):XF(i)?n.compareRef(t):n.signalRef(t.signal);var r=e.expr||ux(i);return r&&Pee(t)?n.exprRef(t.expr,t.as):r&&zee(t)?qc(t.field,t.as):VF(i)?Zi(t,n):Bee(i)?ne(n.getData(t).values):ux(i)?qc(t):XF(i)?n.compareRef(t):t}function jee(e,t,n){return Y(t.from)||F('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Lee(e,t,n){var i=t[e.name];return e.array?(M(i)||F("Expected an array of sub-parameters. Instead: "+B(i)),i.map(function(r){return YF(e,r,n)})):YF(e,i,n)}function YF(e,t,n){var i,r,a,o,s;for(o=0,s=e.params.length;o<s;++o){r=e.params[o];for(a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}return r||F("Unsupported parameter: "+B(t)),i=ce(GF(r,t,n),r.key),ne(n.add(IZ(i)))}function Pee(e){return e&&e.expr}function zee(e){return e&&e.field}function Bee(e){return e==="data"}function VF(e){return e==="expr"}function ux(e){return e==="field"}function XF(e){return e==="compare"}function Uee(e,t,n){var i,r,a,o,s;return e?(i=e.facet)&&(t||F("Only group marks can be faceted."),i.field!=null?o=s=og(i,n):(e.data?s=ne(n.getData(e.data).aggregate):(a=lx(ce({type:"aggregate",groupby:G(i.groupby)},i.aggregate),n),a.params.key=n.keyRef(i.groupby),a.params.pulse=og(i,n),o=s=ne(n.add(a))),r=n.keyRef(i.groupby,!0))):o=ne(n.add(Ai(null,[{}]))),o||(o=og(e,n)),{key:r,pulse:o,parent:s}}function og(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ne(t.getData(e.data).output)}function Jo(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Jo.fromEntries=function(e,t){var n=t.length,i=1,r=t[0],a=t[n-1],o=t[n-2],s=null;for(r&&r.type==="load"&&(r=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=ne(t[i-1]),e.add(t[i]),t[i].type==="aggregate"&&(s=t[i]);return new Jo(e,r,o,a,s)};var Ko=Jo.prototype;Ko.countsRef=function(e,t,n){var i=this,r=i.counts||(i.counts={}),a=JF(t),o,s,l;return a!=null&&(e=i.scope,o=r[a]),o?n&&n.field&&KF(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:ne(i.output)},n&&n.field&&KF(e,l,n),s=e.add(SF(l)),o=e.add(Ai({pulse:ne(s)})),o={agg:s,ref:ne(o)},a!=null&&(r[a]=o)),o.ref};function JF(e){return Y(e)?e:null}function KF(e,t,n){var i=Kp(n.op,n.field),r;if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Jc(e,t,n,i,r,a,o){var s=t[n]||(t[n]={}),l=tZ(a),u=JF(r),c,f;if(u!=null&&(e=t.scope,u=u+(l?"|"+l:""),c=s[u]),!c){var d=a?{field:Hw,pulse:t.countsRef(e,r,a)}:{field:e.fieldRef(r),pulse:ne(t.output)};l&&(d.sort=e.sortRef(a)),f=e.add(Xp(i,void 0,d)),o&&(t.index[r]=f),c=ne(f),u!=null&&(s[u]=c)}return c}Ko.tuplesRef=function(){return ne(this.values)},Ko.extentRef=function(e,t){return Jc(e,this,"extent","extent",t,!1)},Ko.domainRef=function(e,t){return Jc(e,this,"domain","values",t,!1)},Ko.valuesRef=function(e,t,n){return Jc(e,this,"vals","values",t,n||!0)},Ko.lookupRef=function(e,t){return Jc(e,this,"lookup","tupleindex",t,!1)},Ko.indataRef=function(e,t){return Jc(e,this,"indata","tupleindex",t,!0,!0)};function qee(e,t,n){var i=e.from.facet,r=i.name,a=og(i,t),o,s,l,u;i.name||F("Facet must have a name: "+B(i)),i.data||F("Facet must reference a data set: "+B(i)),i.field?u=t.add($F({field:t.fieldRef(i.field),pulse:a})):i.groupby?u=t.add(SZ({key:t.keyRef(i.groupby),group:ne(t.proxy(n.parent)),pulse:a})):F("Facet must specify groupby or field: "+B(i)),o=t.fork(),s=o.add(Ai()),l=o.add(Vo({pulse:ne(s)})),o.addData(r,new Jo(o,s,s,l)),o.addSignal("parent",null),u.params.subflow={$subflow:o.parse(e).toRuntime()}}function Wee(e,t,n){var i=t.add($F({pulse:n.pulse})),r=t.fork();r.add(Vo()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function QF(e,t,n){var i=e.remove,r=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(Jp()),u,c;u="if("+e.trigger+',modify("'+n+'",'+[r,i,a,o,s].map(function(f){return f??"null"}).join(",")+"),0)",c=Zi(u,t),l.update=c.$expr,l.params=c.$params}function sg(e,t){var n=WF(e),i=e.type===ig,r=e.from&&e.from.facet,a=e.layout||n===qw||n===Uw,o=n===Bw||a||r,s=e.overlap,l,u,c,f,d,h,p,g,m,v,y,b,E,x;c=Uee(e.from,i,t),u=t.add(_Z({key:c.key||(e.key?qc(e.key):void 0),pulse:c.pulse,clean:!i})),v=ne(u),u=f=t.add(Ai({pulse:v})),u=t.add(DZ({markdef:Nee(e),interactive:Iee(e.interactive,t),clip:Fee(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ne(u)})),y=ne(u),u=d=t.add(CF(gF(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(function(k){const w=lx(k,t),A=w.metadata;(A.generates||A.changes)&&F("Mark transforms should not generate new data."),A.nomod||(d.params.mod=!0),w.params.pulse=ne(u),t.add(u=w)}),e.sort&&(u=t.add(zZ({sort:t.compareRef(e.sort),pulse:ne(u)}))),b=ne(u),(r||a)&&(a=t.add(RF({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),E=ne(a)),h=t.add(OF({mark:y,pulse:E||b})),x=ne(h),i&&(o&&(l=t.operators,l.pop(),a&&l.pop()),t.pushState(b,E||x,v),r?qee(e,t,c):o?Wee(e,t,c):t.parse(e),t.popState(),o&&(a&&l.push(a),l.push(h))),s&&(x=Gee(s,x,t)),p=t.add(DF({pulse:x})),g=t.add(Vo({pulse:ne(p)},void 0,t.parent())),e.name!=null&&(m=e.name,t.addData(m,new Jo(t,f,p,g)),e.on&&e.on.forEach(function(k){(k.insert||k.remove||k.toggle)&&F("Marks only support modify triggers."),QF(k,t,m)}))}function Gee(e,t,n){var i=e.method,r=e.bound,a=e.separation,o,s={separation:wt(a)?n.signalRef(a.signal):a,method:wt(i)?n.signalRef(i.signal):i,pulse:t};return e.order&&(s.sort=n.compareRef({field:e.order})),r&&(o=r.tolerance,s.boundTolerance=wt(o)?n.signalRef(o.signal):+o,s.boundScale=n.scaleRef(r.scale),s.boundOrient=r.orient),ne(n.add(NZ(s)))}function Hee(e,t){var n=t.config.legend,i=e.encode||{},r=i.legend||{},a=r.name||void 0,o=r.interactive,s=r.style,l=An(e,n),u={},c=0,f,d,h,p,g,m,v,y;return ix.forEach(b=>e[b]?(u[b]=e[b],c=c||e[b]):0),c||F("Missing valid scale for legend."),g=Yee(e,t.scaleType(c)),m={title:e.title!=null,scales:u,type:g,vgrad:g!=="symbol"&&l.isVertical()},v=ne(t.add(Ai(null,[m]))),r=Sl(Xee(l,e,n),r,Vc),f={enter:{x:{value:0},y:{value:0}}},y=ne(t.add(CZ(h={type:g,scale:t.scaleRef(c),count:t.objectProperty(l("tickCount")),limit:t.property(l("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),g===ng?(p=[bee(e,c,n,i.gradient),UF(e,n,i.labels,y)],h.count=h.count||t.signalRef(`max(2,2*floor((${Ho(l.gradientLength())})/100))`)):g===tx?p=[wee(e,c,n,i.gradient,y),UF(e,n,i.labels,y)]:(d=_ee(e,n),p=[kee(e,n,i,y,Ho(d.columns))],h.size=Jee(e,t,p[0].marks)),p=[Xc({role:IQ,from:v,encode:f,marks:p,layout:d,interactive:o})],m.title&&p.push(Ree(e,n,i.title,v)),sg(Xc({role:FQ,from:v,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function Yee(e,t){var n=e.type||LF;return!e.type&&Vee(e)===1&&(e.fill||e.stroke)&&(n=gb(t)?ng:mb(t)?tx:LF),n!==ng?n:mb(t)?tx:ng}function Vee(e){return ix.reduce(function(t,n){return t+(e[n]?1:0)},0)}function Xee(e,t,n){var i={enter:{},update:{}};return Dt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function Jee(e,t,n){var i=Ho(ZF("size",e,n)),r=Ho(ZF("strokeWidth",e,n)),a=Ho(Kee(n[1].encode,t,Yc));return Zi(`max(ceil(sqrt(${i})+${r}),${a})`,t)}function ZF(e,t,n){return t[e]?`scale("${t[e]}",datum)`:zF(e,n[0].encode)}function Kee(e,t,n){return zF("fontSize",e)||vee("fontSize",t,n)}const Qee=`item.orient==="${Tl}"?-90:item.orient==="${Cl}"?90:0`;function Zee(e,t){e=Y(e)?{text:e}:e;var n=An(e,t.config.title),i=e.encode||{},r=i.group||{},a=r.name||void 0,o=r.interactive,s=r.style,l=[],u,c;return u={},c=ne(t.add(Ai(null,[u]))),l.push(nte(e,n,ete(e),c)),e.subtitle&&l.push(ite(e,n,i.subtitle,c)),sg(Xc({role:PQ,from:c,encode:tte(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function ete(e){const t=e.encode;return t&&t.title||ce({name:e.name,interactive:e.interactive,style:e.style},t)}function tte(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:ax},angle:{signal:Qee},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Sl(n,t,Vc)}function nte(e,t,n,i){var r={value:0},a=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Xo,role:zQ,style:lee,from:i,encode:o},n)}function ite(e,t,n,i){var r={value:0},a=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Dt(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),zn({type:Xo,role:BQ,style:uee,from:i,encode:o},n)}function rte(e,t){var n=[];e.transform&&e.transform.forEach(function(i){n.push(lx(i,t))}),e.on&&e.on.forEach(function(i){QF(i,t,e.name)}),t.addDataPipeline(e.name,ate(e,t,n))}function ate(e,t,n){var i=[],r=null,a=!1,o=!1,s,l,u,c,f;for(e.values?Wc(e.values)||Wc(e.format)?(i.push(eN(t,e)),i.push(r=Qo())):i.push(r=Qo({$ingest:e.values,$format:e.format})):e.url?Wc(e.url)||Wc(e.format)?(i.push(eN(t,e)),i.push(r=Qo())):i.push(r=Qo({$request:e.url,$format:e.format})):e.source&&(r=s=G(e.source).map(function(d){return ne(t.getData(d).output)}),i.push(null)),l=0,u=n.length;l<u;++l)c=n[l],f=c.metadata,!r&&!f.source&&i.push(r=Qo()),i.push(c),f.generates&&(o=!0),f.modifies&&!o&&(a=!0),f.source?r=c:f.changes&&(r=null);return s&&(u=s.length-1,i[0]=LZ({derive:a,pulse:u?s:s[0]}),(a||u)&&i.splice(1,0,Qo())),r||i.push(Qo()),i.push(Vo({})),i}function Qo(e){var t=Ai({},e);return t.metadata={source:!0},t}function eN(e,t){return $Z({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const tN=e=>e===Da||e===Si,lg=(e,t,n)=>wt(e)?ute(e.signal,t,n):e===Tl||e===Si?t:n,xt=(e,t,n)=>wt(e)?ste(e.signal,t,n):tN(e)?t:n,Oi=(e,t,n)=>wt(e)?lte(e.signal,t,n):tN(e)?n:t,nN=(e,t,n)=>wt(e)?cte(e.signal,t,n):e===Si?{value:t}:{value:n},ote=(e,t,n)=>wt(e)?fte(e.signal,t,n):e===Cl?{value:t}:{value:n},ste=(e,t,n)=>iN(`${e} === '${Si}' || ${e} === '${Da}'`,t,n),lte=(e,t,n)=>iN(`${e} !== '${Si}' && ${e} !== '${Da}'`,t,n),ute=(e,t,n)=>cx(`${e} === '${Tl}' || ${e} === '${Si}'`,t,n),cte=(e,t,n)=>cx(`${e} === '${Si}'`,t,n),fte=(e,t,n)=>cx(`${e} === '${Cl}'`,t,n),iN=(e,t,n)=>(t=t!=null?bt(t):t,n=n!=null?bt(n):n,rN(t)&&rN(n)?(t=t?t.signal||B(t.value):null,n=n?n.signal||B(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[ce({test:e},t)].concat(n||[])),rN=e=>e==null||Object.keys(e).length===1,cx=(e,t,n)=>({signal:`${e} ? (${Dl(t)}) : (${Dl(n)})`}),dte=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${Tl}' ? (${Dl(i)}) : `:"")+(n!=null?`${e} === '${Da}' ? (${Dl(n)}) : `:"")+(r!=null?`${e} === '${Cl}' ? (${Dl(r)}) : `:"")+(t!=null?`${e} === '${Si}' ? (${Dl(t)}) : `:"")+"(null)"}),Dl=e=>wt(e)?e.signal:e==null?null:B(e),hte=(e,t)=>t===0?0:wt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Rl=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function Fl(e,t,n,i){let r;if(t&&Q(t,e))return t[e];if(Q(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[ex][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Yc][r]}return null}function aN(e){const t={};for(const n of e){if(!n)continue;for(const i in n)t[i]=1}return Object.keys(t)}function pte(e,t){var n=t.config,i=n.style,r=n.axis,a=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,s,l,u;if(wt(o)){const f=aN([n.axisX,n.axisY]),d=aN([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(u of f)s[u]=xt(o,Fl(u,n.axisX,r,i),Fl(u,n.axisY,r,i));l={};for(u of d)l[u]=dte(o.signal,Fl(u,n.axisTop,r,i),Fl(u,n.axisBottom,r,i),Fl(u,n.axisLeft,r,i),Fl(u,n.axisRight,r,i))}else s=o===Si||o===Da?n.axisX:n.axisY,l=n["axis"+o[0].toUpperCase()+o.slice(1)];var c=s||l||a?ce({},r,s,l,a):r;return c}function gte(e,t,n,i){var r=An(e,t),a=e.orient,o,s,l;o={enter:s={opacity:be},update:l={opacity:ti},exit:{opacity:be}},Dt(o,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const u=oN(e,0),c=oN(e,1);return s.x=l.x=xt(a,u,be),s.x2=l.x2=xt(a,c),s.y=l.y=Oi(a,u,be),s.y2=l.y2=Oi(a,c),zn({type:rx,role:TQ,from:i,encode:o},n)}function oN(e,t){return{scale:e.scale,range:t}}function mte(e,t,n,i,r){var a=An(e,t),o=e.orient,s=e.gridScale,l=lg(o,1,-1),u=vte(e.offset,l),c,f,d,h,p,g,m,v;return c={enter:f={opacity:be},update:h={opacity:ti},exit:d={opacity:be}},Dt(c,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")}),p={scale:e.scale,field:ei,band:r.band,extra:r.extra,offset:r.offset,round:a("tickRound")},v=xt(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},m=s?{scale:s,range:1,mult:l,offset:u}:ce(v,{mult:l,offset:u}),f.x=h.x=xt(o,p,g),f.y=h.y=Oi(o,p,g),f.x2=h.x2=Oi(o,m),f.y2=h.y2=xt(o,m),d.x=xt(o,p),d.y=Oi(o,p),zn({type:rx,role:CQ,key:ei,from:i,encode:c},n)}function vte(e,t){if(!(t===1))if(!K(e))e=wt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=ce({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=ce({},n.mult);else return n.mult=wt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function yte(e,t,n,i,r,a){var o=An(e,t),s=e.orient,l=lg(s,-1,1),u,c,f,d,h,p;return u={enter:c={opacity:be},update:d={opacity:ti},exit:f={opacity:be}},Dt(u,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")}),h=bt(r),h.mult=l,p={scale:e.scale,field:ei,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")},d.y=c.y=xt(s,be,p),d.y2=c.y2=xt(s,h),f.x=xt(s,p),d.x=c.x=Oi(s,be,p),d.x2=c.x2=Oi(s,h),f.y=Oi(s,p),zn({type:rx,role:DQ,key:ei,from:i,encode:u},n)}function fx(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function bte(e,t,n,i,r,a){var o=An(e,t),s=e.orient,l=e.scale,u=lg(s,-1,1),c=Ho(o("labelFlush")),f=Ho(o("labelFlushOffset")),d=c===0||!!c,h=o("labelAlign"),p=o("labelBaseline"),g,m,v,y,b,E,x,k,w,A;return y=bt(r),y.mult=u,y.offset=bt(o("labelPadding")||0),y.offset.mult=u,b={scale:l,field:ei,band:.5,offset:BF(a.offset,o("labelOffset"))},E=xt(s,d?fx(l,c,'"left"','"right"','"center"'):{value:"center"},ote(s,"left","right")),x=xt(s,nN(s,"bottom","top"),d?fx(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),A=fx(l,c,`-(${f})`,f,0),d=d&&f,m={opacity:be,x:xt(s,b,y),y:Oi(s,b,y)},g={enter:m,update:v={opacity:ti,text:{field:Zw},x:m.x,y:m.y,align:E,baseline:x},exit:{opacity:be,x:m.x,y:m.y}},Dt(g,{dx:!h&&d?xt(s,A):null,dy:!p&&d?Oi(s,A):null}),Dt(g,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:p}),k=o("labelBound"),w=o("labelOverlap"),w=w||k?{separation:o("labelSeparation"),method:w,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,v.align!==E&&(v.align=Rl(v.align,E)),v.baseline!==x&&(v.baseline=Rl(v.baseline,x)),zn({type:Xo,role:$Q,style:Yc,key:ei,from:i,encode:g,overlap:w},n)}function wte(e,t,n,i){var r=An(e,t),a=e.orient,o=lg(a,-1,1),s,l,u,c;return s={enter:l={opacity:be,anchor:bt(r("titleAnchor",null)),align:{signal:ax}},update:u=ce({},l,{opacity:ti,text:bt(e.title)}),exit:{opacity:be}},c={signal:`lerp(range("${e.scale}"), ${rg(0,1,.5)})`},u.x=xt(a,c),u.y=Oi(a,c),l.angle=xt(a,be,hte(o,90)),l.baseline=xt(a,nN(a,Da,Si),{value:Da}),u.angle=l.angle,u.baseline=l.baseline,Dt(s,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),xte(r,a,s,n),s.update.align=Rl(s.update.align,l.align),s.update.angle=Rl(s.update.angle,l.angle),s.update.baseline=Rl(s.update.baseline,l.baseline),zn({type:Xo,role:RQ,style:ex,from:i,encode:s},n)}function xte(e,t,n,i){const r=(s,l)=>s!=null?(n.update[l]=Rl(bt(s),n.update[l]),!1):!Ol(l,i),a=r(e("titleX"),"x"),o=r(e("titleY"),"y");n.enter.auto=o===a?bt(o):xt(t,bt(o),bt(a))}function Ete(e,t){var n=pte(e,t),i=e.encode||{},r=i.axis||{},a=r.name||void 0,o=r.interactive,s=r.style,l=An(e,n),u=yee(l),c,f,d,h,p;return c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:e.title!=null},f=ne(t.add(Ai({},[c]))),r=Sl(kte(l,e),r,Vc),d=ne(t.add(kZ({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),p=[],c.grid&&p.push(mte(e,n,i.grid,d,u)),c.ticks&&(h=l("tickSize"),p.push(yte(e,n,i.ticks,d,h,u))),c.labels&&(h=c.ticks?h:0,p.push(bte(e,n,i.labels,d,h,u))),c.domain&&p.push(gte(e,n,i.domain,f)),c.title&&p.push(wte(e,n,i.title,f)),sg(Xc({role:OQ,from:f,encode:r,marks:p,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function kte(e,t){var n={enter:{},update:{}};return Dt(n,{orient:e("orient"),offset:e("offset")||0,position:_i(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function sN(e,t,n){var i=G(e.signals),r=G(e.scales);return n||i.forEach(a=>vF(a,t)),G(e.projections).forEach(a=>tee(a,t)),r.forEach(a=>qZ(a,t)),G(e.data).forEach(a=>rte(a,t)),r.forEach(a=>WZ(a,t)),(n||i).forEach(a=>EZ(a,t)),G(e.axes).forEach(a=>Ete(a,t)),G(e.marks).forEach(a=>sg(a,t)),G(e.legends).forEach(a=>Hee(a,t)),e.title&&Zee(e.title,t),t.parseLambdas(),t}const _te=e=>Sl({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Ate(e,t){const n=t.config,i=ne(t.root=t.add(Jp())),r=Ste(e,n);r.forEach(u=>vF(u,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(Ai()),o=t.add(CF(gF(_te(e.encode),ig,Uw,e.style,t,{pulse:ne(a)}))),s=t.add(RF({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ne(o)}));t.operators.pop(),t.pushState(ne(o),ne(s),null),sN(e,t,r),t.operators.push(s);let l=t.add(OF({mark:i,pulse:ne(s)}));return l=t.add(DF({pulse:ne(l)})),l=t.add(Vo({pulse:ne(l)})),t.addData("root",new Jo(t,a,a,l)),t}function Kc(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Ste(e,t){const n=o=>_i(e[o],t[o]),i=[Kc("background",n("background")),Kc("autosize",_Q(n("autosize"))),Kc("padding",SQ(n("padding"))),Kc("width",n("width")||0),Kc("height",n("height")||0)],r=i.reduce((o,s)=>(o[s.name]=s,o),{}),a={};return G(e.signals).forEach(o=>{Q(r,o.name)?o=ce(r[o.name],o):i.push(o),a[o.name]=o}),G(t.signals).forEach(o=>{!Q(a,o.name)&&!Q(r,o.name)&&i.push(o)}),i}function lN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function uN(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var fe=lN.prototype=uN.prototype;fe.parse=function(e){return sN(e,this)},fe.fork=function(){return new uN(this)},fe.isSubscope=function(){return this._subid>0},fe.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},fe.id=function(){return(this._subid?this._subid+":":0)+this._id++},fe.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},fe.proxy=function(e){var t=e instanceof Gw?ne(e):e;return this.add(jZ({value:t}))},fe.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},fe.addUpdate=function(e){return this.updates.push(e),e},fe.finish=function(){var e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,a,o){var s,l;r&&(s=r.data||(r.data={}),l=s[a]||(s[a]=[]),l.push(o))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(var i in t.index)n(t.index[i],e,"index:"+i)}return this},fe.pushState=function(e,t,n){this._encode.push(ne(this.add(Vo({pulse:e})))),this._parent.push(t),this._lookup.push(n?ne(this.proxy(n)):null),this._markpath.push(-1)},fe.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},fe.parent=function(){return ve(this._parent)},fe.encode=function(){return ve(this._encode)},fe.lookup=function(){return ve(this._lookup)},fe.markpath=function(){var e=this._markpath;return++e[e.length-1]},fe.fieldRef=function(e,t){if(Y(e))return qc(e,t);e.signal||F("Unsupported field reference: "+B(e));var n=e.signal,i=this.field[n],r;return i||(r={name:this.signalRef(n)},t&&(r.as=t),this.field[n]=i=ne(this.add(OZ(r)))),i},fe.compareRef=function(e){function t(o){return wt(o)?(i=!0,n.signalRef(o.signal)):nZ(o)?(i=!0,n.exprRef(o.expr)):o}var n=this,i=!1,r=G(e.field).map(t),a=G(e.order).map(t);return i?ne(this.add(TF({fields:r,orders:a}))):yF(r,a)},fe.keyRef=function(e,t){function n(a){return wt(a)?(r=!0,ne(i[a.signal])):a}var i=this.signals,r=!1;return e=G(e).map(n),r?ne(this.add(TZ({fields:e,flat:t}))):QQ(e,t)},fe.sortRef=function(e){if(!e)return e;var t=Kp(e.op,e.field),n=e.order||ZQ;return n.signal?ne(this.add(TF({fields:t,orders:this.signalRef(n.signal)}))):yF(t,n)},fe.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},fe.hasOwnSignal=function(e){return Q(this.signals,e)},fe.addSignal=function(e,t){this.hasOwnSignal(e)&&F("Duplicate signal name: "+B(e));var n=t instanceof Gw?t:this.add(Jp(t));return this.signals[e]=n},fe.getSignal=function(e){return this.signals[e]||F("Unrecognized signal name: "+B(e)),this.signals[e]},fe.signalRef=function(e){return this.signals[e]?ne(this.signals[e]):(Q(this.lambdas,e)||(this.lambdas[e]=this.add(Jp(null))),ne(this.lambdas[e]))},fe.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],r=Zi(i,this),a=this.lambdas[i];a.params=r.$params,a.update=r.$expr}},fe.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},fe.objectProperty=function(e){return!e||!K(e)?e:this.signalRef(e.signal||dx(e))};function dx(e){return(M(e)?Ote:Tte)(e)}function Ote(e){for(var t="[",n=0,i=e.length,r;n<i;++n)r=e[n],t+=(n>0?",":"")+(K(r)?r.signal||dx(r):B(r));return t+"]"}function Tte(e){var t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+B(i)+":"+(K(r)?r.signal||dx(r):B(r));return t+"}"}fe.exprRef=function(e,t){var n={expr:Zi(e,this)};return t&&(n.expr.$name=t),ne(this.add(AZ(n)))},fe.addBinding=function(e,t){this.bindings||F("Nested signals do not support binding: "+B(e)),this.bindings.push(ce({signal:e},t))},fe.addScaleProj=function(e,t){Q(this.scales,e)&&F("Duplicate scale or projection name: "+B(e)),this.scales[e]=this.add(t)},fe.addScale=function(e,t){this.addScaleProj(e,PZ(t))},fe.addProjection=function(e,t){this.addScaleProj(e,MZ(t))},fe.getScale=function(e){return this.scales[e]||F("Unrecognized scale name: "+B(e)),this.scales[e]},fe.projectionRef=fe.scaleRef=function(e){return ne(this.getScale(e))},fe.projectionType=fe.scaleType=function(e){return this.getScale(e).params.type},fe.addData=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.data[e]=t},fe.getData=function(e){return this.data[e]||F("Undefined data set name: "+B(e)),this.data[e]},fe.addDataPipeline=function(e,t){return Q(this.data,e)&&F("Duplicate data set name: "+B(e)),this.addData(e,Jo.fromEntries(this,t))};function Cte(){const e="sans-serif",t=30,n=2,i="#4c78a8",r="#000",a="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:a,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:a,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:a,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function $te(e,t,n){return K(e)||F("Input Vega specification must be an object."),t=Os(Cte(),t,e.config),Ate(e,new lN(t,n)).toRuntime()}ce(Bs,h8,Tq,gW,fH,nY,oV,cV,TV,PV,YV);var Dte=Object.freeze({__proto__:null,version:VV,Dataflow:zs,EventStream:nd,Parameters:td,Pulse:fa,MultiPulse:z0,Operator:Fe,Transform:$,changeset:fo,ingest:ke,isTuple:Zf,definition:U_,transform:q_,transforms:Bs,tupleid:ee,scale:Ee,scheme:yb,interpolate:vb,interpolateColors:Th,interpolateRange:TT,quantizeInterpolator:CT,projection:O1,View:oF,formatLocale:fd,timeFormatLocale:yu,locale:F_,defaultLocale:L0,resetDefaultLocale:y6,expressionFunction:yt,parse:$te,runtimeContext:JR,bandwidthNRD:Y0,bin:X_,bootstrapCI:J_,dotbin:K_,quantiles:G0,quartiles:H0,get random(){return Wn},setRandom:Z6,randomLCG:t4,randomInteger:n4,randomKDE:J0,randomLogNormal:Z_,sampleLogNormal:K0,densityLogNormal:Q0,cumulativeLogNormal:Z0,quantileLogNormal:ev,randomMixture:eA,randomNormal:X0,sampleNormal:xd,densityNormal:V0,cumulativeNormal:Ed,quantileNormal:kd,randomUniform:tA,sampleUniform:tv,densityUniform:nv,cumulativeUniform:iv,quantileUniform:rv,regressionLinear:av,regressionLog:nA,regressionExp:iA,regressionPow:rA,regressionQuad:ov,regressionPoly:aA,regressionLoess:lA,sampleCurve:Ad,TIME_UNITS:g0,YEAR:_t,QUARTER:pn,MONTH:jt,WEEK:ot,DATE:gn,DAY:Lt,DAYOFYEAR:ji,HOURS:Fn,MINUTES:Nn,SECONDS:qn,MILLISECONDS:hi,timeUnitSpecifier:qk,timeUnits:v0,dayofyear:Jk,week:Kk,utcdayofyear:Zk,utcweek:e_,timeFloor:i_,utcFloor:r_,timeInterval:Is,timeOffset:o_,timeSequence:u_,utcInterval:Ms,utcOffset:s_,utcSequence:c_,timeBin:g_,accessor:dn,accessorName:Ye,accessorFields:Nt,id:tu,identity:It,zero:ea,one:Ss,truthy:fi,falsy:ta,logger:Bm,None:PE,Error:Pm,Warn:zm,Info:zE,Debug:BE,mergeConfig:Os,writeConfig:nu,panLinear:YE,panLog:VE,panPow:XE,panSymlog:JE,zoomLinear:Um,zoomLog:qm,zoomPow:Xf,zoomSymlog:Wm,quarter:KE,utcquarter:QE,array:G,clampRange:ZE,compare:Gm,constant:Mt,debounce:Hm,error:F,extend:ce,extent:Mi,extentIndex:tk,fastmap:Ts,field:ci,flush:nk,hasOwnProperty:Q,inherits:P,inrange:Cs,isArray:M,isBoolean:na,isDate:ia,isFunction:de,isNumber:Ce,isObject:K,isRegExp:ik,isString:Y,key:Ym,lerp:rk,lruCache:ak,merge:ok,pad:sk,peek:ve,repeat:iu,span:ru,splitAccessPath:Ii,stringValue:B,toBoolean:Vm,toDate:Xm,toNumber:Xt,toString:Jm,toSet:pt,truncate:lk,visitArray:ra,read:N_,inferType:gk,inferTypes:mk,typeParsers:e0,format:rd,formats:o0,responseType:Ak,loader:yd,Bounds:st,Gradient:HA,GroupItem:Ud,ResourceLoader:sy,Item:Bd,Scenegraph:Ay,Handler:xa,Renderer:bi,CanvasHandler:zu,CanvasRenderer:ch,SVGHandler:$y,SVGRenderer:Ob,SVGStringRenderer:$b,RenderType:Oa,renderModule:Rh,intersect:sC,Marks:Yn,boundClip:fC,boundContext:mn,boundStroke:Er,boundItem:_y,boundMark:KS,pathCurves:ty,pathSymbols:wS,pathRectangle:xS,pathTrail:ES,pathParse:Ys,pathRender:Tu,point:ih,domCreate:wa,domFind:Sy,domChild:In,domClear:yi,openTag:We,closeTag:Ve,font:th,fontFamily:Mu,fontSize:Ui,lineHeight:ya,multiLineOffset:xy,textMetrics:tl,sceneEqual:Rb,pathEqual:dC,sceneToJSON:QS,sceneFromJSON:ZS,intersectPath:uy,intersectPoint:cy,intersectRule:FS,intersectBoxLine:Js,sceneZOrder:fy,sceneVisit:vi,scenePickVisit:Vd,resetSVGClipId:_S,resetSVGDefIds:KU});const Rte="vega-lite",Fte='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Nte="4.13.1",Ite=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Mte="https://vega.github.io/vega-lite/",jte="Vega-Lite is a concise high-level language for interactive visualization.",Lte="build/vega-lite.js",Pte="build/vega-lite.min.js",zte="build/vega-lite.min.js",Bte="build/src/index",Ute="build/src/index.d.ts",qte={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Wte={test:"test"},Gte={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},Hte={type:"git",url:"https://github.com/vega/vega-lite.git"},Yte="BSD-3-Clause",Vte={url:"https://github.com/vega/vega-lite/issues"},Xte={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},Jte={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},Kte={vega:"^5.12.1"},Qte={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1};var Zte={name:Rte,author:Fte,version:Nte,collaborators:Ite,homepage:Mte,description:jte,main:Lte,unpkg:Pte,jsdelivr:zte,module:Bte,types:Ute,bin:qte,directories:Wte,scripts:Gte,repository:Hte,license:Yte,bugs:Vte,devDependencies:Xte,dependencies:Jte,peerDependencies:Kte,jest:Qte};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var ene=Dm(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var a;try{a=Promise}catch(d){a=function(){}}function o(d,h,p,g,m){typeof h=="object"&&(p=h.depth,g=h.prototype,m=h.includeNonEnumerable,h=h.circular);var v=[],y=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof p=="undefined"&&(p=Infinity);function E(x,k){if(x===null)return null;if(k===0)return x;var w,A;if(typeof x!="object")return x;if(n(x,i))w=new i();else if(n(x,r))w=new r();else if(n(x,a))w=new a(function(W,X){x.then(function(J){W(E(J,k-1))},function(J){X(E(J,k-1))})});else if(o.__isArray(x))w=[];else if(o.__isRegExp(x))w=new RegExp(x.source,f(x)),x.lastIndex&&(w.lastIndex=x.lastIndex);else if(o.__isDate(x))w=new Date(x.getTime());else{if(b&&Buffer.isBuffer(x))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(x.length):w=new Buffer(x.length),x.copy(w),w;n(x,Error)?w=Object.create(x):typeof g=="undefined"?(A=Object.getPrototypeOf(x),w=Object.create(A)):(w=Object.create(g),A=g)}if(h){var _=v.indexOf(x);if(_!=-1)return y[_];v.push(x),y.push(w)}n(x,i)&&x.forEach(function(W,X){var J=E(X,k-1),xe=E(W,k-1);w.set(J,xe)}),n(x,r)&&x.forEach(function(W){var X=E(W,k-1);w.add(X)});for(var O in x){var S;if(A&&(S=Object.getOwnPropertyDescriptor(A,O)),S&&S.set==null)continue;w[O]=E(x[O],k-1)}if(Object.getOwnPropertySymbols)for(var T=Object.getOwnPropertySymbols(x),O=0;O<T.length;O++){var D=T[O],I=Object.getOwnPropertyDescriptor(x,D);if(I&&!I.enumerable&&!m)continue;w[D]=E(x[D],k-1),I.enumerable||Object.defineProperty(w,D,{enumerable:!1})}if(m)for(var C=Object.getOwnPropertyNames(x),O=0;O<C.length;O++){var N=C[O],I=Object.getOwnPropertyDescriptor(x,N);if(I&&I.enumerable)continue;w[N]=E(x[N],k-1),Object.defineProperty(w,N,{enumerable:!1})}return w}return E(d,p)}o.clonePrototype=function(h){if(h===null)return null;var p=function(){};return p.prototype=h,new p()};function s(d){return Object.prototype.toString.call(d)}o.__objToStr=s;function l(d){return typeof d=="object"&&s(d)==="[object Date]"}o.__isDate=l;function u(d){return typeof d=="object"&&s(d)==="[object Array]"}o.__isArray=u;function c(d){return typeof d=="object"&&s(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)}),tne=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),i=a.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;r--!==0;){var o=a[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},Qc=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(a){return function(o){return function(s,l){var u={key:s,value:o[s]},c={key:l,value:o[l]};return a(u,c)}}}(t.cmp),r=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var s,l;if(Array.isArray(o)){for(l="[",s=0;s<o.length;s++)s&&(l+=","),l+=a(o[s])||"null";return l+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var u=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(l="",s=0;s<c.length;s++){var f=c[s],d=a(o[f]);if(!d)continue;l&&(l+=","),l+=JSON.stringify(f)+":"+d}return r.splice(u,1),"{"+l+"}"}(e)};function hx(e){return!!e.or}function px(e){return!!e.and}function gx(e){return!!e.not}function ug(e,t){if(gx(e))ug(e.not,t);else if(px(e))for(const n of e.and)ug(n,t);else if(hx(e))for(const n of e.or)ug(n,t);else t(e)}function cg(e,t){return gx(e)?{not:cg(e.not,t)}:px(e)?{and:e.and.map(n=>cg(n,t))}:hx(e)?{or:e.or.map(n=>cg(n,t))}:t(e)}const Zc=tne,ge=ene;function ef(e,t){const n={};for(const i of t)Q(e,i)&&(n[i]=e[i]);return n}function Ir(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Qc(e)).join(",")})`};const Ue=Qc;function we(e){if(Ce(e))return e;const t=Y(e)?e:Qc(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function cN(e){return e===!1||e===null}function ae(e,t){return e.indexOf(t)>-1}function tf(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function fN(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function nne(e,...t){for(const n of t)ine(e,n??{});return e}function ine(e,t){for(const n of z(t))nu(e,n,t[n],!0)}function Ra(e,t){const n=[],i={};let r;for(const a of e){if(r=t(a),r in i)continue;i[r]=1,n.push(a)}return n}function rne(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function dN(e,t){for(const n of e)if(t.has(n))return!0;return!1}function hN(e){const t=new Set();for(const n of e){const i=Ii(n),r=i.map((o,s)=>s===0?o:`[${o}]`),a=r.map((o,s)=>r.slice(0,s+1).join(""));for(const o of a)t.add(o)}return t}function pN(e,t){return e===void 0||t===void 0?!0:dN(hN(e),hN(t))}function Ne(e){return z(e).length===0}const z=Object.keys,Fa=Object.values;function gN(e){const t=[];for(const n in e)Q(e,n)&&t.push({key:n,value:e[n]});return t}function fg(e){return e===!0||e===!1}function qe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function nf(e,t){return gx(e)?"!("+nf(e.not,t)+")":px(e)?"("+e.and.map(n=>nf(n,t)).join(") && (")+")":hx(e)?"("+e.or.map(n=>nf(n,t)).join(") || (")+")":t(e)}function mx(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&mx(e[n],t)&&delete e[n],Ne(e)}function dg(e){return e.charAt(0).toUpperCase()+e.substr(1)}function mN(e,t="datum"){const n=Ii(e),i=[];for(let r=1;r<=n.length;r++){const a=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${a}`)}return i.join(" && ")}function ane(e,t="datum"){return`${t}[${B(Ii(e).join("."))}]`}function one(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Na(e){return`${Ii(e).map(one).join("\\.")}`}function Nl(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function vN(e){return`${Ii(e).join(".")}`}function rf(e){return e?Ii(e).length:0}function rt(...e){for(const t of e)if(t!==void 0)return t;return}let sne=42;function lne(e){const t=++sne;return e?String(e)+t:t}function une(e){return cne(e)?e:`__${e}`}function cne(e){return e.indexOf("__")===0}function hg(e){return e===void 0?void 0:(e%360+360)%360}function vx(e){return Ce(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const yN={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function yx(e){return e&&e.condition}const bN=["domain","grid","labels","ticks","title"],fne={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},wN={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},dne=Object.assign(Object.assign({},wN),{style:1,labelExpr:1,encoding:1});function xN(e){return!!dne[e]}const an={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},EN=an.arc,pg=an.area,gg=an.bar,hne=an.image,mg=an.line,vg=an.point,pne=an.rect,yg=an.rule,kN=an.text,bx=an.tick,gne=an.trail,wx=an.circle,xx=an.square,_N=an.geoshape;function Zo(e){return ae(["line","area","trail"],e)}function AN(e){return ae(["rect","bar","image","arc"],e)}const SN=z(an);function er(e){return e.type}const Pfe=pt(SN),mne=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],vne=["fill","fillOpacity"],yne=[...mne,...vne],bne={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},ON=z(bne),wne={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},xne={color:"#4c78a8",invalid:"filter",timeUnitBand:1},Ene={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},TN=5,kne={binSpacing:1,continuousBandSize:TN,timeUnitBandPosition:.5},_ne={binSpacing:0,continuousBandSize:TN,timeUnitBandPosition:.5},Ane={thickness:1};function Sne(e){return er(e)?e.type:e}function Mr(e){return"mark"in e}class bg{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return Mr(e)?Sne(e.mark)===this.name:!1}}const One={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Tne={count:1,min:1,max:1};function Ia(e){return!!e&&!!e.argmin}function es(e){return!!e&&!!e.argmax}function Ex(e){return Y(e)&&!!One[e]}const Cne=["count","valid","missing","distinct"];function CN(e){return Y(e)&&ae(Cne,e)}function $ne(e){return Y(e)&&ae(["min","max"],e)}const Dne=["count","sum","distinct","valid","missing"],Rne=["mean","average","median","q1","q3","min","max"],Fne=pt(Rne),jr="row",Lr="column",wg="facet",He="x",ct="y",Ti="x2",tr="y2",nr="radius",Pr="radius2",Ci="theta",zr="theta2",ir="latitude",rr="longitude",$i="latitude2",ni="longitude2",Sn="color",ar="fill",or="stroke",On="shape",Br="size",ts="angle",Ur="opacity",Ma="fillOpacity",ja="strokeOpacity",La="strokeWidth",Pa="strokeDash",af="text",of="order",sf="detail",xg="key",ns="tooltip",Eg="href",kg="url",_g="description",Nne={x:1,y:1,x2:1,y2:1},$N={theta:1,theta2:1,radius:1,radius2:1};function DN(e){return e in $N}const kx={longitude:1,longitude2:1,latitude:1,latitude2:1};function Ine(e){switch(e){case ir:return"y";case $i:return"y2";case rr:return"x";case ni:return"x2"}}function Mne(e){return e in kx}const jne=z(kx),RN=Object.assign(Object.assign(Object.assign(Object.assign({},Nne),$N),kx),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Il(e){return e===Sn||e===ar||e===or}const FN={row:1,column:1,facet:1},ii=z(FN),_x=Object.assign(Object.assign({},RN),FN),NN=z(_x),Lne=Z(_x,["order","detail","tooltip"]),Pne=Z(Lne,["row","column","facet"]);function zne(e){return!!Pne[e]}function IN(e){return!!_x[e]}const Bne=[Ti,tr,$i,ni,zr,Pr];function MN(e){const t=is(e);return t!==e}function is(e){switch(e){case Ti:return He;case tr:return ct;case $i:return ir;case ni:return rr;case zr:return Ci;case Pr:return nr}return e}function za(e){if(DN(e))switch(e){case Ci:return"startAngle";case zr:return"endAngle";case nr:return"outerRadius";case Pr:return"innerRadius"}return e}function sr(e){switch(e){case He:return Ti;case ct:return tr;case ir:return $i;case rr:return ni;case Ci:return zr;case nr:return Pr}return}function lr(e){switch(e){case He:case Ti:return"width";case ct:case tr:return"height"}return}function Une(e){switch(e){case He:return"xOffset";case ct:return"yOffset";case Ti:return"x2Offset";case tr:return"y2Offset";case Ci:return"thetaOffset";case nr:return"radiusOffset";case zr:return"theta2Offset";case Pr:return"radius2Offset"}return}const Ax=Z(RN,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),qne=z(Ax),Ba={x:1,y:1},ri=z(Ba);function ur(e){return e in Ba}const Sx={theta:1,radius:1},Wne=z(Sx);function Ag(e){return e==="width"?He:ct}const jN=Z(Ax,["text","tooltip","href","url","description","detail","key","order"]),Gne=z(jN);function Hne(e){return!!Ax[e]}function Yne(e){switch(e){case Sn:case ar:case or:case Br:case On:case Ur:case La:case Pa:return!0;case Ma:case ja:case ts:return!1}}const LN=Object.assign(Object.assign(Object.assign({},Ba),Sx),jN),Sg=z(LN);function Ua(e){return!!LN[e]}function Vne(e,t){return Jne(e)[t]}const PN={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Xne=Z(PN,["geoshape"]);function Jne(e){switch(e){case Sn:case ar:case or:case _g:case sf:case xg:case ns:case Eg:case of:case Ur:case Ma:case ja:case La:case wg:case jr:case Lr:return PN;case He:case ct:case ir:case rr:return Xne;case Ti:case tr:case $i:case ni:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Br:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case Pa:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case On:return{point:"always",geoshape:"always"};case af:return{text:"always"};case ts:return{point:"always",square:"always",text:"always"};case kg:return{image:"always"};case Ci:return{text:"always",arc:"always"};case nr:return{text:"always",arc:"always"};case zr:case Pr:return{arc:"always"}}}function Og(e){switch(e){case He:case ct:case Ci:case nr:case Br:case ts:case La:case Ur:case Ma:case ja:case Ti:case tr:case zr:case Pr:return;case wg:case jr:case Lr:case On:case Pa:case af:case ns:case Eg:case kg:case _g:return"discrete";case Sn:case ar:case or:return"flexible";case ir:case rr:case $i:case ni:case sf:case xg:case of:return}}function zN(e){return na(e)&&(e=Pg(e,void 0)),"bin"+z(e).map(t=>Tg(e[t])?qe(`_${t}_${Object.entries(e[t])}`):qe(`_${t}_${e[t]}`)).join("")}function Me(e){return e===!0||lf(e)&&!e.binned}function on(e){return e==="binned"||lf(e)&&e.binned===!0}function lf(e){return K(e)}function Tg(e){return e==null?void 0:e.selection}function BN(e){switch(e){case jr:case Lr:case Br:case Sn:case ar:case or:case La:case Ur:case Ma:case ja:case On:return 6;case Pa:return 4;default:return 10}}function Ox(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Kne='Autosize "fit" only works for single views and layered views.';function UN(e){const t=e=="width"?"Width":"Height";return`${t} "container" only works for single views and layered views.`}function qN(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function WN(e){return e?`Dropping "fit-${e}" because spec has discrete ${lr(e)}.`:'Dropping "fit" because spec has discrete size.'}function GN(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Qne(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Zne(e){return`The "nearest" transform is not supported for ${e} marks.`}function HN(e){return`Selection not supported for ${e} yet.`}function eie(e){return`Cannot find a selection named "${e}".`}const tie="Scale bindings are currently only supported for scales with unbinned, continuous domains.",nie="Legend bindings are only supported for selections over an individual field or encoding channel.";function iie(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function rie(e){return`Unknown repeated value "${e}".`}function YN(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const aie="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function oie(e){return`Unrecognized parse "${e}".`}function VN(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function sie(e){return`Ignoring an invalid transform: ${Ue(e)}.`}const lie='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function XN(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function uie(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function cie(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ue(t)} is overridden by a child projection ${Ue(n)}.`}const fie="Arc marks uses theta channel rather than angle, replacing angle with theta.";function die(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ue(n)}}.`}function JN(e){return`Invalid field type "${e}".`}function hie(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function pie(e){return`Invalid aggregation operator "${e}".`}function gie(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function KN(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function Tx(e,t){return`Dropping ${Ue(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const mie="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Cg(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function vie(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function yie(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function bie(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function Cx(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function wie(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function xie(e,t){return`Specified orient "${e}" overridden with "${t}".`}const Eie=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function kie(e){return`Cannot use the scale property "${e}" with non-color channel.`}function _ie(e){return`Using unaggregated domain with raw field has no effect (${Ue(e)}).`}function Aie(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Sie(e){return`Unaggregated domain is currently unsupported for log scale (${Ue(e)}).`}function Oie(e){return`Cannot apply size to non-oriented mark "${e}".`}function Tie(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Cie(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function QN(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function ZN(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function $ie(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using ${Ue(n)}.`}function Die(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ue(n)} and ${Ue(i)}). Using the union of the two domains.`}function Rie(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Fie(e){return`Dropping sort property ${Ue(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const eI="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Nie="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Iie="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Mie="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function jie(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Lie(e){return`Cannot stack non-linear scale (${e}).`}function Pie(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function $g(e,t){return`Invalid ${e}: ${Ue(t)}.`}function zie(e){return`Dropping day from datetime ${Ue(e)} as day cannot be combined with other units.`}function Bie(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Uie(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function qie(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Wie(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function tI(e){return`1D error band does not support ${e}.`}function nI(e){return`Channel ${e} is required for "binned" bin.`}function Gie(e){return`Domain for ${e} is required for threshold scale.`}const iI=Bm(zm);let Ml=iI;function Hie(e){return Ml=e,Ml}function Yie(){return Ml=iI,Ml}function j(...e){Ml.warn(...e)}function Vie(...e){Ml.debug(...e)}function jl(e){if(e&&K(e)){for(const t of Dx)if(t in e)return!0}return!1}const rI=["january","february","march","april","may","june","july","august","september","october","november","december"],Xie=rI.map(e=>e.substr(0,3)),aI=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Jie=aI.map(e=>e.substr(0,3));function Kie(e){if(vx(e)&&(e=+e),Ce(e))return e>4&&j($g("quarter",e)),e-1;throw new Error($g("quarter",e))}function Qie(e){if(vx(e)&&(e=+e),Ce(e))return e-1;{const t=e.toLowerCase(),n=rI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Xie.indexOf(i);if(r!==-1)return r;throw new Error($g("month",e))}}function Zie(e){if(vx(e)&&(e=+e),Ce(e))return e%7;{const t=e.toLowerCase(),n=aI.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Jie.indexOf(i);if(r!==-1)return r;throw new Error($g("day",e))}}function $x(e,t){const n=[];if(t&&e.day!==void 0&&(z(e).length>1&&(j(zie(e)),e=ge(e),delete e.day)),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Qie(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Kie(e.quarter):e.quarter;n.push(Ce(i)?i*3:i+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Zie(e.day):e.day;n.push(Ce(i)?i+1:i+"+1")}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function uf(e){const t=$x(e,!0),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function ere(e){const t=$x(e,!1),n=t.join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function tre(e){const t=$x(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const oI={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Dx=z(oI);function nre(e){return!!oI[e]}function Rx(e){return e.startsWith("utc")}function ire(e){return e.substr(3)}const rre={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Fx(e){const t=[];for(const n of Dx)sI(e,n)&&t.push(n);return t}function sI(e,t){const n=e.indexOf(t);return n<0||(n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o")?!1:!(n>0&&t==="year"&&e.charAt(n-1)==="f")}function are(e,t,{end:n}={end:!1}){const i=mN(t),r=Rx(e)?"utc":"";function a(l){return l==="quarter"?`(${r}quarter(${i})-1)`:`${r}${l}(${i})`}let o;const s={};for(const l of Dx)sI(e,l)&&(s[l]=a(l),o=l);return n&&(s[o]+="+1"),ere(s)}function lI(e){if(!e)return;const t=Fx(e);return`timeUnitSpecifier(${Qc(t)}, ${Qc(rre)})`}function ore(e,t,n){if(!e)return;const i=lI(e),r=n||Rx(e);return`${r?"utc":"time"}Format(${t}, ${i})`}function sn(e){if(!e)return;let t;return Y(e)?t={unit:e}:K(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Rx(t.unit)&&(t.utc=!0,t.unit=ire(t.unit)),t}function sre(e){const t=sn(e),{utc:n}=t,i=Z(t,["utc"]);return i.unit?(n?"utc":"")+z(i).map(r=>qe(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+z(i).map(r=>qe(`_${r}_${i[r]}`)).join("")}function oe(e){return e&&!!e.signal}function qa(e){return!!e.step}function lre(e){return M(e)?!1:"fields"in e&&!("data"in e)}function ure(e){return M(e)?!1:"fields"in e&&"data"in e}function Wa(e){return M(e)?!1:"field"in e&&"data"in e}const cre={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},fre=z(cre),dre={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Nx=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function hre(e){return e==null?void 0:e.selection}function Ix(e){return e&&!!e.field&&e.equal!==void 0}function uI(e){return e&&!!e.field&&e.lt!==void 0}function cI(e){return e&&!!e.field&&e.lte!==void 0}function fI(e){return e&&!!e.field&&e.gt!==void 0}function dI(e){return e&&!!e.field&&e.gte!==void 0}function Mx(e){if(e&&e.field){if(M(e.range)&&e.range.length===2)return!0;if(oe(e.range))return!0}return!1}function jx(e){return e&&!!e.field&&(M(e.oneOf)||M(e.in))}function pre(e){return e&&!!e.field&&e.valid!==void 0}function hI(e){return jx(e)||Ix(e)||Mx(e)||uI(e)||fI(e)||cI(e)||dI(e)}function cr(e,t){return t2(e,{timeUnit:t,wrapTime:!0})}function gre(e,t){return e.map(n=>cr(n,t))}function pI(e,t=!0){var n;const{field:i}=e,r=(n=sn(e.timeUnit))===null||n===void 0?void 0:n.unit,a=r?"time("+are(r,i)+")":U(e,{expr:"datum"});if(Ix(e))return a+"==="+cr(e.equal,r);if(uI(e)){const o=e.lt;return`${a}<${cr(o,r)}`}else if(fI(e)){const o=e.gt;return`${a}>${cr(o,r)}`}else if(cI(e)){const o=e.lte;return`${a}<=${cr(o,r)}`}else if(dI(e)){const o=e.gte;return`${a}>=${cr(o,r)}`}else{if(jx(e))return`indexof([${gre(e.oneOf,r).join(",")}], ${a}) !== -1`;if(pre(e))return Lx(a,e.valid);if(Mx(e)){const{range:o}=e,s=oe(o)?{signal:`${o.signal}[0]`}:o[0],l=oe(o)?{signal:`${o.signal}[1]`}:o[1];if(s!==null&&l!==null&&t)return"inrange("+a+", ["+cr(s,r)+", "+cr(l,r)+"])";const u=[];return s!==null&&u.push(`${a} >= ${cr(s,r)}`),l!==null&&u.push(`${a} <= ${cr(l,r)}`),u.length>0?u.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Lx(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function mre(e){var t;return hI(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=sn(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Ll={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},rs=Ll.quantitative,Px=Ll.ordinal,Pl=Ll.temporal,zx=Ll.nominal,zl=Ll.geojson,vre=z(Ll);function yre(e){if(e){e=e.toLowerCase();switch(e){case"q":case rs:return"quantitative";case"t":case Pl:return"temporal";case"o":case Px:return"ordinal";case"n":case zx:return"nominal";case zl:return"geojson"}}return}const at={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Bx={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},bre=z(Bx);function wre(e,t){const n=Bx[e],i=Bx[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const xre={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function gI(e){return xre[e]}const mI=["linear","log","pow","sqrt","symlog","time","utc"],Ere=pt(mI),kre=["linear","log","pow","sqrt","symlog"],_re=pt(kre);function Are(e){return e in _re}const Sre=["quantile","quantize","threshold"],Ore=pt(Sre),Tre=mI.concat(["quantile","quantize","threshold","sequential","identity"]),Cre=pt(Tre),$re=["ordinal","bin-ordinal","point","band"],Dre=pt($re);function Tn(e){return e in Dre}function ai(e){return e in Cre}function Di(e){return e in Ere}function Dg(e){return e in Ore}const Rre={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Fre(e){return!Y(e)&&!!e.name}function vI(e){return e==null?void 0:e.selection}function Nre(e){return e&&e.unionWith}const Ire={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Mre=Z(Ire,["type","domain","range","scheme"]),jre=z(Mre),zfe=Lre();function yI(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!ae(["point","band","identity"],e);case"bins":return!ae(["point","band","identity","ordinal"],e);case"round":return Di(e)||e==="band"||e==="point";case"padding":return Di(e)||ae(["point","band"],e);case"paddingOuter":case"align":return ae(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return Di(e);case"nice":return Di(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ai(e)&&!ae(["log","time","utc","threshold","quantile"],e)}}function bI(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Il(e)?void 0:kie(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function wI(e,t){return ae([Px,zx],t)?e===void 0||Tn(e):t===Pl?ae([at.TIME,at.UTC,void 0],e):t===rs?ae([at.LOG,at.POW,at.SQRT,at.SYMLOG,at.QUANTILE,at.QUANTIZE,at.THRESHOLD,at.LINEAR,void 0],e):!0}function xI(e,t){if(!Ua(e))return!1;switch(e){case He:case ct:case Ci:case nr:return Di(t)||ae(["band","point"],t);case Br:case La:case Ur:case Ma:case ja:case ts:return Di(t)||Dg(t)||ae(["band","point","ordinal"],t);case Sn:case ar:case or:return t!=="band";case Pa:return t==="ordinal"||Dg(t);case On:return t==="ordinal"}}function Lre(){var e;const t={};for(const n of NN)for(const i of vre)for(const r of bre){const a=Pre(n,i);xI(n,r)&&wI(r,i)&&(t[a]=(e=t[a])!==null&&e!==void 0?e:[],t[a].push(r))}return t}function Pre(e,t){return e+"_"+t}function Ux(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:a}=e,o=kI(e);return q(n)&&!CN(n.aggregate)&&r&&Di(r.get("type"))&&r.get("zero")===!1?EI({fieldDef:n,channel:t,markDef:i,ref:o,config:a}):o}function EI({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){if(Zo(n.type))return i;const a=Se("invalid",n,r);return a===null?i:[zre(e,t),i]}function zre(e,t){const n=qx(e,!0),i=is(t),r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function qx(e,t=!0){return Lx(Y(e)?e:U(e,{expr:"datum"}),!t)}function Bre(e){const{datum:t}=e;return jl(t)?uf(t):`${JSON.stringify(t)}`}function as(e,t,n,i){const r={};if(t&&(r.scale=t),Ha(e)){const{datum:a}=e;jl(a)?r.signal=uf(a):oe(a)?r.signal=a.signal:r.value=a}else r.field=U(e,n);if(i){const{offset:a,band:o}=i;a&&(r.offset=a),o&&(r.band=o)}return r}function Rg({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=U(t,{expr:o,suffix:r}),l=n!==void 0?U(n,{expr:o}):U(t,{suffix:"end",expr:o}),u={};if(a===0||a===1){u.scale=e;const c=a===0?s:l;u.field=c}else{const c=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${c})`}return i&&(u.offset=i),u}function kI({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(se(t)){if(Bn(t)){c=c??df({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:s,config:r,isMidPoint:!0});const{bin:h,timeUnit:p,type:g}=t;if(Me(h)||c&&p&&g===Pl)return s&&s.impute?as(t,a,{binSuffix:"mid"},{offset:l}):c?Rg({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):as(t,a,hf(t,e)?{binSuffix:"range"}:{},{offset:l});if(on(h)){if(q(n))return Rg({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});{const m=e===He?Ti:tr;j(nI(m))}}}const d=o==null?void 0:o.get("type");return as(t,a,Tn(d)?{binSuffix:"range"}:{},{offset:l,band:d==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(qr(t)){const d=t.value,h=l?{offset:l}:{};return Object.assign(Object.assign({},cf(e,d)),h)}}return de(u)&&(u=u()),u&&Object.assign(Object.assign({},u),l?{offset:l}:{})}function cf(e,t){return ae(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:ae(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:nt(t)}function os(e){return e&&e!=="number"&&e!=="time"}function _I(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const Ure=" â€“ ";function Wx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a}){var o,s;if(os(n))return Gx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:a});const l=AI(e,i,r);if(zg(e)){const u=Wre(l,q(e)?(o=sn(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,a.timeFormat,Kx(e)&&((s=e.scale)===null||s===void 0?void 0:s.type)===at.UTC);return u?{signal:u}:void 0}if(t=TI(Ga(e),t,a),q(e)&&Me(e.bin)){const u=U(e,{expr:i,binSuffix:"end"});return{signal:Fg(l,u,t,n,a)}}else return t||Ga(e)==="quantitative"?{signal:`${CI(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function AI(e,t,n){return q(e)?n?`${U(e,{expr:t,suffix:"end"})}-${U(e,{expr:t,suffix:"start"})}`:U(e,{expr:t}):Bre(e)}function Gx({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:a,field:o}){if(o=o??AI(e,i,r),q(e)&&Me(e.bin)){const s=U(e,{expr:i,binSuffix:"end"});return{signal:Fg(o,s,t,n,a)}}return{signal:_I(n,o,t)}}function SI(e,t,n,i,r,a){var o;if(os(i))return;if(zg(e)){const s=q(e)?(o=sn(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return qre(n,s,r,a)}return TI(t,n,r)}function OI(e,t,n){return e&&(oe(e)||e==="number"||e==="time")?e:zg(t)&&n!=="time"&&n!=="utc"?"time":void 0}function TI(e,t,n){return Y(t)?t:e===rs?n.numberFormat:void 0}function qre(e,t,n,i){return e||(t?{signal:lI(t)}:i?void 0:n.timeFormat)}function CI(e,t){return`format(${e}, "${t||""}")`}function $I(e,t,n,i){var r;return os(n)?_I(n,e,t):CI(e,(r=Y(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Fg(e,t,n,i,r){const a=$I(e,n,i,r),o=$I(t,n,i,r);return`${Lx(e,!1)} ? "null" : ${a} + "${Ure}" + ${o}`}function Wre(e,t,n,i,r){return!t||n?(n=Y(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):ore(t,e,r)}const Ng="min",Gre={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function DI(e){return e in Gre}function RI(e){return!!e&&!!e.encoding}function fr(e){return!!e&&(e.op==="count"||!!e.field)}function FI(e){return!!e&&M(e)}function ff(e){return"row"in e||"column"in e}function Hx(e){return!!e&&"header"in e}function Ig(e){return"facet"in e}function Hre(e){return e.selection}function Yre(e){return e&&!Y(e)&&"repeat"in e}function NI(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function II(e){return Bn(e)&&"sort"in e}function df({channel:e,fieldDef:t,fieldDef2:n,markDef:i,stack:r,config:a,isMidPoint:o}){if(se(t)&&t.band!==void 0)return t.band;if(q(t)){const{timeUnit:s,bin:l}=t;if(s&&!n)return o?us("timeUnitBandPosition",i,a):AN(i.type)?us("timeUnitBand",i,a):0;if(Me(l))return AN(i.type)&&!o?1:.5}return(r==null?void 0:r.fieldChannel)===e&&o?.5:void 0}function Yx(e,t,n,i,r,a){return Me(t.bin)||t.timeUnit&&Bn(t)&&t.type==="temporal"?!!df({channel:e,fieldDef:t,fieldDef2:n,stack:i,markDef:r,config:a}):!1}function Vx(e){return!!e&&"condition"in e}function Mg(e){const t=e&&e.condition;return!!t&&!M(t)&&q(t)}function Xx(e){const t=e&&e.condition;return!!t&&!M(t)&&se(t)}function Vre(e){const t=e&&e.condition;return!!t&&(M(t)||qr(t))}function q(e){return!!e&&(!!e.field||e.aggregate==="count")}function Ga(e){return e&&e.type}function Ha(e){return!!e&&"datum"in e}function dr(e){return Bn(e)&&PI(e)||Jx(e)}function Jx(e){return Ha(e)&&Ce(e.datum)}function se(e){return q(e)||Ha(e)}function Bn(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function qr(e){return e&&"value"in e&&"value"in e}function Kx(e){return!!e&&("scale"in e||"sort"in e)}function Qx(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function MI(e){return!!e&&"legend"in e}function jI(e){return!!e&&("format"in e||"formatType"in e)}function Xre(e){return"op"in e}function U(e,t={}){var n,i,r;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(Jre(e))a=une("count");else{let u;if(!t.nofn)if(Xre(e))u=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;Me(c)?(u=zN(c),s=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?es(f)?(l=`["${a}"]`,a=`argmax_${f.argmax}`):Ia(f)?(l=`["${a}"]`,a=`argmin_${f.argmin}`):u=String(f):d&&(u=sre(d),s=(!ae(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}u&&(a=a?`${u}_${a}`:u)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?vN(a):t.expr?ane(a,t.expr)+l:Na(a)+l}function LI(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return q(e)&&!!e.bin;case"temporal":return!1}throw new Error(JN(e.type))}function PI(e){return!LI(e)}function Jre(e){return e.aggregate==="count"}function Kre(e,t){var n;const{field:i,bin:r,timeUnit:a,aggregate:o}=e;if(o==="count")return t.countTitle;if(Me(r))return`${i} (binned)`;if(a){const s=(n=sn(a))===null||n===void 0?void 0:n.unit;if(s)return`${i} (${Fx(s).join("-")})`}else if(o)return es(o)?`${i} for max ${o.argmax}`:Ia(o)?`${i} for min ${o.argmin}`:`${dg(o)} of ${i}`;return i}function Qre(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(es(t))return`${r} for argmax(${t.argmax})`;if(Ia(t))return`${r} for argmin(${t.argmin})`;const a=sn(i),o=t||(a==null?void 0:a.unit)||(a==null?void 0:a.maxbins)&&"timeunit"||Me(n)&&"bin";return o?o.toUpperCase()+"("+r+")":r}const zI=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Qre(e);default:return Kre(e,t)}};let BI=zI;function UI(e){BI=e}function Zre(){UI(zI)}function ss(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,a;const o=(r=Zx(e))!==null&&r!==void 0?r:{},s=o.title;if(!q(e))return s;const l=e,u=i?qI(l,t):void 0;return n?rt(s,l.title,u):(a=s??l.title)!==null&&a!==void 0?a:u}function Zx(e){return Qx(e)&&e.axis?e.axis:MI(e)&&e.legend?e.legend:Hx(e)&&e.header?e.header:void 0}function qI(e,t){return BI(e,t)}function jg(e){var t;if(jI(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=Zx(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function eae(e,t){if(e.timeUnit)return"temporal";if(Me(e.bin))return"quantitative";switch(Og(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function hr(e){return q(e)?e:Mg(e)?e.condition:void 0}function ft(e){return se(e)?e:Xx(e)?e.condition:void 0}function e2(e,t,n){if(Y(e)||Ce(e)||na(e)){const i=Y(e)?"string":Ce(e)?"number":"boolean";return j(die(t,i,e)),{value:e}}return se(e)?Lg(e,t,n):Xx(e)?Object.assign(Object.assign({},e),{condition:Lg(e.condition,t,n)}):e}function Lg(e,t,n){if(jI(e)){const{format:i,formatType:r}=e,a=Z(e,["format","formatType"]);if(os(r)&&!n.customFormatTypes)return j(XN(t)),Lg(a,t,n)}else{const i=Qx(e)?"axis":MI(e)?"legend":Hx(e)?"header":null;if(i&&e[i]){const r=e[i],{format:a,formatType:o}=r,s=Z(r,["format","formatType"]);if(os(o)&&!n.customFormatTypes)return j(XN(t)),Lg(Object.assign(Object.assign({},e),{[i]:s}),t,n)}}return q(e)?WI(e,t):tae(e)}function tae(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Ce(n)?"quantitative":Y(n)?"nominal":jl(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function WI(e,t){const{aggregate:n,timeUnit:i,bin:r,field:a}=e,o=Object.assign({},e);if(n&&!Ex(n)&&!es(n)&&!Ia(n)&&(j(pie(n)),delete o.aggregate),i&&(o.timeUnit=sn(i)),a&&(o.field=`${a}`),Me(r)&&(o.bin=Pg(r,t)),on(r)&&!ur(t)&&j(`Channel ${t} should not be used with "binned" bin.`),Bn(o)){const{type:s}=o,l=yre(s);s!==l&&(o.type=l),s!=="quantitative"&&(CN(n)&&(j(hie(s,n)),o.type="quantitative"))}else if(!MN(t)){const s=eae(o,t);j(gie(t,s)),o.type=s}if(Bn(o)){const{compatible:s,warning:l}=nae(o,t);s||j(l)}if(II(o)&&Y(o.sort)){const{sort:s}=o;if(DI(s))return Object.assign(Object.assign({},o),{sort:{encoding:s}});const l=s.substr(1);if(s.charAt(0)==="-"&&DI(l))return Object.assign(Object.assign({},o),{sort:{encoding:l,order:"descending"}})}if(Hx(o)){const{header:s}=o,{orient:l}=s,u=Z(s,["orient"]);if(l)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},u),{labelOrient:s.labelOrient||l,titleOrient:s.titleOrient||l})})}return o}function Pg(e,t){return na(e)?{maxbins:BN(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:BN(t)}):e}const ls={compatible:!0};function nae(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case jr:case Lr:case wg:return PI(e)?{compatible:!1,warning:yie(t)}:ls;case He:case ct:case Sn:case ar:case or:case af:case sf:case xg:case ns:case Eg:case kg:case ts:case Ci:case nr:case _g:return ls;case rr:case ni:case ir:case $i:return n!==rs?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:ls;case Ur:case Ma:case ja:case La:case Br:case zr:case Pr:case Ti:case tr:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:ls;case Pa:return ae(["ordinal","nominal"],e.type)?ls:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case On:return ae(["ordinal","nominal","geojson"],e.type)?ls:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case of:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:ls}}function zg(e){const{formatType:t}=jg(e);return t==="time"||!t&&iae(e)}function iae(e){return e&&(e.type==="temporal"||q(e)&&!!e.timeUnit)}function t2(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var a;const o=t&&((a=sn(t))===null||a===void 0?void 0:a.unit);let s=o||n==="temporal",l;return oe(e)?l=e.signal:jl(e)?(s=!0,l=uf(e)):(Y(e)||Ce(e))&&(s&&(l=`datetime(${JSON.stringify(e)})`,nre(o)&&((Ce(e)&&e<1e4||Y(e)&&isNaN(Date.parse(e)))&&(l=uf({[o]:e}))))),l?i&&s?`time(${l})`:l:r?void 0:JSON.stringify(e)}function GI(e,t){const{type:n}=e;return t.map(i=>{const r=t2(i,{timeUnit:q(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function hf(e,t){return Me(e.bin)?Ua(t)&&ae(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function HI(e){const{anchor:t,frame:n,offset:i,orient:r,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=Z(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{}),v=ef(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:v,nonMark:g,subtitle:m}}function Ya(e){return Y(e)||M(e)&&Y(e[0])}function nt(e){return oe(e)?e:e!==void 0?{value:e}:void 0}function YI(e){return oe(e)?e.signal:B(e.value)}function pf(e){return oe(e)?e.signal:e==null?null:B(e)}function rae(e,t,n){for(const i of n){const r=us(i,t.markDef,t.config);r!==void 0&&(e[i]=nt(r))}return e}function VI(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Se(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:a}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:a&&(!r||r===e)?void 0:us(e,t,n,i)}function us(e,t,n,{vgChannel:i}={}){return rt(i?Bg(e,t,n.style):void 0,Bg(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function Bg(e,t,n){return XI(e,VI(t),n)}function XI(e,t,n){t=G(t);let i;for(const r of t){const a=n[r];a&&a[e]!==void 0&&(i=a[e])}return i}function JI(e,t){return G(e).reduce((n,i)=>{var r;return n.field.push(U(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function KI(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Zc(r,i))return;n.push(i)}),n}function QI(e,t){return Zc(e,t)||!t?e:e?[...G(e),...G(t)].join(", "):t}function ZI(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Ya(n)||oe(n))&&(Ya(i)||oe(i)))return{explicit:e.explicit,value:QI(n,i)};if(Ya(n)||oe(n))return{explicit:e.explicit,value:n};if(Ya(i)||oe(i))return{explicit:e.explicit,value:i};if(!Ya(n)&&!oe(n)&&!Ya(i)&&!oe(i))return{explicit:e.explicit,value:KI(n,i)};throw new Error("It should never reach here")}function cs(e,t){const n=e&&e[t];return n?M(n)?tf(n,i=>!!i.field):q(n)||Mg(n):!1}function n2(e){return tf(NN,t=>{if(cs(e,t)){const n=e[t];if(M(n))return tf(n,i=>!!i.aggregate);{const i=hr(n);return i&&!!i.aggregate}}return!1})}function i2(e,t){const n=[],i=[],r=[],a=[],o={};return r2(e,(s,l)=>{if(q(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=Z(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const p=Zx(s),g=p&&p.title;let m=U(s,{forAs:!0});const v=Object.assign(Object.assign(Object.assign({},g?[]:{title:ss(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let y;if(es(c)?(y="argmax",m=U({op:"argmax",field:c.argmax},{forAs:!0}),v.field=`${m}.${u}`):Ia(c)?(y="argmin",m=U({op:"argmin",field:c.argmin},{forAs:!0}),v.field=`${m}.${u}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(y=c),y){const b={op:y,as:m};u&&(b.field=u),a.push(b)}}else if(n.push(m),Bn(s)&&Me(f)){if(i.push({bin:f,field:u,as:m}),n.push(U(s,{binSuffix:"end"})),hf(s,l)&&n.push(U(s,{binSuffix:"range"})),ur(l)){const y={field:m+"_end"};o[l+"2"]=y}v.bin="binned",MN(l)||(v.type=rs)}else if(d){r.push({timeUnit:d,field:u,as:m});const y=Bn(s)&&s.type!==Pl&&"time";y&&(l===af||l===ns?v.formatType=y:Hne(l)?v.legend=Object.assign({formatType:y},v.legend):ur(l)&&(v.axis=Object.assign({formatType:y},v.axis)))}o[l]=v}else n.push(u),o[l]=e[l]}else o[l]=e[l]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function aae(e,t,n){const i=Vne(t,n);if(i){if(i==="binned"){const r=e[t===Ti?He:ct];return!!(q(r)&&q(e[t])&&on(r.bin))}}else return!1;return!0}function oae(e,t,n){const i=t.type;return z(e).reduce((r,a)=>{if(!IN(a))return j(vie(a)),r;const o=e[a];if(a==="angle"&&i==="arc"&&!e.theta&&(j(fie),a=Ci),!aae(e,a,i))return j(Cg(a,i)),r;if(a===Br&&i==="line"){const s=hr(e[a]);if(s==null?void 0:s.aggregate)return j(mie),r}if(a===Sn&&(t.filled?"fill"in e:"stroke"in e))return j(KN("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(a===sf||a===of&&!M(o)&&!qr(o)||a===ns&&M(o))o&&(r[a]=G(o).reduce((s,l)=>(q(l)?s.push(WI(l,a)):j(Tx(l,a)),s),[]));else{if(a===ns&&o===null)r[a]=null;else if(!q(o)&&!Ha(o)&&!qr(o)&&!Vx(o)&&!oe(o))return j(Tx(o,a)),r;r[a]=e2(o,a,n)}return r},{})}function sae(e){const t=[];for(const n of z(e))if(cs(e,n)){const i=e[n],r=G(i);for(const a of r)q(a)?t.push(a):Mg(a)&&t.push(a.condition)}return t}function r2(e,t,n){if(!e)return;for(const i of z(e)){const r=e[i];if(M(r))for(const a of r)t.call(n,a,i);else t.call(n,r,i)}}function eM(e,t,n,i){return e?z(e).reduce((r,a)=>{const o=e[a];return M(o)?o.reduce((s,l)=>t.call(i,s,l,a),r):t.call(i,r,o,a)},n):n}function tM(e,t){return z(t).reduce((n,i)=>{switch(i){case He:case ct:case Eg:case _g:case kg:case Ti:case tr:case Ci:case zr:case nr:case Pr:case ir:case rr:case $i:case ni:case af:case On:case ts:case ns:return n;case of:if(e==="line"||e==="trail")return n;case sf:case xg:{const r=t[i];if(M(r)||q(r))for(const a of G(r))a.aggregate||n.push(U(a,{}));return n}case Br:if(e==="trail")return n;case Sn:case ar:case or:case Ur:case Ma:case ja:case Pa:case La:{const r=hr(t[i]);return r&&!r.aggregate&&n.push(U(r,{})),n}}},[])}function lae(e){const{tooltip:t}=e,n=Z(e,["tooltip"]);if(!t)return{filteredEncoding:e};let i,r;if(M(t)){for(const a of t)a.aggregate?(i||(i=[]),i.push(a)):(r||(r=[]),r.push(a));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return M(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function a2(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:o})=>{const s=i?` of ${t.field}`:"";return{field:a+t.field,type:t.type,title:oe(o)?{signal:o+`"${escape(s)}"`}:o+s}});return{tooltip:[...r,...sae(n)]}}function nM(e){const{axis:t,title:n,field:i}=e;return t&&t.title!==void 0?void 0:rt(n,i)}function o2(e,t,n,i,r){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c=void 0,aria:f,extraEncoding:d={}})=>{const h=nM(n);return iM(e,s,r,f,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},h!==void 0?{title:h}:{}),a!==void 0?{scale:a}:{}),o!==void 0?{axis:o}:{})},Y(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),i),d)})}}function iM(e,t,n,i,r){const{clip:a,color:o,opacity:s}=e,l=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),a?{clip:a}:{}),o?{color:o}:{}),s?{opacity:s}:{}),er(r.mark)?r.mark:{type:r.mark}),{style:`${l}-${t}`}),na(e[t])?{}:e[t]),i===!1?{aria:i}:{})})]:[]}function rM(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",a=i[r],o=i[r+"2"],s=i[r+"Error"],l=i[r+"Error2"];return{continuousAxisChannelDef:Ug(a,n),continuousAxisChannelDef2:Ug(o,n),continuousAxisChannelDefError:Ug(s,n),continuousAxisChannelDefError2:Ug(l,n),continuousAxis:r}}function Ug(e,t){if(e&&e.aggregate){const{aggregate:n}=e,i=Z(e,["aggregate"]);return n!==t&&j(qie(n,t)),i}else return e}function aM(e,t){const{mark:n,encoding:i}=e,{x:r,y:a}=i;if(dr(r)){if(dr(a)){const o=q(r)&&r.aggregate,s=q(a)&&a.aggregate;if(!o&&s===t)return"vertical";if(!s&&o===t)return"horizontal";if(o===t&&s===t)throw new Error("Both x and y cannot have aggregate");return er(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(dr(a))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const qg="boxplot",uae=["box","median","outliers","rule","ticks"],cae=new bg(qg,sM);function oM(e){return Ce(e)?"tukey":e}function sM(e,{config:t}){var n,i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=er(r)?r:{type:r};o&&j(HN("boxplot"));const c=(n=u.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Se("size",u,t),d=oM(c),{transform:h,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:v,encodingWithoutContinuousAxis:y,ticksOrient:b,boxOrient:E,customTooltipWithoutAggregatedField:x}=fae(e,c,t),{color:k,size:w}=y,A=Z(y,["color","size"]),_=J=>o2(u,g,p,J,t.boxplot),O=_(A),S=_(y),T=_(Object.assign(Object.assign({},A),w?{size:w}:{})),D=a2([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,y),I={type:"tick",color:"black",opacity:1,orient:b,invalid:null},C=d==="min-max"?D:a2([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,y),N=[...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:C}),...O({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:I,positionPrefix:"lower_whisker",aria:!1,extraEncoding:C}),...O({partName:"ticks",mark:I,positionPrefix:"upper_whisker",aria:!1,extraEncoding:C})],W=[...d!=="tukey"?N:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:E,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:D}),...T({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:D})];let X;if(d!=="min-max"){const J=`datum["lower_box_${p.field}"]`,xe=`datum["upper_box_${p.field}"]`,Pe=`(${xe} - ${J})`,dt=`${J} - ${c} * ${Pe}`,ht=`${xe} + ${c} * ${Pe}`,Qe=`datum["${p.field}"]`,Rt={joinaggregate:lM(p.field),groupby:m};let ui;d==="tukey"&&(ui={transform:[{filter:`(${dt} <= ${Qe}) && (${Qe} <= ${ht})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:m}],layer:N});const no=Z(A,["tooltip"]),{scale:Xr,axis:H}=p,ue=nM(p),me=iM(u,"outliers",t.boxplot,!0,{transform:[{filter:`(${Qe} < ${dt}) || (${Qe} > ${ht})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},ue!==void 0?{title:ue}:{}),Xr!==void 0?{scale:Xr}:{}),H!==void 0?{axis:H}:{})},no),x?{tooltip:x}:{})})[0];me&&ui?X={transform:[Rt],layer:[me,ui]}:me?(X=me,X.transform.unshift(Rt)):ui&&(X=ui,X.transform.unshift(Rt))}return X?Object.assign(Object.assign({},l),{layer:[X,{transform:h,layer:W}]}):Object.assign(Object.assign({},l),{transform:((i=l.transform)!==null&&i!==void 0?i:[]).concat(h),layer:W})}function lM(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function fae(e,t,n){const i=aM(e,qg),{continuousAxisChannelDef:r,continuousAxis:a}=rM(e,i,qg),o=r.field,s=oM(t),l=[...lM(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}],u=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=c[f],h=Z(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:p,filteredEncoding:g}=lae(h),{bins:m,timeUnits:v,aggregate:y,groupby:b,encoding:E}=i2(g,n),x=i==="vertical"?"horizontal":"vertical",k=i,w=[...m,...v,{aggregate:[...y,...l],groupby:b},...u];return{transform:w,groupby:b,aggregate:y,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:E,ticksOrient:x,boxOrient:k,customTooltipWithoutAggregatedField:p}}const s2="errorbar",dae=["ticks","rule"],hae=new bg(s2,uM);function uM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=cM(e,s2,t),c=o2(s,r,i,a,t.errorbar),f={type:"tick",orient:o},d=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:u}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),d.length>1?{layer:d}:Object.assign({},d[0]))}function pae(e,t){const{encoding:n}=e;if(gae(n))return{orient:aM(e,t),inputType:"raw"};const i=mae(n),r=vae(n),a=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const s=n.x2,l=n.y2;if(se(s)&&se(l))throw new Error(`${t} cannot have both x2 and y2`);if(se(s)){if(dr(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(se(l)){if(dr(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const s=n.xError,l=n.xError2,u=n.yError,c=n.yError2;if(se(l)&&!se(s))throw new Error(`${t} cannot have xError2 without xError`);if(se(c)&&!se(u))throw new Error(`${t} cannot have yError2 without yError`);if(se(s)&&se(u))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(se(s)){if(dr(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(se(u)){if(dr(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function gae(e){return(se(e.x)||se(e.y))&&!se(e.x2)&&!se(e.y2)&&!se(e.xError)&&!se(e.xError2)&&!se(e.yError)&&!se(e.yError2)}function mae(e){return se(e.x2)||se(e.y2)}function vae(e){return se(e.xError)||se(e.xError2)||se(e.yError)||se(e.yError2)}function cM(e,t,n){var i;const{mark:r,encoding:a,selection:o,projection:s}=e,l=Z(e,["mark","encoding","selection","projection"]),u=er(r)?r:{type:r};o&&j(HN(t));const{orient:c,inputType:f}=pae(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=rM(e,c,t),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:E}=yae(u,d,h,p,g,f,t,n),x=a,k=m,w=x[k],A=m==="x"?"x2":"y2",_=x[A],O=m==="x"?"xError":"yError",S=x[O],T=m==="x"?"xError2":"yError2",D=x[T],I=Z(x,[typeof k=="symbol"?k:k+"",typeof A=="symbol"?A:A+"",typeof O=="symbol"?O:O+"",typeof T=="symbol"?T:T+""]),{bins:C,timeUnits:N,aggregate:W,groupby:X,encoding:J}=i2(I,n),xe=[...W,...v],Pe=f!=="raw"?[]:X,dt=a2(b,d,J,E);return{transform:[...(i=l.transform)!==null&&i!==void 0?i:[],...C,...N,...xe.length===0?[]:[{aggregate:xe,groupby:Pe}],...y],groupby:Pe,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:J,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:dt}}function yae(e,t,n,i,r,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if(a==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":s.errorbar.center,p=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!==(p==="iqr")&&j(Uie(h,p,o)),p==="stderr"||p==="stdev")l=[{op:p,field:c,as:"extent_"+c},{op:h,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:dg(h)},{fieldPrefix:"upper_",titlePrefix:fM(h,p,"+")},{fieldPrefix:"lower_",titlePrefix:fM(h,p,"-")}],d=!0;else{e.center&&e.extent&&j(Wie(e.extent,o));let g,m,v;p==="ci"?(g="mean",m="ci0",v="ci1"):(g="median",m="q1",v="q3"),l=[{op:m,field:c,as:"lower_"+c},{op:v,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:ss({field:c,aggregate:v,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:ss({field:c,aggregate:m,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:ss({field:c,aggregate:g,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&j(Bie(e.center,e.extent)),a==="aggregated-upper-lower"?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):a==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"upper_"+c}],r?u.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:"lower_"+c}));for(const h of u)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Nl(Nl(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}function fM(e,t,n){return dg(e)+" "+n+" "+t}const l2="errorband",bae=["band","borders"],wae=new bg(l2,dM);function dM(e,{config:t}){const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=cM(e,l2,t),u=o,c=o2(u,r,i,a,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign({},h),p)):u.interpolate?j(tI("interpolate")):u.tension&&j(tI("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",aria:!1,extraEncoding:l})]})}const hM={};function u2(e,t,n){const i=new bg(e,t);hM[e]={normalizer:i,parts:n}}function xae(){return z(hM)}u2(qg,sM,uae),u2(s2,uM,dae),u2(l2,dM,bae);const Eae=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],pM=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],kae={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},_ae={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Aae={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},Bl="_vgsid_",Sae={single:{on:"click",fields:[Bl],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[Bl],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function c2(e){return!!e&&(e==="legend"||!!e.legend)}function f2(e){return c2(e)&&K(e)}function Oae(e){return Wg(e)||h2(e)||d2(e)}function d2(e){return"concat"in e}function Wg(e){return"vconcat"in e}function h2(e){return"hconcat"in e}function pr(e){return K(e)&&e.step!==void 0}function gM(e){return e.view||e.width||e.height}const mM=20,Tae={align:1,bounds:1,center:1,columns:1,spacing:1},Cae=z(Tae);function $ae(e,t,n){var i,r;const a=n[t],o={},{spacing:s,columns:l}=a;s!==void 0&&(o.spacing=s),l!==void 0&&((Ig(e)&&!ff(e.facet)||d2(e))&&(o.columns=l)),Wg(e)&&(o.columns=1);for(const u of Cae)if(e[u]!==void 0)if(u==="spacing"){const c=e[u];o[u]=Ce(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:s,column:(r=c.column)!==null&&r!==void 0?r:s}}else o[u]=e[u];return o}function p2(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function Gg(e,t){const n=gf(e,t);return pr(n)?n.step:g2}function gf(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return rt(i,{step:e.step})}const g2=20,Dae={continuousWidth:200,continuousHeight:200,step:g2},Rae={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Dae,mark:xne,arc:{},area:{},bar:kne,circle:{},geoshape:{},image:{},line:{},point:{},rect:_ne,rule:{color:"black"},square:{},text:{color:"black"},tick:Ane,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Rre,projection:{},legend:_ae,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Sae,style:{},title:{},facet:{spacing:mM},concat:{spacing:mM}},Wr=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],vM={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},yM={blue:Wr[0],orange:Wr[1],red:Wr[2],teal:Wr[3],green:Wr[4],yellow:Wr[5],purple:Wr[6],pink:Wr[7],brown:Wr[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Fae(e={}){return{signals:[{name:"color",value:K(e)?Object.assign(Object.assign({},yM),e):yM}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Nae(e){return{signals:[{name:"fontSize",value:K(e)?Object.assign(Object.assign({},vM),e):vM}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Iae(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function bM(e={}){const{color:t,font:n,fontSize:i}=e,r=Z(e,["color","font","fontSize"]);return Os({},Rae,n?Iae(n):{},t?Fae(t):{},i?Nae(i):{},r||{})}const Mae=["view",...SN],jae=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Lae=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},wne);function Pae(e){e=ge(e);for(const t of jae)delete e[t];if(e.axis)for(const t in e.axis)yx(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Eae)delete e.legend[t];if(e.mark){for(const t of ON)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of Mae){for(const i of ON)delete e[t][i];const n=Lae[t];if(n)for(const i of n)delete e[t][i];Bae(e,t)}for(const t of xae())delete e[t];zae(e);for(const t in e)K(e[t])&&Ne(e[t])&&delete e[t];return Ne(e)?void 0:e}function zae(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=HI(e.title);Ne(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Ne(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Ne(i)?delete e.title:e.title=i}function Bae(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const a=Object.assign(Object.assign({},r),e.style[n??t]);Ne(a)||(e.style[n??t]=a),i||delete e[t]}function Hg(e){return"layer"in e}function Uae(e){return"repeat"in e}function qae(e){return!M(e.repeat)&&e.repeat.layer}class wM{map(e,t){return Ig(e)?this.mapFacet(e,t):Uae(e)?this.mapRepeat(e,t):h2(e)?this.mapHConcat(e,t):Wg(e)?this.mapVConcat(e,t):d2(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(Hg(e))return this.mapLayer(e,t);if(Mr(e))return this.mapUnit(e,t);throw new Error(Ox(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map(n=>this.mapLayerOrUnit(n,t))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map(n=>this.map(n,t))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map(n=>this.map(n,t))})}mapConcat(e,t){const{concat:n}=e,i=Z(e,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map(r=>this.map(r,t))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}const Wae={zero:1,center:1,normalize:1};function Gae(e){return e in Wae}const Hae=new Set([EN,gg,pg,yg,vg,wx,xx,mg,kN,bx]),Yae=new Set([gg,pg,EN]);function xM(e,t){var n,i;const r=t==="x"?"y":"radius",a=e[t],o=e[r];if(q(a)&&q(o))if(Ga(a)==="quantitative"&&Ga(o)==="quantitative"){if(a.stack)return t;if(o.stack)return r;const s=q(a)&&!!a.aggregate,l=q(o)&&!!o.aggregate;if(s!==l)return s?t:r;{const u=(n=a.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(u&&u!=="linear")return r;if(c&&c!=="linear")return t}}else{if(Ga(a)==="quantitative")return t;if(Ga(o)==="quantitative")return r}else{if(Ga(a)==="quantitative")return t;if(Ga(o)==="quantitative")return r}return}function Vae(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function EM(e,t,n={}){const i=er(e)?e.type:e;if(!Hae.has(i))return null;const r=xM(t,"x")||xM(t,"theta");if(!r)return null;const a=t[r],o=q(a)?U(a,{}):void 0;let s=Vae(r),l=t[s],u=q(l)?U(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=qne.reduce((d,h)=>{if(h!=="tooltip"&&cs(t,h)){const p=t[h];for(const g of G(p)){const m=hr(g);if(m.aggregate)continue;const v=U(m,{});(!v||v!==u)&&d.push({channel:h,fieldDef:m})}}return d},[]);let f;if(a.stack!==void 0?na(a.stack)?f=a.stack?"zero":null:f=a.stack:c.length>0&&Yae.has(i)&&(f="zero"),!f||!Gae(f))return null;if(n2(t)&&c.length===0)return null;if(a.scale&&a.scale.type&&a.scale.type!==at.LINEAR){if(n.disallowNonLinearStack)return null;j(Lie(a.scale.type))}return se(t[sr(r)])?(a.stack!==void 0&&j(jie(r)),null):(q(a)&&a.aggregate&&!ae(Dne,a.aggregate)&&j(Pie(a.aggregate)),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:r,impute:a.impute===null?!1:Zo(i),stackBy:c,offset:f})}function Xae(e){const t=Z(e,["point","line"]);return z(t).length>1?t:t.type}function Jae(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:Ir(e[t],["point","line"])}));return e}function m2(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function kM(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class Kae{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(Mr(e)){const{mark:n,encoding:i}=e,r=er(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!m2(r,t[r.type],i);case"area":return!!m2(r,t[r.type],i)||!!kM(r,t[r.type])}}return!1}run(e,t,n){const{config:i}=t,{selection:r,projection:a,encoding:o,mark:s}=e,l=Z(e,["selection","projection","encoding","mark"]),u=er(s)?s:{type:s},c=m2(u,i[u.type],o),f=u.type==="area"&&kM(u,i[u.type]),d=[Object.assign(Object.assign({},r?{selection:r}:{}),{mark:Xae(Object.assign(Object.assign({},u.type==="area"&&u.opacity===void 0&&u.fillOpacity===void 0?{opacity:.7}:{}),u)),encoding:Ir(o,["shape"])})],h=EM(u,o);let p=o;if(h){const{fieldChannel:g,offset:m}=h;p=Object.assign(Object.assign({},o),{[g]:Object.assign(Object.assign({},o[g]),m?{stack:m}:{})})}return f&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},ef(u,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&d.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},ef(u,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},t),{config:Jae(i)}))}}class Qae{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(Mr(e)&&e.encoding)for(const n of ri){const i=e.encoding[n];if(i&&se(i)&&((t=i==null?void 0:i.scale)===null||t===void 0?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let i=Object.assign({},e.encoding);for(const r of ri){const a=lr(r),o=i[r];if(o&&se(o)&&((t=o==null?void 0:o.scale)===null||t===void 0?void 0:t.rangeStep)){const{scale:s}=o,l=Z(o,["scale"]),u=s,c=Z(u,["rangeStep"]);n[a]={step:s.rangeStep},j(Eie),i=Object.assign(Object.assign({},i),{[r]:Object.assign(Object.assign({},l),Ne(c)?{}:{scale:c})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:i})}}function Zae(e,t){return t?ff(e)?OM(e,t):_M(e,t):e}function v2(e,t){return t?OM(e,t):e}function y2(e,t,n){const i=t[e];if(Yre(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});j(rie(i.repeat));return}return t}function _M(e,t){if(e=y2("field",e,t),e===void 0)return;if(e===null)return null;if(II(e)&&fr(e.sort)){const n=y2("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}function AM(e,t){if(q(e))return _M(e,t);{const n=y2("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function SM(e,t){if(se(e)){const n=AM(e,t);if(n)return n;if(Vx(e))return{condition:e.condition}}else{if(Xx(e)){const n=AM(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});{const i=Z(e,["condition"]);return i}}return e}return}function OM(e,t){const n={};for(const i in e)if(Q(e,i)){const r=e[i];if(M(r))n[i]=r.map(a=>SM(a,t)).filter(a=>a);else{const a=SM(r,t);a!==void 0&&(n[i]=a)}}return n}class eoe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(Mr(e)){const{encoding:t,mark:n}=e;if(n==="line")for(const i of Bne){const r=is(i),a=t[r];if(t[i]&&(q(a)&&!on(a.bin)||Ha(a)))return!0}}return!1}run(e,t,n){const{encoding:i}=e;return j(wie(!!i.x2,!!i.y2)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}class toe extends wM{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[cae,hae,wae,new Kae(),new eoe(),new Qae()]}map(e,t){if(Mr(e)){const n=cs(e.encoding,jr),i=cs(e.encoding,Lr),r=cs(e.encoding,wg);if(n||i||r)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:i}=t,r=Object.assign(Object.assign({},e),{encoding:v2(e.encoding,t.repeater)});if(n||i)return this.mapUnitWithParentEncodingOrProjection(r,t);const a=this.mapLayerOrUnit.bind(this);for(const o of this.nonFacetUnitNormalizers)if(o.hasMatchingType(r,t.config))return o.run(r,t,a);return r}mapRepeat(e,t){return qae(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:i}=e,r=Z(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:i}}),t):Object.assign(Object.assign({},r),{layer:s.map(c=>{const f=Object.assign(Object.assign({},l),{layer:c}),d=(i.name||"")+u+`child__layer_${qe(c)}`,h=this.mapLayerOrUnit(i,Object.assign(Object.assign({},t),{repeater:f,repeaterPrefix:d}));return h.name=d,h})})}mapNonLayerRepeat(e,t){var n;const{repeat:i,spec:r,data:a}=e,o=Z(e,["repeat","spec","data"]);!M(i)&&e.columns&&(e=Ir(e,["columns"]),j(YN("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!M(i)&&i.row||[l?l.row:null],f=!M(i)&&i.column||[l?l.column:null],d=M(i)&&i||[l?l.repeat:null];for(const p of d)for(const g of c)for(const m of f){const v={repeat:p,row:g,column:m,layer:l.layer},y=(r.name||"")+u+"child__"+(M(i)?`${qe(p)}`:(i.row?`row_${qe(g)}`:"")+(i.column?`column_${qe(m)}`:"")),b=this.map(r,Object.assign(Object.assign({},t),{repeater:v,repeaterPrefix:y}));b.name=y,s.push(Ir(b,["data"]))}const h=M(i)?e.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=r.data)!==null&&n!==void 0?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return ff(n)&&e.columns&&(e=Ir(e,["columns"]),j(YN("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:i}=e,{parentEncoding:r,parentProjection:a,config:o}=t,s=CM({parentProjection:a,projection:i}),l=TM({parentEncoding:r,encoding:v2(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:i,column:r,facet:a}=n,o=Z(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=Z(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:a},t),v=v2(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:v}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:i,column:r,facet:a}=e;if(i||r){a&&j(bie([...i?[jr]:[],...r?[Lr]:[]]));const o={},s={};for(const l of[jr,Lr]){const u=e[l];if(u){const c=Z(u,["align","center","spacing","columns"]);o[l]=c;for(const f of["align","center","spacing"])u[f]!==void 0&&(s[f]=(n=s[f])!==null&&n!==void 0?n:{},s[f][l]=u[f])}}return{facetMapping:o,layout:s}}else{const{align:o,center:s,spacing:l,columns:u}=a,c=Z(a,["align","center","spacing","columns"]);return{facetMapping:Zae(c,t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},o?{align:o}:{}),s?{center:s}:{}),l?{spacing:l}:{}),u?{columns:u}:{})}}}mapLayer(e,t){var{parentEncoding:n,parentProjection:i}=t,r=Z(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=Z(e,["encoding","projection"]),l=Object.assign(Object.assign({},r),{parentEncoding:TM({parentEncoding:n,encoding:a}),parentProjection:CM({parentProjection:i,projection:o})});return super.mapLayer(s,l)}}function TM(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const r=z(t).reduce((a,o)=>(n[o]&&a.push(o),a),[]);r.length>0&&j(uie(r))}const i=Object.assign(Object.assign({},t??{}),n??{});return Ne(i)?void 0:i}function CM(e){const{parentProjection:t,projection:n}=e;return t&&n&&j(cie({parentProjection:t,projection:n})),n??t}function $M(e,t){t===void 0&&(t=bM(e.config));const n=ioe(e,t),{width:i,height:r}=e,a=roe(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const noe=new toe();function ioe(e,t={}){return noe.map(e,{config:t})}function DM(e){return Y(e)?{type:e}:e??{}}function roe(e,t,n){let{width:i,height:r}=t;const a=Mr(e)||Hg(e),o={};a?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(j(UN("width")),i=void 0),r=="container"&&(j(UN("height")),r=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?DM(n.autosize):{}),DM(e.autosize));return s.type==="fit"&&!a&&(j(Kne),s.type="pad"),i=="container"&&!(s.type=="fit"||s.type=="fit-x")&&j(qN("width")),r=="container"&&!(s.type=="fit"||s.type=="fit-y")&&j(qN("height")),Zc(s,{type:"pad"})?void 0:s}function aoe(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function ooe(e){return e?`fit-${Ag(e)}`:"fit"}const soe=["background","padding"];function RM(e){return soe.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class Va{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Va(ge(this.explicit),ge(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return rt(this.explicit[e],this.implicit[e])}getWithExplicit(e){return this.explicit[e]!==void 0?{explicit:!0,value:this.explicit[e]}:this.implicit[e]!==void 0?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){t.value!==void 0&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){t.explicit[e]!==void 0?this.set(e,t.explicit[e],!0):t.implicit[e]!==void 0&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){t[e]!==void 0&&this.set(e,t[e],!0)}copyAll(e){for(const t of z(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function fs(e){return{explicit:!0,value:e}}function Un(e){return{explicit:!1,value:e}}function FM(e){return(t,n,i,r)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:Yg(t,n,i,r)}}function Yg(e,t,n,i){return e.explicit&&t.explicit&&j($ie(n,i,e.value,t.value)),e}function Xa(e,t,n,i,r=Yg){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Zc(e.value,t.value)?e:r(e,t,n,i)}class loe extends Va{constructor(e={},t={},n=!1){super(e,t);this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function mf(e){return"url"in e}function Vg(e){return"values"in e}function NM(e){return"name"in e&&!mf(e)&&!Vg(e)&&!ds(e)}function ds(e){return e&&(IM(e)||MM(e)||b2(e))}function IM(e){return"sequence"in e}function MM(e){return"sphere"in e}function b2(e){return"graticule"in e}const Ht="main",Xg="raw";function jM(e){return"filter"in e}function uoe(e){return(e==null?void 0:e.stop)!==void 0}function coe(e){return"lookup"in e}function foe(e){return"data"in e}function doe(e){return"selection"in e}function hoe(e){return"pivot"in e}function poe(e){return"density"in e}function goe(e){return"quantile"in e}function moe(e){return"regression"in e}function voe(e){return"loess"in e}function yoe(e){return"sample"in e}function boe(e){return"window"in e}function woe(e){return"joinaggregate"in e}function xoe(e){return"flatten"in e}function Eoe(e){return"calculate"in e}function koe(e){return"bin"in e}function _oe(e){return"impute"in e}function Aoe(e){return"timeUnit"in e}function Soe(e){return"aggregate"in e}function Ooe(e){return"stack"in e}function Toe(e){return"fold"in e}function Coe(e){return e.map(t=>jM(t)?{filter:cg(t.filter,mre)}:t)}function vf(e,t,n,i){const r=Vx(t)&&t.condition,a=i(t);if(r){const o=G(r),s=o.map(l=>{const u=i(l),c=Hre(l)?uj(e,l.selection):tm(e,l.test);return Object.assign({test:c},u)});return{[n]:[...s,...a!==void 0?[a]:[]]}}else return a!==void 0?{[n]:a}:{}}function w2(e,t="text"){const n=e.encoding[t];return vf(e,n,t,i=>Jg(i,e.config))}function Jg(e,t,n="datum"){if(e){if(qr(e))return nt(e.value);if(se(e)){const{format:i,formatType:r}=jg(e);return Wx({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}return}function LM(e,t={}){const{encoding:n,markDef:i,config:r,stack:a}=e,o=n.tooltip;if(M(o))return{tooltip:zM({tooltip:o},a,r,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return vf(e,o,"tooltip",l=>{const u=Jg(l,r,s);if(u)return u;if(l===null)return;let c=Se("tooltip",i,r);return c===!0&&(c={content:"encoding"}),Y(c)?{value:c}:K(c)?c.content==="encoding"?zM(n,a,r,t):{signal:s}:void 0})}}function PM(e,t,n,{reactiveGeom:i}={}){const r={},a=i?"datum.datum":"datum",o=[];function s(u,c){const f=is(c),d=Bn(u)?u:Object.assign(Object.assign({},u),{type:e[f].type}),h=G(ss(d,n,{allowDisabling:!1})).join(", ");let p;if(ur(c)){const g=c==="x"?"x2":"y2",m=hr(e[g]);if(on(d.bin)&&m){const v=U(d,{expr:a}),y=U(m,{expr:a}),{format:b,formatType:E}=jg(d);p=Fg(v,y,b,E,n),r[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:y}=jg(d);p=Wx({fieldOrDatumDef:d,format:v,formatType:y,expr:a,config:n,normalizeStack:!0}).signal}}p=p??Jg(d,n,a).signal,o.push({channel:c,key:h,value:p})}r2(e,(u,c)=>{q(u)?s(u,c):Mg(u)&&s(u.condition,c)});const l={};for(const{channel:u,key:c,value:f}of o)!r[u]&&!l[c]&&(l[B(c)]=f);return l}function zM(e,t,n,{reactiveGeom:i}={}){const r=PM(e,t,n,{reactiveGeom:i}),a=gN(r).map(({key:o,value:s})=>`${o}: ${s}`);return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function $oe(e){const{markDef:t,config:n}=e,i=Se("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Doe(e)),Roe(e))}function Doe(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Se("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in dre?{}:{ariaRoleDescription:{value:t}}}function Roe(e){const{encoding:t,markDef:n,config:i,stack:r}=e,a=t.description;if(a)return vf(e,a,"description",l=>Jg(l,e.config));const o=Se("description",n,i);if(o!=null)return{description:nt(o)};if(i.aria===!1)return{};const s=PM(t,r,i);return Ne(s)?void 0:{description:{signal:gN(s).map(({key:l,value:u})=>`${l} + ": " + (${u})`).join(' + "; " + ')}}}function Et(e,t,n={}){const{markDef:i,encoding:r,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;s===void 0&&(l=l??Se(e,i,a,{vgChannel:o,ignoreVgConfig:!0}),l!==void 0&&(s=nt(l)));const u=r[e];return vf(t,u,o??e,c=>kI({channel:e,channelDef:c,markDef:i,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s}))}function BM(e,t={filled:void 0}){var n,i,r,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=(n=t.filled)!==null&&n!==void 0?n:Se("filled",o,l),f=ae(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=(r=(i=Se(c===!0?"color":void 0,o,l,{vgChannel:"fill"}))!==null&&i!==void 0?i:l.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(a=Se(c===!1?"color":void 0,o,l,{vgChannel:"stroke"}))!==null&&a!==void 0?a:l.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:nt(d)}:{}),h?{stroke:nt(h)}:{});return o.color&&(c?o.fill:o.stroke)&&j(KN("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),Et("color",e,{vgChannel:p,defaultValue:c?d:h})),Et("fill",e,{defaultValue:s.fill?d:void 0})),Et("stroke",e,{defaultValue:s.stroke?h:void 0}))}function yf(e,t){const n=Une(e),i=t[n];return i||void 0}function Yt(e,t,{defaultPos:n,vgChannel:i,isMidPoint:r}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[sr(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=yf(e,o),p=x2({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),g=!u&&ur(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:Foe({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:r,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return g?{[i||e]:g}:void 0}function Foe(e){const{channel:t,channelDef:n,isMidPoint:i,scaleName:r,stack:a,offset:o,markDef:s,config:l}=e;if(se(n)&&a&&t===a.fieldChannel){if(q(n)){const u=df({channel:t,fieldDef:n,isMidPoint:i,markDef:s,stack:a,config:l});if(u!==void 0)return Rg({scaleName:r,fieldOrDatumDef:n,startSuffix:"start",band:u,offset:o})}return as(n,r,{suffix:"end"},{offset:o})}return Ux(e)}function x2({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:a,config:o}=e;return()=>{const s=is(n),l=za(n),u=Se(n,a,o,{vgChannel:l});if(u!==void 0)return cf(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!ae([at.LOG,at.TIME,at.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return s==="y"?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[lr(n)];return Object.assign(Object.assign({},c),{mult:.5})}}return}}const Noe={left:"x",center:"xc",right:"x2"},Ioe={top:"y",middle:"yc",bottom:"y2"};function UM(e,t,n,i="middle"){if(e==="radius"||e==="theta")return za(e);const r=e==="x"?"align":"baseline",a=Se(r,t,n);return e==="x"?Noe[a||(i==="top"?"left":"center")]:Ioe[a||i]}function Kg(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?qM(e,t,{defaultPos:n,defaultPos2:i}):Yt(e,t,{defaultPos:n})}function qM(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:a}=t,o=sr(e),s=lr(e),l=Moe(t,i,o),u=l[s]?UM(e,r,a):za(e);return Object.assign(Object.assign({},Yt(e,t,{defaultPos:n,vgChannel:u})),l)}function Moe(e,t,n){const{encoding:i,mark:r,markDef:a,stack:o,config:s}=e,l=is(n),u=lr(n),c=za(n),f=i[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=n in i||n in a?yf(n,e.markDef):yf(l,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude))return{[c]:{field:e.getName(n)}};const g=joe({channel:n,channelDef:f,channel2Def:i[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:Qg(n,a)||Qg(n,{[n]:Bg(n,a,s.style),[u]:Bg(u,a,s.style)})||Qg(n,s[r])||Qg(n,s.mark)||{[c]:x2({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function joe({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){return se(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0)?as(t,a,{suffix:"start"},{offset:l}):Ux({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:i,config:r,offset:l,defaultRef:u})}function Qg(e,t){const n=lr(e),i=za(e);return t[i]!==void 0?{[i]:cf(e,t[i])}:t[e]!==void 0?{[i]:cf(e,t[e])}:t[n]?{[n]:cf(e,t[n])}:void 0}function Ja(e,t,n){var i,r,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=sr(t),d=lr(t),h=l[t],p=l[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,v=e.scaleName(t),y=u.orient,b=(r=(i=l[d])!==null&&i!==void 0?i:l.size)!==null&&r!==void 0?r:Se("size",u,s,{vgChannel:d}),E=n==="bar"&&(t==="x"?y==="vertical":y==="horizontal");if(q(h)&&(Me(h.bin)||on(h.bin)||h.timeUnit&&!p)&&!b&&!Tn(m)){const x=df({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),k=(a=e.component.axes[t])===null||a===void 0?void 0:a[0],w=(o=k==null?void 0:k.get("translate"))!==null&&o!==void 0?o:.5;return zoe({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:v,band:x,axisTranslate:w,spacing:ur(t)?Se("binSpacing",u,s):void 0,reverse:g.get("reverse"),config:s})}else return(se(h)&&Tn(m)||E)&&!p?Poe(n,h,t,e):qM(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function Loe(e,t,n,i,r,a){if(i){const l=i.get("type");if(l==="point"||l==="band"){if(r[e].discreteBandSize!==void 0)return{value:r[e].discreteBandSize};if(l===at.POINT){const u=i.get("range");return qa(u)&&Ce(u.step)?{value:u.step-2}:{value:g2-2}}else return{scale:n,band:a}}else return{value:r[e].continuousBandSize}}const o=Gg(r.view,t),s=rt(r[e].discreteBandSize,o-2);return s!==void 0?{value:s}:void 0}function Poe(e,t,n,i){var r;const{markDef:a,encoding:o,config:s,stack:l}=i,u=a.orient,c=i.scaleName(n),f=i.getScaleComponent(n),d=lr(n),h=sr(n),p=u==="horizontal"&&n==="y"||u==="vertical"&&n==="x",g=Se(p?"size":d,a,s,{vgChannel:d});let m;(o.size||g!==void 0)&&(p?m=Et("size",i,{vgChannel:d,defaultValue:g}):j(Oie(a.type)));const v=(r=se(t)?df({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)!==null&&r!==void 0?r:1;m=m||{[d]:Loe(e,d,c,f,s,v)};const y=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[d]),b=UM(n,a,s,y?"middle":"top"),E=yf(n,a),x=Ux({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:E,defaultRef:x2({model:i,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:y?.5:(1-v)/2});if(d)return Object.assign({[b]:x},m);{const k=za(h),w=m[d],A=E?Object.assign(Object.assign({},w),{offset:E}):w;return{[b]:x,[k]:M(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:A})]:Object.assign(Object.assign({},x),{offset:A})}}}function bf(e,t,n,i,r){if(DN(e))return 0;const a=e==="x"||e==="y2"?-t/2:t/2;if(oe(n)){const o=pf(r);return{signal:`${n.signal} ? ${i-a}${o?"-"+o:""} : ${i+a}${o?"+"+o:""}`}}else{if(oe(r)){const o=i+(n?-a:a);return{signal:`${o||""}${n?" - ":o?" + ":""}${r.signal}`}}return r=r||0,i+(n?-r-a:+r+a)}}function zoe({fieldDef:e,fieldDef2:t,channel:n,band:i,scaleName:r,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=sr(n),f=za(n),d=za(c),h=yf(n,a);if(Me(e.bin)||e.timeUnit)return{[d]:WM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:(1-i)/2,offset:bf(c,o,l,s,h),config:u}),[f]:WM({channel:n,fieldDef:e,scaleName:r,markDef:a,band:1-(1-i)/2,offset:bf(n,o,l,s,h),config:u})};if(on(e.bin)){const p=as(e,r,{},{offset:bf(c,o,l,s,h)});if(q(t))return{[d]:p,[f]:as(t,r,{},{offset:bf(n,o,l,s,h)})};if(lf(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${U(e,{expr:"datum"})} + ${e.bin.step})`,offset:bf(n,o,l,s,h)}}}j(nI(c));return}function WM({channel:e,fieldDef:t,scaleName:n,markDef:i,band:r,offset:a,config:o}){const s=Rg({scaleName:n,fieldOrDatumDef:t,band:r,offset:a});return EI({fieldDef:t,channel:e,markDef:i,ref:s,config:o})}const Boe=new Set(["aria"]);function oi(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?BM(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Uoe(e.markDef,t)),GM(e,"fill",n)),GM(e,"stroke",i)),Et("opacity",e)),Et("fillOpacity",e)),Et("strokeOpacity",e)),Et("strokeWidth",e)),Et("strokeDash",e)),LM(e)),w2(e,"href")),$oe(e))}function GM(e,t,n){const{config:i,mark:r,markDef:a}=e,o=Se("invalid",a,i);if(o==="hide"&&n&&!Zo(r)){const s=qoe(e,{invalid:!0,channels:Sg});if(s)return{[t]:[{test:s,value:null},...G(n)]}}return n?{[t]:n}:{}}function Uoe(e,t){return fre.reduce((n,i)=>(!Boe.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=nt(e[i])),n),{})}function qoe(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>qx(o,t)).join(` ${a} `)}return}function E2(e){const{config:t,markDef:n}=e,i=Se("invalid",n,t);if(i){const r=Woe(e,{channels:ri});if(r)return{defined:{signal:r}}}return{}}function Woe(e,{invalid:t=!1,channels:n}){const i=n.reduce((a,o)=>{const s=e.getScaleComponent(o);if(s){const l=s.get("type"),u=e.vgField(o,{expr:"datum"});u&&ai(l)&&(a[u]=!0)}return a},{}),r=z(i);if(r.length>0){const a=t?"||":"&&";return r.map(o=>qx(o,t)).join(` ${a} `)}return}function HM(e,t){return t!==void 0?{[e]:nt(t)}:void 0}const k2="voronoi",YM={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(k2)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,a=e.mark;if(Zo(a))return j(Zne(a)),n;const o={name:e.getName(k2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},LM(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach((u,c)=>{var f;const d=(f=u.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?s=c:d.indexOf(k2)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}};class Re{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){if(this._children.indexOf(e)>-1){console.warn("Attempt to add the same child twice.");return}t!==void 0?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const n of this._children)n.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class ln extends Re{constructor(e,t,n,i){super(e,t);this.type=n,this.refCounts=i,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor();return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return this._hash===void 0&&(this._hash=`Output ${lne()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}class Gr extends Re{constructor(e,t){super(e);this.formula=t}clone(){return new Gr(null,ge(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{const{field:o,timeUnit:s}=r,l=Ke(t)?t.encoding[sr(a)]:void 0,u=Ke(t)&&Yx(a,r,l,t.stack,t.markDef,t.config);if(s){const c=U(r,{forAs:!0});i[we({as:c,field:o,timeUnit:s})]=Object.assign({as:c,field:o,timeUnit:s},u?{band:!0}:{})}return i},{});return Ne(n)?null:new Gr(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:i}=n,r=Z(n,["timeUnit"]),a=sn(i),o=Object.assign(Object.assign({},r),{timeUnit:a});return new Gr(e,{[we(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)(!this.formula[t]||e.formula[t].band)&&(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(Fa(this.formula).map(e=>e.as))}dependentFields(){return new Set(Fa(this.formula).map(e=>e.field))}hash(){return`TimeUnit ${we(this.formula)}`}assemble(){const e=[];for(const t of Fa(this.formula)){const{field:n,as:i,timeUnit:r}=t,a=sn(r),{unit:o,utc:s}=a,l=Z(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:Na(n),type:"timeunit"},o?{units:Fx(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return e}}const wf="_tuple_fields";class Goe{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const Hoe={has:()=>!0,parse:(e,t,n)=>{var i,r,a;const o=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new Goe(),l={},u={},c=new Set(),f=(d,h)=>{const p=h==="visual"?d.channel:d.field;let g=qe(`${o}_${p}`);for(let m=1;c.has(g);m++)g=qe(`${o}_${p}_${m}`);return c.add(g),{[h]:g}};if(!n.fields&&!n.encodings){const d=e.config.selection[n.type];if(n.init)for(const h of G(n.init))for(const p of z(h))zne(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(j('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=d.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=d.encodings,n.fields=d.fields}for(const d of(r=n.fields)!==null&&r!==void 0?r:[]){const h={type:"E",field:d};h.signals=Object.assign({},f(h,"data")),s.items.push(h),s.hasField[d]=h}for(const d of(a=n.encodings)!==null&&a!==void 0?a:[]){const h=e.fieldDef(d);if(h){let p=h.field;if(h.aggregate){j(Qne(d,h.aggregate));continue}else if(!p){j(GN(d));continue}if(h.timeUnit){p=e.vgField(d);const g={timeUnit:h.timeUnit,as:p,field:h.field};u[we(g)]=g}if(!l[p]){let g="E";if(t.type==="interval"){const v=e.getScaleComponent(d).get("type");ai(v)&&(g="R")}else h.bin&&(g="R-RE");const m={field:p,channel:d,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),s.items.push(l[p]=m),s.hasField[p]=s.hasChannel[d]=l[p]}}else j(GN(d))}if(n.init){const d=h=>s.items.map(p=>h[p.channel]!==void 0?h[p.channel]:h[p.field]);if(n.type==="interval")t.init=d(n.init);else{const h=G(n.init);t.init=h.map(d)}}Ne(u)||(s.timeUnit=new Gr(null,u))},signals:(e,t,n)=>{const i=t.name+wf,r=n.filter(a=>a.name===i);return r.length>0?n:n.concat({name:i,value:t.project.items.map(a=>{const o=Z(a,["signals","hasLegend"]);return o.field=Na(o.field),o})})}},VM={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!c2(e.bind),parse:(e,t,n,i)=>{i.on||delete t.events,i.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,a=t.bind,o=t.init&&t.init[0],s=YM.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((l,u)=>{var c,f;const d=qe(`${i}_${l.field}`),h=n.filter(p=>p.name===d);h.length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Ul(o[u])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${B(l.field)}] : null`}]:[],bind:(f=(c=a[l.field])!==null&&c!==void 0?c:a[l.channel])!==null&&f!==void 0?f:a}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.filter(u=>u.name===i+gr)[0],o=i+wf,s=r.items.map(u=>qe(`${i}_${u.field}`)),l=s.map(u=>`${u} !== null`).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},Zg="_toggle",XM={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Zg,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+gr,i=t.name+Zg;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Hr(e)}}, `)+`${i} ? ${n} : null`}},Yoe={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=Y(n.clear)?Yo(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(VM.has(t))for(const i of t.project.items){const r=n.findIndex(a=>a.name===qe(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,a){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:a})}if(t.type==="interval")for(const r of t.project.items){const a=n.findIndex(o=>o.name===r.signals.visual);if(i(a,"[0, 0]"),a===-1){const o=n.findIndex(s=>s.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(a=>a.name===t.name+gr);i(r,"null"),XM.has(t)&&(r=n.findIndex(a=>a.name===t.name+Zg),i(r,"false"))}return n}},Ka={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Ua(r))continue;const a=e.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!ai(o)){j(tie);continue}const s={selection:t.name,field:i.field};a.set("selectionExtent",s,!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(s=>s.name===o.signals.data).length===0);if(!e.parent||A2(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let a=r.update;if(a.indexOf(oj)>=0)r.update=`{${i.map(o=>`${B(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const s=`${B(o.field)}: ${o.signals.data}`;a.indexOf(s)<0&&(a=`${a.substring(0,a.length-1)}, ${s}}`)}r.update=a}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!A2(e))for(const i of t.scales){const r=n.filter(a=>a.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function _2(e,t){const n=B(e.scaleName(t));return`domain(${n})`}function A2(e){var t;return e.parent&&Vl(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:A2(e.parent.parent))}const JM={has:e=>{const t=e.resolve==="global"&&e.bind&&c2(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==Bl;return t&&!n&&j(nie),t&&n},parse:(e,t,n,i)=>{var r;if(i.on||delete t.events,i.clear||delete t.clear,i.on||i.clear){const s='event.item && indexof(event.item.mark.role, "legend") < 0';for(const l of t.events)l.filter=G((r=l.filter)!==null&&r!==void 0?r:[]),l.filter.indexOf(s)<0&&l.filter.push(s)}const a=f2(t.bind)?t.bind.legend:"click",o=Y(a)?Yo(a,"view"):G(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=f2(t.bind)&&t.bind.legend,a=o=>s=>{const l=ge(s);return l.markname=o,l};for(const o of t.project.items){if(!o.hasLegend)continue;const s=`${qe(o.field)}_legend`,l=`${i}_${s}`,u=n.filter(c=>c.name===l);if(u.length===0){const c=r.merge.map(a(`${s}_symbols`)).concat(r.merge.map(a(`${s}_labels`))).concat(r.merge.map(a(`${s}_entries`)));n.unshift(Object.assign(Object.assign({name:l},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${l}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,a=n.find(d=>d.name===i+gr),o=i+wf,s=r.items.filter(d=>d.hasLegend).map(d=>qe(`${i}_${qe(d.field)}_legend`)),l=s.map(d=>`${d} !== null`).join(" && "),u=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map(d=>({signal:d})),update:u}):s.length>0&&(a.update=u,delete a.value,delete a.on);const c=n.find(d=>d.name===i+Zg),f=f2(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function Voe(e,t,n){var i;const r=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;ps(e,a=>{var o,s;const l=(o=a.project.hasField[r])!==null&&o!==void 0?o:a.project.hasChannel[t];if(l&&JM.has(a)){const u=(s=n.get("selections"))!==null&&s!==void 0?s:[];u.push(a.name),n.set("selections",u,!1),l.hasLegend=!0}})}const KM="_translate_anchor",QM="_translate_delta",Xoe={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ka.has(t),a=i+KM,{x:o,y:s}=t.project.hasChannel;let l=Yo(t.translate,"scope");return r||(l=l.map(u=>(u.between[0].markname=i+xf,u))),n.push({name:a,value:{},on:[{events:l.map(u=>u.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(r?_2(e,He):`slice(${o.signals.visual})`):"")+(s!==void 0?", extent_y: "+(r?_2(e,ct):`slice(${s.signals.visual})`):"")+"}"}]},{name:i+QM,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),o!==void 0&&ZM(e,t,o,"width",n),s!==void 0&&ZM(e,t,s,"height",n),n}};function ZM(e,t,n,i,r){var a;const o=t.name,s=o+KM,l=o+QM,u=n.channel,c=Ka.has(t),f=r.filter(E=>E.name===n.signals[c?"data":"visual"])[0],d=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(u),p=h.get("type"),g=c&&u===He?"-":"",m=`${s}.extent_${u}`,v=`${g}${l}.${u} / `+(c?`${d}`:`span(${m})`),y=c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear",b=`${y}(${m}, ${v}`+(c&&p==="pow"?`, ${(a=h.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?b:`clampRange(${b}, 0, ${d})`})}const ej="_zoom_anchor",tj="_zoom_delta",Joe={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ka.has(t),a=i+tj,{x:o,y:s}=t.project.hasChannel,l=B(e.scaleName(He)),u=B(e.scaleName(ct));let c=Yo(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+xf,f))),n.push({name:i+ej,on:[{events:c,update:r?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&nj(e,t,o,"width",n),s!==void 0&&nj(e,t,s,"height",n),n}};function nj(e,t,n,i,r){var a;const o=t.name,s=n.channel,l=Ka.has(t),u=r.filter(y=>y.name===n.signals[l?"data":"visual"])[0],c=e.getSizeSignalRef(i).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?_2(e,s):u.name,p=o+tj,g=`${o}${ej}.${s}`,m=l?d==="log"?"zoomLog":d==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=`${m}(${h}, ${g}, ${p}`+(l&&d==="pow"?`, ${(a=f.get("exponent"))!==null&&a!==void 0?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?v:`clampRange(${v}, 0, ${c})`})}const Koe=[Hoe,XM,Ka,JM,Xoe,Joe,VM,YM,Yoe];function em(e,t){for(const n of Koe)n.has(e)&&t(n)}function Ul(e,t=!0,n=It){if(M(e)){const i=e.map(r=>Ul(r,t,n));return t?`[${i.join(", ")}]`:i}else if(jl(e))return n(t?uf(e):tre(e));return t?n(JSON.stringify(e)):e}function Qoe(e,t){return ps(e,(n,i)=>{const r=n.name;let a=i.modifyExpr(e,n);t.push(...i.signals(e,n)),em(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(a=o.modifyExpr(e,n,a))}),t.push({name:r+lse,on:[{events:{signal:n.name+gr},update:`modify(${B(n.name+hs)}, ${a})`}]})}),S2(t)}function Zoe(e,t){if(e.component.selection&&z(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Yo("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return S2(t)}function ese(e,t){let n=!1;if(ps(e,(i,r)=>{const a=i.name,o=B(a+hs),s=t.filter(l=>l.name===a);if(s.length===0){const l=i.resolve==="global"?"union":i.resolve,u=i.type==="multi"?", true)":")";t.push({name:i.name,update:`${oj}(${o}, ${B(l)}${u}`})}n=!0,r.topLevelSignals&&(t=r.topLevelSignals(e,i,t)),em(i,l=>{l.topLevelSignals&&(t=l.topLevelSignals(e,i,t))})}),n){const i=t.filter(r=>r.name==="unit");i.length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}return S2(t)}function tse(e,t){const n=[...t];return ps(e,i=>{const r={name:i.name+hs};if(i.init){const o=i.project.items.map(l=>{const u=Z(l,["signals"]);return u}),s=i.init.map(l=>Ul(l,!1));r.values=i.type==="interval"?[{unit:Hr(e,{escape:!1}),fields:o,values:s}]:s.map(l=>({unit:Hr(e,{escape:!1}),fields:o,values:l}))}const a=n.filter(o=>o.name===i.name+hs);a.length||n.push(r)}),n}function ij(e,t){return ps(e,(n,i)=>{t=i.marks?i.marks(e,n,t):t,em(n,r=>{r.marks&&(t=r.marks(e,n,t))})}),t}function nse(e,t){for(const n of e.children)Ke(n)&&(t=ij(n,t));return t}function ise(e,t){const n=t.selection,i=e.getSelectionComponent(n,qe(n));return{signal:cj(i,t)}}function S2(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const xf="_brush",O2="_scale_trigger",rse={signals:(e,t)=>{const n=t.name,i=n+wf,r=Ka.has(t),a=[],o=[],s=[];if(t.translate&&!r){const c=`!event.item || event.item.mark.name !== ${B(n+xf)}`;rj(t,(f,d)=>{var h;const p=G((h=d.between[0].filter)!==null&&h!==void 0?h:d.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==He&&d!==ct){j("Interval selections only support x and y encoding channels.");return}const h=t.init?t.init[f]:null,p=ase(e,t,c,h),g=c.signals.data,m=c.signals.visual,v=B(e.scaleName(d)),y=e.getScaleComponent(d).get("type"),b=ai(y)?"+":"";a.push(...p),o.push(g),s.push({scaleName:e.scaleName(d),expr:`(!isArray(${g}) || (${b}invert(${v}, ${m})[0] === ${b}${g}[0] && ${b}invert(${v}, ${m})[1] === ${b}${g}[1]))`})}),r||a.push({name:n+O2,value:{},on:[{events:s.map(c=>({scale:c.scaleName})),update:s.map(c=>c.expr).join(" && ")+` ? ${n+O2} : {}`}]});const l=t.init,u=`unit: ${Hr(e)}, fields: ${i}, values`;return a.concat(Object.assign(Object.assign({name:n+gr},l?{init:`{${u}: ${Ul(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>{const n=t.name+gr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Hr(e)}}`)},marks:(e,t,n)=>{const i=t.name,{x:r,y:a}=t.project.hasChannel,o=r&&r.signals.visual,s=a&&a.signals.visual,l=`data(${B(t.name+hs)})`;if(Ka.has(t))return n;const u={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:a!==void 0?{signal:`${s}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:a!==void 0?{signal:`${s}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of z(u))u[m]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${Hr(e)}`},u[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=Z(c,["fill","fillOpacity","cursor"]),g=z(p).reduce((m,v)=>(m[v]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,a!==void 0&&`${s}[0] !== ${s}[1]`].filter(y=>y).join(" && "),value:p[v]},{value:null}],m),{});return[{name:i+xf+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:i+xf,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),g)}}]}};function ase(e,t,n,i){const r=n.channel,a=n.signals.visual,o=n.signals.data,s=Ka.has(t),l=B(e.scaleName(r)),u=e.getScaleComponent(r),c=u?u.get("type"):void 0,f=g=>`scale(${l}, ${g})`,d=e.getSizeSignalRef(r===He?"width":"height").signal,h=`${r}(unit)`,p=rj(t,(g,m)=>[...g,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]);return p.push({events:{signal:t.name+O2},update:ai(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},i?{init:Ul(i,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:Ul(i)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}function rj(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(j(`${i} is not an ordered event stream for interval selections.`),n),[])}function aj(e,t){const n=t.name,i=n+wf,r=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=r.items.map(u=>{const c=e.fieldDef(u.channel);return c&&c.bin?`[${a}[${B(e.vgField(u.channel,{}))}], ${a}[${B(e.vgField(u.channel,{binSuffix:"end"}))}]]`:`${a}[${B(u.field)}]`}).join(", "),s=`unit: ${Hr(e)}, fields: ${i}, values`,l=t.events;return[{name:n+gr,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const ose={signals:aj,modifyExpr:(e,t)=>{const n=t.name+gr;return n+", "+(t.resolve==="global"?"null":`{unit: ${Hr(e)}}`)}},sse={signals:aj,modifyExpr:(e,t)=>{const n=t.name+gr;return n+", "+(t.resolve==="global"?"true":`{unit: ${Hr(e)}}`)}},hs="_store",gr="_tuple",lse="_modify",oj="vlSelectionResolve",use={single:sse,multi:ose,interval:rse};function ps(e,t){const n=e.component.selection;if(n)for(const i of Fa(n)){const r=t(i,use[i.type]);if(r===!0)break}}function cse(e){let t=e.parent;for(;t&&!Fi(t);)t=t.parent;return t}function Hr(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=cse(e);if(i){const{facet:r}=i;for(const a of ii)r[a]&&(n+=` + '__facet_${a}_' + (facet[${B(i.vgField(a))}])`)}return n}function T2(e){let t=!1;return ps(e,n=>{t=t||n.project.items.some(i=>i.field===Bl)}),t}function C2(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...C2(e.object)),t.push(...C2(e.property))),t)}function sj(e){return e.object.type==="MemberExpression"?sj(e.object):e.object.name==="datum"}function lj(e){const t=TR(e),n=new Set();return t.visit(i=>{i.type==="MemberExpression"&&sj(i)&&n.add(C2(i).slice(1).join("."))}),n}class Ef extends Re{constructor(e,t,n){super(e);this.model=t,this.filter=n,this.expr=tm(this.model,this.filter,this),this._dependentFields=lj(this.expr)}clone(){return new Ef(null,this.model,ge(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set()}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function fse(e,t){var n;const i={},r=e.config.selection;for(const a of z(t??{})){const o=ge(t[a]),s=r[o.type],l=Z(s,["fields","encodings"]);for(const f in l){if(f==="encodings"&&o.fields||f==="fields"&&o.encodings)continue;f==="mark"&&(o[f]=Object.assign(Object.assign({},l[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=l[f])!==null&&n!==void 0?n:o[f])}const u=qe(a),c=i[u]=Object.assign(Object.assign({},o),{name:u,events:Y(o.on)?Yo(o.on,"scope"):ge(o.on)});em(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[a])})}return i}function uj(e,t,n,i="datum"){const r=[];function a(s){const l=qe(s),u=e.getSelectionComponent(l,s),c=B(l+hs);if(u.project.timeUnit){const f=n??e.component.data.raw,d=u.project.timeUnit.clone();f.parent?d.insertAsParentOf(f):f.parent=d}return u.empty!=="none"&&r.push(c),`vlSelectionTest(${c}, ${i}`+(u.resolve==="global"?")":`, ${B(u.resolve)})`)}const o=nf(t,a);return(r.length?"!("+r.map(s=>`length(data(${s}))`).join(" || ")+") || ":"")+`(${o})`}function cj(e,t){const n=t.encoding;let i=t.field;if(!n&&!i)i=e.project.items[0].field,e.project.items.length>1&&j(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(i)}.`);else if(n&&!i){const r=e.project.items.filter(a=>a.channel===n);!r.length||r.length>1?(i=e.project.items[0].field,j((r.length?"Multiple ":"No ")+`matching ${B(n)} encoding found for selection ${B(t.selection)}. Using "field": ${B(i)}.`)):i=r[0].field}return`${e.name}[${B(i)}]`}function dse(e,t){ps(e,n=>{const i=n.name,r=e.getName(`lookup_${i}`);e.component.data.outputNodes[r]=n.materialized=new ln(new Ef(t,e,{selection:i}),r,"lookup",e.component.data.outputNodeRefCounts)})}function tm(e,t,n){return nf(t,i=>Y(i)?i:hre(i)?uj(e,i.selection,n):pI(i))}function hse(e,t){return e?M(e)&&!Ya(e)?e.map(n=>qI(n,t)).join(", "):e:void 0}function $2(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function kf(e,t,n,i={header:!1}){var r,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=Z(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s)return;for(const p in h){const g=fne[p],m=h[p];if(g&&g!==t&&g!=="both")delete h[p];else if(yx(m)){const{condition:v}=m,y=Z(m,["condition"]),b=G(v),E=yN[p];if(E){const{vgProp:x,part:k}=E,w=[...b.map(A=>{const{test:_}=A,O=Z(A,["test"]);return Object.assign({test:tm(null,_)},O)}),y];$2(h,k,x,w),delete h[p]}else if(E===null){const x={signal:b.map(k=>{const{test:w}=k,A=Z(k,["test"]);return`${tm(null,w)} ? ${YI(A)} : `}).join("")+YI(y)};h[p]=x}}else if(oe(m)){const v=yN[p];if(v){const{vgProp:y,part:b}=v;$2(h,b,y,m),delete h[p]}}}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:p}=h.encode;h.encode=Object.assign({},p?{grid:p}:{}),Ne(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:rt(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let g=c;((a=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||a===void 0?void 0:a.update)&&oe(h.encode.labels.update.text)&&(g=Nl(c,"datum.label",h.encode.labels.update.text.signal)),$2(h,"labels","text",{signal:g})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const g of bN)e.hasAxisPart(g)||delete h.encode[g];Ne(h.encode)&&delete h.encode}const p=hse(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},p?{title:p}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:rt(d,0)})}}function fj(e){const{axes:t}=e.component,n=[];for(const i of ri)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const a=i==="x"?"height":"width",o=e.getSizeSignalRef(a).signal;a!==o&&n.push({name:a,update:o})}}return n}function pse(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>kf(r,"grid",t)),...i.map(r=>kf(r,"grid",t)),...n.map(r=>kf(r,"main",t)),...i.map(r=>kf(r,"main",t))].filter(r=>r)}const dj={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},hj={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},gse=z(dj),mse=z(hj);function pj(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const a=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},s=t[n==="x"?"axisTop":"axisRight"]||{},l=new Set([...z(o),...z(s)]),u={};for(const c of l.values())u[c]={signal:`${i.signal} === "${a}" ? ${pf(o[c])} : ${pf(s[c])}`};return u}return t[r]})])}function vse(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:Are(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],a=e==="x"?"axisX":"axisY",o=oe(n)?"axisOrient":"axis"+dg(n),s=[...r,...r.map(u=>a+u.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:pj(s,i,e,n),vgAxisConfig:pj(l,i,e,n),axisConfigStyle:yse([...l,...s],i)}}function yse(e,t){var n;const i=[{}];for(const r of e){let a=(n=t[r])===null||n===void 0?void 0:n.style;if(a){a=G(a);for(const o of a)i.push(t.style[o])}}return Object.assign.apply(null,i)}function D2(e,t,n,i={}){var r;const a=XI(e,n,t.style);if(a!==void 0)return{configFrom:"style",configValue:a};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const gj={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return SI(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return OI(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return q(e)&&on(e.bin)?!1:(i=t.grid)!==null&&i!==void 0?i:bse(n,e)},gridScale:({model:e,channel:t})=>wse(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||vj(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||mj(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:Ese(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:kse(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var a;const o=e==="x"?"width":e==="y"?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return(a=n.tickCount)!==null&&a!==void 0?a:Ase({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=yj(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),a=n==="x"?"x2":"y2",o=t.fieldDef(a);return KI(r?[NI(r)]:[],q(o)?[NI(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Sse(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:Ose(n,t)}};function bse(e,t){return!Tn(e)&&q(t)&&!Me(t==null?void 0:t.bin)}function wse(e,t){const n=t==="x"?"y":"x";return e.getScaleComponent(n)?e.scaleName(n):void 0}function xse(e,t,n,i,r){const a=t==null?void 0:t.labelAngle;if(a!==void 0)return oe(a)?a:hg(a);{const{configValue:o}=D2("labelAngle",e.config,t==null?void 0:t.style,r);return o!==void 0?hg(o):n===He&&ae([zx,Px],i.type)?270:void 0}}function R2(e){return`(((${e.signal} % 360) + 360) % 360)`}function mj(e,t,n,i){if(e!==void 0)if(n==="x"){if(oe(e)){const r=R2(e),a=oe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${a} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(oe(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)===(t==="top")?"bottom":"top"}else{if(oe(e)){const r=R2(e),a=oe(t)?`(${t.signal} === "left")`:t==="left",o=i?'"middle"':"null";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${o} : (45 <= ${r} && ${r} <= 135) === ${a} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(oe(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)===(t==="left")?"top":"bottom"}return}function vj(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,a=i?"bottom":"left";if(oe(e)){const o=R2(e),s=oe(t)?`(${t.signal} === "${a}")`:t===a;return{signal:`(${r?"("+o+" + 90)":o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${s} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(oe(t)){const o=r<e&&e<180+r?"===":"!==",s=`${t.signal} ${o} "${a}"`;return{signal:`${s} ? "left" : "right"`}}return(r<e&&e<180+r)===(t===a)?"left":"right"}function Ese(e,t){return t==="x"&&ae(["quantitative","temporal"],e)?!0:void 0}function kse(e,t){return e!=="nominal"?t==="log"?"greedy":!0:void 0}function _se(e){return e==="x"?"bottom":"left"}function Ase({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!Tn(t)&&t!=="log"){if(q(e)){if(Me(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&ae(["month","hours","day","quarter"],(r=sn(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}function yj(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),a=i?i.title:void 0,o=r?r.title:void 0;return a&&o?QI(a,o):a||(o||(a!==void 0?a:o!==void 0?o:void 0))}function Sse(e,t){const n=e.values;return M(n)?GI(t,n):oe(n)?n:void 0}function Ose(e,t){return e==="rect"&&LI(t)?1:0}class _f extends Re{constructor(e,t){super(e);this.transform=t,this._dependentFields=lj(this.transform.calculate)}clone(){return new _f(null,ge(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef((n,i)=>{if(!Kx(n))return;if(FI(n.sort)){const{field:r,timeUnit:a}=n,o=n.sort,s=o.map((l,u)=>`${pI({field:r,timeUnit:a,equal:l})} ? ${u} : `).join("")+o.length;e=new _f(e,{calculate:s,as:ql(n,i,{forAs:!0})})}}),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${we(this.transform)}`}}function ql(e,t,n){return U(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function nm(e,t){return ae(["top","bottom"],t)?"column":ae(["left","right"],t)||e==="row"?"row":"column"}function Wl(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return rt(((t==null?void 0:t.header)||{})[e],r[e],n.header[e])}function im(e,t,n,i){const r={};for(const a of e){const o=Wl(a,t,n,i);o!==void 0&&(r[a]=o)}return r}const F2=["row","column"],N2=["header","footer"];function Tse(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=im(["titleAnchor","titleAngle","titleOrient"],r,i,t),l=nm(t,s),u=hg(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),wj(u,l)),bj(l,u,a)),xj(i,r,t,gse,dj))}}function bj(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=vj(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function wj(e,t){const n=mj(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Cse(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of N2)if(n[r])for(const a of n[r]){const o=Dse(e,t,r,n,a);o!=null&&i.push(o)}return i}function $se(e,t){var n;const{sort:i}=e;return fr(i)?{field:U(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:M(i)?{field:ql(e,t,{expr:"datum"}),order:"ascending"}:{field:U(e,{expr:"datum"}),order:i??"ascending"}}function I2(e,t,n){const{format:i,formatType:r,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=im(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),u=Wx({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=nm(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?Nl(Nl(l,"datum.label",u),"datum.value",U(e,{expr:"parent"})):u}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),wj(a,c)),bj(c,a,o)),xj(n,e,t,mse,hj))}function Dse(e,t,n,i,r){if(r){let a=null;const{facetFieldDef:o}=i,s=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=im(["labelOrient"],o,s,t);(t==="row"&&!ae(["top","bottom"],f)||t==="column"&&!ae(["left","right"],f))&&(a=I2(o,t,s))}const l=Fi(e)&&!ff(e.facet),u=r.axes,c=(u==null?void 0:u.length)>0;if(a||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:$se(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const Rse={column:{start:0,end:1},row:{start:1,end:0}};function Fse(e,t){return Rse[t][e]}function Nse(e,t){const n={};for(const i of ii){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:a,titleOrient:o}=im(["titleAnchor","titleOrient"],r.facetFieldDef,t,i),s=nm(i,o),l=Fse(a,s);l!==void 0&&(n[s]=l)}}return Ne(n)?void 0:n}function xj(e,t,n,i,r){const a={};for(const o of i){if(!r[o])continue;const s=Wl(o,t,e,n);s!==void 0&&(a[r[o]]=s)}return a}function M2(e){return[...rm(e,"width"),...rm(e,"height"),...rm(e,"childWidth"),...rm(e,"childHeight")]}function rm(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const a=e.getScaleComponent(n);if(a){const o=a.get("type"),s=a.get("range");if(Tn(o)&&qa(s)){const l=e.scaleName(n);if(Fi(e.parent)){const u=e.parent.component.resolve;if(u.scale[n]==="independent")return[Ej(l,s)]}return[Ej(l,s),{name:r,update:kj(l,a,`domain('${l}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const a=r.endsWith("width"),o=a?"containerSize()[0]":"containerSize()[1]",s=p2(e.config.view,a?"width":"height"),l=`isFinite(${o}) ? ${o} : ${s}`;return[{name:r,init:l,on:[{update:l,events:"window:resize"}]}]}else return[{name:r,value:i}]}function Ej(e,t){return{name:e+"_step",value:t.step}}function kj(e,t,n){const i=t.get("type"),r=t.get("padding"),a=rt(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${o}, ${a}) * ${e}_step`}function _j(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function Aj(e,t){return z(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),vf(t,r,i,a=>oe(a)?a:{value:a.value}))},{})}function Ise(e,t){if(Vl(t)||Fi(t))return"shared";if(X2(t))return ur(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function j2(e,t){const n=e.scale[t],i=ur(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&j(Rie(t)),"independent"):e[i][t]||"shared"}const Mse=Object.assign(Object.assign({},Aae),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),Sj=z(Mse);class jse extends Va{}const Oj={symbols:Lse,gradient:Pse,labels:zse,entries:Bse};function Lse(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:a}){var o,s,l,u,c;if(a!=="symbol")return;const{markDef:f,encoding:d,config:h,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},rae({},n,yne)),BM(n,{filled:g}));const v=(o=Tj(d.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(i==="fill"||g&&i===Sn)delete m.fill;else if(m.fill.field)r.get("symbolFillColor")?delete m.fill:(m.fill=nt((s=h.legend.symbolBaseFillColor)!==null&&s!==void 0?s:"black"),m.fillOpacity=nt(v??1));else if(M(m.fill)){const y=(c=(u=L2((l=d.fill)!==null&&l!==void 0?l:d.color))!==null&&u!==void 0?u:f.fill)!==null&&c!==void 0?c:g&&f.color;y&&(m.fill=nt(y))}}if(m.stroke){if(i==="stroke"||!g&&i===Sn)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(M(m.stroke)){const y=rt(L2(d.stroke||d.color),f.stroke,g?f.color:void 0);y&&(m.stroke={value:y})}}if(i!==Ur){const y=q(t)&&$j(n,r,t);y?m.opacity=[Object.assign({test:y},nt(v??1)),nt(h.legend.unselectedOpacity)]:v&&(m.opacity=nt(v))}return m=Object.assign(Object.assign({},m),e),Ne(m)?void 0:m}function Pse(e,{model:t,legendType:n}){if(n!=="gradient")return;let i={};const r=Tj(t.encoding.opacity)||t.markDef.opacity;return r&&(i.opacity=nt(r)),i=Object.assign(Object.assign({},i),e),Ne(i)?void 0:i}function zse(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const a=n.legend(i)||{},o=n.config,s=q(t)?$j(n,r,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=os(c)?Gx({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return Ne(d)?void 0:d}function Bse(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function Tj(e){return Cj(e,(t,n)=>Math.max(t,n.value))}function L2(e){return Cj(e,(t,n)=>rt(t,n.value))}function Cj(e,t){return Vre(e)?G(e.condition).reduce(t,e.value):qr(e)?e.value:void 0}function $j(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=B(n.field);return i.map(a=>{const o=B(qe(a)+hs);return`(!length(data(${o})) || (${a}[${r}] && indexof(${a}[${r}], datum.value) >= 0))`}).join(" || ")}const Dj={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return SI(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return OI(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Vse(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Xse(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:qse(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>ss(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Il(n)&&Di(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Use(t,e)};function Use(e,t){const n=e.values;return M(n)?GI(t,n):oe(n)?n:void 0}function qse(e,t,n,i){var r;if(t!=="shape"){const a=(r=L2(n))!==null&&r!==void 0?r:i;if(a)return a}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Wse(e){const{legend:t}=e;return rt(t.type,Gse(e))}function Gse({channel:e,timeUnit:t,scaleType:n}){if(Il(e)){if(ae(["quarter","month","day"],t))return"symbol";if(Di(n))return"gradient"}return"symbol"}function Hse({legendConfig:e,legendType:t,orient:n,legend:i}){var r,a;return(a=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&a!==void 0?a:Yse(n,t)}function Yse(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Vse({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;return Di(r)?n==="horizontal"?i==="top"||i==="bottom"?Rj(t,"width",o,a):o:Rj(t,"height",l,s):void 0}function Rj(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Xse(e){return ae(["quantile","threshold","log"],e)?"greedy":void 0}function Fj(e){const t=Ke(e)?Jse(e):ele(e);return e.component.legends=t,t}function Jse(e){const{encoding:t}=e,n={};for(const i of[Sn,...pM]){const r=ft(t[i]);if(!r||!e.getScaleComponent(i))continue;if(i===On&&q(r)&&r.type===zl)continue;n[i]=Zse(e,i)}return n}function Kse(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Qse(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Zse(e,t){var n,i,r;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new jse({},Kse(e,t));Voe(e,t,c);const f=a!==void 0?!a:u.disable;if(c.set("disable",f,a!==void 0),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=ft(s[t]),p=q(h)?(n=sn(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=a.orient||l.legend.orient||"right",m=Wse({legend:a,channel:t,timeUnit:p,scaleType:d}),v=Hse({legend:a,legendType:m,orient:g,legendConfig:u}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:g,legendType:m,direction:v};for(const w of Sj){const A=w in Dj?Dj[w](y):a[w];if(A!==void 0){const _=Qse(A,w,a,e.fieldDef(t));(_||l.legend[w]===void 0)&&c.set(w,A,_)}}const b=(i=a==null?void 0:a.encoding)!==null&&i!==void 0?i:{},E=c.get("selections"),x={},k={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const A=Aj((r=b[w])!==null&&r!==void 0?r:{},e),_=w in Oj?Oj[w](A,k):A;_!==void 0&&!Ne(_)&&(x[w]=Object.assign(Object.assign(Object.assign({},(E==null?void 0:E.length)&&q(h)?{name:`${qe(h.field)}_legend_${w}`}:{}),(E==null?void 0:E.length)?{interactive:!!E}:{}),{update:_}))}return Ne(x)||c.set("encode",x,!!(a==null?void 0:a.encoding)),c}function ele(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Fj(i);for(const r of z(i.component.legends))n.legend[r]=j2(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=Nj(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of z(t))for(const r of e.children){if(!r.component.legends[i])continue;n.legend[i]==="shared"&&delete r.component.legends[i]}return t}function Nj(e,t){var n,i,r,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const u of Sj){const c=Xa(e.getWithExplicit(u),t.getWithExplicit(u),u,"legend",(f,d)=>{switch(u){case"symbolType":return tle(f,d);case"title":return ZI(f,d);case"type":return l=!0,Un("symbol")}return Yg(f,d,u,"legend")});e.setWithExplicit(u,c)}return l&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&mx(e.implicit,["encode","gradient"]),((a=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||a===void 0?void 0:a.gradient)&&mx(e.explicit,["encode","gradient"])),e}function tle(e,t){return t.value==="circle"?t:e}function Ij(e,t,n,i){var r,a,o;e.encode=(r=e.encode)!==null&&r!==void 0?r:{},e.encode[t]=(a=e.encode[t])!==null&&a!==void 0?a:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=i}function Mj(e){const t=e.component.legends,n={};for(const r of z(t)){const a=e.getScaleComponent(r),o=Ue(a.get("domains"));if(n[o])for(const s of n[o]){const l=Nj(s,t[r]);l||n[o].push(t[r])}else n[o]=[t[r].clone()]}const i=Fa(n).flat().map(r=>nle(r,e.config)).filter(r=>r!==void 0);return i}function nle(e,t){var n,i,r;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=Z(a,["disable","labelExpr","selections"]);if(o)return;if(t.aria===!1&&u.aria==null&&(u.aria=!1),(n=u.encode)===null||n===void 0?void 0:n.symbols){const c=u.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!u.stroke&&(c.stroke={value:"transparent"});for(const f of pM)u[f]&&delete c[f]}if(u.title||delete u.title,s!==void 0){let c=s;((r=(i=u.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&oe(u.encode.labels.update.text)&&(c=Nl(s,"datum.label",u.encode.labels.update.text.signal)),Ij(u,"labels","text",{signal:c})}for(const c in u){const f=u[c];if(oe(f)){const d=kae[c];if(d){const{vgProp:h,part:p}=d;Ij(u,p,h,f),delete u[c]}}}return u}function ile(e){return Vl(e)||X2(e)?rle(e):jj(e)}function rle(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),jj(e))}function jj(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},a=t.data.reduce((o,s)=>{const l=oe(s)?s.signal:`data('${e.lookupDataSource(s)}')`;return ae(o,l)||o.push(l),o},[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const ale=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Lj extends Va{constructor(e,t,n,i){super(Object.assign({},t),{name:e});this.specifiedProjection=t,this.size=n,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function Pj(e){e.component.projection=Ke(e)?ole(e):ule(e)}function ole(e){var t;if(e.hasProjection){const n=e.specifiedProjection,i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=i?sle(e):void 0;return new Lj(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),r,a)}return}function sle(e){const t=[],{encoding:n}=e;for(const i of[[rr,ir],[ni,$i]])(ft(n[i[0]])||ft(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(On)&&e.typedFieldDef(On).type===zl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Ht)),t}function lle(e,t){const n=fN(ale,r=>!Q(e.explicit,r)&&!Q(t.explicit,r)?!0:!!(Q(e.explicit,r)&&Q(t.explicit,r)&&Ue(e.get(r))===Ue(t.get(r)))),i=Ue(e.size)===Ue(t.size);if(i){if(n)return e;if(Ue(e.explicit)===Ue({}))return t;if(Ue(t.explicit)===Ue({}))return e}return null}function ule(e){if(e.children.length===0)return;let t;for(const i of e.children)Pj(i);const n=fN(e.children,i=>{const r=i.component.projection;if(r)if(t){const a=lle(t,r);return a&&(t=a),!!a}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new Lj(i,t.specifiedProjection,t.size,ge(t.data));for(const a of e.children){const o=a.component.projection;o&&(o.isFit&&r.data.push(...a.component.projection.data),a.renameProjection(o.get("name"),i),o.merged=!0)}return r}return}function cle(e,t,n,i){var r,a;if(hf(t,n)){const o=Ke(e)?(a=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&a!==void 0?a:{}:{},s=U(t,{expr:"datum"}),l=U(t,{expr:"datum",binSuffix:"end"});return{formulaAs:U(t,{binSuffix:"range",forAs:!0}),formula:Fg(s,l,o.format,o.formatType,i)}}return{}}function zj(e,t){return`${zN(e)}_${t}`}function fle(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function P2(e,t,n){var i;const r=(i=Pg(n,void 0))!==null&&i!==void 0?i:{},a=zj(r,t);return e.getName(`${a}_bins`)}function dle(e){return"as"in e}function Bj(e,t,n){let i,r;dle(e)?i=Y(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[U(e,{forAs:!0}),U(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},Pg(t,void 0)),o=zj(a,e.field),{signal:s,extentSignal:l}=fle(n,o);if(Tg(a.extent)){const c=a.extent,f=c.selection;r=cj(n.getSelectionComponent(qe(f),f),c),delete a.extent}const u=Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[i]},s?{signal:s}:{}),l?{extentSignal:l}:{}),r?{span:r}:{});return{key:o,binComponent:u}}class Yr extends Re{constructor(e,t){super(e);this.bins=t}clone(){return new Yr(null,ge(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef((i,r,a)=>{if(Bn(r)&&Me(r.bin)){const{key:o,binComponent:s}=Bj(r,r.bin,t);i[o]=Object.assign(Object.assign(Object.assign({},s),i[o]),cle(t,r,a,t.config))}return i},{});return Ne(n)?null:new Yr(e,n)}static makeFromTransform(e,t,n){const{key:i,binComponent:r}=Bj(t,t.bin,n);return new Yr(e,{[i]:r})}merge(e,t){for(const n of z(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=Ra([...this.bins[n].as,...e.bins[n].as],we)):this.bins[n]=e.bins[n];for(const n of e.children)e.removeChild(n),n.parent=this;e.remove()}producedFields(){return new Set(Fa(this.bins).map(e=>e.as).flat(2))}dependentFields(){return new Set(Fa(this.bins).map(e=>e.field))}hash(){return`Bin ${we(this.bins)}`}assemble(){return Fa(this.bins).flatMap(e=>{const t=[],[n,...i]=e.as,r=e.bin,{extent:a}=r,o=Z(r,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:Na(e.field),as:n,signal:e.signal},Tg(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:Na(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const l of i)for(let u=0;u<2;u++)t.push({type:"formula",expr:U({field:n[u]},{expr:"datum"}),as:l[u]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t})}}class Gl extends Re{constructor(e){super(null);e=e??{name:"source"};let t;if(ds(e)||(t=e.format?Object.assign({},Ir(e.format,["parse"])):{}),Vg(e))this._data={values:e.values};else if(mf(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];ae(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else MM(e)?this._data={values:[{type:"Sphere"}]}:(NM(e)||ds(e))&&(this._data={});this._generator=ds(e),e.name&&(this._name=e.name),t&&!Ne(t)&&(this._data.format=t)}dependentFields(){return new Set()}producedFields(){return}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function z2(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!z2(t.children))return!1}return!0}class am extends Re{constructor(e,t){super(e);this.params=t}clone(){return new am(null,this.params)}dependentFields(){return new Set()}producedFields(){return}hash(){return`Graticule ${we(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class om extends Re{constructor(e,t){super(e);this.params=t}clone(){return new om(null,this.params)}dependentFields(){return new Set()}producedFields(){var e;return new Set([(e=this.params.as)!==null&&e!==void 0?e:"data"])}hash(){return`Hash ${we(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function sm(e){return e instanceof Gl||e instanceof am||e instanceof om}class Uj{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Vr extends Uj{constructor(){super();this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:e,mutatedFlag:t}){e&&this.setContinue(),t&&this.setMutated()}reset(){}optimizeNextFromLeaves(e){if(sm(e))return!1;const t=e.parent,{continueFlag:n}=this.run(e);return n&&this.optimizeNextFromLeaves(t),this.mutatedFlag}}class B2 extends Uj{}function hle(e,t,n,i){const r=Ke(i)?i.encoding[sr(t)]:void 0;if(Bn(n)&&Ke(i)&&Yx(t,n,r,i.stack,i.markDef,i.config))e.add(U(n,{})),e.add(U(n,{suffix:"end"})),n.bin&&hf(n,t)&&e.add(U(n,{binSuffix:"range"}));else if(Mne(t)){const a=Ine(t);e.add(i.getName(a))}else e.add(U(n));return e}function ple(e,t){var n;for(const i of z(t)){const r=t[i];for(const a of z(r))i in e?e[i][a]=new Set([...(n=e[i][a])!==null&&n!==void 0?n:[],...r[a]]):e[i]={[a]:r[a]}}}class mr extends Re{constructor(e,t,n){super(e);this.dimensions=t,this.measures=n}clone(){return new mr(null,new Set(this.dimensions),ge(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef(a=>{a.aggregate&&(n=!0)});const i={},r=new Set();return n?(t.forEachFieldDef((a,o)=>{var s,l,u,c;const{aggregate:f,field:d}=a;if(f)if(f==="count")i["*"]=(s=i["*"])!==null&&s!==void 0?s:{},i["*"].count=new Set([U(a,{forAs:!0})]);else{if(Ia(f)||es(f)){const h=Ia(f)?"argmin":"argmax",p=f[h];i[p]=(l=i[p])!==null&&l!==void 0?l:{},i[p][h]=new Set([U({op:h,field:p},{forAs:!0})])}else i[d]=(u=i[d])!==null&&u!==void 0?u:{},i[d][f]=new Set([U(a,{forAs:!0})]);Ua(o)&&t.scaleDomain(o)==="unaggregated"&&(i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d].min=new Set([U({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([U({field:d,aggregate:"max"},{forAs:!0})]))}else hle(r,o,a,t)}),r.size+z(i).length===0?null:new mr(e,r,i)):null}static makeFromTransform(e,t){var n,i,r;const a=new Set(),o={};for(const s of t.aggregate){const{op:l,field:u,as:c}=s;l&&(l==="count"?(o["*"]=(n=o["*"])!==null&&n!==void 0?n:{},o["*"].count=new Set([c||U(s,{forAs:!0})])):(o[u]=(i=o[u])!==null&&i!==void 0?i:{},o[u][l]=new Set([c||U(s,{forAs:!0})])))}for(const s of(r=t.groupby)!==null&&r!==void 0?r:[])a.add(s);return a.size+z(o).length===0?null:new mr(e,a,o)}merge(e){return rne(this.dimensions,e.dimensions)?(ple(this.measures,e.measures),!0):(Vie("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...z(this.measures)])}producedFields(){const e=new Set();for(const t of z(this.measures))for(const n of z(this.measures[t])){const i=this.measures[t][n];i.size===0?e.add(`${n}_${t}`):i.forEach(e.add,e)}return e}hash(){return`Aggregate ${we({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of z(this.measures))for(const a of z(this.measures[r]))for(const o of this.measures[r][a])n.push(o),e.push(a),t.push(r==="*"?null:Na(r));const i={type:"aggregate",groupby:[...this.dimensions].map(Na),ops:e,fields:t,as:n};return i}}class Hl extends Re{constructor(e,t,n,i){super(e);this.model=t,this.name=n,this.data=i;for(const r of ii){const a=t.facet[r];if(a){const{bin:o,sort:s}=a;this[r]=Object.assign({name:t.getName(`${r}_domain`),fields:[U(a),...Me(o)?[U(a,{binSuffix:"end"})]:[]]},fr(s)?{sortField:s}:M(s)?{sortIndexField:ql(a,r)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of ii)this[t]&&(e+=` ${t.charAt(0)}:${we(this[t])}`);return e}get fields(){var e;const t=[];for(const n of ii)((e=this[n])===null||e===void 0?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of ii)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set()}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of ri){const n=this.childModel.component.scales[t];if(n&&!n.merged){const i=n.get("type"),r=n.get("range");if(Tn(i)&&qa(r)){const a=um(this.childModel,t),o=Y2(a);o?e[t]=o:j(`Unknown field for ${t}. Cannot calculate view size.`)}}}return e}assembleRowColumnHeaderData(e,t,n){const i={row:"y",column:"x"}[e],r=[],a=[],o=[];n&&n[i]&&(t?(r.push(`distinct_${n[i]}`),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push(`distinct_${n[i]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:u=Ng,field:c}=s;r.push(c),a.push(u),o.push(U(s,{forAs:!0}))}else l&&(r.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:t??this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},r.length?{fields:r,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:i}=this.model.layout,{layoutHeaders:r}=this.model.component,a=[],o={};for(const u of F2){for(const c of N2){const f=(t=r[u]&&r[u][c])!==null&&t!==void 0?t:[];for(const d of f)if(((n=d.axes)===null||n===void 0?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const c=`length(data("${this.facet.name}"))`,f=u==="row"?i?{signal:`ceil(${c} / ${i})`}:1:i?{signal:`min(${c}, ${i})`}:{signal:c};a.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((e=r.x)!==null&&e!==void 0?e:[],(t=r.y)!==null&&t!==void 0?t:[]),u=l.map(()=>"distinct");n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[Lr,jr])this[l]&&n.push(this.assembleRowColumnHeaderData(l,i,r));if(s){const l=this.assembleFacetHeaderData(r);l&&n.push(...l)}return n}}function qj(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function gle(e,t){const n=mN(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const i=qj(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.indexOf("utc:")===0){const i=qj(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return j(oie(t)),null}function mle(e){const t={};return ug(e.filter,n=>{var i;if(hI(n)){let r=null;Ix(n)?r=n.equal:Mx(n)?r=n.range[0]:jx(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(jl(r)?t[n.field]="date":Ce(r)?t[n.field]="number":Y(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function vle(e){const t={};function n(i){zg(i)?t[i.field]="date":i.type==="quantitative"&&$ne(i.aggregate)?t[i.field]="number":rf(i.field)>1?i.field in t||(t[i.field]="flatten"):Kx(i)&&fr(i.sort)&&rf(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((Ke(e)||Fi(e))&&e.forEachFieldDef((i,r)=>{if(Bn(i))n(i);else{const a=is(r),o=e.fieldDef(a);n(Object.assign(Object.assign({},i),{type:o.type}))}}),Ke(e)){const{mark:i,markDef:r,encoding:a}=e;if(Zo(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",s=a[o];q(s)&&s.type==="quantitative"&&!(s.field in t)&&(t[s.field]="number")}}return t}function yle(e){const t={};if(Ke(e)&&e.component.selection)for(const n of z(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&rf(r.field)>1&&(t[r.field]="flatten")}return t}class un extends Re{constructor(e,t){super(e);this._parse=t}clone(){return new un(null,ge(this._parse))}hash(){return`Parse ${we(this._parse)}`}static makeExplicit(e,t,n){let i={};const r=t.data;return!ds(r)&&r&&r.format&&r.format.parse&&(i=r.format.parse),this.makeWithAncestors(e,i,{},n)}static makeWithAncestors(e,t,n,i){for(const o of z(n)){const s=i.getWithExplicit(o);s.value!==void 0&&(s.explicit||s.value===n[o]||s.value==="derived"||n[o]==="flatten"?delete n[o]:j(VN(o,n[o],s.value)))}for(const o of z(t)){const s=i.get(o);s!==void 0&&(s===t[o]?delete t[o]:j(VN(o,t[o],s)))}const r=new Va(t,n);i.copyAll(r);const a={};for(const o of z(r.combine())){const s=r.get(o);s!==null&&(a[o]=s)}return z(a).length===0||i.parseNothing?null:new un(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of z(this._parse)){const n=this._parse[t];rf(t)===1&&(e[t]=n)}return e}producedFields(){return new Set(z(this._parse))}dependentFields(){return new Set(z(this._parse))}assembleTransforms(e=!1){return z(this._parse).filter(t=>e?rf(t)>1:!0).map(t=>{const n=gle(t,this._parse[t]);if(!n)return null;const i={type:"formula",expr:n,as:vN(t)};return i}).filter(t=>t!==null)}}class gs extends Re{clone(){return new gs(null)}constructor(e){super(e)}dependentFields(){return new Set()}producedFields(){return new Set([Bl])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Bl}}}class Yl extends Re{constructor(e,t){super(e);this.transform=t}clone(){return new Yl(null,ge(this.transform))}addDimensions(e){this.transform.groupby=Ra(this.transform.groupby.concat(e),t=>t)}dependentFields(){const e=new Set();return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map(t=>t.field).filter(t=>t!==void 0).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`JoinAggregateTransform ${we(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(r.field===void 0?null:r.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},i!==void 0?{groupby:i}:{})}}function ble(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=U(i);return r&&t.push(r),t},[])}function wle(e){return M(e)&&e.every(t=>Y(t))&&e.length>1}class Qa extends Re{constructor(e,t){super(e);this._stack=t}clone(){return new Qa(null,ge(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:i,as:r,offset:a="zero"}=t,o=[],s=[];if(t.sort!==void 0)for(const c of t.sort)o.push(c.field),s.push(rt(c.order,"ascending"));const l={field:o,order:s};let u;return wle(r)?u=r:Y(r)?u=[r,r+"_end"]:u=[t.stack+"_start",t.stack+"_end"],new Qa(e,{stackField:n,groupby:i,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:i}=t;if(!n)return null;const{groupbyChannel:r,fieldChannel:a,offset:o,impute:s}=n;let l;if(r){const d=i[r];l=hr(d)}const u=ble(t),c=t.encoding.order;let f;return M(c)||q(c)?f=JI(c):f=u.reduce((d,h)=>(d.field.push(h),d.order.push(a==="y"?"descending":"ascending"),d),{field:[],order:[]}),new Qa(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set();return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${we(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[U(e,{binSuffix:"mid"})]:[U(e,{}),U(e,{binSuffix:"end"})]:[U(e)]:n??[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:u=.5,bin:c}=n;c&&e.push({type:"formula",expr:`${u}*`+U(n,{expr:"datum"})+`+${1-u}*`+U(n,{expr:"datum",binSuffix:"end"}),as:U(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:i,groupby:[...r,...t],key:U(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:i,sort:a,as:l,offset:o}),e}}class Af extends Re{constructor(e,t){super(e);this.transform=t}clone(){return new Af(null,ge(this.transform))}addDimensions(e){this.transform.groupby=Ra(this.transform.groupby.concat(e),t=>t)}dependentFields(){var e,t;const n=new Set();return((e=this.transform.groupby)!==null&&e!==void 0?e:[]).forEach(n.add,n),((t=this.transform.sort)!==null&&t!==void 0?t:[]).forEach(i=>n.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return(t=e.as)!==null&&t!==void 0?t:U(e)}hash(){return`WindowTransform ${we(this.transform)}`}assemble(){var e;const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&a[0]===null&&a[1]===null&&n.every(f=>Ex(f)))return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},o!==void 0?{groupby:o}:{});const s=[],l=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)s.push(f.field),l.push((e=f.order)!==null&&e!==void 0?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:t,sort:u},c!==void 0?{ignorePeers:c}:{}),o!==void 0?{groupby:o}:{}),a!==void 0?{frame:a}:{})}}class xle extends Vr{run(e){const t=e.parent;if(e instanceof un){if(sm(t))return this.flags;if(t.numChildren()>1)return this.setContinue(),this.flags;if(t instanceof un)this.setMutated(),t.merge(e);else{if(pN(t.producedFields(),e.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),e.swapWithParent()}}return this.setContinue(),this.flags}}class Ele extends B2{mergeNodes(e,t){const n=t.shift();for(const i of t)e.removeChild(i),i.parent=n,i.remove()}run(e){const t=e.children.map(i=>i.hash()),n={};for(let i=0;i<t.length;i++)n[t[i]]===void 0?n[t[i]]=[e.children[i]]:n[t[i]].push(e.children[i]);for(const i of z(n))n[i].length>1&&(this.setMutated(),this.mergeNodes(e,n[i]));for(const i of e.children)this.run(i);return this.mutatedFlag}}class kle extends Vr{run(e){return e instanceof ln||e.numChildren()>0||e instanceof Hl?this.flags:(this.setMutated(),e.remove(),this.flags)}}class _le extends Vr{constructor(){super(...arguments);this.fields=new Set(),this.prev=null}run(e){if(this.setContinue(),e instanceof Gr){const t=e.producedFields();dN(t,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...t]),this.prev=e}return this.flags}reset(){this.fields.clear()}}class Ale extends Vr{run(e){this.setContinue();const t=e.parent,n=t.children.filter(r=>r instanceof Gr),i=n.pop();for(const r of n)this.setMutated(),i.merge(r);return this.flags}}function Sle(e){function t(n){if(!(n instanceof Hl)){const i=n.clone();if(i instanceof ln){const r=q2+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof mr||i instanceof Qa||i instanceof Af||i instanceof Yl)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function U2(e){if(e instanceof Hl)if(e.numChildren()===1&&!(e.children[0]instanceof ln)){const t=e.children[0];(t instanceof mr||t instanceof Qa||t instanceof Af||t instanceof Yl)&&t.addDimensions(e.fields),t.swapWithParent(),U2(e)}else{const t=e.model.component.data.main;Wj(t);const n=Sle(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(U2)}function Wj(e){if(e instanceof ln&&e.type===Ht&&e.numChildren()===1){const t=e.children[0];t instanceof Hl||(t.swapWithParent(),Wj(e))}}class Ole extends B2{constructor(){super()}run(e){e instanceof ln&&!e.isRequired()&&(this.setMutated(),e.remove());for(const t of e.children)this.run(t);return this.mutatedFlag}}class Tle extends B2{constructor(e){super();this.requiresSelectionId=e&&T2(e)}run(e){e instanceof gs&&(this.requiresSelectionId&&(sm(e.parent)||e.parent instanceof mr||e.parent instanceof un)||(this.setMutated(),e.remove()));for(const t of e.children)this.run(t);return this.mutatedFlag}}class Cle extends Vr{run(e){const t=e.parent,n=[...t.children],i=t.children.filter(r=>r instanceof un);if(t.numChildren()>1&&i.length>=1){const r={},a=new Set();for(const o of i){const s=o.parse;for(const l of z(s))l in r?r[l]!==s[l]&&a.add(l):r[l]=s[l]}for(const o of a)delete r[o];if(!Ne(r)){this.setMutated();const o=new un(t,r);for(const s of n){if(s instanceof un)for(const l of z(r))delete s.parse[l];t.removeChild(s),s.parent=o,s instanceof un&&z(s.parse).length===0&&s.remove()}}}return this.setContinue(),this.flags}}class $le extends Vr{run(e){const t=e.parent,n=t.children.filter(r=>r instanceof mr),i={};for(const r of n){const a=we(r.groupBy);a in i||(i[a]=[]),i[a].push(r)}for(const r of z(i)){const a=i[r];if(a.length>1){const o=a.pop();for(const s of a)o.merge(s)&&(t.removeChild(s),s.parent=o,s.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class Dle extends Vr{constructor(e){super();this.model=e}run(e){const t=e.parent,n=!(sm(t)||t instanceof Ef||t instanceof un||t instanceof gs),i=[],r=[];for(const a of t.children)a instanceof Yr&&(n&&!pN(t.producedFields(),a.dependentFields())?i.push(a):r.push(a));if(i.length>0){const a=i.pop();for(const o of i)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated(),t instanceof Yr?t.merge(a,this.model.renameSignal.bind(this.model)):a.swapWithParent()}if(r.length>1){const a=r.pop();for(const o of r)a.merge(o,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Rle extends Vr{run(e){const t=e.parent,n=[...t.children],i=tf(n,o=>o instanceof ln);if(!i||t.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let a;for(const o of n)if(o instanceof ln){let s=o;for(;s.numChildren()===1;){const l=s.children[0];if(l instanceof ln)s=l;else break}r.push(...s.children),a?(t.removeChild(o),o.parent=a.parent,a.parent.removeChild(a),a.parent=s,this.setMutated()):a=s}else r.push(o);if(r.length){this.setMutated();for(const o of r)o.parent.removeChild(o),o.parent=a}return this.setContinue(),this.flags}}const q2="scale_",lm=5;function Za(e){const t=[];function n(i){if(i.numChildren()===0)t.push(i);else for(const r of i.children)n(r)}for(const i of e)n(i);return t}function Fle(e){return e}function Ri(e,t){const n=t.map(i=>{if(e instanceof Vr){const r=e.optimizeNextFromLeaves(i);return e.reset(),r}else return e.run(i)});return n.some(Fle)}function Gj(e,t){let n=e.sources;const i=new Set();return i.add(Ri(new Ole(),n)),i.add(Ri(new Tle(t),n)),n=n.filter(r=>r.numChildren()>0),i.add(Ri(new kle(),Za(n))),n=n.filter(r=>r.numChildren()>0),i.add(Ri(new xle(),Za(n))),i.add(Ri(new Dle(t),Za(n))),i.add(Ri(new _le(),Za(n))),i.add(Ri(new Cle(),Za(n))),i.add(Ri(new $le(),Za(n))),i.add(Ri(new Ale(),Za(n))),i.add(Ri(new Ele(),n)),i.add(Ri(new Rle(),Za(n))),e.sources=n,i.has(!0)}function Nle(e,t){z2(e.sources);let n=0,i=0;for(let r=0;r<lm&&Gj(e,t);r++)n++;e.sources.map(U2);for(let r=0;r<lm&&Gj(e,t);r++)i++;z2(e.sources),Math.max(n,i)===lm&&j(`Maximum optimization runs(${lm}) reached.`)}class si{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new si(()=>e(t))}}function Hj(e){Ke(e)?Ile(e):Mle(e)}function Ile(e){const t=e.component.scales;for(const n of z(t)){const i=Lle(e,n),r=t[n];if(r.setWithExplicit("domains",i),zle(e,n),e.component.data.isFaceted){let a=e;for(;!Fi(a)&&a.parent;)a=a.parent;const o=a.component.resolve.scale[n];if(o==="shared")for(const s of i.value)Wa(s)&&(s.data=q2+s.data.replace(q2,""))}}}function Mle(e){for(const n of e.children)Hj(n);const t=e.component.scales;for(const n of z(t)){let i,r=null;for(const a of e.children){const o=a.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Xa(i,o.getWithExplicit("domains"),"domains","scale",H2);const s=o.get("selectionExtent");r&&s&&r.selection!==s.selection&&j("The same selection must be used to override scale domains in a layered view."),r=s}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function jle(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:a}=Yj(t,n);if(!r){j(a);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Yj(t,n);if(r)return"unaggregated"}return e}function Lle(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=jle(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&ft(i.x2)?ft(i.x)?Xa(eo(n,r,e,"x"),eo(n,r,e,"x2"),"domain","scale",H2):eo(n,r,e,"x2"):t==="y"&&ft(i.y2)?ft(i.y)?Xa(eo(n,r,e,"y"),eo(n,r,e,"y2"),"domain","scale",H2):eo(n,r,e,"y2"):eo(n,r,e,t)}function Ple(e,t,n){return e.map(i=>{const r=t2(i,{timeUnit:n,type:t});return{signal:`{data: ${r}}`}})}function W2(e,t,n){var i;const r=(i=sn(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?Ple(e,t,r):[e]}function eo(e,t,n,i){const{encoding:r}=n,a=ft(r[i]),{type:o}=a,s=a.timeUnit;if(Nre(t)){const f=eo(e,void 0,n,i),d=W2(t.unionWith,o,s);return fs([...f.value,...d])}else{if(oe(t))return fs([t]);if(t&&t!=="unaggregated"&&!vI(t))return fs(W2(t,o,s))}const l=n.stack;if(l&&i===l.fieldChannel){if(l.offset==="normalize")return Un([[0,1]]);const f=n.requestDataName(Ht);return Un([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const u=Ua(i)&&q(a)?Ble(n,i,e):void 0;if(Ha(a)){const f=W2([a.datum],o,s);return Un(f)}const c=a;if(t==="unaggregated"){const f=n.requestDataName(Ht),{field:d}=a;return Un([{data:f,field:U({field:d,aggregate:"min"})},{data:f,field:U({field:d,aggregate:"max"})}])}else if(Me(c.bin)){if(Tn(e))return e==="bin-ordinal"?Un([]):Un([{data:fg(u)?n.requestDataName(Ht):n.requestDataName(Xg),field:n.vgField(i,hf(c,i)?{binSuffix:"range"}:{}),sort:u===!0||!K(u)?{field:n.vgField(i,{}),op:"min"}:u}]);{const{bin:f}=c;if(Me(f)){const d=P2(n,c.field,f);return Un([new si(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return Un([{data:n.requestDataName(Ht),field:n.vgField(i,{})}])}}else if(c.timeUnit&&ae(["time","utc"],e)&&Yx(i,c,Ke(n)?n.encoding[sr(i)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(Ht);return Un([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Un(u?[{data:fg(u)?n.requestDataName(Ht):n.requestDataName(Xg),field:n.vgField(i),sort:u}]:[{data:n.requestDataName(Ht),field:n.vgField(i)}])}function G2(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n??(t?"sum":Ng)},i?{field:Na(i)}:{}),r?{order:r}:{})}function zle(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,a=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=vI(r)&&r,s=lf(a)&&Tg(a.extent)&&a.extent;(o||s)&&i.set("selectionExtent",o??s,!0)}function Ble(e,t,n){if(!Tn(n))return;const i=e.fieldDef(t),r=i.sort;if(FI(r))return{op:"min",field:ql(i,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map(s=>s.fieldDef.field)]:void 0;if(fr(r)){const s=a&&!ae(o,r.field);return G2(r,s)}else if(RI(r)){const{encoding:s,order:l}=r,u=e.fieldDef(s),{aggregate:c,field:f}=u,d=a&&!ae(o,f);if(Ia(c)||es(c))return G2({field:U(u),order:l},d);if(Ex(c)||!c)return G2({op:c,field:f,order:l},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(ae(["ascending",void 0],r))return!0}return}function Yj(e,t){const{aggregate:n,type:i}=e;return n?Y(n)&&!Fne[n]?{valid:!1,reason:Aie(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Sie(e)}:{valid:!0}:{valid:!1,reason:_ie(e)}}function H2(e,t,n,i){return e.explicit&&t.explicit&&j(Die(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function Ule(e){const t=Ra(e.map(o=>{if(Wa(o)){const s=Z(o,["sort"]);return s}return o}),we),n=Ra(e.map(o=>{if(Wa(o)){const s=o.sort;return s!==void 0&&!fg(s)&&("op"in s&&s.op==="count"&&delete s.field,s.order==="ascending"&&delete s.order),s}return}).filter(o=>o!==void 0),we);if(t.length===0)return;if(t.length===1){const o=e[0];if(Wa(o)&&n.length>0){let s=n[0];if(n.length>1)j(eI),s=!0;else if(K(s)&&"field"in s){const l=s.field;o.field===l&&(s=s.order?{order:s.order}:!0)}return Object.assign(Object.assign({},o),{sort:s})}return o}const i=Ra(n.map(o=>fg(o)||!("op"in o)||o.op in Tne?o:(j(Fie(o)),!0)),we);let r;i.length===1?r=i[0]:i.length>1&&(j(eI),r=!0);const a=Ra(e.map(o=>Wa(o)?o.data:null),o=>o);if(a.length===1&&a[0]!==null){const o=Object.assign({data:a[0],fields:t.map(s=>s.field)},r?{sort:r}:{});return o}return Object.assign({fields:t},r?{sort:r}:{})}function Y2(e){if(Wa(e)&&Y(e.field))return e.field;if(lre(e)){let t;for(const n of e.fields)if(Wa(n)&&Y(n.field)){if(!t)t=n.field;else if(t!==n.field)return j(Nie),t}return j(Iie),t}else if(ure(e)){j(Mie);const t=e.fields[0];return Y(t)?t:void 0}return}function um(e,t){const n=e.component.scales[t],i=n.get("domains").map(r=>(Wa(r)&&(r.data=e.lookupDataSource(r.data)),r));return Ule(i)}function Vj(e){return Vl(e)||X2(e)?e.children.reduce((t,n)=>t.concat(Vj(n)),Xj(e)):Xj(e)}function Xj(e){return z(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=r,f=Z(r,["name","type","selectionExtent","domains","range","reverse"]),d=qle(r.range,a,n);let h;s&&(h=ise(e,s));const p=um(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function qle(e,t,n){return ur(n)&&qa(e)?{step:{signal:t+"_step"}}:e}class Jj extends Va{constructor(e,t){super({},{name:e});this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:tf(this.get("domains"),e=>M(e)&&e.length===2&&e[0]<=0&&e[1]>=0)}}const Wle=["range","scheme"];function Kj(e){return e==="x"?"width":e==="y"?"height":void 0}function Gle(e){const t=e.component.scales;for(const n of Sg){const i=t[n];if(!i)continue;const r=Hle(n,e);i.setWithExplicit("range",r)}}function Qj(e,t){const n=e.fieldDef(t);if(n&&n.bin&&Me(n.bin)){const i=P2(e,n.field,n.bin),r=Kj(t),a=e.getName(r);return new si(()=>{const o=e.getSignalName(i),s=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(a)} / (${s})`})}return}function Hle(e,t){const n=t.specifiedScales[e],{size:i}=t,r=t.getScaleComponent(e),a=r.get("type");for(const o of Wle)if(n[o]!==void 0){const s=yI(a,o),l=bI(e,o);if(!s)j(QN(a,o,e));else if(l)j(l);else switch(o){case"range":return M(n.range)&&ur(e)?fs(n.range.map(u=>{if(u==="width"||u==="height"){const c=t.getName(u),f=t.getSignalName.bind(t);return si.fromName(f,c)}return u})):fs(n.range);case"scheme":return fs(Yle(n[o]))}}if(e===He||e===ct){const o=e===He?"width":"height",s=i[o];if(pr(s)){if(Tn(a))return fs({step:s.step});j(ZN(o))}}return Un(Vle(e,t))}function Yle(e){return Fre(e)?Object.assign({scheme:e.name},Ir(e,["name"])):{scheme:e}}function Vle(e,t){const{size:n,config:i,mark:r,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=ft(a[e]),l=t.getScaleComponent(e),u=l.get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case He:case ct:{if(ae(["point","band"],u)){if(e===He&&!n.width){const p=gf(i.view,"width");if(pr(p))return p}else if(e===ct&&!n.height){const p=gf(i.view,"height");if(pr(p))return p}}const d=Kj(e),h=t.getName(d);return e===ct&&ai(u)?[si.fromName(o,h),0]:[0,si.fromName(o,h)]}case Br:{const d=t.component.scales[e].get("zero"),h=Zj(r,d,i),p=Kle(r,n,t,i);return Dg(u)?Jle(h,p,Xle(u,i,c,e)):[h,p]}case Ci:return[0,Math.PI*2];case ts:return[0,360];case nr:return[0,new si(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case La:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case Pa:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case On:return"symbol";case Sn:case ar:case or:return u==="ordinal"?s==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Ur:case Ma:case ja:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function Xle(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&M(n)?n.length+1:(j(Gie(i)),3)}}function Jle(e,t,n){const i=()=>{const r=pf(t),a=pf(e),o=`(${r} - ${a}) / (${n} - 1)`;return`sequence(${a}, ${r} + ${o}, ${o})`};return oe(t)?new si(i):{signal:i()}}function Zj(e,t,n){if(t)return oe(t)?{signal:`${t.signal} ? 0 : ${Zj(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Cg("size",e))}const e3=.95;function Kle(e,t,n,i){const r={x:Qj(n,"x"),y:Qj(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const a=t3(t,r,i.view);return Ce(a)?a-1:new si(()=>`${a.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const a=t3(t,r,i.view);return Ce(a)?Math.pow(e3*a,2):new si(()=>`pow(${e3} * ${a.signal}, 2)`)}}throw new Error(Cg("size",e))}function t3(e,t,n){const i=pr(e.width)?e.width.step:Gg(n,"width"),r=pr(e.height)?e.height.step:Gg(n,"height");return t.x||t.y?new si(()=>{const a=[t.x?t.x.signal:i,t.y?t.y.signal:r];return`min(${a.join(", ")})`}):Math.min(i,r)}function n3(e,t){Ke(e)?Qle(e,t):a3(e,t)}function Qle(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:a,specifiedScales:o}=e;for(const s of z(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=ft(r[s]),d=l[t],h=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=yI(h,t),v=bI(s,t);if(d!==void 0&&(m?v&&j(v):j(QN(h,t,s))),m&&v===void 0)if(d!==void 0)u.copyKeyFromObject(t,l);else{const y=t in i3?i3[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:g,domain:l.domain,markDef:a,config:i}):i.scale[t];y!==void 0&&u.set(t,y,!1)}}}const i3={bins:({model:e,fieldOrDatumDef:t})=>q(t)?Zle(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>eue(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>tue(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>nue(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>iue(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:a})=>rue(e,t,n,i.type,r,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=q(e)?e.sort:void 0;return aue(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>oue(e,t,n,i,r)};function r3(e){Ke(e)?Gle(e):a3(e,"range")}function a3(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?r3(i):n3(i,t);for(const i of z(n)){let r;for(const a of e.children){const o=a.component.scales[i];if(o){const s=o.getWithExplicit(t);r=Xa(r,s,t,"scale",FM((l,u)=>{switch(t){case"range":return l.step&&u.step?l.step-u.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function Zle(e,t){const n=t.bin;if(Me(n)){const i=P2(e,t.field,n);return new si(()=>e.getSignalName(i))}else if(on(n)&&lf(n)&&n.step!==void 0)return{step:n.step};return}function eue(e,t){return ae([Sn,ar,or],e)&&t!=="nominal"?"hcl":void 0}function tue(e,t,n){var i;return((i=hr(n))===null||i===void 0?void 0:i.bin)||ae([at.TIME,at.UTC],e)?void 0:t in Ba?!0:void 0}function nue(e,t,n,i,r,a){if(e in Ba){if(Di(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:s}=r;if(o==="bar"&&!(q(i)&&(i.bin||i.timeUnit))&&(s==="vertical"&&e==="x"||s==="horizontal"&&e==="y"))return a.continuousBandSize}if(t===at.POINT)return n.pointPadding}return}function iue(e,t,n,i){if(e!==void 0)return;if(t in Ba){const{bandPaddingInner:r,barBandPaddingInner:a,rectBandPaddingInner:o}=i;return rt(r,n==="bar"?a:o)}return}function rue(e,t,n,i,r,a){if(e!==void 0)return;if(t in Ba&&n===at.BAND){const{bandPaddingOuter:o}=a;return rt(o,oe(r)?{signal:`${r.signal}/2`}:r/2)}return}function aue(e,t,n,i){return n==="x"&&i.xReverse!==void 0?ai(e)&&t==="descending"?oe(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse:ai(e)&&t==="descending"?!0:void 0}function oue(e,t,n,i,r){const a=!!n&&n!=="unaggregated";if(a&&ai(r)){if(M(n)){const o=n[0],s=n[n.length-1];if(o<=0&&s>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!Dg(r))return!0;if(!(q(t)&&t.bin)&&ae([...ri,...Wne],e)){const{orient:o,type:s}=i;return!(ae(["bar","area","line","trail"],s)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function sue(e,t,n,i){const r=lue(t,n,i),{type:a}=e;return Ua(t)?a!==void 0?xI(t,a)?q(n)&&!wI(a,n.type)?(j(Cie(a,r)),r):a:(j(Tie(t,a,r)),r):r:null}function lue(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":if(Il(e)||Og(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&j(Cx(e,"ordinal")),"ordinal";if(e in Ba){if(ae(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Sx)return"band";return t.band!==void 0||Qx(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point";case"temporal":return Il(e)?"time":Og(e)==="discrete"?(j(Cx(e,"temporal")),"ordinal"):q(t)&&t.timeUnit&&sn(t.timeUnit).utc?"utc":"time";case"quantitative":return Il(e)?q(t)&&Me(t.bin)?"bin-ordinal":"linear":Og(e)==="discrete"?(j(Cx(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(JN(t.type))}function uue(e,{ignoreRange:t}={}){o3(e),Hj(e);for(const n of jre)n3(e,n);t||r3(e)}function o3(e){Ke(e)?e.component.scales=cue(e):e.component.scales=due(e)}function cue(e){const{encoding:t,mark:n}=e;return Sg.reduce((i,r)=>{const a=ft(t[r]);if(a&&n===_N&&r===On&&a.type===zl)return i;let o=a&&a.scale;if(a&&o!==null&&o!==!1){o=o??{};const s=sue(o,r,a,n);i[r]=new Jj(e.scaleName(r+"",!0),{value:s,explicit:o.type===s})}return i},{})}const fue=FM((e,t)=>gI(e)-gI(t));function due(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const a of e.children){o3(a);for(const o of z(a.component.scales))if(r.scale[o]=(t=r.scale[o])!==null&&t!==void 0?t:Ise(o,e),r.scale[o]==="shared"){const s=i[o],l=a.component.scales[o].getWithExplicit("type");s?wre(s.value,l.value)?i[o]=Xa(s,l,"type","scale",fue):(r.scale[o]="independent",delete i[o]):i[o]=l}}for(const a of z(i)){const o=e.scaleName(a,!0),s=i[a];n[a]=new Jj(o,s);for(const l of e.children){const u=l.component.scales[a];u&&(l.renameScale(u.get("name"),o),u.merged=!0)}}return n}class V2{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return this.nameMap[e]!==void 0}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function Ke(e){return(e==null?void 0:e.type)==="unit"}function Fi(e){return(e==null?void 0:e.type)==="facet"}function X2(e){return(e==null?void 0:e.type)==="concat"}function Vl(e){return(e==null?void 0:e.type)==="layer"}class J2{constructor(e,t,n,i,r,a,o){var s,l;this.type=t,this.parent=n,this.config=r,this.view=o,this.children=[],this.correctDataNames=u=>(u.from&&u.from.data&&(u.from.data=this.lookupDataSource(u.from.data)),u.from&&u.from.facet&&u.from.facet.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u),this.parent=n,this.config=r,this.name=(s=e.name)!==null&&s!==void 0?s:i,this.title=Ya(e.title)?{text:e.title}:e.title,this.scaleNameMap=n?n.scaleNameMap:new V2(),this.projectionNameMap=n?n.projectionNameMap:new V2(),this.signalNameMap=n?n.signalNameMap:new V2(),this.data=e.data,this.description=e.description,this.transforms=Coe((l=e.transform)!==null&&l!==void 0?l:[]),this.layout=t==="layer"||t==="unit"?{}:$ae(e,t,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Ig(e)||n&&n.component.data.isFaceted&&e.data===void 0},layoutSize:new Va(),layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?ge(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){uue(this)}parseProjection(){Pj(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Fj(this)}assembleGroupStyle(){var e,t;return this.type==="unit"||this.type==="layer"?(t=(e=this.view)===null||e===void 0?void 0:e.style)!==null&&t!==void 0?t:"cell":void 0}assembleEncodeFromView(e){const t=Z(e,["style"]),n={};for(const i of z(t)){const r=t[i];r!==void 0&&(n[i]=nt(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),!e&&(this.description&&(t.description=nt(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},t??{}):Ne(t)?void 0:t}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=Z(e,["spacing"]),{component:i,config:r}=this,a=Nse(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of ii)e[n].title&&t.push(Tse(this,n));for(const n of F2)t=t.concat(Cse(this,n));return t}assembleAxes(){return pse(this.component.axes,this.config)}assembleLegends(){return Mj(this)}assembleProjections(){return ile(this)}assembleTitle(){var e,t,n;const i=(e=this.title)!==null&&e!==void 0?e:{},{encoding:r}=i,a=Z(i,["encoding"]),o=Object.assign(Object.assign(Object.assign({},HI(this.config.title).nonMark),a),r?{encode:{update:r}}:{});return o.text?(ae(["unit","layer"],this.type)?ae(["middle",void 0],o.anchor)&&(o.frame=(t=o.frame)!==null&&t!==void 0?t:"group"):o.anchor=(n=o.anchor)!==null&&n!==void 0?n:"start",Ne(o)?void 0:o):void 0}assembleGroup(e=[]){const t={};e=e.concat(this.assembleSignals()),e.length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Fi(this.parent)?Vj(this):[];i.length>0&&(t.scales=i);const r=this.assembleAxes();r.length>0&&(t.axes=r);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return qe((this.name?this.name+"_":"")+e)}requestDataName(e){var t;const n=this.getName(e),i=this.component.data.outputNodeRefCounts;return i[n]=((t=i[n])!==null&&t!==void 0?t:0)+1,n}getSizeSignalRef(e){if(Fi(this.parent)){const t=_j(e),n=Ag(t),i=this.component.scales[n];if(i&&!i.merged){const r=i.get("type"),a=i.get("range");if(Tn(r)&&qa(a)){const o=i.get("name"),s=um(this,n),l=Y2(s);if(l){const u=U({aggregate:"distinct",field:l},{expr:"datum"});return{signal:kj(o,i,u)}}else return j(`Unknown field for ${n}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):IN(e)&&Ua(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(eie(t));return n}hasAxisOrientSignalRef(){var e,t;return((e=this.component.axes.x)===null||e===void 0?void 0:e.some(n=>n.hasOrientSignalRef()))||((t=this.component.axes.y)===null||t===void 0?void 0:t.some(n=>n.hasOrientSignalRef()))}}class s3 extends J2{vgField(e,t={}){const n=this.fieldDef(e);return n?U(n,t):void 0}reduceFieldDef(e,t){return eM(this.getMapping(),(n,i,r)=>{const a=hr(i);return a?e(n,a,r):n},t)}forEachFieldDef(e,t){r2(this.getMapping(),(n,i)=>{const r=hr(n);r&&e(r,i)},t)}}class K2 extends Re{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=ge(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"value",(r=a[1])!==null&&r!==void 0?r:"density"]}clone(){return new K2(null,ge(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${we(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=Z(e,["density"]),i=Object.assign({type:"kde",field:t},n);return i}}class cm extends Re{constructor(e,t){super(e);this.filter=t}clone(){return new cm(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:i,markDef:r}=t,a=Se("invalid",r,n);if(a!=="filter")return null;const o=t.reduceFieldDef((s,l,u)=>{const c=Ua(u)&&t.getScaleComponent(u);if(c){const f=c.get("type");ai(f)&&l.aggregate!=="count"&&!Zo(i)&&(s[l.field]=l)}return s},{});return z(o).length?new cm(e,o):null}dependentFields(){return new Set(z(this.filter))}producedFields(){return new Set()}hash(){return`FilterInvalid ${we(this.filter)}`}assemble(){const e=z(this.filter).reduce((t,n)=>{const i=this.filter[n],r=U(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):i.type==="quantitative"&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t},[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class Q2 extends Re{constructor(e,t){super(e);this.transform=t,this.transform=ge(t);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((r,a)=>{var o;return(o=i[a])!==null&&o!==void 0?o:r})}clone(){return new Q2(this.parent,ge(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${we(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform,n={type:"flatten",fields:e,as:t};return n}}class Z2 extends Re{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=ge(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"key",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new Z2(null,ge(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${we(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform,n={type:"fold",fields:e,as:t};return n}}class Sf extends Re{constructor(e,t,n,i){super(e);this.fields=t,this.geojson=n,this.signal=i}clone(){return new Sf(null,ge(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const i of[[rr,ir],[ni,$i]]){const r=i.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Ha(o)?{expr:`${o.datum}`}:qr(o)?{expr:`${o.value}`}:void 0});(r[0]||r[1])&&(e=new Sf(e,r,null,t.getName(`geojson_${n++}`)))}if(t.channelHasField(On)){const i=t.typedFieldDef(On);i.type===zl&&(e=new Sf(e,null,i.field,t.getName(`geojson_${n++}`)))}return e}dependentFields(){var e;const t=((e=this.fields)!==null&&e!==void 0?e:[]).filter(Y);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set()}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${we(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class fm extends Re{constructor(e,t,n,i){super(e);this.projection=t,this.fields=n,this.as=i}clone(){return new fm(null,this.projection,ge(this.fields),ge(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[rr,ir],[ni,$i]]){const i=n.map(a=>{const o=ft(t.encoding[a]);return q(o)?o.field:Ha(o)?{expr:`${o.datum}`}:qr(o)?{expr:`${o.value}`}:void 0}),r=n[0]===ni?"2":"";(i[0]||i[1])&&(e=new fm(e,t.projectionName(),i,[t.getName("x"+r),t.getName("y"+r)]))}return e}dependentFields(){return new Set(this.fields.filter(Y))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${we(this.fields)} ${we(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Xl extends Re{constructor(e,t){super(e);this.transform=t}clone(){return new Xl(null,ge(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:i}=e,r=[t,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(e,t){return new Xl(e,t)}static makeFromEncoding(e,t){const n=t.encoding,i=n.x,r=n.y;if(q(i)&&q(r)){const a=i.impute?i:r.impute?r:void 0;if(a===void 0)return;const o=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=tM(t.mark,n);return new Xl(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),l!==void 0?{value:l}:{}),u?{frame:u}:{}),c!==void 0?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${we(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:uoe(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:!i||i==="value"?a:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[i],fields:[e],frame:o,ignorePeers:!1},r?{groupby:r}:{}),u={type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e};return[s,l,u]}else return[s]}}class eE extends Re{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=ge(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.loess]}clone(){return new eE(null,ge(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${we(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,i=Z(e,["loess","on"]),r=Object.assign({type:"loess",x:n,y:t},i);return r}}class dm extends Re{constructor(e,t,n){super(e);this.transform=t,this.secondary=n}clone(){return new dm(null,ge(this.transform),this.secondary)}static make(e,t,n,i){const r=t.component.data.sources,{from:a}=n;let o=null;if(foe(a)){let s=f3(a.data,r);s||(s=new Gl(a.data),r.push(s));const l=t.getName(`lookup_${i}`);o=new ln(s,l,"lookup",t.component.data.outputNodeRefCounts),t.component.data.outputNodes[l]=o}else if(doe(a)){const s=a.selection;if(n=Object.assign({as:s},n),o=t.getSelectionComponent(qe(s),s).materialized,!o)throw new Error(iie(s))}return new dm(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?G(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${we({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:G(this.transform.as)}:{});else{let t=this.transform.as;Y(t)||(j(lie),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}class tE extends Re{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=ge(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:"prob",(r=a[1])!==null&&r!==void 0?r:"value"]}clone(){return new tE(null,ge(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${we(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=Z(e,["quantile"]),i=Object.assign({type:"quantile",field:t},n);return i}}class nE extends Re{constructor(e,t){var n,i,r;super(e);this.transform=t,this.transform=ge(t);const a=(n=this.transform.as)!==null&&n!==void 0?n:[void 0,void 0];this.transform.as=[(i=a[0])!==null&&i!==void 0?i:t.on,(r=a[1])!==null&&r!==void 0?r:t.regression]}clone(){return new nE(null,ge(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${we(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,i=Z(e,["regression","on"]),r=Object.assign({type:"regression",x:n,y:t},i);return r}}class iE extends Re{constructor(e,t){super(e);this.transform=t}clone(){return new iE(null,ge(this.transform))}addDimensions(e){var t;this.transform.groupby=Ra(((t=this.transform.groupby)!==null&&t!==void 0?t:[]).concat(e),n=>n)}producedFields(){return}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...(e=this.transform.groupby)!==null&&e!==void 0?e:[]])}hash(){return`PivotTransform ${we(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},i!==void 0?{limit:i}:{}),r!==void 0?{op:r}:{}),n!==void 0?{groupby:n}:{})}}class rE extends Re{constructor(e,t){super(e);this.transform=t}clone(){return new rE(null,ge(this.transform))}dependentFields(){return new Set()}producedFields(){return new Set()}hash(){return`SampleTransform ${we(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function l3(e){let t=0;function n(i,r){var a;if(i instanceof Gl&&(!i.isGenerator&&!mf(i.data))){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}if(i instanceof un&&(i.parent instanceof Gl&&!r.source?(r.format=Object.assign(Object.assign({},(a=r.format)!==null&&a!==void 0?a:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Hl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source;for(const o of i.assemble())e.push(o);return}if((i instanceof am||i instanceof om||i instanceof cm||i instanceof Ef||i instanceof _f||i instanceof fm||i instanceof Sf||i instanceof mr||i instanceof dm||i instanceof Af||i instanceof Yl||i instanceof Z2||i instanceof Q2||i instanceof K2||i instanceof eE||i instanceof tE||i instanceof nE||i instanceof gs||i instanceof rE||i instanceof iE)&&r.transform.push(i.assemble()),(i instanceof Yr||i instanceof Gr||i instanceof Xl||i instanceof Qa)&&r.transform.push(...i.assemble()),i instanceof ln){if(r.source&&r.transform.length===0)i.setSource(r.source);else if(i.parent instanceof ln)i.setSource(r.name);else if(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1){e.push(r);const o={name:null,source:r.name,transform:[]};r=o}}switch(i.numChildren()){case 0:i instanceof ln&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const s of i.children){const l={name:null,source:o,transform:[]};n(s,l)}break}}}return n}function hue(e){const t=[],n=l3(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function pue(e,t){var n,i;const r=[],a=l3(r);let o=0;for(const l of e.sources){l.hasName()||(l.dataName=`source_${o++}`);const u=l.assemble();a(l,u)}for(const l of r)l.transform.length===0&&delete l.transform;let s=0;for(const[l,u]of r.entries())((n=u.transform)!==null&&n!==void 0?n:[]).length===0&&!u.source&&r.splice(s++,0,r.splice(l,1)[0]);for(const l of r)for(const u of(i=l.transform)!==null&&i!==void 0?i:[])u.type==="lookup"&&(u.from=e.outputNodes[u.from].getSource());for(const l of r)l.name in t&&(l.values=t[l.name]);return r}function gue(e){return e==="top"||e==="left"||oe(e)?"header":"footer"}function mue(e){for(const t of ii)vue(e,t);c3(e,"x"),c3(e,"y")}function vue(e,t){var n;const{facet:i,config:r,child:a,component:o}=e;if(e.channelHasField(t)){const s=i[t],l=Wl("title",null,r,t);let u=ss(s,r,{allowDisabling:!0,includeDefault:l===void 0||!!l});a.component.layoutHeaders[t].title&&(u=M(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=Wl("labelOrient",s,r,t),f=(n=s.header)!==null&&n!==void 0?n:{},d=rt(f.labels,r.header.labels,!0),h=ae(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[h]:t==="facet"?[]:[u3(e,t,d)]}}}function u3(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function c3(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:a}=e.component;if(a.axis[t]=j2(a,t),a.axis[t]==="shared"){const o=t==="x"?"column":"row",s=r[o];for(const l of i.component.axes[t]){const u=gue(l.get("orient"));s[u]=(n=s[u])!==null&&n!==void 0?n:[u3(e,o,!1)];const c=kf(l,"main",e.config,{header:!0});c&&s[u][0].axes.push(c),l.mainExtracted=!0}}}}function yue(e){aE(e),hm(e,"width"),hm(e,"height")}function bue(e){aE(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";hm(e,t),hm(e,n)}function aE(e){for(const t of e.children)t.parseLayoutSize()}function hm(e,t){const n=_j(t),i=Ag(n),r=e.component.resolve,a=e.component.layoutSize;let o;for(const s of e.children){const l=s.component.layoutSize.getWithExplicit(n),u=r.scale[i];if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=Xa(o,l,n,"")}else o=l}if(o){for(const s of e.children)e.renameSignal(s.getName(n),e.getName(t)),s.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function wue(e){const{size:t,component:n}=e;for(const i of ri){const r=lr(i);if(t[r]){const a=t[r];n.layoutSize.set(r,pr(a)?"step":a,!0)}else{const a=xue(e,r);n.layoutSize.set(r,a,!1)}}}function xue(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const a=r.get("type"),o=r.get("range");if(Tn(a)){const s=gf(i.view,t);return qa(o)||pr(s)?"step":s}else return p2(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return p2(i.view,t);{const a=gf(i.view,t);return pr(a)?a.step:a}}}function oE(e,t,n){return U(t,Object.assign({suffix:`by_${U(e)}`},n??{}))}class pm extends s3{constructor(e,t,n,i){super(e,"facet",t,n,i,e.resolve);this.child=lE(e.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(e.facet,i)}initFacet(e,t){return ff(e)?eM(e,(n,i,r)=>ae([jr,Lr],r)?i.field===void 0?(j(Tx(i,r)),n):(n[r]=e2(i,r,t),n):(j(Cg(r,"facet")),n),{}):{facet:e2(e,"facet",t)}}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=gm(this),this.child.parseData()}parseLayoutSize(){aE(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),mue(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const i={};for(const r of ii)for(const a of N2){const o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:l}=o;if(l){const u=Wl("titleOrient",l,this.config,r);if(ae(["right","bottom"],u)){const c=nm(r,u);i.titleAnchor=(e=i.titleAnchor)!==null&&e!==void 0?e:{},i.titleAnchor[c]="end"}}if(s==null?void 0:s[0]){const u=r==="row"?"height":"width",c=a==="header"?"headerBand":"footerBand";r!=="facet"&&!this.child.component.layoutSize.get(u)&&(i[c]=(t=i[c])!==null&&t!==void 0?t:{},i[c][r]=.5),o.title&&(i.offset=(n=i.offset)!==null&&n!==void 0?n:{},i.offset[r==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let i="all";return(!t&&this.component.resolve.scale.x==="independent"||!e&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof pm)return;{const e=this.getName("column_domain");return{signal:`length(data('${e}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof pm?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:U(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof pm){if(this.child.channelHasField("column")){const i=U(this.child.facet.column);e.push(i),t.push("distinct"),n.push(`distinct_${i}`)}}else for(const i of ri){const r=this.child.component.scales[i];if(r&&!r.merged){const a=r.get("type"),o=r.get("range");if(Tn(a)&&qa(o)){const s=um(this.child,i),l=Y2(s);l?(e.push(l),t.push("distinct"),n.push(`distinct_${l}`)):j(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const u of ii){const c=this.facet[u];if(c){s.push(U(c));const{bin:f,sort:d}=c;if(Me(f)&&s.push(U(c,{binSuffix:"end"})),fr(d)){const{field:h,op:p=Ng}=d,g=oE(c,d);n&&i?(r.push(g),a.push("max"),o.push(g)):(r.push(h),a.push(p),o.push(g))}else if(M(d)){const h=ql(c,u);r.push(h),a.push("max"),o.push(h)}}}const l=!!n&&!!i;return Object.assign({name:e,data:t,groupby:s},l||r.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),r.length?{fields:r,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?fr(n.sort)?[oE(n,n.sort,{expr:"datum"})]:M(n.sort)?[ql(n,e,{expr:"datum"})]:[U(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:i}=n,r=(fr(i)?i.order:!M(i)&&i)||"ascending";return[r]}return[]}assembleLabelTitle(){const{facet:e,config:t}=this;if(e.facet)return I2(e.facet,"facet",t);const n={row:["top","bottom"],column:["left","right"]};for(const i of F2)if(e[i]){const r=Wl("labelOrient",e[i],t,i);if(ae(n[i],r))return I2(e[i],i,t)}return}assembleMarks(){const{child:e}=this,t=this.component.data.facetRoot,n=hue(t),i=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),a=e.assembleGroupStyle(),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),a?{style:a}:{}),{from:{facet:this.assembleFacet()},sort:{field:ii.map(s=>this.facetSortFields(s)).flat(),order:ii.map(s=>this.facetSortOrder(s)).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup(Zoe(this,[])));return[o]}getMapping(){return this.facet}}function Eue(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const a of[n,i])if(fr(a.sort)){const{field:o,op:s=Ng}=a.sort;e=r=new Yl(e,{joinaggregate:[{op:s,field:o,as:oE(a,a.sort,{forAs:!0})}],groupby:[U(a)]})}return r}return null}function f3(e,t){var n,i,r,a,o,s,l,u,c,f;for(const d of t){const h=d.data;if(e.name&&d.hasName()&&e.name!==d.dataName)continue;if(((n=e.format)===null||n===void 0?void 0:n.mesh)&&((i=h.format)===null||i===void 0?void 0:i.feature))continue;if((((r=e.format)===null||r===void 0?void 0:r.feature)||((a=h.format)===null||a===void 0?void 0:a.feature))&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((s=h.format)===null||s===void 0?void 0:s.feature))continue;if((((l=e.format)===null||l===void 0?void 0:l.mesh)||((u=h.format)===null||u===void 0?void 0:u.mesh))&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=h.format)===null||f===void 0?void 0:f.mesh))continue;if(Vg(e)&&Vg(h)){if(Zc(e.values,h.values))return d}else if(mf(e)&&mf(h)){if(e.url===h.url)return d}else if(NM(e)&&e.name===d.dataName)return d}return null}function kue(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Gl({values:[]});return t.push(i),i}const n=f3(e.data,t);if(n)return ds(e.data)||(n.data.format=nne({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Gl(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function _ue(e,t,n){var i,r;let a=0;for(const o of t.transforms){let s,l;if(Eoe(o))l=e=new _f(e,o),s="derived";else if(jM(o)){const u=mle(o);l=e=(i=un.makeWithAncestors(e,{},u,n))!==null&&i!==void 0?i:e,e=new Ef(e,t,o.filter)}else if(koe(o))l=e=Yr.makeFromTransform(e,o,t),s="number";else if(Aoe(o)){s="date";const u=n.getWithExplicit(o.field);u.value===void 0&&(e=new un(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=Gr.makeFromTransform(e,o)}else if(Soe(o))l=e=mr.makeFromTransform(e,o),s="number",T2(t)&&(e=new gs(e));else if(coe(o))l=e=dm.make(e,t,o,a++),s="derived";else if(boe(o))l=e=new Af(e,o),s="number";else if(woe(o))l=e=new Yl(e,o),s="number";else if(Ooe(o))l=e=Qa.makeFromTransform(e,o),s="derived";else if(Toe(o))l=e=new Z2(e,o),s="derived";else if(xoe(o))l=e=new Q2(e,o),s="derived";else if(hoe(o))l=e=new iE(e,o),s="derived";else if(yoe(o))e=new rE(e,o);else if(_oe(o))l=e=Xl.makeFromTransform(e,o),s="derived";else if(poe(o))l=e=new K2(e,o),s="derived";else if(goe(o))l=e=new tE(e,o),s="derived";else if(moe(o))l=e=new nE(e,o),s="derived";else if(voe(o))l=e=new eE(e,o),s="derived";else{j(sie(o));continue}if(l&&s!==void 0)for(const u of(r=l.producedFields())!==null&&r!==void 0?r:[])n.set(u,s,!1)}return e}function gm(e){var t,n,i,r,a,o,s,l,u,c;let f=kue(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new loe(),g=e.data;ds(g)?(IM(g)?f=new om(f,g.sequence):b2(g)&&(f=new am(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=un.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new gs(f);const m=e.parent&&Vl(e.parent);(Ke(e)||Fi(e))&&(m&&(f=(i=Yr.makeFromEncoding(f,e))!==null&&i!==void 0?i:f)),e.transforms.length>0&&(f=_ue(f,e,p));const v=yle(e),y=vle(e);f=(r=un.makeWithAncestors(f,{},Object.assign(Object.assign({},v),y),p))!==null&&r!==void 0?r:f,Ke(e)&&(f=Sf.parseAll(f,e),f=fm.parseAll(f,e)),(Ke(e)||Fi(e))&&(m||(f=(a=Yr.makeFromEncoding(f,e))!==null&&a!==void 0?a:f),f=(o=Gr.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=_f.parseAllForSortIndex(f,e));const b=e.getName(Xg),E=new ln(f,b,Xg,h);if(d[b]=E,f=E,Ke(e)){const A=mr.makeFromEncoding(f,e);A&&(f=A,T2(e)&&(f=new gs(f))),f=(s=Xl.makeFromEncoding(f,e))!==null&&s!==void 0?s:f,f=(l=Qa.makeFromEncoding(f,e))!==null&&l!==void 0?l:f}Ke(e)&&(f=(u=cm.make(f,e))!==null&&u!==void 0?u:f);const x=e.getName(Ht),k=new ln(f,x,Ht,h);d[x]=k,f=k,Ke(e)&&dse(e,k);let w=null;if(Fi(e)){const A=e.getName("facet");f=(c=Eue(f,e.facet))!==null&&c!==void 0?c:f,w=new Hl(f,e,A,k.getSource()),d[A]=w}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:E,main:k,facetRoot:w,ancestorParse:p})}class Aue extends J2{constructor(e,t,n,i){var r,a,o,s;super(e,"concat",t,n,i,e.resolve);(((a=(r=e.resolve)===null||r===void 0?void 0:r.axis)===null||a===void 0?void 0:a.x)==="shared"||((s=(o=e.resolve)===null||o===void 0?void 0:o.axis)===null||s===void 0?void 0:s.y)==="shared")&&j(aie),this.children=this.getChildren(e).map((l,u)=>lE(l,this,this.getName("concat_"+u),void 0,i))}parseData(){this.component.data=gm(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return Wg(e)?e.vconcat:h2(e)?e.hconcat:e.concat}parseLayoutSize(){bue(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.forEach(e=>e.assembleSignals()),[]}assembleLayoutSignals(){const e=M2(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleMarks(){return this.children.map(e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),i=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),e.assembleGroup())})}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},e!=null?{columns:e}:{}),{bounds:"full",align:"each"})}}function Sue(e){return e===!1||e===null}const Oue=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},wN),{labelExpr:1,encode:1}),d3=z(Oue);class h3 extends Va{constructor(e={},t={},n=!1){super();this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new h3(ge(this.explicit),ge(this.implicit),this.mainExtracted)}hasAxisPart(e){return e==="axis"?!0:e==="grid"||e==="title"?!!this.get(e):!Sue(this.get(e))}hasOrientSignalRef(){return oe(this.explicit.orient)}}function Tue(e,t,n){var i;const{encoding:r,config:a}=e,o=(i=ft(r[t]))!==null&&i!==void 0?i:ft(r[sr(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return os(u)?Object.assign({text:Gx({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}function Cue(e){return ri.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Mue(n,e)]),t),{})}const $ue={bottom:"top",top:"bottom",left:"right",right:"left"};function Due(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const a of e.children){a.parseAxesAndHeaders();for(const o of z(a.component.axes))i.axis[o]=j2(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=Rue(n[o],a.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const a of ri){for(const o of e.children){if(!o.component.axes[a])continue;if(i.axis[a]==="independent"){n[a]=((t=n[a])!==null&&t!==void 0?t:[]).concat(o.component.axes[a]);for(const s of o.component.axes[a]){const{value:l,explicit:u}=s.getWithExplicit("orient");if(oe(l))continue;if(r[l]>0&&!u){const c=$ue[l];r[l]>r[c]&&s.set("orient",c,!1)}r[l]++}}delete o.component.axes[a]}if(i.axis[a]==="independent"&&n[a]&&n[a].length>1)for(const o of n[a])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function Rue(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],a=t[i];if(!!r!==!!a)return;if(r&&a){const o=r.getWithExplicit("orient"),s=a.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;e[i]=Fue(r,a)}}}else return t.map(n=>n.clone());return e}function Fue(e,t){for(const n of d3){const i=Xa(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,a)=>{switch(n){case"title":return ZI(r,a);case"gridScale":return{explicit:r.explicit,value:rt(r.value,a.value)}}return Yg(r,a,n,"axis")});e.setWithExplicit(n,i)}return e}function Nue(e,t,n,i,r){if(t==="disable")return n!==void 0;n=n||{};switch(t){case"titleAngle":case"labelAngle":return e===(oe(n.labelAngle)?n.labelAngle:hg(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===yj(i,r))return!0}return e===n[t]}const Iue=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Mue(e,t){var n,i,r;let a=t.axis(e);const o=new h3(),s=ft(t.encoding[e]),{mark:l,config:u}=t,c=(a==null?void 0:a.orient)||((n=u[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=u.axis)===null||i===void 0?void 0:i.orient)||_se(e),f=t.getScaleComponent(e).get("type"),d=vse(e,f,c,t.config),h=a!==void 0?!a:D2("disable",u,a==null?void 0:a.style,d).configValue;if(o.set("disable",h,a!==void 0),h)return o;a=a||{};const p=xse(t,a,e,s,d),g={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const y of d3){const b=y in gj?gj[y](g):xN(y)?a[y]:void 0,E=b!==void 0,x=Nue(b,y,a,t,e);if(E&&x)o.set(y,b,x);else{const{configValue:k=void 0,configFrom:w=void 0}=xN(y)&&y!=="values"?D2(y,t.config,a.style,d):{},A=k!==void 0;E&&!A?o.set(y,b,x):(!(w==="vgAxisConfig")||Iue.has(y)&&A||yx(k)||oe(k))&&o.set(y,k,!1)}}const m=(r=a.encoding)!==null&&r!==void 0?r:{},v=bN.reduce((y,b)=>{var E;if(!o.hasAxisPart(b))return y;const x=Aj((E=m[b])!==null&&E!==void 0?E:{},t),k=b==="labels"?Tue(t,e,x):x;return k!==void 0&&!Ne(k)&&(y[b]={update:k}),y},{});return Ne(v)||o.set("encode",v,!!a.encoding||a.labelAngle!==void 0),o}function jue({encoding:e,size:t}){for(const n of ri){const i=lr(n);pr(t[i])&&(dr(e[n])&&(delete t[i],j(ZN(i))))}return t}function Lue(e,t,n,{graticule:i}){const r=er(e)?Object.assign({},e):{type:e},a=Se("orient",r,n);if(r.orient=Uue(r.type,t,a),a!==void 0&&a!==r.orient&&j(xie(r.orient,a)),r.type==="bar"&&r.orient){const u=Se("cornerRadiusEnd",r,n);if(u!==void 0){const c=r.orient==="horizontal"&&t.x2||r.orient==="vertical"&&t.y2?["cornerRadius"]:Ene[r.orient];for(const f of c)r[f]=u;r.cornerRadiusEnd!==void 0&&delete r.cornerRadiusEnd}}const o=Se("opacity",r,n);o===void 0&&(r.opacity=zue(r.type,t));const s=r.filled;s===void 0&&(r.filled=i?!1:Bue(r,n));const l=Se("cursor",r,n);return l===void 0&&(r.cursor=Pue(r,t,n)),r}function Pue(e,t,n){return t.href||e.href||Se("href",e,n)?"pointer":e.cursor}function zue(e,t){return ae([vg,bx,wx,xx],e)&&!n2(t)?.7:void 0}function Bue(e,t){const n=us("filled",e,t),i=e.type;return rt(n,i!==vg&&i!==mg&&i!==yg)}function Uue(e,t,n){switch(e){case vg:case wx:case xx:case kN:case pne:case hne:return}const{x:i,y:r,x2:a,y2:o}=t;switch(e){case gg:if(q(i)&&(on(i.bin)||q(r)&&r.aggregate&&!i.aggregate))return"vertical";if(q(r)&&(on(r.bin)||q(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(q(i)&&i.type===rs&&!Me(i.bin)||Jx(i)))return"horizontal";if(!o&&(q(r)&&r.type===rs&&!Me(r.bin)||Jx(r)))return"vertical"}case yg:if(a&&!(q(i)&&on(i.bin))&&o&&!(q(r)&&on(r.bin)))return;case pg:if(o)return q(r)&&on(r.bin)?"horizontal":"vertical";if(a)return q(i)&&on(i.bin)?"vertical":"horizontal";if(e===yg){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case mg:case bx:{const s=dr(i),l=dr(r);if(s&&!l)return e!=="tick"?"horizontal":"vertical";if(!s&&l)return e!=="tick"?"vertical":"horizontal";if(s&&l){const u=i,c=r,f=u.type===Pl,d=c.type===Pl;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!u.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":u.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const que={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Yt("x",e,{defaultPos:"mid"})),Yt("y",e,{defaultPos:"mid"})),Ja(e,"radius","arc")),Ja(e,"theta","arc"))},Wue={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Kg("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),Kg("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),E2(e))},Gue={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ja(e,"x","bar")),Ja(e,"y","bar"))},Hue={vgMark:"shape",encodeEntry:e=>Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape,i=Object.assign({type:"geoshape",projection:e.projectionName()},n&&q(n)&&n.type===zl?{field:U(n,{expr:"datum"})}:{});return[i]}},Yue={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Ja(e,"x","image")),Ja(e,"y","image")),w2(e,"url"))},Vue={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Yt("x",e,{defaultPos:"mid"})),Yt("y",e,{defaultPos:"mid"})),Et("size",e,{vgChannel:"strokeWidth"})),E2(e))},Xue={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Yt("x",e,{defaultPos:"mid"})),Yt("y",e,{defaultPos:"mid"})),Et("size",e)),E2(e))};function sE(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Yt("x",e,{defaultPos:"mid"})),Yt("y",e,{defaultPos:"mid"})),Et("size",e)),Et("angle",e)),Jue(e,n,t))}function Jue(e,t,n){return n?{shape:{value:n}}:Et("shape",e)}const Kue={vgMark:"symbol",encodeEntry:e=>sE(e)},Que={vgMark:"symbol",encodeEntry:e=>sE(e,"circle")},Zue={vgMark:"symbol",encodeEntry:e=>sE(e,"square")},ece={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Ja(e,"x","rect")),Ja(e,"y","rect"))},tce={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Kg("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),Kg("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),Et("size",e,{vgChannel:"strokeWidth"}))}},nce={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Yt("x",e,{defaultPos:"mid"})),Yt("y",e,{defaultPos:"mid"})),w2(e)),Et("size",e,{vgChannel:"fontSize"})),Et("angle",e)),HM("align",ice(e.markDef,n,t))),HM("baseline",rce(e.markDef,n,t))),Yt("radius",e,{defaultPos:null,isMidPoint:!0})),Yt("theta",e,{defaultPos:null,isMidPoint:!0}))}};function ice(e,t,n){const i=Se("align",e,n);return i===void 0?"center":void 0}function rce(e,t,n){const i=Se("baseline",e,n);return i===void 0?"middle":void 0}const ace={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",a=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},oi(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Yt("x",e,{defaultPos:"mid",vgChannel:"xc"})),Yt("y",e,{defaultPos:"mid",vgChannel:"yc"})),Et("size",e,{defaultValue:oce(e),vgChannel:r})),{[a]:nt(Se("thickness",n,t))})}};function oce(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,a=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),s=(t=Se("size",i,n,{vgChannel:a}))!==null&&t!==void 0?t:n.tick.bandSize;if(s!==void 0)return s;{const l=o?o.get("range"):void 0;if(l&&qa(l)&&Ce(l.step))return l.step*3/4;const u=Gg(n.view,a);return u*3/4}}const mm={arc:que,area:Wue,bar:Gue,circle:Que,geoshape:Hue,image:Yue,line:Vue,point:Kue,rect:ece,rule:tce,square:Zue,text:nce,tick:ace,trail:Xue};function sce(e){return ae([mg,pg,gne],e.mark)?lce(e):ae([gg],e.mark)?uce(e):vm(e)}const p3="faceted_path_";function lce(e){const t=tM(e.mark,e.encoding),n=vm(e,{fromPrefix:t.length>0?p3:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:p3+e.requestDataName(Ht),data:e.requestDataName(Ht),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const g3="stack_group_";function uce(e){const t=Nx.some(n=>Se(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=vm(e,{fromPrefix:g3}),i=e.scaleName(e.stack.fieldChannel),r=(f={})=>e.vgField(e.stack.fieldChannel,f),a=(f,d)=>{const h=[r({prefix:"min",suffix:"start",expr:d}),r({prefix:"max",suffix:"start",expr:d}),r({prefix:"min",suffix:"end",expr:d}),r({prefix:"max",suffix:"end",expr:d})];return`${f}(${h.map(p=>`scale('${i}',${p})`).join(",")})`};let o,s;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},ef(n.encode.update,["y","yc","y2","height",...Nx])),{x:{signal:a("min","datum")},x2:{signal:a("max","datum")},clip:{value:!0}}),s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},Ir(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},ef(n.encode.update,["x","xc","x2","width"])),{y:{signal:a("min","datum")},y2:{signal:a("max","datum")},clip:{value:!0}}),s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},Ir(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of Nx){const d=us(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):d&&(o[f]=nt(d)),d&&(n.encode.update[f]={value:0})}const l=e.fieldDef(e.stack.groupbyChannel),u=U(l)?[U(l)]:[];((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&u.push(U(l,{binSuffix:"end"}));const c=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];return o=c.reduce((f,d)=>{if(n.encode.update[d])return Object.assign(Object.assign({},f),{[d]:n.encode.update[d]});{const h=us(d,e.markDef,e.config);return h!==void 0?Object.assign(Object.assign({},f),{[d]:nt(h)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Ht),name:g3+e.requestDataName(Ht),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}else return vm(e)}function cce(e){const{encoding:t,stack:n,mark:i,markDef:r,config:a}=e,o=t.order;if(!M(o)&&qr(o)&&cN(o.value)||!o&&cN(Se("order",r,a)))return;if((M(o)||q(o))&&!n)return JI(o,{expr:"datum"});if(Zo(i)){const s=r.orient==="horizontal"?"y":"x",l=t[s];if(q(l)){const u=l.sort;if(M(u))return{field:U(l,{prefix:s,suffix:"sort_index",expr:"datum"})};if(fr(u))return{field:U({aggregate:n2(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(RI(u)){const c=e.fieldDef(u.encoding);return{field:U(c,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:U(l,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}return}function vm(e,t={fromPrefix:""}){const{mark:n,markDef:i,config:r}=e,a=rt(i.clip,fce(e),dce(e)),o=VI(i),s=e.encoding.key,l=cce(e),u=hce(e),c=Se("aria",i,r),f=mm[n].postEncodingTransform?mm[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:mm[n].vgMark},a?{clip:!0}:{}),o?{style:o}:{}),s?{key:s.field}:{}),l?{sort:l}:{}),u||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(Ht)},encode:{update:mm[n].encodeEntry(e)}}),f?{transform:f}:{})]}function fce(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function dce(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function hce(e){if(!e.component.selection)return null;const t=z(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=z(i.component.selection).length,i=i.parent;return n?{interactive:t>0}:null}class m3 extends s3{constructor(e,t,n,i={},r){var a,o;super(e,"unit",t,n,r,void 0,gM(e)?e.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=er(e.mark)?e.mark.type:e.mark;this.markDef=Lue(e.mark,(a=e.encoding)!==null&&a!==void 0?a:{},r,{graticule:e.data&&b2(e.data)});const l=this.encoding=oae((o=e.encoding)!==null&&o!==void 0?o:{},this.markDef,r);this.size=jue({encoding:l,size:gM(e)?Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):i}),this.stack=EM(s,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===_N,n=e&&jne.some(i=>se(e[i]));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return Sg.reduce((n,i)=>{var r;const a=ft(t[i]);return a&&(n[i]=(r=a.scale)!==null&&r!==void 0?r:{}),n},{})}initAxes(e){return ri.reduce((t,n)=>{const i=e[n];if(se(i)||n===He&&se(e.x2)||n===ct&&se(e.y2)){const r=se(i)?i.axis:void 0;t[n]=r&&Object.assign({},r)}return t},{})}initLegend(e){return Gne.reduce((t,n)=>{const i=ft(e[n]);if(i&&Yne(n)){const r=i.legend;t[n]=r&&Object.assign({},r)}return t},{})}parseData(){this.component.data=gm(this)}parseLayoutSize(){wue(this)}parseSelections(){this.component.selection=fse(this,this.selection)}parseMarkGroup(){this.component.mark=sce(this)}parseAxesAndHeaders(){this.component.axes=Cue(this)}assembleSelectionTopLevelSignals(e){return ese(this,e)}assembleSignals(){return[...fj(this),...Qoe(this,[])]}assembleSelectionData(e){return tse(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return M2(this)}assembleMarks(){var e;let t=(e=this.component.mark)!==null&&e!==void 0?e:[];return(!this.parent||!Vl(this.parent))&&(t=ij(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return cs(this.encoding,e)}fieldDef(e){const t=this.encoding[e];return hr(t)}typedFieldDef(e){const t=this.fieldDef(e);return Bn(t)?t:null}}class v3 extends J2{constructor(e,t,n,i,r){super(e,"layer",t,n,r,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},i),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map((o,s)=>{if(Hg(o))return new v3(o,this,this.getName("layer_"+s),a,r);if(Mr(o))return new m3(o,this,this.getName("layer_"+s),a,r);throw new Error(Ox(o))})}parseData(){this.component.data=gm(this);for(const e of this.children)e.parseData()}parseLayoutSize(){yue(this)}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of z(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){Due(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce((t,n)=>n.assembleSelectionTopLevelSignals(t),e)}assembleSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleSignals()),fj(this))}assembleLayoutSignals(){return this.children.reduce((e,t)=>e.concat(t.assembleLayoutSignals()),M2(this))}assembleSelectionData(e){return this.children.reduce((t,n)=>n.assembleSelectionData(t),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e;return}assembleLayout(){return null}assembleMarks(){return nse(this,this.children.flatMap(e=>e.assembleMarks()))}assembleLegends(){return this.children.reduce((e,t)=>e.concat(t.assembleLegends()),Mj(this))}}function lE(e,t,n,i,r){if(Ig(e))return new pm(e,t,n,r);if(Hg(e))return new v3(e,t,n,i,r);if(Mr(e))return new m3(e,t,n,i,r);if(Oae(e))return new Aue(e,t,n,r);throw new Error(Ox(e))}function pce(e,t={}){t.logger&&Hie(t.logger),t.fieldTitle&&UI(t.fieldTitle);try{const n=bM(Os(t.config,e.config)),i=$M(e,n),r=lE(i,null,"",void 0,n);r.parse(),Nle(r.component.data,r);const a=mce(r,gce(e,i.autosize,n,r),e.datasets,e.usermeta);return{spec:a,normalized:i}}finally{t.logger&&Yie(),t.fieldTitle&&Zre()}}function gce(e,t,n,i){const r=i.component.layoutSize.get("width"),a=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):Y(t)&&(t={type:t}),r&&a&&aoe(t.type)){if(r==="step"&&a==="step")j(WN()),t.type="pad";else if(r==="step"||a==="step"){const o=r==="step"?"width":"height";j(WN(Ag(o)));const s=o==="width"?"height":"width";t.type=ooe(s)}}return Object.assign(Object.assign(Object.assign({},z(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),RM(n)),RM(e))}function mce(e,t,n={},i){const r=e.config?Pae(e.config):void 0,a=[].concat(e.assembleSelectionData([]),pue(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),r?{config:r}:{}),i?{usermeta:i}:{})}class vce extends wM{mapUnit(e,{config:t}){if(e.encoding){const{encoding:n,transform:i}=e,{bins:r,timeUnits:a,aggregate:o,groupby:s,encoding:l}=i2(n,t),u=[...i||[],...r,...a,...o.length===0?[]:[{aggregate:o,groupby:s}]];return Object.assign(Object.assign(Object.assign({},e),u.length>0?{transform:u}:{}),{encoding:l})}else return e}}const yce=new vce();function bce(e,t){return yce.map(e,{config:t})}const wce=Zte.version;var xce=Object.freeze({__proto__:null,normalize:$M,version:wce,compile:pce,extractTransforms:bce}),Ece=Dm(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(i){var r=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g,a=r.exec(i).slice(1,3),o=a[0],s=a[1];return{library:o,version:s}}t.default=n}),y3=V3(Ece);const kce="vega-themes",_ce="2.8.3",Ace="Themes for stylized Vega and Vega-Lite visualizations.",Sce=["vega","vega-lite","themes","style"],Oce="BSD-3-Clause",Tce={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Cce=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],$ce="build/vega-themes.js",Dce="build/src/index.js",Rce="build/vega-themes.min.js",Fce="build/vega-themes.min.js",Nce="build/src/index.d.ts",Ice={type:"git",url:"https://github.com/vega/vega-themes.git"},Mce={prepare:"beemo create-config --silent",clean:"rm -rf build examples/build",prettierbase:"beemo prettier 'examples/*.{html,scss,css}'",eslintbase:"beemo eslint 'src/**/*.ts'",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",prebuild:"mkdir -p build",build:"tsc && rollup -c",postbuild:"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Typescript,Rollup 'yarn serve' 'tsc -w' 'rollup -c -w'"},jce={"@rollup/plugin-json":"^4.0.2","browser-sync":"^2.26.7",concurrently:"^5.1.0","gh-pages":"^2.2.0",rollup:"^2.1.0",terser:"^4.6.7",typescript:"^3.8.3",vega:"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.5.0"},Lce={vega:"*","vega-lite":"*"},Pce={module:"vega-lite-dev-config",drivers:["prettier","eslint"]};var zce={name:kce,version:_ce,description:Ace,keywords:Sce,license:Oce,author:Tce,contributors:Cce,main:$ce,module:Dce,unpkg:Rce,jsdelivr:Fce,typings:Nce,repository:Ice,scripts:Mce,devDependencies:jce,peerDependencies:Lce,beemo:Pce};const Of="#fff",Bce="#888",Uce={background:"#333",title:{color:Of},style:{"guide-label":{fill:Of},"guide-title":{fill:Of}},axis:{domainColor:Of,gridColor:Bce,tickColor:Of}},ms="#4572a7",qce={background:"#fff",arc:{fill:ms},area:{fill:ms},line:{stroke:ms,strokeWidth:2},path:{stroke:ms},rect:{fill:ms},shape:{stroke:ms},symbol:{fill:ms,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},vs="#30a2da",uE="#cbcbcb",Wce="#999",Gce="#333",b3="#f0f0f0",w3="#333",Hce={arc:{fill:vs},area:{fill:vs},axis:{domainColor:uE,grid:!0,gridColor:uE,gridWidth:1,labelColor:Wce,labelFontSize:10,titleColor:Gce,tickColor:uE,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:b3,group:{fill:b3},legend:{labelColor:w3,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:w3,titleFontSize:14,titlePadding:10},line:{stroke:vs,strokeWidth:2},path:{stroke:vs,strokeWidth:.5},rect:{fill:vs},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:vs},bar:{binSpacing:2,fill:vs,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},ys="#000",Yce={group:{fill:"#e5e5e5"},arc:{fill:ys},area:{fill:ys},line:{stroke:ys},path:{stroke:ys},rect:{fill:ys},shape:{stroke:ys},symbol:{fill:ys,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Vce=22,Xce="normal",x3="Benton Gothic, sans-serif",E3=11.5,Jce="normal",bs="#82c6df",cE="Benton Gothic Bold, sans-serif",k3="normal",_3=13,Tf={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},Kce={background:"#ffffff",title:{anchor:"start",color:"#000000",font:cE,fontSize:Vce,fontWeight:Xce},arc:{fill:bs},area:{fill:bs},line:{stroke:bs,strokeWidth:2},path:{stroke:bs},rect:{fill:bs},shape:{stroke:bs},symbol:{fill:bs,size:30},axis:{labelFont:x3,labelFontSize:E3,labelFontWeight:Jce,titleFont:cE,titleFontSize:_3,titleFontWeight:k3},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:x3,labelFontSize:E3,symbolType:"square",titleFont:cE,titleFontSize:_3,titleFontWeight:k3},range:{category:Tf["category-6"],diverging:Tf["fireandice-6"],heatmap:Tf["fire-7"],ordinal:Tf["fire-7"],ramp:Tf["fire-7"]}},ws="#ab5787",ym="#979797",Qce={background:"#f9f9f9",arc:{fill:ws},area:{fill:ws},line:{stroke:ws},path:{stroke:ws},rect:{fill:ws},shape:{stroke:ws},symbol:{fill:ws,size:30},axis:{domainColor:ym,domainWidth:.5,gridWidth:.2,labelColor:ym,tickColor:ym,tickWidth:.2,titleColor:ym},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},xs="#3e5c69",Zce={background:"#fff",arc:{fill:xs},area:{fill:xs},line:{stroke:xs},path:{stroke:xs},rect:{fill:xs},shape:{stroke:xs},symbol:{fill:xs},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},li="#1696d2",A3="#000000",efe="#FFFFFF",bm="Lato",fE="Lato",tfe="Lato",nfe="#DEDDDD",ife=18,Cf={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},rfe={background:efe,title:{anchor:"start",fontSize:ife,font:bm},axisX:{domain:!0,domainColor:A3,domainWidth:1,grid:!1,labelFontSize:12,labelFont:fE,labelAngle:0,tickColor:A3,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:bm},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:nfe,gridWidth:1,labelFontSize:12,labelFont:fE,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:bm,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:fE,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:bm,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Cf["six-groups-cat-1"],diverging:Cf["diverging-colors"],heatmap:Cf["diverging-colors"],ordinal:Cf["six-groups-seq"],ramp:Cf["shades-blue"]},area:{fill:li},rect:{fill:li},line:{color:li,stroke:li,strokeWidth:5},trail:{color:li,stroke:li,strokeWidth:0,size:1},path:{stroke:li,strokeWidth:.5},point:{filled:!0},text:{font:tfe,color:li,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:li,stroke:null}},arc:{fill:li},shape:{stroke:li},symbol:{fill:li,size:30}},Es="#3366CC",S3="#ccc",wm="Arial, sans-serif",afe={arc:{fill:Es},area:{fill:Es},path:{stroke:Es},rect:{fill:Es},shape:{stroke:Es},symbol:{stroke:Es},circle:{fill:Es},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:wm,fontSize:12},"guide-title":{font:wm,fontSize:12},"group-title":{font:wm,fontSize:12}},title:{font:wm,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:S3,tickColor:S3,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},ofe=zce.version;var sfe=Object.freeze({__proto__:null,version:ofe,dark:Uce,excel:qce,fivethirtyeight:Hce,ggplot2:Yce,latimes:Kce,quartz:Qce,vox:Zce,urbaninstitute:rfe,googlecharts:afe}),lfe=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const O3="vg-tooltip-element",ufe={offsetX:10,offsetY:10,id:O3,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:cfe,maxDepth:2};function cfe(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function ffe(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return lfe.toString().replace(O3,e)}var dfe=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function hfe(e,t,n){if(M(e))return`[${e.map(i=>t(Y(i)?i:T3(i,n))).join(", ")}]`;if(K(e)){let i="";const r=e,{title:a,image:o}=r,s=dfe(r,["title","image"]);a&&(i+=`<h2>${t(a)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){i+="<table>";for(const u of l){let c=s[u];if(c===void 0)continue;K(c)&&(c=T3(c,n)),i+=`<tr><td class="key">${t(u)}:</td><td class="value">${t(c)}</td></tr>`}i+="</table>"}return i||"{}"}return t(e)}function pfe(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function T3(e,t){return JSON.stringify(e,pfe(t))}function gfe(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let a=e.clientY+i;return a+t.height>window.innerHeight&&(a=+e.clientY-i-t.height),{x:r,y:a}}class mfe{constructor(e){this.options=Object.assign(Object.assign({},ufe),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const n=document.createElement("style");n.setAttribute("id",this.options.styleId),n.innerHTML=ffe(t);const i=document.head;i.childNodes.length>0?i.insertBefore(n,i.childNodes[0]):i.appendChild(n)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,i){if(i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=hfe(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:r,y:a}=gfe(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${r}px`)}}function vfe(e,t,n){const i=e.open(t),r=1e4,a=250,{origin:o}=new URL(t);let s=~~(r/a);function l(c){c.source===i&&(s=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function u(){if(s<=0)return;i.postMessage(n,o),setTimeout(u,a),s-=1}setTimeout(u,a)}var yfe=`.vega-embed {
  position: relative;
  display: inline-block; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: scroll;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function C3(e,...t){for(const n of t)bfe(e,n);return e}function bfe(e,t){for(const n of Object.keys(t))nu(e,n,t[n],!0)}var dE;const to=Dte;let $f=xce;const xm=typeof window!="undefined"?window:void 0;$f===void 0&&((dE=xm==null?void 0:xm.vl)===null||dE===void 0?void 0:dE.compile)&&($f=xm.vl);const wfe={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},xfe={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Df={vega:"Vega","vega-lite":"Vega-Lite"},Em={vega:to.version,"vega-lite":$f?$f.version:"not available"},Efe={vega:e=>e,"vega-lite":(e,t)=>$f.compile(e,{config:t}).spec},kfe=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`;function _fe(e){return typeof e=="function"}function $3(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+a),o.document.title=`${Df[i]} JSON Source`}function Afe(e,t){var n;if(e.$schema){const i=y3(e.$schema);t&&t!==i.library&&console.warn(`The given visualization spec is written in ${Df[i.library]}, but mode argument sets ${(n=Df[t])!==null&&n!==void 0?n:t}.`);const r=i.library;return jE.satisfies(Em[r],`^${i.version.slice(1)}`)||console.warn(`The input spec uses ${Df[r]} ${i.version}, but the current version of ${Df[r]} is v${Em[r]}.`),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function Sfe(e){return!!(e&&"load"in e)}function Ofe(e,t,n={}){var i,r,a;return Rf(this,void 0,void 0,function*(){const o=Sfe(n.loader)?n.loader:to.loader(n.loader),s=Y(t)?JSON.parse(yield o.load(t)):t,l=yield D3((i=s.usermeta&&s.usermeta.embedOptions)!==null&&i!==void 0?i:{},o),u=yield D3(n,o),c=Object.assign(Object.assign({},C3(u,l)),{config:Os((r=u.config)!==null&&r!==void 0?r:{},(a=l.config)!==null&&a!==void 0?a:{})});return yield Tfe(e,s,c,o)})}function D3(e,t){var n;return Rf(this,void 0,void 0,function*(){const i=Y(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},r=Y(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),r?{patch:r}:{}),i?{config:i}:{})})}function Tfe(e,t,n={},i){var r,a,o,s,l,u;return Rf(this,void 0,void 0,function*(){const c=n.theme?Os(sfe[n.theme],(r=n.config)!==null&&r!==void 0?r:{}):n.config,f=na(n.actions)?n.actions:C3({},wfe,(a=n.actions)!==null&&a!==void 0?a:{}),d=Object.assign(Object.assign({},xfe),n.i18n),h=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(s=n.logLevel)!==null&&s!==void 0?s:to.Warn,g=(l=n.downloadFileName)!==null&&l!==void 0?l:"visualization";if(n.defaultStyle!==!1){const O="vega-embed-style";if(!document.getElementById(O)){const S=document.createElement("style");S.id=O,S.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?yfe.toString():n.defaultStyle,document.head.appendChild(S)}}const m=Afe(t,n.mode);let v=Efe[m](t,c);if(m==="vega-lite"&&v.$schema){const O=y3(v.$schema);jE.satisfies(Em.vega,`^${O.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${O.version}, but current version is v${Em.vega}.`)}const y=typeof e=="string"?document.querySelector(e):e;if(!y)throw Error(`${e} does not exist`);y.classList.add("vega-embed"),f&&y.classList.add("has-actions"),y.innerHTML="";const b=n.patch;b&&(b instanceof Function?v=b(v):v=Nf(v,b,!0,!1).newDocument),n.formatLocale&&to.formatLocale(n.formatLocale),n.timeFormatLocale&&to.timeFormatLocale(n.timeFormatLocale);const{ast:E}=n,x=to.parse(v,m==="vega-lite"?{}:c,{ast:E}),k=new to.View(x,Object.assign({loader:i,logLevel:p,renderer:h},E?{expr:to.expressionInterpreter}:{}));if(n.tooltip!==!1){let O;_fe(n.tooltip)?O=n.tooltip:O=new mfe(n.tooltip===!0?{}:n.tooltip).call,k.tooltip(O)}let{hover:w}=n;if(w===void 0&&(w=m==="vega"),w){const{hoverSet:O,updateSet:S}=typeof w=="boolean"?{}:w;k.hover(O,S)}n&&(n.width!=null&&k.width(n.width),n.height!=null&&k.height(n.height),n.padding!=null&&k.padding(n.padding)),yield k.initialize(e).runAsync();let A;if(f!==!1){let O=y;if(n.defaultStyle!==!1){const T=document.createElement("details");T.title=d.CLICK_TO_VIEW_ACTIONS,y.append(T),O=T;const D=document.createElement("summary");D.innerHTML=kfe,T.append(D),A=I=>{T.contains(I.target)||T.removeAttribute("open")},document.addEventListener("click",A)}const S=document.createElement("div");if(O.append(S),S.classList.add("vega-actions"),f===!0||f.export!==!1){for(const T of["svg","png"])if(f===!0||f.export===!0||f.export[T]){const D=d[`${T.toUpperCase()}_ACTION`],I=document.createElement("a");I.text=D,I.href="#",I.target="_blank",I.download=`${g}.${T}`,I.addEventListener("mousedown",function(C){return Rf(this,void 0,void 0,function*(){C.preventDefault();const N=yield k.toImageURL(T,n.scaleFactor);this.href=N})}),S.append(I)}}if(f===!0||f.source!==!1){const T=document.createElement("a");T.text=d.SOURCE_ACTION,T.href="#",T.addEventListener("click",function(D){var I,C;$3($m(t),(I=n.sourceHeader)!==null&&I!==void 0?I:"",(C=n.sourceFooter)!==null&&C!==void 0?C:"",m),D.preventDefault()}),S.append(T)}if(m==="vega-lite"&&(f===!0||f.compiled!==!1)){const T=document.createElement("a");T.text=d.COMPILED_ACTION,T.href="#",T.addEventListener("click",function(D){var I,C;$3($m(v),(I=n.sourceHeader)!==null&&I!==void 0?I:"",(C=n.sourceFooter)!==null&&C!==void 0?C:"","vega"),D.preventDefault()}),S.append(T)}if(f===!0||f.editor!==!1){const T=(u=n.editorUrl)!==null&&u!==void 0?u:"https://vega.github.io/editor/",D=document.createElement("a");D.text=d.EDITOR_ACTION,D.href="#",D.addEventListener("click",function(I){vfe(window,T,{config:c,mode:m,renderer:h,spec:$m(t)}),I.preventDefault()}),S.append(D)}}function _(){A&&document.removeEventListener("click",A),k.finalize()}return{view:k,spec:t,vgSpec:v,finalize:_}})}export default Ofe;
